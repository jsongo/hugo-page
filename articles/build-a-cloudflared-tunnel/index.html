<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="通过 cloudflare 提供的免费软件和服务，搭建一条免费的 Tunnel 穿透内网，并指定自定义域名来访问你的内网服务，关键还没有网速限制"><title>免费的花生壳 - cloudflared</title>
<link rel=canonical href=https://www.jsongo.top/articles/build-a-cloudflared-tunnel/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="免费的花生壳 - cloudflared"><meta property='og:description' content="通过 cloudflare 提供的免费软件和服务，搭建一条免费的 Tunnel 穿透内网，并指定自定义域名来访问你的内网服务，关键还没有网速限制"><meta property='og:url' content='https://www.jsongo.top/articles/build-a-cloudflared-tunnel/'><meta property='og:site_name' content='Ethan 的思考札记'><meta property='og:type' content='article'><meta property='article:section' content='Articles'><meta property='article:tag' content='IT/折腾/cloudflare'><meta property='og:image' content='https://cdn.jsongo.top/banners/f53c5884b5505531f32ad8fa0fc57247.jpg'><meta name=twitter:title content="免费的花生壳 - cloudflared"><meta name=twitter:description content="通过 cloudflare 提供的免费软件和服务，搭建一条免费的 Tunnel 穿透内网，并指定自定义域名来访问你的内网服务，关键还没有网速限制"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://cdn.jsongo.top/banners/f53c5884b5505531f32ad8fa0fc57247.jpg'><link rel="shortcut icon" href=https://cdn.jsongo.top/mc/favicon.jpg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu7049013329120086875.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Ethan 的思考札记</a></h1><h2 class=site-description>Keeping Grit!</h2></div></header><ol class=menu id=main-menu><li><a href=/about target=_blank><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About Me</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#创建-tunnel>创建 Tunnel</a></li><li><a href=#启动接入>启动、接入</a></li></ul></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/articles/build-a-cloudflared-tunnel/><img src=https://cdn.jsongo.top/banners/f53c5884b5505531f32ad8fa0fc57247.jpg loading=lazy alt="Featured image of post 免费的花生壳 - cloudflared"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/articles/build-a-cloudflared-tunnel/>免费的花生壳 - cloudflared</a></h2><h3 class=article-subtitle>通过 cloudflare 提供的免费软件和服务，搭建一条免费的 Tunnel 穿透内网，并指定自定义域名来访问你的内网服务，关键还没有网速限制</h3></div></div></header><section class=article-content><p>一般我们习惯用花生壳来实现内网穿透，不过花生壳本身是要收钱的，它的域名也要收钱，流量也收一次钱，而且给了钱之后它的流量带宽也受到限制，正常是 1M 带宽下载速度只有 100 多 k，用起来很难受，加点带宽就要加不少钱。<br>其实 cloudflare 本身就提供了一个免费的 cloudflared 的 tunnel 工具，直接下载运行就行。如果用 Docker 的话可以用这个镜像：<a class=link href=https://hub.docker.com/r/cloudflare/cloudflared target=_blank rel=noopener>hub.docker.com/r/cloudflare/cloudflared</a> 里面也有一些简单的指引。</p><h1 id=简单使用>简单使用</h1><p>一条命令就可以搞定：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cloudflared tunnel --no-autoupdate --hello-world
</span></span></code></pre></div><p>不过这么跑，比较依赖于不需要 Cloudflare 帐户的公共 trycloudflare.com，很不稳定，我之前试用过，经常断。要实际上线使用的话，还是得自己注册一个 cloudflare 账号，下面介绍。</p><h1 id=注册一个-tunnel>注册一个 Tunnel</h1><p>到 <a class=link href=https://dash.teams.cloudflare.com/%e2%81%a0 target=_blank rel=noopener>Cloudflare One</a> 上注册一个 Cloudflare Zero Trust 域名，选 Free 就可以了<br><img src=https://cdn.jsongo.top/2024/12/420352862a7523747b97d596ff767b81.webp loading=lazy><br>接下去它会让你绑定一个支付卡，即使选的是免费的。这是海外各类服务的常见操作，因为收费计划可能会变，而且你使用时也可能会超额，所以先让你把扣费的方式留好，以备后面需要的时候能扣到钱。<br>注册完后，添加一个 application<br><img src=https://cdn.jsongo.top/2024/12/8f84310e20e4607177bc7b2cbc75b440.webp loading=lazy><br>选 private network<br><img src=https://cdn.jsongo.top/2024/12/11b0e1407e478978825bc52900b68eeb.webp loading=lazy></p><p>自己取一个名字（不跟别人重复就行）</p><h2 id=创建-tunnel>创建 Tunnel</h2><p>在下图中的菜单里找到创建的地方，选 Cloudflared。<br><img src=https://cdn.jsongo.top/2024/12/5b690dff91048eeaeb5663f168c837a2.webp loading=lazy><br><img src=https://cdn.jsongo.top/2024/12/8652218a31d2d78c56aa4f0a43edcf8d.webp loading=lazy><br>下一步，取得 token：<br><img src=https://cdn.jsongo.top/2024/12/29b1a001c14459ba21b349c12cb4288d.webp loading=lazy><br>如上图，划线处就是你的 token，先记下来，下面用。</p><h2 id=启动接入>启动、接入</h2><p>创建完之后，在本地运行 cloudflared 的命令：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cloudflare tunnel --no-autoupdate run --token xxx
</span></span></code></pre></div><p>如果使用 docker 的话，可以用这个 compose yml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#39;3.8&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>cloudflared</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>cloudflare/cloudflared:latest</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>container_name</span>: <span style=color:#ae81ff>cloudflared</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>command</span>: <span style=color:#ae81ff>tunnel --no-autoupdate run --token xxxx</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>unless-stopped</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>network_mode</span>: <span style=color:#ae81ff>host</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>dns</span>:
</span></span><span style=display:flex><span>        - <span style=color:#ae81ff>1.1.1.1</span>
</span></span></code></pre></div><p>其中，xxx 换成你自己的 token。<br>如果你家里有个服务器或 NAS，其实 docker 是比较合适的，它可以一直在线跑。<br>创建完之后，在同一个界面里可以看到已经有一个设备连接上来了：<br><img src=https://cdn.jsongo.top/2024/12/3c23fd4e318bb3198e69dd369ed24c29.webp loading=lazy alt=|725><br>再下一步，public hostnames 里添加一个你转到 cloudflare 来解析的域名，加一个子域名。同时 Service 填写你内网的某个服务的地址，如你的 nginx 网关等。<br><img src=https://cdn.jsongo.top/2024/12/0e9d6a0c0afadbd8100b681aab58a962.webp loading=lazy><br>再下一步就回到了列表页，可以看到你的 tunnel 已经在跑了：<br><img src=https://cdn.jsongo.top/2024/12/f39e1282f64410a6862142f136b7108b.webp loading=lazy alt=|775><br>回到你的 cloudflare DNS 配置页面，可以看到它帮你添加了一个 cname，说明已经成功了<br><img src=https://cdn.jsongo.top/2024/12/292affb6bfeac40389684bb915b7bce0.webp loading=lazy alt=|700>
现在你可以用刚配置的域名来访问你的内网服务了。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/it/%E6%8A%98%E8%85%BE/cloudflare/>IT/折腾/Cloudflare</a></section></footer></article><script src=https://giscus.app/client.js data-repo=jsongo/hugo-page data-repo-id=R_kgDONQf4yA data-category=Announcements data-category-id=DIC_kwDONQf4yM4CkfAr data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"preferred_color_scheme":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2024 Ethan 的思考札记</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>