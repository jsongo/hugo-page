<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no"><meta name=description content="主要介绍了如何在 Azure Functions 中使用自定义 Docker 镜像，包括创建和配置 Dockerfile，以及将镜像推送到 Azure 容器注册表（ACR）。此外，还讨论了在 Azure 平台上使用这些镜像的步骤和相关的计划选择。"><title>azure Function 自定义镜像</title>
<link rel=canonical href=https://www.jsongo.top/articles/azure-function-custom-containers/><link rel=stylesheet href=/scss/style.min.b4cd21f325cfc998a0d460813276c3ae35b324142278563c2c80066f5d320e0c.css><script src=https://res.wx.qq.com/open/js/jweixin-1.6.0.js></script><script>wx.ready(function(){wx.updateAppMessageShareData({title:"azure Function 自定义镜像",desc:"主要介绍了如何在 Azure Functions 中使用自定义 Docker 镜像，包括创建和配置 Dockerfile，以及将镜像推送到 Azure 容器注册表（ACR）。此外，还讨论了在 Azure 平台上使用这些镜像的步骤和相关的计划选择。",link:"https://www.jsongo.top/articles/azure-function-custom-containers/",imgUrl:"https://cdn.jsongo.top/banners/772c64fbb07e3cd46573602f922a7829.jpg",success:function(){}})})</script><meta property='og:title' content="azure Function 自定义镜像"><meta property='og:description' content="主要介绍了如何在 Azure Functions 中使用自定义 Docker 镜像，包括创建和配置 Dockerfile，以及将镜像推送到 Azure 容器注册表（ACR）。此外，还讨论了在 Azure 平台上使用这些镜像的步骤和相关的计划选择。"><meta property='og:url' content='https://www.jsongo.top/articles/azure-function-custom-containers/'><meta property='og:site_name' content='Ethan 的思考札记'><meta property='og:type' content='article'><meta property='article:section' content='Articles'><meta property='article:tag' content='IT/折腾/azure'><meta property='article:published_time' content='2025-01-05T11:25:49+08:00'><meta property='article:modified_time' content='2025-01-05T11:25:49+08:00'><meta property='og:image' content='https://cdn.jsongo.top/banners/772c64fbb07e3cd46573602f922a7829.jpg'><meta name=twitter:title content="azure Function 自定义镜像"><meta name=twitter:description content="主要介绍了如何在 Azure Functions 中使用自定义 Docker 镜像，包括创建和配置 Dockerfile，以及将镜像推送到 Azure 容器注册表（ACR）。此外，还讨论了在 Azure 平台上使用这些镜像的步骤和相关的计划选择。"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://cdn.jsongo.top/banners/772c64fbb07e3cd46573602f922a7829.jpg'><link rel="shortcut icon" href=https://cdn.jsongo.top/mc/favicon.jpg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu7049013329120086875.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>Ethan 的思考札记</a></h1><h2 class=site-description>Keeping Grit!</h2></div></header><ol class=menu id=main-menu><li><a href=/page/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/page/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/page/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li><a href=/about target=_blank><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>About Me</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ul><li><a href=#创建自己的镜像>创建自己的镜像</a><ul><li><a href=#创建-dockerfile>创建 Dockerfile</a></li><li><a href=#注册>注册</a></li><li><a href=#构建>构建</a></li><li><a href=#用-azure-cli-更新镜像>用 Azure CLI 更新镜像</a></li><li><a href=#推到-azure-平台上>推到 Azure 平台上</a></li></ul></li><li><a href=#使用镜像>使用镜像</a><ul><li><a href=#创建函数应用>创建函数应用</a></li><li><a href=#创建函数容器环境container-apps>创建函数容器环境（Container Apps）</a></li></ul></li><li><a href=#应用开发和部署>应用开发和部署</a></li><li><a href=#其它>其它</a><ul><li><a href=#关于-premium-plan-和-dedicated-plan>关于 Premium Plan 和 Dedicated Plan</a><ul><li><a href=#premium-plan>Premium Plan</a></li><li><a href=#dedicated-plan>Dedicated Plan</a></li><li><a href=#选择>选择</a></li></ul></li></ul></li><li><a href=#参考>参考</a></li></ul></nav></div></section><section class="widget tagCloud"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg></div><h2 class="widget-title section-title">Tags</h2><div class=tagCloud-tags><a href=/tags/it/%E6%8A%98%E8%85%BE/azure/ class=font_size_5>IT/折腾/Azure
</a><a href=/tags/ai/diffusion/ class=font_size_3>AI/Diffusion
</a><a href=/tags/area/thinking/ class=font_size_3>Area/Thinking
</a><a href=/tags/%E8%BE%93%E5%85%A5/%E4%B9%A6/ class=font_size_2>输入/书
</a><a href=/tags/ai/%E5%8E%9F%E7%90%86/ class=font_size_1>AI/原理
</a><a href=/tags/ai/%E5%B7%A5%E5%85%B7/ class=font_size_1>AI/工具
</a><a href=/tags/area/life/2024/ class=font_size_1>Area/Life/2024
</a><a href=/tags/area/life/weekly/ class=font_size_1>Area/Life/Weekly
</a><a href=/tags/area/%E6%80%9D%E8%80%83/ class=font_size_1>Area/思考
</a><a href=/tags/import/flowus/ class=font_size_1>Import/Flowus</a></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/articles/azure-function-custom-containers/><img src=https://cdn.jsongo.top/banners/772c64fbb07e3cd46573602f922a7829.jpg loading=lazy alt="Featured image of post azure Function 自定义镜像"></a></div><div class=article-details><div class=article-title-wrapper><h2 class=article-title><a href=/articles/azure-function-custom-containers/>azure Function 自定义镜像</a></h2><h3 class=article-subtitle>主要介绍了如何在 Azure Functions 中使用自定义 Docker 镜像，包括创建和配置 Dockerfile，以及将镜像推送到 Azure 容器注册表（ACR）。此外，还讨论了在 Azure 平台上使用这些镜像的步骤和相关的计划选择。</h3></div><footer class=article-tags><div><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<a href=/tags/IT/%e6%8a%98%e8%85%be/azure>IT/折腾/azure</a></div></footer><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Sun, Jan 05, 2025</time></div></footer></div></header><section class=article-content><p>Azure Function 默认是跑在它官方的 <a class=link href=https://hub.docker.com/r/microsoft/azure-functions-base target=_blank rel=noopener>microsoft/azure-functions-base</a> 这个镜像上。当然你可以定义自己的镜像，Azure 开放了这个能力。本文主要介绍如何操作。</p><h1 id=创建自己的镜像>创建自己的镜像</h1><h2 id=创建-dockerfile>创建 Dockerfile</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>func init --docker
</span></span></code></pre></td></tr></table></div></div><p>它会初始化一个 Dockerfile 等文件，如果你只需要 Dockerfile 可以把参数改成 <code>--docker-only</code>。<br>生成的 Dockerfile 里面有如下基础的配置：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=c># To enable ssh &amp; remote debugging on app service change the base image to the one below</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># FROM mcr.microsoft.com/azure-functions/python:4-python3.12-appservice</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>FROM</span><span class=s> mcr.microsoft.com/azure-functions/python:4-python3.12</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>ENV</span> <span class=nv>AzureWebJobsScriptRoot</span><span class=o>=</span>/home/site/wwwroot <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    <span class=nv>AzureFunctionsJobHost__Logging__Console__IsEnabled</span><span class=o>=</span>true<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> requirements.txt /<span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> pip install -r /requirements.txt<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> . /home/site/wwwroot<span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>这些不要改动。不过可以在上面添加你自己的东西，比如我在做视频相关的处理，所以我需要一个 ffmpeg 库安装上去，所以我添加了如下的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Dockerfile data-lang=Dockerfile><span class=line><span class=cl><span class=c># 安装 ffmpeg</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> apt-get update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get install -y ffmpeg <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    apt-get clean <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>    rm -rf /var/lib/apt/lists/*<span class=err>
</span></span></span></code></pre></td></tr></table></div></div><h2 id=注册>注册</h2><p>在 <a class=link href=https://portal.azure.com/#browse/Microsoft.ContainerRegistry%2Fregistries target=_blank rel=noopener>Azure Container Registry</a>（容器注册表）这里注册一个你自己的命令空间。<br><img src=https://cdn.jsongo.top/2025/01/463f2950bea861c9729cb23cdc5a6478.webp width=675 loading=lazy alt=|675><br>创建完你就有一个自己的专属 Azure 镜像的域，如我这里的是 <code>jsongo.azurecr.io</code>。<br>在 CLI 中登录：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az acr login --name jsongo
</span></span></code></pre></td></tr></table></div></div><p>如果你的 <code>az</code> 命令之前登录过，这里直接就成功了。记住后面再遇到 docker 操作提示登录的问题，直接运行上面这个命令即可。<br>接下去你就可以构建镜像，并把它推到你的这个域上了。</p><h2 id=构建>构建</h2><p>首先你本地得有一个 Docker 软件安装并运行起来，可以到 Docker 官网上去下载，这个比较简单。当然如果你有一个线上的虚拟机，那就直接在上面处理也行，只不过还得在上面安装 azure 的 CLI。上一篇已经介绍过了、不再赘述。<br>接下去在本地构建上面创建的镜像。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker build --tag jsongo/azure-video:0.1.0 .
</span></span></code></pre></td></tr></table></div></div><p>如下示例。<br><img src=https://cdn.jsongo.top/2025/01/a28f11024d5a8fe4f5c8ad0337479ee7.webp width=750 loading=lazy alt=|750><br>比如我这个镜像，由于加了 ffmpeg 之后，构建完成时整个镜像很大，一下子撑到了 2G。<br><img src=https://cdn.jsongo.top/2025/01/4f71b5b5f343bcc4b0db975f24bfce60.webp width=700 loading=lazy alt=|700><br>构建完，试着把它运行起来看看：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker run --rm -e <span class=nv>WEBSITES_INCLUDE_CLOUD_CERTS</span><span class=o>=</span><span class=nb>true</span> -p 8080:80 --name test-azure-video -it jsongo.azurecr.io/azure-video
</span></span></code></pre></td></tr></table></div></div><p>当然你的 auth level 要设置成 anonymous authorization 才可以直接访问，如果没问题它能正常跑起来。接下去在本地 curl 一下 8080 端口就可以看到有没有正确返回。</p><h2 id=用-azure-cli-更新镜像>用 Azure CLI 更新镜像</h2><p>Azure 也提供了相应的指令用于更新你的镜像。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az acr build --registry jsongo --image jsongo.azurecr.io/azure-video:0.2.0 .
</span></span></code></pre></td></tr></table></div></div><p>这里我们构建一个 0.2.0 版本，它同时会把新构建完的镜像 push 到 Registry 里。<br><img src=https://cdn.jsongo.top/2025/01/30c03710c34bfd64f9299837e3ee22ce.webp width=750 loading=lazy alt=|750></p><h2 id=推到-azure-平台上>推到 Azure 平台上</h2><p>先打个 tag，刚构建时，默认是用的 dockerhub 的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker tag jsongo/azure-video:0.1.0 jsongo.azurecr.io/azure-video:0.1.0
</span></span></code></pre></td></tr></table></div></div><p>其中 <code>jsongo.azurecr.io</code> 就是我们上面创建的域，它标识了一个 Docker Registry 的地址（默认是 <code>docker.io</code>）。<br>接下去运行 docker push 的时候，就可以找到 azure 的 Registry。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>docker push jsongo.azurecr.io/azure-video:0.1.0
</span></span></code></pre></td></tr></table></div></div><p>然后就是等了。我这个镜像 2G+，着实是要等好一会儿。<br>Push 完，打开你的 <a class=link href=https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.ContainerRegistry%2Fregistries target=_blank rel=noopener>容器注册表页面</a>，在这里就可以看到你刚推送上去的镜像了。<br><img src=https://cdn.jsongo.top/2025/01/fb1175d6eaf44464ccf31a4c1a79046b.webp width=750 loading=lazy alt=|750></p><h1 id=使用镜像>使用镜像</h1><p>下面介绍两种使用镜像的方式，分别对应下图中的两个红框。<br><img src=https://cdn.jsongo.top/2025/01/05e3ba7519cfcf0353ab94e9920cd241.webp width=800 loading=lazy alt=|800></p><h2 id=创建函数应用>创建函数应用</h2><p>创建一个 Function 如果要使用自己的镜像，“弹性消耗”是不支持的。要选“高级计划”或“应用服务”才行。<br><img src=https://cdn.jsongo.top/2025/01/61ccd18ce92bbd84fe47a4bdf732ff55.webp width=600 loading=lazy alt=|600><br>一步步往下直到创建完成。<br><img src=https://cdn.jsongo.top/2025/01/db86acc839e4545ce6e255d56a6bc911.webp loading=lazy><br>接下去就可以打开 azure 函数首页，去看刚部署的函数。<br><img src=https://cdn.jsongo.top/2025/01/6efc5b6d235cc4e37d11ef1a7b0c52de.webp width=750 loading=lazy alt=|750><br>至于哪些计划可以支持自定义容器部署可以参考这里：<a class=link href=https://learn.microsoft.com/en-us/azure/azure-functions/functions-scale target=_blank rel=noopener>Azure Functions scale and hosting | Microsoft Learn</a>。<br><img src=https://cdn.jsongo.top/2025/01/3ef8be06d615efb0daf5495e872d716e.webp width=725 loading=lazy alt=|725></p><h2 id=创建函数容器环境container-apps>创建函数容器环境（Container Apps）</h2><p>其实如果要更好的跟 Azure Function 结合的话，可以试下“容器应用环境”(Azure Container Apps environment)，它可以用于你已经在跑的函数中。<br>同样我们也在首页创建一个，在“基本”（basics）中填写一些基础信息，这里不再赘述，比较简单。<br><img src=https://cdn.jsongo.top/2025/01/8214ec925893f7b328ad5d50499b3e4d.webp width=800 loading=lazy alt=|800><br>接着到“部署”选项卡中，设置你刚 push 上去的镜像。先把“使用快速入门图像”勾选去掉，另外映像类型选专用的（Private），如图一样填写你的镜像信息。<br><img src=https://cdn.jsongo.top/2025/01/31737bdba1d7f1ee2ca7666308ac3471.webp loading=lazy><br>费用是按需支付的，跟之前的两种方式不太一样：<br><img src=https://cdn.jsongo.top/2025/01/e6a5c97b8e6c5a26b8b16c017f57bc69.webp width=500 loading=lazy alt=|500><br>而且单个机子的配置选项也足够灵活，如图。<br><img src=https://cdn.jsongo.top/2025/01/e3e7946cc1641c5515fbb230dca83c28.webp width=275 loading=lazy alt=|275></p><h1 id=应用开发和部署>应用开发和部署</h1><p>如果使用了第一种方式创建了函数应用，它的部署方式就有所变化。之前在 [[azure serverless]] 里做过一些简单的介绍，当时提到发布方式比较简单：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>func azure functionapp publish xxx
</span></span></code></pre></td></tr></table></div></div><p>不过现在我们是把代码打包到容器里，所以没法再使用这种方式去部署。现在需要改成 azure CLI 提供的 build 命令，其实在上文中提过了，只不过要稍加修改。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>az acr build --registry jsongo --image jsongo.azurecr.io/azure-video:latest .
</span></span></code></pre></td></tr></table></div></div><p>它会重新构建并</p><h1 id=其它>其它</h1><h2 id=关于-premium-plan-和-dedicated-plan>关于 Premium Plan 和 Dedicated Plan</h2><p>这些 Plan 其实都涉及到了多种服务和资源，根据不同情况来选择。</p><h3 id=premium-plan>Premium Plan</h3><ul><li><strong>计算资源</strong>：通常指高性能的虚拟机或计算实例等。以虚拟机为例，不同规格的虚拟机收费不同，一般每小时的费用在 0.5 美元到几美元不等，如 DS 系列虚拟机可能比普通系列的虚拟机费用要高，高性能的虚拟机每小时费用可能要 0.834 美元甚至更高。</li><li><strong>存储资源</strong>：如果是 Premium Storage，收费标准通常按磁盘的最大容量阶梯收费，而不是用多少算多少，且其读写操作也可能会有额外的收费，如每 10 万个存储事务为 3 元，不过每月一般会提供 100 亿次免费的事务 13。</li><li><strong>网络资源</strong>：对于使用流量较大的公网 IP，每月费用可能在 1.2 美元及以上，负载均衡器每小时也会有一定的费用，如标准负载均衡器每小时的费用是 0.016 美元左右。</li></ul><h3 id=dedicated-plan>Dedicated Plan</h3><ul><li><strong>计算资源</strong>：如 Dedicated Host，一般会根据主机的配置和租用时长收费，一台配置中等的 Dedicated Host 每月费用可能在 1000 美元到 3000 美元左右。<ul><li><strong>存储资源</strong>：若使用专用的存储设备或特定的存储方案，收费也会因存储容量、性能要求等因素而异，通常专用存储的费用相对较高，每 GB 每月的费用可能在 0.2 美元到 0.5 美元之间，具体取决于存储类型和性能等级。</li></ul></li><li><strong>网络资源</strong>：如果需要专用的网络设备或带宽保证，费用也会相应增加，专用网络带宽每 Mbps 每月的费用可能在 10 美元到 50 美元左右。</li></ul><h3 id=选择>选择</h3><p>可以根据需求来选择：</p><ul><li>如果对计算性能要求极高，但对资源的独占性要求不是特别高，Premium plan 可能更合适，因为它可以提供高性能的计算资源，同时成本相对较低。</li><li>如果对安全性、合规性以及资源的独占性有严格要求，需要完全隔离的计算和存储环境，那么 Dedicated plan 可能是更好的选择，尽管费用相对较高，但能满足特定的业务需求。<br>实在不好选择，直接就选 Premium plan，比较经济些，一般也用不到比较太高级的配置。它目前有以下三个配置可以选：<br><img src=https://cdn.jsongo.top/2025/01/c0f3dcf1e6ca0c79664d2697b121675b.webp width=450 loading=lazy alt=|450><br>不过价格上… 是有点高些，具体可以看这里：<a class=link href=https://azure.microsoft.com/zh-cn/pricing/details/functions/ target=_blank rel=noopener>定价 - Functions | Microsoft Azure</a>。<br>小时视角：<br><img src=https://cdn.jsongo.top/2025/01/bcac629924bd882bed230aa3781131f6.webp width=850 loading=lazy alt=|850><br>月视角：<br><img src=https://cdn.jsongo.top/2025/01/cc859d4f93fc2c606083a65c5d005ff7.webp width=800 loading=lazy alt=|800><br>补：后来在函数的设置里，看到了比较实际的价格。<br><img src=https://cdn.jsongo.top/2025/01/cfd8d327d4b15dd049054f2fcf6223d7.webp width=800 loading=lazy alt=|800><br>这个看起来比较切合实际，1 小时不到 2 块。</li></ul><h1 id=参考>参考</h1><ul><li><a class=link href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-how-to-custom-container?tabs=core-tools,acr,azure-cli2,azure-cli&amp;pivots=container-apps#creating-containerized-function-apps" target=_blank rel=noopener>Working with Azure Functions in containers | Microsoft Learn</a></li><li><a class=link href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-create-container-registry?tabs=acr,bash&amp;pivots=programming-language-python#build-the-container-image-and-verify-locally" target=_blank rel=noopener>Create Azure Functions in a local Linux container | Microsoft Learn</a></li><li><a class=link href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-roles?tabs=azure-cli" target=_blank rel=noopener>Azure Container Registry roles and permissions - Azure Container Registry | Microsoft Learn</a></li><li><a class=link href=https://zone.huoxian.cn/d/2594-azure-functions target=_blank rel=noopener>使用自定义云容器在 Azure Functions 中增强云安全性</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/it/%E6%8A%98%E8%85%BE/azure/>IT/折腾/Azure</a></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Sun, Jan 05, 2025 11:25 +0800</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/articles/azure-function-triggers/><div class=article-image><img src=https://cdn.jsongo.top/banners/54ae9a6d9d56a2e58c20dc50f584fd39.jpg loading=lazy data-key=azure-function-triggers data-hash=https://cdn.jsongo.top/banners/54ae9a6d9d56a2e58c20dc50f584fd39.jpg></div><div class=article-details><h2 class=article-title>Azure Function Triggers</h2></div></a></article><article class=has-image><a href=/articles/azure-serverless-mysql/><div class=article-image><img src=https://cdn.jsongo.top/banners/0dba76ff89c558a40825ce7e7a507005.jpg loading=lazy data-key=azure-serverless-mysql data-hash=https://cdn.jsongo.top/banners/0dba76ff89c558a40825ce7e7a507005.jpg></div><div class=article-details><h2 class=article-title>Azure Function + Mysql 入门</h2></div></a></article><article class=has-image><a href=/articles/azure-serverless/><div class=article-image><img src=https://cdn.jsongo.top/banners/9f2713cc4890d8cf0449df9f4877fa26.jpg loading=lazy data-key=azure-serverless data-hash=https://cdn.jsongo.top/banners/9f2713cc4890d8cf0449df9f4877fa26.jpg></div><div class=article-details><h2 class=article-title>azure serverless 使用</h2></div></a></article></div></div></aside><script src=https://giscus.app/client.js data-repo=jsongo/hugo-page data-repo-id=R_kgDONQf4yA data-category=Announcements data-category-id=DIC_kwDONQf4yM4CkfAr data-mapping=title data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=preferred_color_scheme data-lang=zh-CN data-loading=lazy crossorigin=anonymous async></script><script>function setGiscusTheme(e){let t=document.querySelector("iframe.giscus-frame");t&&t.contentWindow.postMessage({giscus:{setConfig:{theme:e}}},"https://giscus.app")}(function(){addEventListener("message",t=>{if(event.origin!=="https://giscus.app")return;e()}),window.addEventListener("onColorSchemeChange",e);function e(){setGiscusTheme(document.documentElement.dataset.scheme==="light"?"preferred_color_scheme":"dark_dimmed")}})()</script><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 Ethan 的思考札记</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>