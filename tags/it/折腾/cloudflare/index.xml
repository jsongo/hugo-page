<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>IT/æŠ˜è…¾/Cloudflare on Ethan çš„æ€è€ƒæœ­è®°</title><link>https://www.jsongo.top/tags/it/%E6%8A%98%E8%85%BE/cloudflare/</link><description>Recent content in IT/æŠ˜è…¾/Cloudflare on Ethan çš„æ€è€ƒæœ­è®°</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 15 Dec 2024 16:03:07 +0800</lastBuildDate><atom:link href="https://www.jsongo.top/tags/it/%E6%8A%98%E8%85%BE/cloudflare/index.xml" rel="self" type="application/rss+xml"/><item><title>å…è´¹çš„èŠ±ç”Ÿå£³ - cloudflared</title><link>https://www.jsongo.top/articles/build-a-cloudflared-tunnel/</link><pubDate>Sun, 15 Dec 2024 16:03:07 +0800</pubDate><guid>https://www.jsongo.top/articles/build-a-cloudflared-tunnel/</guid><description>&lt;img src="https://cdn.jsongo.top/banners/f53c5884b5505531f32ad8fa0fc57247.jpg" alt="Featured image of post å…è´¹çš„èŠ±ç”Ÿå£³ - cloudflared" />
&lt;blockquote class="alert alert-note">
&lt;p class="alert-heading">
ğŸ’¡
èŠ±ç”Ÿå£³&lt;br
&lt;/p>
&lt;p>ä¸€èˆ¬æˆ‘ä»¬ä¹ æƒ¯ç”¨èŠ±ç”Ÿå£³æ¥å®ç°å†…ç½‘ç©¿é€ï¼Œä¸è¿‡èŠ±ç”Ÿå£³æœ¬èº«æ˜¯è¦æ”¶é’±çš„ï¼Œå®ƒçš„åŸŸåä¹Ÿè¦æ”¶é’±ï¼Œæµé‡ä¹Ÿæ”¶ä¸€æ¬¡é’±ï¼Œè€Œä¸”ç»™äº†é’±ä¹‹åå®ƒçš„æµé‡å¸¦å®½ä¹Ÿå—åˆ°é™åˆ¶ï¼Œæ­£å¸¸æ˜¯ 1M å¸¦å®½ä¸‹è½½é€Ÿåº¦åªæœ‰ 100 å¤š kï¼Œç”¨èµ·æ¥å¾ˆéš¾å—ï¼ŒåŠ ç‚¹å¸¦å®½å°±è¦åŠ ä¸å°‘é’±ã€‚è€Œä¸”æ¯ä¸ªæœˆè¿˜æœ‰æ€»æµé‡é™åˆ¶ï¼Œç»å¸¸ç”¨äº†åŠä¸ªæœˆå°±ä¸è¡Œäº†ï¼Œéå¸¸ç—›è‹¦ã€‚&lt;/p>
&lt;/blockquote>
&lt;p>å…¶å® cloudflare æœ¬èº«å°±æä¾›äº†ä¸€ä¸ªå…è´¹çš„ cloudflared çš„ tunnel å·¥å…·ï¼Œç›´æ¥ä¸‹è½½è¿è¡Œå°±è¡Œã€‚å¦‚æœç”¨ Docker çš„è¯å¯ä»¥ç”¨è¿™ä¸ªé•œåƒï¼š&lt;a class="link" href="https://hub.docker.com/r/cloudflare/cloudflared" target="_blank" rel="noopener"
>hub.docker.com/r/cloudflare/cloudflared&lt;/a> é‡Œé¢ä¹Ÿæœ‰ä¸€äº›ç®€å•çš„æŒ‡å¼•ã€‚&lt;/p>
&lt;h1 id="ç®€å•ä½¿ç”¨">ç®€å•ä½¿ç”¨
&lt;/h1>&lt;p>ä¸€æ¡å‘½ä»¤å°±å¯ä»¥æå®šï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cloudflared tunnel --no-autoupdate --hello-world
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸è¿‡è¿™ä¹ˆè·‘ï¼Œæ¯”è¾ƒä¾èµ–äºä¸éœ€è¦ Cloudflare å¸æˆ·çš„å…¬å…± trycloudflare.comï¼Œå¾ˆä¸ç¨³å®šï¼Œæˆ‘ä¹‹å‰è¯•ç”¨è¿‡ï¼Œç»å¸¸æ–­ï¼Œç½‘é€Ÿä¹Ÿä¸ç¨³å®šã€‚è¦å®é™…ä¸Šçº¿ä½¿ç”¨çš„è¯ï¼Œè¿˜æ˜¯å¾—è‡ªå·±æ³¨å†Œä¸€ä¸ª cloudflare è´¦å·ï¼Œä¸‹é¢ä»‹ç»ã€‚&lt;/p>
&lt;h1 id="æ­å»ºä¸ªäºº-tunnel-ç½‘ç»œ">æ­å»ºä¸ªäºº Tunnel ç½‘ç»œ
&lt;/h1>&lt;h2 id="æ³¨å†Œä¸€ä¸ª-tunnel">æ³¨å†Œä¸€ä¸ª Tunnel
&lt;/h2>&lt;p>åˆ° &lt;a class="link" href="https://dash.teams.cloudflare.com/%e2%81%a0" target="_blank" rel="noopener"
>Cloudflare One&lt;/a> ä¸Šæ³¨å†Œä¸€ä¸ª Cloudflare Zero Trust åŸŸåï¼Œé€‰ Free å°±å¯ä»¥äº†&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/420352862a7523747b97d596ff767b81.webp"
loading="lazy"
alt="|875"
>&lt;br>
æ¥ä¸‹å»å®ƒä¼šè®©ä½ ç»‘å®šä¸€ä¸ªæ”¯ä»˜å¡ï¼Œå³ä½¿é€‰çš„æ˜¯å…è´¹çš„ã€‚è¿™æ˜¯æµ·å¤–å„ç±»æœåŠ¡çš„å¸¸è§æ“ä½œï¼Œå› ä¸ºæ”¶è´¹è®¡åˆ’å¯èƒ½ä¼šå˜ï¼Œè€Œä¸”ä½ ä½¿ç”¨æ—¶ä¹Ÿå¯èƒ½ä¼šè¶…é¢ï¼Œæ‰€ä»¥å…ˆè®©ä½ æŠŠæ‰£è´¹çš„æ–¹å¼ç•™å¥½ï¼Œä»¥å¤‡åé¢éœ€è¦çš„æ—¶å€™èƒ½æ‰£åˆ°é’±ã€‚&lt;br>
æ³¨å†Œå®Œåï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥åˆ›å»ºä¸€ä¸ª tunnelï¼Œå…¶å®è¿‡ç¨‹ä¹Ÿå¾ˆç®€å•ã€‚&lt;/p>
&lt;blockquote>
&lt;p>è¿™äº›æ˜¯ä¸€æ­¥æ­¥æ‘¸ç´¢å‡ºæ¥çš„ï¼Œæ²¡æœ‰å‚è€ƒå…¶å®ƒå¤–éƒ¨çš„æŒ‡å¼•ï¼Œæ‰€ä»¥å¯èƒ½ä¼šæœ‰æ›´å¥½çš„åŠæ³•ã€‚å¸Œæœ›æœ‰è¯»è€…æ‰¾åˆ°æ›´å¥½çš„æ–¹æ³•æ—¶ï¼Œèƒ½ç»™æˆ‘ç•™ä¸ªè¯„è®ºï¼Œæ„Ÿæ¿€ä¸å°½ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="åˆ›å»º-tunnel">åˆ›å»º Tunnel
&lt;/h2>&lt;p>åœ¨ä¸‹å›¾ä¸­çš„èœå•é‡Œæ‰¾åˆ°åˆ›å»ºçš„åœ°æ–¹ï¼Œé€‰ Cloudflaredã€‚&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/5b690dff91048eeaeb5663f168c837a2.webp"
loading="lazy"
alt="|875"
>&lt;br>
è‡ªå·±å–ä¸€ä¸ªåå­—ï¼ˆä¸è·Ÿåˆ«äººé‡å¤å°±è¡Œï¼‰&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/8652218a31d2d78c56aa4f0a43edcf8d.webp"
loading="lazy"
alt="|900"
>&lt;br>
ä¸‹ä¸€æ­¥ï¼Œå–å¾— tokenï¼š&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/29b1a001c14459ba21b349c12cb4288d.webp"
loading="lazy"
alt="|925"
>&lt;br>
å¦‚ä¸Šå›¾ï¼Œåˆ’çº¿å¤„å°±æ˜¯ä½ çš„ tokenï¼Œå…ˆè®°ä¸‹æ¥ï¼Œä¸‹é¢ç”¨ã€‚&lt;/p>
&lt;h2 id="å¯åŠ¨æ¥å…¥">å¯åŠ¨ã€æ¥å…¥
&lt;/h2>&lt;p>åˆ›å»ºå®Œä¹‹åï¼Œåœ¨æœ¬åœ°è¿è¡Œ cloudflared çš„å‘½ä»¤ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cloudflare tunnel --no-autoupdate run --token xxx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¦‚æœä½¿ç”¨ docker çš„è¯ï¼Œå¯ä»¥ç”¨è¿™ä¸ª compose yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;3.8&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloudflared&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cloudflare/cloudflared:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cloudflared&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tunnel --no-autoupdate run --token xxxx&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">unless-stopped&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">network_mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">host&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dns&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">1.1.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å…¶ä¸­ï¼Œxxx æ¢æˆä½ è‡ªå·±çš„ tokenã€‚&lt;br>
å¦‚æœä½ å®¶é‡Œæœ‰ä¸ªæœåŠ¡å™¨æˆ– NASï¼Œå…¶å® docker æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œå®ƒå¯ä»¥ä¸€ç›´åœ¨çº¿è·‘ã€‚&lt;br>
åˆ›å»ºå®Œä¹‹åï¼Œåœ¨åŒä¸€ä¸ªç•Œé¢é‡Œå¯ä»¥çœ‹åˆ°å·²ç»æœ‰ä¸€ä¸ªè®¾å¤‡è¿æ¥ä¸Šæ¥äº†ï¼š&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/3c23fd4e318bb3198e69dd369ed24c29.webp"
loading="lazy"
alt="|725"
>&lt;br>
å†ä¸‹ä¸€æ­¥ï¼Œpublic hostnames é‡Œæ·»åŠ ä¸€ä¸ªä½ è½¬åˆ° cloudflare æ¥è§£æçš„åŸŸåï¼ŒåŠ ä¸€ä¸ªå­åŸŸåã€‚åŒæ—¶ Service å¡«å†™ä½ å†…ç½‘çš„æŸä¸ªæœåŠ¡çš„åœ°å€ï¼Œå¦‚ä½ çš„ nginx ç½‘å…³ç­‰ã€‚&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/0e9d6a0c0afadbd8100b681aab58a962.webp"
loading="lazy"
alt="|875"
>&lt;br>
å†ä¸‹ä¸€æ­¥å°±å›åˆ°äº†åˆ—è¡¨é¡µï¼Œå¯ä»¥çœ‹åˆ°ä½ çš„ tunnel å·²ç»åœ¨è·‘äº†ï¼š&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/f39e1282f64410a6862142f136b7108b.webp"
loading="lazy"
alt="|850"
>&lt;br>
å›åˆ°ä½ çš„ cloudflare DNS é…ç½®é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°å®ƒå¸®ä½ æ·»åŠ äº†ä¸€ä¸ª CNAMEï¼Œè¯´æ˜å·²ç»æˆåŠŸäº†&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/292affb6bfeac40389684bb915b7bce0.webp"
loading="lazy"
alt="|875"
>&lt;br>
&lt;a class="link" href="https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/routing-to-tunnel/dns/" target="_blank" rel="noopener"
>DNS records Â· Cloudflare Zero Trust docs&lt;/a> è¿™æ¡ CNAME çš„è§„åˆ™æ˜¯ï¼š&lt;code>&amp;lt;Tunnel ID&amp;gt;.cfargotunnel.com&lt;/code> ï¼Œè¿™ä¸ª Tunnel ID å¯ä»¥åœ¨ä¸Šæ–¹çš„æˆªå›¾ä¸­æ‰¾åˆ°ã€‚æ‰€ä»¥æ‰‹åŠ¨é…ç½®ä¹Ÿè¡Œã€‚&lt;/p>
&lt;p>ç°åœ¨ä½ å¯ä»¥ç”¨åˆšé…ç½®çš„åŸŸåæ¥è®¿é—®ä½ çš„å†…ç½‘æœåŠ¡äº†ã€‚ç½‘é€Ÿå¾ˆå¿«ã€‚&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/7063c449ce57a9dfa970e2e9c6916d9e.webp"
loading="lazy"
alt="|750"
>&lt;/p>
&lt;h2 id="ä¼˜åŒ–ç½‘ç»œè¿æ¥">ä¼˜åŒ–ç½‘ç»œè¿æ¥
&lt;/h2>&lt;p>å¦‚æœä½ çš„æœåŠ¡éœ€è¦è€—æ—¶æ¯”è¾ƒä¹…ï¼Œæ¯”å¦‚ git æœåŠ¡ï¼Œæœ‰æ—¶ä½ æ‹‰å†…å®¹çš„æ—¶å€™éƒ½è¦å¥½å‡ åˆ†é’Ÿï¼Œé‚£å°±éœ€è¦è®¾ç½®è¿æ¥å’Œè¶…æ—¶æ—¶é•¿äº†ã€‚&lt;br>
åœ¨ä¸Šé¢æˆ‘ä»¬é…ç½® publish hostname æ—¶ï¼Œä¸‹æ–¹å…¶å®è¿˜æœ‰é«˜çº§é…ç½®ï¼Œå¦‚ä¸‹å›¾ä½ç½®ï¼š&lt;br>
&lt;img src="https://cdn.jsongo.top/2024/12/321e5240cb520e8f255d0afad7893609.webp"
loading="lazy"
alt="|725"
>&lt;br>
è°ƒæ•´ä¸‹ timeout çš„æ—¶é•¿ï¼ˆé»˜è®¤ 30sï¼‰ï¼Œè¶…è¿‡ 30 ç§’å°±è‡ªåŠ¨å…³é—­é“¾æ¥äº†ï¼Œæ‰€ä»¥è¿™ä¸ªåœ°æ–¹å¯ä»¥é€‚å½“è°ƒå¤§ä¸€äº›ã€‚&lt;/p></description></item></channel></rss>