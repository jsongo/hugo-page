<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>互联网/Git on Ethan 的思考札记</title><link>https://www.jsongo.top/tags/%E4%BA%92%E8%81%94%E7%BD%91/git/</link><description>Recent content in 互联网/Git on Ethan 的思考札记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Tue, 17 Dec 2024 23:34:22 +0800</lastBuildDate><atom:link href="https://www.jsongo.top/tags/%E4%BA%92%E8%81%94%E7%BD%91/git/index.xml" rel="self" type="application/rss+xml"/><item><title>git 恢复误删笔记or文件</title><link>https://www.jsongo.top/articles/git-recover-notes/</link><pubDate>Tue, 17 Dec 2024 23:34:22 +0800</pubDate><guid>https://www.jsongo.top/articles/git-recover-notes/</guid><description>&lt;img src="https://cdn.ethango.top/banners/6424b2c83ab269ea18c2240356db3b9d.jpg" alt="Featured image of post git 恢复误删笔记or文件" />&lt;p>自从改用 Obsidian 来做笔记后，再也不怕文件丢失了，特别是我有了 git 来管理文件后，不小心删掉一些文件也都能找回来，即使是 100 天前删除的都行，非常方便。&lt;/p>
&lt;div class="admonition tip">
&lt;div class="details-summary admonition-title">
&lt;i class='icon fas fa-lightbulb fa-fw'>&lt;/i>
为什么用 git 管理？同步软件不行吗&lt;br
&lt;/div>&lt;/div>
&lt;div class="details-content">
&lt;div class="admonition-content">
&lt;p>我试过用 Obsidian 官方的，但我的笔记增长太快了（最近一直在迁移以前的笔记），一个月就增长 1G，所以买官方的服务太贵了，而且还有一个更重要的原因：文件经常会莫名其妙地被覆盖，而我完全没办法，可以看到一些历史，但很麻烦，得一个个点开找，可以说不太可用。&lt;br>
其实 git 是最完美的版本管理工具，非常丰富的命令可以实现各种操作、满足各类诉求。下面讲讲我是怎么找回我的文件&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>&lt;h1 id="主要方法">主要方法
&lt;/h1>&lt;p>文件不小心删掉了要找回来是比较常见的，比如我装的 &lt;code>clear unused images&lt;/code> 插件，经常有些不知名的原因删我的图片。开始我还一个一个 commit 找，效率实在太低了，其实 git 是支持从 log 里找的，命令也不难。比如我今天不小心删掉了某个文件，现在我想恢复，我明确知道是今天删的（因为昨天还没有这个图片贴的那个文档），所以我就从今天开始搜索，很快：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git log --since&lt;span class="o">=&lt;/span>midnight -- 74a006c91c5150f0d9d9dd25d5c5ab34.webp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>找到有哪些 commit 操作了这个文件，然后再用 git show 命令来看当时做了哪些操作：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git show 5b12e80a540539b0da2ac75cf4d5e7221f2b7342 -- 74a006c91c5150f0d9d9dd25d5c5ab34.webp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>结果：&lt;br>
&lt;img src="https://cdn.ethango.top/2024/12/95c7302d5fa881834bb45c88c8115cb2.webp"
width="725"
loading="lazy"
alt="|725"
>&lt;br>
可以看到，当时把这个文件给删掉了。再往上看，可以找到第一条 commit，这就是它创建的那个提交，还能看到是什么时候提交的：&lt;br>
&lt;img src="https://cdn.ethango.top/2024/12/861fa74e3155d6e84b9e6ffba287e05e.webp"
width="725"
loading="lazy"
alt="|725"
>&lt;br>
最后就是恢复文件，直接用 &lt;code>git checkout&lt;/code> 命令就行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git co c171a4c169470455fa8ac62fd8d4164ea677c8ec -- 2c579673c6b2f0793f2e423523cc6fe3.webp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="扩展">扩展
&lt;/h1>&lt;h2 id="时间范围">时间范围
&lt;/h2>&lt;p>上文讲 git log，它其实有很多指定时间范围的参数，刚刚用了 since midnight (非常语义化、好理解)，也可以指定要几天前。另外还有一个 &lt;code>--util&lt;/code> 参数，用法跟 since 一样，这两个参数可以办公室一个范围，比如大前天的文件变更情况，可以用：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git log --since&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;3 days ago&amp;#34;&lt;/span> --until&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;2 days ago&amp;#34;&lt;/span> -- &amp;lt;filename&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>此外还有两个类似的参数：after（=since）、before（=until），记住一组就行。&lt;/p>
&lt;h2 id="时间写法">时间写法
&lt;/h2>&lt;p>上文涉及到：&lt;code>midnight&lt;/code>、&lt;code>3 days ago&lt;/code> 这两种，都是直接用英文表达的。做个汇总：&lt;/p>
&lt;ul>
&lt;li>相对日期：&lt;code>--since=&amp;quot;3 days ago&amp;quot;&lt;/code>&lt;/li>
&lt;li>绝对日期：&lt;code>--since=&amp;quot;2024-10-01&amp;quot;&lt;/code> 或具体到时间，如 &lt;code>2024-10-01 12:00&lt;/code>&lt;/li>
&lt;li>时间戳（秒）：&lt;code>--since=1633046400&lt;/code>&lt;/li>
&lt;li>自然语言时间，主要有：
&lt;ul>
&lt;li>&lt;code>yesterday&lt;/code>&lt;/li>
&lt;li>&lt;code>today&lt;/code>&lt;/li>
&lt;li>&lt;code>midnight&lt;/code>：今天的午夜&lt;/li>
&lt;li>&lt;code>noon&lt;/code>：今天的中午&lt;/li>
&lt;li>&lt;code>teatime&lt;/code>：今天的下午 4 点&lt;/li>
&lt;li>&lt;code>last week&lt;/code>&lt;/li>
&lt;li>&lt;code>last month&lt;/code>&lt;/li>
&lt;li>&lt;code>last year&lt;/code>&lt;/li>
&lt;li>&lt;code>last christmas&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>组件表达，非常强大，举几个例子：
&lt;ul>
&lt;li>&lt;code>3 days ago 14:00&lt;/code>&lt;/li>
&lt;li>&lt;code>2 weeks ago midnight&lt;/code>&lt;/li>
&lt;li>&lt;code>last friday&lt;/code>&lt;/li>
&lt;li>&lt;code>last year december 31 23:59&lt;/code>&lt;/li>
&lt;li>&lt;code>new year's eve 2022&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>优化 .git 目录过大的问题</title><link>https://www.jsongo.top/articles/optimize-large-git-directory/</link><pubDate>Sun, 27 Oct 2024 11:31:09 +0800</pubDate><guid>https://www.jsongo.top/articles/optimize-large-git-directory/</guid><description>&lt;img src="https://cdn.ethango.top/banners/c9b66ea1eb0408c5eedd37d7d3b2ea29.jpg" alt="Featured image of post 优化 .git 目录过大的问题" />&lt;h1 id="优化-git-仓库的存储设置">优化 Git 仓库的存储设置
&lt;/h1>&lt;h2 id="调整-git-gc-参数">调整 &lt;code>git gc&lt;/code> 参数
&lt;/h2>&lt;ul>
&lt;li>原理：&lt;code>git gc&lt;/code>（垃圾回收）命令用于清理 Git 仓库中不必要的文件和优化存储。默认情况下，&lt;code>git gc&lt;/code> 会自动运行，但你可以手动调整它的参数来更好地优化仓库。&lt;/li>
&lt;li>步骤：可以通过增加 &lt;code>--prune = &amp;lt;date&amp;gt;&lt;/code> 参数来指定一个日期，删除在这个日期之前的所有未引用的对象。例如，要删除一年前的未引用对象，可以使用以下命令：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git gc --prune &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;1 year ago&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>注意事项：这个操作会清理 Git 仓库中的对象，可能会影响到一些历史版本的恢复等功能。所以在使用之前要确保仓库中的历史记录没有重要的未引用对象需要保留。&lt;/li>
&lt;/ul>
&lt;h2 id="使用浅克隆--depth">使用浅克隆（&lt;code>--depth&lt;/code>）
&lt;/h2>&lt;ul>
&lt;li>原理：浅克隆是指只克隆仓库的一部分提交历史，而不是全部。对于一些只需要最新代码的场景，如持续集成环境或者临时开发环境，浅克隆可以大大减少克隆仓库的大小。&lt;/li>
&lt;li>步骤：在克隆仓库时，使用 &lt;code>--depth&lt;/code> 参数来指定克隆的深度。例如，要克隆最近的 10 个提交，可以使用以下命令：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git clone --depth &lt;span class="m">10&lt;/span> &amp;lt;repository - url&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>注意事项：浅克隆的仓库不包含完整的提交历史，所以如果需要查看或者恢复更早的提交，就需要重新克隆完整的仓库。并且，浅克隆的仓库在拉取更新时可能会受到一些限制，需要根据实际情况进行调整。&lt;/li>
&lt;/ul></description></item></channel></rss>