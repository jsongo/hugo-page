<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Ethan 的思考札记</title><link>https://www.jsongo.top/</link><description>Recent content on Ethan 的思考札记</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Mon, 10 Nov 2025 11:41:03 +0800</lastBuildDate><atom:link href="https://www.jsongo.top/index.xml" rel="self" type="application/rss+xml"/><item><title>Windows 11 集成 AI 功能迎重大更新；蓝色起源成功发射火星任务；新研究揭示暗能量或在改变宇宙</title><link>https://www.jsongo.top/articles/windows-11-ai-update-blue-origin-mars-mission-dark-energy-discovery-2025-11-09-11.10/</link><pubDate>Mon, 10 Nov 2025 11:41:03 +0800</pubDate><guid>https://www.jsongo.top/articles/windows-11-ai-update-blue-origin-mars-mission-dark-energy-discovery-2025-11-09-11.10/</guid><description>&lt;h1 id="互联网与软件">互联网与软件
&lt;/h1>&lt;p>近期，互联网与软件领域经历了显著的变革与创新。微软的 Windows 11 十一月更新引入了强大的 AI 功能，重新定义了操作系统的人机交互方式。同时，游戏行业正经历结构性调整，Square Enix 的裁员和 EA 的收购事件引发了广泛关注，而《半条命3》的潜在发布则点燃了粉丝的热情。此外，苹果 CarPlay 的新小组件和开发者社区的互助行动，也展示了软件生态的多样性与活力。&lt;/p>
&lt;h2 id="ai-驱动的操作系统革新与智能体验提升">AI 驱动的操作系统革新与智能体验提升
&lt;/h2>&lt;p>微软的 Windows 11 十一月更新标志着操作系统向智能化迈出了重要一步。通过集成人工智能技术，该系统不仅优化了文件管理和用户界面，还引入了更智能的小组件，旨在无缝衔接日常任务，提升整体生产力。这些更新反映了软件行业对个性化、高效化体验的持续追求，预计将影响未来操作系统的设计方向。&lt;/p>
&lt;h3 id="windows-11-十一月更新七大亮点ai功能全新开始菜单等">Windows 11 十一月更新七大亮点：AI功能、全新开始菜单等
&lt;/h3>&lt;p>Windows 11 的最新更新聚焦于人工智能的深度融合，例如 AI 驱动的文件操作能自动分类和推荐文件，减少用户手动整理的时间。重新设计的开始菜单采用了动态布局，根据使用习惯优先显示常用应用，而智能小组件则能实时推送天气、新闻和日历事件，打造更直观的交互体验。这些功能不仅提升了操作效率，还通过机器学习不断适应用户行为，预示着操作系统正从工具向智能助手演变。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746046-poWifzG22GVJM4o9CiiKua-1675-80.jpg"
loading="lazy"
alt="Windows 11 更新"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.windowscentral.com/microsoft/windows-11/top-7-features-coming-on-windows-11-with-the-november-2025-update" target="_blank" rel="noopener"
>Windows 11 十一月更新七大亮点：AI功能、全新开始菜单等&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="你应该立即安装的5个苹果carplay小组件">你应该立即安装的5个苹果CarPlay小组件
&lt;/h3>&lt;p>苹果 CarPlay 的新小组件扩展了车载系统的实用性，例如日历小组件能同步日程提醒，天气小组件提供实时路况预警，而智能家居控制则允许用户在驾驶中管理家庭设备。这些工具通过简洁的界面减少驾驶分心，同时整合多源数据，体现了软件在提升生活便利性方面的潜力。随着汽车智能化趋势加速，此类创新有望成为未来出行的标准配置。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746047-l-intro-1762193024.jpg"
loading="lazy"
alt="CarPlay 小组件"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.slashgear.com/2015612/apple-carplay-widgets-install-now/" target="_blank" rel="noopener"
>你应该立即安装的5个苹果CarPlay小组件&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="游戏行业的战略调整与社区动态">游戏行业的战略调整与社区动态
&lt;/h2>&lt;p>游戏产业正面临内部重组与外部收购的双重挑战。Square Enix 的裁员反映了全球发行策略的优化需求，而 EA 被沙特收购则引发了内容创作者的伦理考量。与此同时，经典 IP 如《半条命》的新动向和开发者流动，凸显了行业在创新与传承之间的平衡努力。&lt;/p>
&lt;h3 id="square-enix-确认在欧美地区进行裁员与业务重组">Square Enix 确认在欧美地区进行裁员与业务重组
&lt;/h3>&lt;p>Square Enix 在北美和欧洲的裁员波及超过100名员工，旨在精简发行业务以应对市场压力。这次重组可能源于数字分销的崛起和本地化成本上升，迫使公司聚焦核心市场。尽管短期阵痛难免，但这一举措或有助于长期竞争力，提醒业界关注全球化运营的可持续性。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746047-screenshot-2025-11-08-174938.png.jpg"
loading="lazy"
alt="Square Enix 裁员"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.animenewsnetwork.com/news/2025-11-08/square-enix-confirms-layoffs-restructuring-in-n-american-european-publishing-operations/.230748" target="_blank" rel="noopener"
>Square Enix 确认在欧美地区进行裁员与业务重组&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="模拟人生主播因ea被收购而考虑与其保持距离">《模拟人生》主播因EA被收购而考虑与其保持距离
&lt;/h3>&lt;p>EA 被沙特阿拉伯政府收购后，部分《模拟人生》主播担忧文化价值观冲突，正重新评估与公司的合作。这些创作者依赖 EA 的内容生态谋生，但收购可能带来审查风险，使其陷入商业与原则的两难。事件反映了游戏行业资本化进程中，社区信任的重要性。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746048-ar5la.png"
loading="lazy"
alt="模拟人生主播"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.theverge.com/games/816750/the-sims-ea-buyout-content-creator-program-departures-lilsimsie" target="_blank" rel="noopener"
>《模拟人生》主播因EA被收购而考虑与其保持距离&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="半条命粉丝相信他们已破解半条命3的可能发布日期">《半条命》粉丝相信他们已破解《半条命3》的可能发布日期
&lt;/h3>&lt;p>《半条命》粉丝通过分析游戏内线索和官方活动，推测《半条命3》可能很快公布。这种社区驱动的解密活动体现了粉丝文化的凝聚力，也显示了 Valve 在营销上的巧妙布局。如果成真，这将终结系列长达多年的等待，重燃玩家对叙事驱动游戏的热情。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746052-half-life-2-art-crop.jpg"
loading="lazy"
alt="半条命3"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.eurogamer.net/half-life-fans-believe-theyve-worked-out-a-possible-announcement-date-for-half-life-3-and-its-very-very-soon" target="_blank" rel="noopener"
>《半条命》粉丝相信他们已破解《半条命3》的可能发布日期&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="天国拯救2资深开发者加入巫师4团队">《天国：拯救2》资深开发者加入《巫师4》团队
&lt;/h3>&lt;p>Karel Kolmann 从《天国：拯救2》转投 CD Projekt Red 的《巫师4》团队，其任务设计经验有望丰富新作的叙事深度。这种人才流动促进了行业知识共享，可能带来更复杂的角色和世界观构建。对于玩家而言，这预示着《巫师4》将融合历史真实与奇幻元素，提升沉浸感。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746053-henry-from-kingdom-come-deliverance-2-next-to-ciri-from-the-witcher-4-composite.jpg"
loading="lazy"
alt="巫师4团队"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://gamerant.com/witcher-4-kingdom-come-deliverance-sr-quest-designer-dev-karel-kolmann/" target="_blank" rel="noopener"
>《天国：拯救2》资深开发者加入《巫师4》团队&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="bioware用神秘艺术图逐步构建质量效应5的故事情节">BioWare用神秘艺术图逐步构建《质量效应5》的故事情节
&lt;/h3>&lt;p>BioWare 通过发布 cryptic 艺术图，逐步揭示《质量效应5》的剧情线索，每张图都对应游戏中的关键事件或角色。这种营销策略构建了社区互动，让粉丝参与解读，同时保持了故事的神秘性。它展示了现代游戏开发中，叙事与玩家参与度的紧密结合。&lt;/p>
&lt;p>&lt;img src="https://gizmodo.com/app/uploads/2025/11/mass-effect-5-hed-1200x675.jpg"
loading="lazy"
alt="质量效应5"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://gizmodo.com/biowares-cryptic-mass-effect-5-art-is-building-the-games-story-2000683272" target="_blank" rel="noopener"
>BioWare用神秘艺术图逐步构建《质量效应5》的故事情节&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="社会影响与社区支持行动">社会影响与社区支持行动
&lt;/h2>&lt;p>科技行业的社会维度日益凸显，从创始人的争议行为到社区的互助倡议。旧金山科技精英参加“精修学校”引发了关于阶级文化的讨论，而《蓝王子》团队的肾脏求助则体现了游戏社区的团结精神。&lt;/p>
&lt;h3 id="旧金山科技创始人参加精修学校引争议">旧金山科技创始人参加“精修学校”引争议
&lt;/h3>&lt;p>旧金山科技创始人学习社交礼仪的行为，被批评为脱离现实的精英主义，尽管其本意是提升商业形象。Y Combinator CEO Garry Tan 的反对声音强调了务实创新的重要性，事件折射出科技圈文化认同的冲突。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746054--C100.00%25x78.71%25%2C0.00%25%2C1.61%25-FWEBP"
loading="lazy"
alt="精修学校"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://sfstandard.com/2025/11/08/sf-tech-founders-go-finishing-school-garry-tan-does-approve/" target="_blank" rel="noopener"
>旧金山科技创始人参加“精修学校”引争议&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="蓝王子团队为开发者寻求救命肾源">《蓝王子》团队为开发者寻求救命肾源
&lt;/h3>&lt;p>《蓝王子》团队公开为一名核心测试员寻找肾脏捐献者，呼吁社区支持，展现了游戏产业的人情味。这种行动超越了商业利益，突出了健康关怀的紧迫性，并可能激励更多行业内的互助倡议。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746056-blue-prince_tB9iGeB.jpg"
loading="lazy"
alt="蓝王子团队"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.rockpapershotgun.com/the-team-behind-blue-prince-puts-out-a-call-to-get-one-of-the-puzzle-games-devs-a-life-saving-kidney" target="_blank" rel="noopener"
>《蓝王子》团队为开发者寻求救命肾源&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="硬件与半导体">硬件与半导体
&lt;/h1>&lt;p>硬件与半导体领域正迎来创新浪潮，存储技术、移动设备和可持续材料成为焦点。三星的模块化 SSD 和带 DRAM 的 M.2 2242 SSD 预示着存储介质的未来方向，而苹果可能重启上网本概念的传闻则引发了产品形态的重新思考。同时，环保发光材料和 DIY 项目的兴起，体现了行业对可持续性和用户创意的重视。&lt;/p>
&lt;h2 id="存储与移动设备的创新突破">存储与移动设备的创新突破
&lt;/h2>&lt;p>存储技术的进步正重新定义数据管理效率，三星的新 SSD 设计提供了更高的灵活性和性能。与此同时，移动设备市场见证了对经典产品形态的回归与反思，苹果的潜在策略调整可能影响整个行业格局。&lt;/p>
&lt;h3 id="三星预告模块化ssd和带dram的m2-2242-ssd">三星预告模块化SSD和带DRAM的M.2 2242 SSD
&lt;/h3>&lt;p>三星的模块化 SSD 允许用户自定义存储容量和接口，提升了升级性和可维护性，而带 DRAM 的 M.2 2242 SSD 则针对便携设备优化了速度和功耗。这些创新解决了传统 SSD 的固定限制，尤其适合游戏笔记本和嵌入式系统，推动了存储技术向个性化发展。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746056-ii2Ub9uudPykkG2P.jpg"
loading="lazy"
alt="三星SSD"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.techpowerup.com/342751/samsung-teases-modular-ssd-and-m-2-2242-ssd-with-dram" target="_blank" rel="noopener"
>三星预告模块化SSD和带DRAM的M.2 2242 SSD&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="苹果曾扼杀上网本现在会带回它们吗">苹果曾扼杀上网本，现在会带回它们吗？
&lt;/h3>&lt;p>苹果可能推出廉价 MacBook，其轻薄设计和基础功能与上网本相似，这反映了市场对低成本便携设备的持续需求。如果成真，这将标志苹果对主流用户的战略调整，也可能激发竞争对手重新评估类似产品线。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746056-P7150216-hero.1419979718.webp"
loading="lazy"
alt="苹果上网本"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.theverge.com/tech/817277/apple-ipad-killed-the-netbook-cheap-macbook-is-bringing-them-back" target="_blank" rel="noopener"
>苹果曾扼杀上网本，现在会带回它们吗？&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="努比亚z80-ultra全球发售">努比亚Z80 Ultra全球发售
&lt;/h3>&lt;p>努比亚 Z80 Ultra 搭载骁龙 8 Elite Gen 5 芯片和 7200mAh 电池，结合 144Hz AMOLED 屏，瞄准高端移动用户。其全球发售策略强调了中兴在国际市场的扩张野心，同时大电池和快充技术回应了消费者对续航的迫切需求。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746057-nubia-z80-ultra-hits-global-markets-for-sale-after-china-launch-techjuice-202660-145922.jpg"
loading="lazy"
alt="努比亚Z80"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.techjuice.pk/nubia-z80-ultra-hits-global-markets-for-sale-after-china-launch/" target="_blank" rel="noopener"
>努比亚Z80 Ultra全球发售&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="可持续材料与安全工具演进">可持续材料与安全工具演进
&lt;/h2>&lt;p>硬件行业正积极拥抱环保替代品，植物基发光材料有望减少电子垃圾。同时，安全工具如 Kode Dot 的竞争推动了多功能设备的普及，而 DIY 文化则鼓励用户赋予旧设备新生命。&lt;/p>
&lt;h3 id="利用植物废料和氨基酸开发显示屏发光材料的绿色替代品">利用植物废料和氨基酸开发显示屏发光材料的绿色替代品
&lt;/h3>&lt;p>科学家利用植物废料和氨基酸合成发光材料，为显示技术提供环保替代方案，减少对稀土元素的依赖。这种方法不仅降低生产成本，还支持循环经济，可能引领未来屏幕制造的可持续发展。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746059-scientists-develop-gre-1.jpg"
loading="lazy"
alt="绿色发光材料"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://techxplore.com/news/2025-11-green-alternative-emitting-materials-displays.html" target="_blank" rel="noopener"
>利用植物废料和氨基酸开发显示屏发光材料的绿色替代品&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="kode-dot希望取代flipper-zero的地位">Kode Dot希望取代Flipper Zero的地位
&lt;/h3>&lt;p>Kode Dot 作为 Flipper Zero 的竞争对手，集成了更多渗透测试和硬件诊断功能，旨在提供更全面的安全工具套件。它的出现反映了网络安全需求的增长，可能推动消费级黑客工具的标准化发展。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746060-_9aO9r2jJJi.blob"
loading="lazy"
alt="Kode Dot"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.hackster.io/news/kode-dot-wants-to-dethrone-the-flipper-zero-bdd5ae75b6a5" target="_blank" rel="noopener"
>Kode Dot希望取代Flipper Zero的地位&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="如何将你的旧电视变成一个智能镜子">如何将你的旧电视变成一个智能镜子
&lt;/h3>&lt;p>通过树莓派和 Magic Mirror 软件，用户可将旧电视改造成智能镜子，显示天气和新闻等信息。这个 DIY 项目不仅延长了设备寿命，还促进了开源硬件的普及，体现了“减少浪费”的环保理念。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746060-l-intro-1761933800.jpg"
loading="lazy"
alt="智能镜子"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.bgr.com/2014813/how-to-turn-old-tv-into-smart-mirror-raspberry-pi-guide/" target="_blank" rel="noopener"
>如何将你的旧电视变成一个智能镜子&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="历史回顾与市场促销">历史回顾与市场促销
&lt;/h2>&lt;p>对失败产品的分析提供了宝贵经验，亚马逊 Fire Phone 的案例警示了创新与市场需求的脱节。此外，促销活动如 Apple Watch 的特价，则反映了消费电子市场的动态定价策略。&lt;/p>
&lt;h3 id="亚马逊fire-phone为何会失败">亚马逊Fire Phone为何会失败？
&lt;/h3>&lt;p>亚马逊 Fire Phone 的失败源于其过度依赖 3D 屏幕等噱头，而忽视了用户体验和生态系统建设。缺乏应用支持和高价定位使其无法与 iOS 和 Android 竞争，这一教训提醒厂商创新需以实用为导向。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746060-VH_FirePhone_Site.jpg"
loading="lazy"
alt="Fire Phone"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.theverge.com/podcast/816739/amazon-fire-phone-version-history" target="_blank" rel="noopener"
>亚马逊Fire Phone为何会失败？&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="本周优惠精选apple-watch-se-3和乐高星战降临节日历">本周优惠精选：Apple Watch SE 3和乐高星战降临节日历
&lt;/h3>&lt;p>Apple Watch SE 3 和谷歌电视流媒体器的降价，以及乐高星战日历的特价，反映了年末促销季的开启。这些优惠助力消费者以更低成本接入智能生态，同时刺激了配件和娱乐产品的销售。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746061-257945_Applewatch_Series_11_AKrales_0096.jpg"
loading="lazy"
alt="Apple Watch"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.theverge.com/tech/816649/apple-watch-se-3-lego-star-wars-advent-calendar-deal-sale" target="_blank" rel="noopener"
>本周优惠精选：Apple Watch SE 3和乐高星战降临节日历&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="航空航天">航空航天
&lt;/h1>&lt;p>航空航天领域正迎来探索高潮，从火星任务到宇宙现象研究，人类对太空的认知不断深化。蓝色起源的 ESCAPADE 发射开启了商业航天的里程碑，而欧几里得望远镜的燃料盈余则延长了宇宙观测的窗口。同时，对死亡恒星和年迈恒星的研究，揭示了宇宙的动态本质，为地球的未来提供了参考。&lt;/p>
&lt;h2 id="深空探测与任务扩展">深空探测与任务扩展
&lt;/h2>&lt;p>商业航天公司与政府机构合作，推动了火星探索的新时代。蓝色起源的发射测试了可重复使用火箭技术，而欧几里得望远镜的延寿计划则有望拓展暗能量研究，这些努力共同加速了星际探索的进程。&lt;/p>
&lt;h3 id="蓝色起源为nasa发射escapade火星任务如何观看">蓝色起源为NASA发射ESCAPADE火星任务：如何观看
&lt;/h3>&lt;p>蓝色起源的新格伦火箭为 NASA 发射 ESCAPADE 任务，重点测试助推器回收技术，以实现低成本太空访问。此次任务将研究火星大气逃逸，同时直播观看选项提升了公众参与度，标志着商业航天在深空探测中的角色日益关键。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746062-09HS-blue-origin-launch-vfqw-facebookJumbo.jpg"
loading="lazy"
alt="蓝色起源发射"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.nytimes.com/2025/11/09/science/blue-origin-new-glenn-launch.html" target="_blank" rel="noopener"
>蓝色起源为NASA发射ESCAPADE火星任务：如何观看&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="欧几里得望远镜燃料超预期科学家计划延长8年任务">欧几里得望远镜燃料超预期，科学家计划延长8年任务
&lt;/h3>&lt;p>欧几里得望远镜的额外燃料允许任务延长8年，科学家提议扩展暗物质和暗能量测绘。这不仅能验证当前宇宙模型，还可能发现新物理现象，凸显了任务规划中冗余设计的重要性。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762746062-PIA16692_fig1_20251103_193045.jpg"
loading="lazy"
alt="欧几里得望远镜"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>[欧几里得望远镜&lt;/li>
&lt;/ul></description></item><item><title>Windows 11 集成 AI 功能迎重大更新；蓝色起源成功发射火星任务；新研究揭示暗能量或在改变宇宙</title><link>https://www.jsongo.top/articles/windows-11-ai-update-blue-origin-mars-mission-dark-energy-discovery-2025-11-09-11.10/</link><pubDate>Mon, 10 Nov 2025 11:41:02 +0800</pubDate><guid>https://www.jsongo.top/articles/windows-11-ai-update-blue-origin-mars-mission-dark-energy-discovery-2025-11-09-11.10/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/c3a203262bd526090c0c9e7feab3eae7.jpg" alt="Featured image of post Windows 11 集成 AI 功能迎重大更新；蓝色起源成功发射火星任务；新研究揭示暗能量或在改变宇宙" /></description></item><item><title>谷歌发布“持续学习”AI模型HOPE，Gemini赋能地图；新研究称宇宙无法被模拟</title><link>https://www.jsongo.top/articles/google-hope-ai-gemini-maps-universe-simulation-research-11.10/</link><pubDate>Mon, 10 Nov 2025 08:04:21 +0800</pubDate><guid>https://www.jsongo.top/articles/google-hope-ai-gemini-maps-universe-simulation-research-11.10/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/4e076eb4ff636b6bf9f74fb25b6536ac.jpg" alt="Featured image of post 谷歌发布“持续学习”AI模型HOPE，Gemini赋能地图；新研究称宇宙无法被模拟" />&lt;h1 id="人工智能前沿进展">人工智能前沿进展
&lt;/h1>&lt;p>近期，人工智能领域迎来了一系列激动人心的突破，从基础模型的持续学习能力到具体应用的深度集成，AI技术正以前所未有的速度渗透到我们生活的方方面面。谷歌推出的&amp;quot;HOPE&amp;quot;模型解决了大语言模型无法持续学习的关键难题，为更智能、更自适应的AI系统奠定了基础。同时，AI在面部识别、智能家居和地图导航等实际应用场景中也取得了显著进展，展现了人工智能技术从实验室走向日常生活的强大潜力。&lt;/p>
&lt;h2 id="持续学习与基础模型突破">持续学习与基础模型突破
&lt;/h2>&lt;p>人工智能领域最令人振奋的进展来自于基础模型的突破，特别是解决了大语言模型无法持续学习这一长期存在的挑战。&lt;/p>
&lt;h3 id="谷歌推出新型ai模型hope在持续学习方面取得重大进展">谷歌推出新型AI模型“HOPE”，在“持续学习”方面取得重大进展
&lt;/h3>&lt;p>谷歌最新发布的&amp;quot;HOPE&amp;quot;模型代表了AI领域的一个重要里程碑。该模型基于&amp;quot;嵌套学习&amp;quot;概念，旨在克服现有大语言模型无法持续学习的局限性。传统的大语言模型在完成训练后，其知识就固定在了训练时的状态，无法像人类一样通过新的经验不断更新和扩展知识。HOPE模型通过创新的架构设计，使得AI系统能够在不遗忘已有知识的前提下，持续吸收新信息，向更动态、更高效的AI系统迈出了关键一步。&lt;/p>
&lt;p>这项突破的意义不仅在于技术层面，更在于它为AI的未来发展指明了方向。持续学习能力是实现真正通用人工智能的核心要素之一，HOPE模型的成功开发为后续研究提供了宝贵的技术积累和实践经验。从实际应用角度看，具备持续学习能力的AI系统将能够更好地适应快速变化的环境和需求，在医疗诊断、科学研究、教育等领域的价值尤为突出。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733050-Tech-feature-images138.jpg"
loading="lazy"
alt="HOPE模型"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://indianexpress.com/article/technology/artificial-intelligence/google-big-step-continual-learning-new-ai-model-10355454/" target="_blank" rel="noopener"
>谷歌推出新型AI模型“HOPE”，在“持续学习”方面取得重大进展&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="人类超级识别者通过视觉模式训练ai提升面部识别能力">人类“超级识别者”通过视觉模式训练AI，提升面部识别能力
&lt;/h3>&lt;p>在面部识别这一具体应用领域，研究人员从人类&amp;quot;超级识别者&amp;quot;身上获得了重要启发。这项创新研究利用眼动追踪技术，详细分析了37位&amp;quot;超级识别者&amp;quot;和68位普通观察者在识别人脸时的视觉模式差异。超级识别者是指那些在面部识别能力上远超常人的个体，他们能够记住并识别出只见过一面的人脸，这种能力在安保、执法等领域具有重要价值。&lt;/p>
&lt;p>研究人员将这些人类专家的视觉模式数据用于训练AI系统，显著提升了机器面部识别的准确性和效率。这种方法的核心优势在于它模拟了人类专家处理面部信息的策略，而不是单纯依赖大量数据的堆砌。训练出的AI系统不仅识别准确率更高，而且在处理低质量图像、部分遮挡面孔等挑战性场景时表现更为鲁棒。这项研究体现了人机协作的巨大潜力，通过将人类专家的直觉和经验转化为可量化的训练数据，为AI性能的提升开辟了新途径。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733052-face-recognition-cropped-scaled.jpg"
loading="lazy"
alt="面部识别研究"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.biometricupdate.com/202511/human-super-recognizers-teach-ai-how-to-recognize-faces-in-new-study" target="_blank" rel="noopener"
>人类“超级识别者”通过视觉模式训练AI，提升面部识别能力&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ai应用场景的深度拓展">AI应用场景的深度拓展
&lt;/h2>&lt;p>人工智能技术不仅在基础研究层面取得突破，在实际应用场景的拓展和深化方面也展现出强劲势头，从智能家居到导航服务，AI正在重塑我们的日常生活体验。&lt;/p>
&lt;h3 id="谷歌地图将集成gemini-ai以增强功能">谷歌地图将集成Gemini AI以增强功能
&lt;/h3>&lt;p>谷歌正在将Gemini AI深度集成到谷歌地图中，这一举措标志着AI技术在日常生活服务中的进一步深化。该功能首先在印度推出，将为用户提供更丰富的路线信息和安全警报，使导航体验更加智能和个性化。与传统的地图服务相比，集成Gemini AI后的谷歌地图能够更好地理解用户的偏好和上下文，提供更加精准的路线建议和实时信息更新。&lt;/p>
&lt;p>这项集成的意义在于它将被动的地图服务转变为主动的智能助手。例如，系统可以根据用户的出行习惯、实时交通状况、天气信息等多维度数据，预测用户可能的需求并提供相应建议。安全警报功能的增强则体现了AI在保障用户安全方面的价值，系统能够识别潜在的危险区域或路况，及时向用户发出警告。这种深度集成展现了AI技术如何将传统的工具型应用转化为智能的生活伴侣。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733052-Google-maps-ai.jpg"
loading="lazy"
alt="谷歌地图AI"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.gulte.com/trends/380927/google-maps-to-be-upgraded-with-gemini-ai-heres-why" target="_blank" rel="noopener"
>谷歌地图将集成Gemini AI以增强功能&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="评测在新款nest摄像头上体验gemini-for-home的ai功能">评测：在新款Nest摄像头上体验Gemini for Home的AI功能
&lt;/h3>&lt;p>Gemini for Home为Nest的第三代摄像头带来了先进的AI安防功能，代表了智能家居安全领域的一次重要升级。评测者实际体验后发现，这项新功能在识别准确性、响应速度和用户体验方面都有显著提升。与传统安防摄像头相比，集成Gemini AI的Nest摄像头能够更准确地区分普通运动（如树枝摇晃、宠物经过）和真正的安全威胁（如陌生人入侵），大大减少了误报率。&lt;/p>
&lt;p>在实际使用中，Gemini for Home的AI功能表现出对复杂场景的出色理解能力。系统不仅能够检测到异常活动，还能对活动的性质进行初步判断，为用户提供更有价值的警报信息。例如，当检测到有人在房屋周围徘徊时，系统可以区分这是快递员投递包裹还是潜在的安全威胁。这种智能判断能力使得家庭安防系统从被动的记录工具转变为主动的安全守护者，为用户提供真正的安心保障。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733053-nest-cam-2025-front.jpg"
loading="lazy"
alt="Nest摄像头"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.cnet.com/home/security/i-tested-gemini-for-homes-ai-features-on-nests-newest-cam-heres-what-i-thought/" target="_blank" rel="noopener"
>评测：在新款Nest摄像头上体验Gemini for Home的AI功能&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="互联网与软件动态">互联网与软件动态
&lt;/h1>&lt;p>互联网与软件行业正处于快速变革期，从操作系统更新到云存储服务，从游戏产业并购到开发策略调整，各个领域都呈现出新的发展趋势。Android 17有望带来注重实用性的创新功能，云存储市场出现新的商业模式，同时游戏行业因企业并购和战略调整而面临重新洗牌，这些变化共同塑造着数字生态的未来面貌。&lt;/p>
&lt;h2 id="操作系统与云服务创新">操作系统与云服务创新
&lt;/h2>&lt;p>软件生态的核心组成部分——操作系统和云服务——正在经历重要演进，这些变化直接影响着亿万用户的数字体验和设备使用方式。&lt;/p>
&lt;h3 id="android-17可能带来年度最佳功能">Android 17可能带来年度最佳功能
&lt;/h3>&lt;p>Android 17系统预计将推出一项备受期待的实用功能，该更新专注于提升用户体验而非引入华而不实的噣头，有可能成为年度最佳更新之一。与以往注重界面美化或添加复杂功能的更新不同，Android 17似乎更加注重解决用户在日常使用中遇到的实际痛点。这种转变反映了移动操作系统发展阶段的成熟——从追求功能丰富性转向优化核心体验。&lt;/p>
&lt;p>虽然具体功能细节尚未完全披露，但业界推测可能涉及电池管理优化、后台任务调度改进或隐私保护增强等基础性提升。这些看似不那么炫目的改进，实际上对用户体验的影响更为深远。例如，更智能的电量管理可以延长设备单次充电的使用时间，更高效的资源调度可以使设备在多任务处理时更加流畅。这种务实的产品开发思路标志着移动操作系统进入了以用户真实需求为导向的新发展阶段。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733057-hand-holding-a-phone-showing-a-minimalist-map-on-the-always-on-display-with-the-android-mascot-and-cinnamon-rolls-in-the-background.png"
loading="lazy"
alt="Android 17"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.androidpolice.com/im-more-excited-about-this-android-17-feature/" target="_blank" rel="noopener"
>Android 17可能带来年度最佳功能&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="一次性付款即可获得1tb安全云存储空间">一次性付款即可获得1TB安全云存储空间
&lt;/h3>&lt;p>FolderFort推出的新型云存储服务采用了一次性付费模式，用户支付一次费用即可获得1TB的安全云存储空间，这为云存储市场带来了新的商业模式选择。与传统按月或按年订阅的模式不同，一次性付费模式消除了持续付费的负担，为用户提供了更可预测的长期存储成本。这种模式特别适合那些希望长期保存重要文件但又不想承担持续订阅费用的用户。&lt;/p>
&lt;p>除了商业模式的创新，FolderFort的服务还强调安全性和易用性。安全性方面，可能采用了端到端加密、多因素认证等先进保护措施，确保用户数据不被未授权访问。易用性则体现在简洁的界面设计和顺畅的文件同步体验上。这种结合了创新商业模式和扎实技术基础的服务，反映了云存储市场正在从简单的价格竞争转向更全面的价值竞争，为用户提供更多元化的选择。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733057-02hTqKq5asfOtXC0FYpV85a-1.fit_lim.size_1200x630.v1762547767.png"
loading="lazy"
alt="云存储"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.pcmag.com/deals/your-one-time-payment-gets-you-a-terabyte-of-secure-cloud-storage" target="_blank" rel="noopener"
>一次性付款即可获得1TB安全云存储空间&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="游戏产业变革与挑战">游戏产业变革与挑战
&lt;/h2>&lt;p>游戏行业正在经历深刻的结构性变化，企业并购、项目取消和开发策略调整等事件频发，这些变化不仅影响游戏公司，也波及内容创作者和玩家社区。&lt;/p>
&lt;h3 id="模拟人生主播因ea收购事件考虑远离游戏">《模拟人生》主播因EA收购事件考虑远离游戏
&lt;/h3>&lt;p>在EA宣布将被沙特阿拉伯政府收购后，一些《模拟人生》的主播正在考虑是否停止玩这款游戏，以表达他们对这一收购的立场。这一事件凸显了游戏产业全球化过程中面临的文化、政治和价值观冲突。对于许多内容创作者来说，游戏不仅是娱乐产品，也是表达个人价值观和建立社区认同的载体。当游戏公司的所有权发生变化，特别是涉及敏感的地缘政治因素时，内容创作者不得不重新思考自己与游戏的关系。&lt;/p>
&lt;p>这一困境尤其明显对于那些以《模拟人生》为核心创作内容的主播。对于他们中的许多人来说，《模拟人生》不仅是工作收入的来源，也是个人热情所在和社区身份的组成部分。放弃游戏意味着可能失去稳定的观众群和收入来源，而继续玩则可能面临社区压力和自我价值观的冲突。这种两难处境反映了当代内容创作者在商业利益和个人原则之间寻求平衡的普遍挑战。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733058-ar5la.png"
loading="lazy"
alt="模拟人生"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.theverge.com/games/816750/the-sims-ea-buyout-content-creator-program-departures-lilsimsie" target="_blank" rel="noopener"
>《模拟人生》主播因EA收购事件考虑远离游戏&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="光环无限将在四年后停止活跃开发">《光环：无限》将在四年后停止活跃开发
&lt;/h3>&lt;p>343 Industries宣布，《光环：无限》将在11月18日&amp;quot;无限行动&amp;quot;开始的同一天结束活跃开发，这意味着这款游戏在推出四年后将不再有大规模的内容更新。《光环：无限》采用&amp;quot;游戏即服务&amp;quot;的模式，原本计划通过持续更新来延长游戏生命周期，但最终在四年后决定停止活跃开发。这一决定反映了现代游戏开发中面临的现实挑战——在玩家期待、技术可能性和商业可行性之间寻找平衡。&lt;/p>
&lt;p>停止活跃开发并不意味着游戏服务器会立即关闭，玩家仍然可以访问已有内容，但不再期待重大的新功能或内容更新。这种转变对玩家社区产生了复杂影响：一方面，部分玩家对不再有新内容感到失望；另一方面，明确的开发终点也为游戏状态提供了稳定性，玩家可以基于现有功能建立长期的游戏体验。这一案例为游戏行业提供了关于&amp;quot;游戏即服务&amp;quot;模式生命周期管理的重要参考。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733058-halo-infinite-photo-1382120.jpg"
loading="lazy"
alt="光环无限"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.eurogamer.net/turns-out-halo-infinite-isnt-infinite-at-all-as-halo-studios-ends-active-development-after-just-four-years" target="_blank" rel="noopener"
>《光环：无限》将在四年后停止活跃开发&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="网易取消战锤mmo项目开发商确认合作终止">网易取消《战锤》MMO项目，开发商确认合作终止
&lt;/h3>&lt;p>游戏开发商Jackalyptic Games确认，其与网易游戏的合作已经终止，这意味着备受期待的《战锤》大型多人在线游戏项目已被取消。这一决定导致开发团队员工正在寻找新的工作机会。项目取消的原因可能涉及多方面因素，包括开发成本控制、市场前景评估、技术挑战或合作双方的战略调整。&lt;/p>
&lt;p>《战锤》MMO项目的取消反映了大型多人在线游戏开发面临的高风险和高挑战。MMO游戏通常需要巨大的前期投入和长期的运营支持，在市场竞争日益激烈的环境下，游戏公司对这类项目的评估更加谨慎。对于玩家社区而言，知名IP的MMO项目取消总是令人失望的，特别是当玩家已经对游戏概念产生期待时。这一事件也提醒我们，游戏产业的繁荣背后是无数个像这样未能与玩家见面的项目，每个成功游戏的背后都有多个类似的中途夭折的尝试。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733060-warhammer-mmo-developer-splits-from-netease-games.jpg"
loading="lazy"
alt="战锤MMO"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.pcgamesn.com/warhammer-mmo-netease-partnership-ends" target="_blank" rel="noopener"
>网易取消《战锤》MMO项目，开发商确认合作终止&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="硬件与半导体演进">硬件与半导体演进
&lt;/h1>&lt;p>硬件与半导体行业持续推动计算设备的性能边界和形态创新，从下一代处理器平台到移动设备安全功能，从可穿戴设备设计到专业摄影器材，各个细分领域都呈现出明确的技术进步轨迹。微软为Arm架构芯片准备特殊Windows版本，苹果可能重新定义入门级笔记本市场，三星计划在安全功能上追赶苹果，这些动态共同描绘出个人计算设备未来的发展图景。&lt;/p>
&lt;h2 id="芯片平台与计算设备革新">芯片平台与计算设备革新
&lt;/h2>&lt;p>计算生态的核心——芯片和操作系统——正在经历重要转型，这一转型将重新定义个人电脑的性能、能效和使用体验。&lt;/p>
&lt;h3 id="微软为骁龙x2和英伟达n1x平台准备windows-11-26h1">微软为骁龙X2和英伟达N1X平台准备Windows 11 26H1
&lt;/h3>&lt;p>微软正在准备一个名为26H1的特殊Windows 11版本，该版本基于Bromine平台，专为搭载下一代Arm架构芯片（如高通X2和英伟达N1X）的PC设计，预计于2026年上半年发布。这一举措标志着Windows on Arm生态系统的进一步成熟，也反映了整个行业对高能效计算方案的持续追求。与基于x86架构的传统PC相比，Arm架构设备通常具有更长的电池续航和即开即用的连接能力。&lt;/p>
&lt;p>26H1版本的特别之处在于它针对新一代Arm芯片进行了深度优化，可能包括更高效的核心调度、更好的功耗管理以及对芯片特定功能的支持。高通X2平台预计将提供显著的性能提升，特别是在AI计算任务方面；而英伟达N1X则可能将公司在GPU领域的技术积累带入PC市场。这种硬件多样性有助于打破传统Wintel联盟的垄断局面，为消费者提供更多选择，同时也促使整个生态系统在性能和能效方面展开更激烈的竞争。&lt;/p>
&lt;p>&lt;img src="https://cdn.videocardz.com/1/2025/11/WINDOWS-11-26H1-QUALCOMM-NVIDIA-HERO.jpg"
loading="lazy"
alt="Windows 11 26H1"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://videocardz.com/newz/microsoft-reportedly-readies-windows-11-26h1-for-snapdragon-x2-and-nvidia-n1x-platforms" target="_blank" rel="noopener"
>微软为骁龙X2和英伟达N1X平台准备Windows 11 26H1&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="苹果曾终结上网本如今会以廉价macbook的形式带回吗">苹果曾终结上网本，如今会以廉价MacBook的形式带回吗？
&lt;/h3>&lt;p>有传言称，苹果可能推出一款廉价版MacBook，这让人回想起当年被iPad终结的上网本（netbook）概念。上网本在2000年代末期曾短暂流行，它们以低价格和便携性为卖点，但最终因性能不足和用户体验差而退出市场。苹果如今可能以新的形式重新带回这一概念，但会在性能、设计和生态系统方面提供完全不同的体验。&lt;/p>
&lt;p>廉价MacBook的潜在意义在于它可能大幅降低苹果计算生态的入门门槛。与历史上的上网本不同，现代的低成本MacBook很可能仍然提供足够的性能满足日常使用，同时保持苹果产品标志性的设计质量和用户体验。这种产品策略有助于苹果在增长放缓的PC市场中寻找新的机会，特别是针对教育市场、轻度用户和作为第二台设备的购买场景。如果这一传言成真，它将重新定义入门级笔记本市场的竞争格局，并可能进一步模糊平板电脑和传统笔记本之间的界限。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733060-P7150216-hero.1419979718.webp"
loading="lazy"
alt="廉价MacBook"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.theverge.com/tech/817277/apple-ipad-killed-the-netbook-cheap-macbook-is-bringing-them-back" target="_blank" rel="noopener"
>苹果曾终结上网本，如今会以廉价MacBook的形式带回吗？&lt;/a>&lt;/li>
&lt;/ul>
&lt;h3 id="传言galaxy-s27-ultra将加入iphone已沿用多年的关键安全功能">传言Galaxy S27 Ultra将加入iPhone已沿用多年的关键安全功能
&lt;/h3>&lt;p>关于三星2027年旗舰手机的首批传言显示，Galaxy S27 Ultra可能会加入一项iPhone多年前就已具备的关键安全功能。虽然具体是哪种安全功能尚未明确，但可能的候选包括更先进的面容ID系统、硬件级的安全飞地增强或基于UWB的精准定位安全功能。无论具体是哪种功能，这一动向都反映了安卓旗舰机在安全性方面追赶iPhone的努力。&lt;/p>
&lt;p>移动设备安全性的重要性随着我们生活中数字内容的增多而不断提升。手机不再只是通讯工具，更是数字身份、支付手段和个人数据的保管库。三星作为安卓阵营的领导者，在其旗舰设备中加入苹果已验证的安全功能，表明行业对设备安全性的重视已从差异化竞争要素转变为基本要求。对消费者而言，这种竞争带来的安全性提升无疑是有益的，它意味着我们的个人数据将得到更好的保护，设备丢失或被盗时的风险也将降低。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762733061-Galaxy-S27-Ultra-may-finally-have-a-key-security-feature-iPhones-have-had-for-years.jpg"
loading="lazy"
alt="Galaxy S27 Ultra"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>[传言Galaxy&lt;/li>
&lt;/ul></description></item><item><title>OpenAI浏览器集成ChatGPT引隐私担忧；苹果或于2026年推廉价MacBook；神秘星际访客3I/ATLAS行为异常</title><link>https://www.jsongo.top/articles/openai-browser-privacy-apple-low-cost-macbook-and-interstellar-visitor-3i-atlas-11.09/</link><pubDate>Sun, 09 Nov 2025 22:12:12 +0800</pubDate><guid>https://www.jsongo.top/articles/openai-browser-privacy-apple-low-cost-macbook-and-interstellar-visitor-3i-atlas-11.09/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/3343f2913710598211a5970f85538887.jpg" alt="Featured image of post OpenAI浏览器集成ChatGPT引隐私担忧；苹果或于2026年推廉价MacBook；神秘星际访客3I/ATLAS行为异常" /></description></item><item><title>OpenAI浏览器集成ChatGPT引隐私担忧；苹果或于2026年推廉价MacBook；神秘星际访客3I/ATLAS行为异常</title><link>https://www.jsongo.top/articles/openai-browser-privacy-apple-low-cost-macbook-and-interstellar-visitor-3i-atlas-11.09/</link><pubDate>Sun, 09 Nov 2025 22:12:10 +0800</pubDate><guid>https://www.jsongo.top/articles/openai-browser-privacy-apple-low-cost-macbook-and-interstellar-visitor-3i-atlas-11.09/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/4eeb11a24039e694daca2aefd191e443.jpg" alt="Featured image of post OpenAI浏览器集成ChatGPT引隐私担忧；苹果或于2026年推廉价MacBook；神秘星际访客3I/ATLAS行为异常" /></description></item><item><title>苹果Siri将集成谷歌Gemini AI，年费高达10亿美元；备受期待的《GTA6》宣布延期至2026年底发售</title><link>https://www.jsongo.top/articles/apple-siri-google-gemini-gta6-delayed-2026-11.08/</link><pubDate>Sat, 08 Nov 2025 08:04:27 +0800</pubDate><guid>https://www.jsongo.top/articles/apple-siri-google-gemini-gta6-delayed-2026-11.08/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/4e076eb4ff636b6bf9f74fb25b6536ac.jpg" alt="Featured image of post 苹果Siri将集成谷歌Gemini AI，年费高达10亿美元；备受期待的《GTA6》宣布延期至2026年底发售" />&lt;h1 id="人工智能前沿进展">人工智能前沿进展
&lt;/h1>&lt;p>近期，人工智能领域正经历着前所未有的高速发展与深度融合。从科技巨头间史无前例的战略合作，到AI能力向汽车、个人设备等日常场景的快速渗透，人工智能正在重塑我们的技术生态。这些进展不仅展示了AI技术的成熟度，更预示着人机交互方式即将发生的根本性变革。&lt;/p>
&lt;h2 id="巨头联盟与生态整合">巨头联盟与生态整合
&lt;/h2>&lt;p>科技行业的两大巨头——苹果与谷歌，正在就一项可能重塑移动AI格局的合作进行深入谈判。与此同时，谷歌自身的AI产品也在加速向更多平台扩展，展现出AI技术从独立工具向生态系统核心组件演进的明确趋势。&lt;/p>
&lt;h3 id="苹果每年将向谷歌支付10亿美元以在siri中使用定制的gemini-ai模型">苹果每年将向谷歌支付10亿美元，以在Siri中使用定制的Gemini AI模型
&lt;/h3>&lt;p>据最新报道，苹果公司计划每年向谷歌支付高达10亿美元的费用，以便在Siri中集成谷歌专门为苹果定制的Gemini AI模型。这一合作标志着两大科技巨头在AI领域的深度捆绑，也反映了苹果在自研AI模型进展不及预期后的战略调整。值得注意的是，出于成本考虑，苹果最终选择了谷歌而非另一家AI公司Anthropic作为合作伙伴。&lt;/p>
&lt;p>这项合作如果最终达成，将彻底改变当前移动AI助手市场的竞争格局。苹果设备用户将能通过Siri体验到谷歌最先进的AI能力，而谷歌则能通过这一合作将其AI技术触达苹果庞大的用户群体。这种“竞合关系”体现了在AI研发成本日益高昂的背景下，即使是最强大的科技公司也需要通过合作来保持竞争力。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560255-wwdc24-siri-v3.jpg"
loading="lazy"
alt="Siri集成Gemini"
>&lt;/p>
&lt;h3 id="谷歌gemini现已登陆android-auto带来多项智能升级">谷歌Gemini现已登陆Android Auto，带来多项智能升级
&lt;/h3>&lt;p>谷歌Gemini已经开始在Android Auto上推出，为驾驶场景带来了更智能、更安全的AI体验。升级后的Gemini能够总结冗长的信息内容、提供情境化建议，并执行更加复杂的多步指令，显著提升了驾驶过程中的信息交互效率。&lt;/p>
&lt;p>这一集成特别优化了驾驶安全性，用户可以通过语音指令完成以往需要在手机上手动操作的任务。例如，Gemini可以快速总结未读消息的要点，根据行程安排推荐餐厅或加油站，甚至处理更复杂的查询如“找到沿途的充电站并估算到达时间”。这种无缝的语音交互体验代表了车载AI助手的未来发展方向。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560255-KzVEENfW8FWnFYDeuWR573-2000-80.jpg"
loading="lazy"
alt="Android Auto中的Gemini"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.cnet.com/tech/services-and-software/apple-to-pay-google-1-billion-per-year-for-siris-custom-gemini-ai-model-report-says/" target="_blank" rel="noopener"
>苹果每年将向谷歌支付10亿美元，以在Siri中使用定制的Gemini AI模型&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.techradar.com/vehicle-tech/car-infotainment/google-gemini-is-now-rolling-out-on-android-auto-here-are-the-upgrades-you-get" target="_blank" rel="noopener"
>谷歌Gemini现已登陆Android Auto，带来多项智能升级&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ai工具普及与硬件创新">AI工具普及与硬件创新
&lt;/h2>&lt;p>随着AI技术的成熟，其应用门槛正在迅速降低，普通用户现在也能轻松使用先进的AI图像生成工具。同时，硬件设备也在积极拥抱AI能力，从传统的笔记本电脑到新兴的智能戒指，都在探索AI技术的最佳落地场景。&lt;/p>
&lt;h3 id="如何使用chatgpt生成ai图片">如何使用ChatGPT生成AI图片？
&lt;/h3>&lt;p>OpenAI的ChatGPT现在已经具备了图像生成能力，让普通用户也能免费创作AI图片。这篇教程详细解释了使用ChatGPT生成图片的全部流程和技巧，从基本的提示词撰写到高级的风格控制，为初学者提供了完整的入门指南。&lt;/p>
&lt;p>教程强调了提示工程的重要性——如何通过精确的语言描述来引导AI生成符合预期的图像。与专业的AI绘画工具相比，ChatGPT的图像生成功能更加注重易用性和可访问性，降低了AI创作的技术门槛。这一功能的普及预示着AI正在从专业工具转变为大众创意助手。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560256-chatgpt-how-to-lede-1.jpg"
loading="lazy"
alt="ChatGPT生成图片"
>&lt;/p>
&lt;h3 id="sandbar推出stream-ring智能戒指主打ai语音笔记功能">Sandbar推出Stream Ring智能戒指，主打AI语音笔记功能
&lt;/h3>&lt;p>初创公司Sandbar推出了一款名为Stream Ring的AI智能戒指，它采取了与市场上其他智能戒指截然不同的产品策略。与专注于健康和睡眠追踪的主流智能戒指不同，Stream Ring将核心功能定位在AI语音笔记记录上，为智能穿戴设备市场带来了全新的思路。&lt;/p>
&lt;p>这款戒指通过优化的麦克风阵列和本地AI处理能力，能够准确捕捉和转录语音内容，特别适合会议记录、灵感捕捉等场景。其专注单一功能的做法反映了AI硬件市场正在出现的细分趋势——不同设备针对特定使用场景进行深度优化，而非追求大而全的功能覆盖。&lt;/p>
&lt;h3 id="宏碁predator-triton-14-ai笔记本评测游戏与创作的跨界之选">宏碁Predator Triton 14 AI笔记本评测：游戏与创作的跨界之选
&lt;/h3>&lt;p>宏碁推出的Predator Triton 14 AI笔记本试图同时满足游戏玩家和内容创作者的需求，评测显示它在大部分情况下都做得不错。这款设备集成了专用的AI处理单元，能够加速各种AI增强的创意应用和游戏功能。&lt;/p>
&lt;p>设备在性能平衡方面表现出色，既提供了足够的图形处理能力满足游戏需求，又通过AI优化提升了内容创作效率。这种“跨界”定位反映了PC市场的新趋势——硬件制造商正在寻找超越传统分类的产品定位，通过AI能力为设备增加独特的价值主张。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560256-Review-%20Acer%20Predator%20Triton%2014%20AI.png"
loading="lazy"
alt="宏碁Predator Triton 14 AI"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.engadget.com/ai/how-to-generate-ai-images-using-chatgpt-120000560.html" target="_blank" rel="noopener"
>如何使用ChatGPT生成AI图片？&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.wareable.com/wearable-tech/sandbar-ai-smart-stream-ring-voice-notes-announcement" target="_blank" rel="noopener"
>Sandbar推出Stream Ring智能戒指，主打AI语音笔记功能&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.wired.com/review/acer-predator-triton-14-ai/" target="_blank" rel="noopener"
>宏碁Predator Triton 14 AI笔记本评测：游戏与创作的跨界之选&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="互联网与软件动态">互联网与软件动态
&lt;/h1>&lt;p>互联网与软件行业正处在一个关键的转型期。从备受期待的游戏大作延期到操作系统更新，从公司结构调整到用户体验优化，这一领域的每个动向都在塑造着数字生活的未来面貌。平台整合、用户体验优化和开发策略调整成为当前的主要趋势。&lt;/p>
&lt;h2 id="游戏产业重大动向">游戏产业重大动向
&lt;/h2>&lt;p>游戏行业近期迎来了多个重量级消息，从备受期待的大作发售日期调整到主要游戏公司的战略重组，这些变化将对未来几年的游戏市场格局产生深远影响。玩家期待与商业现实之间的平衡再次成为行业焦点。&lt;/p>
&lt;h3 id="侠盗猎车手-vi确认延期至2026年11月19日发售">《侠盗猎车手 VI》确认延期至2026年11月19日发售
&lt;/h3>&lt;p>Rockstar Games正式宣布，全球玩家翘首以盼的《侠盗猎车手 VI》将延期至2026年11月19日发售。官方声明中表示，需要更多时间来达到玩家所期望的打磨水平。这一决定虽然令许多玩家失望，但也反映了游戏开发规模日益庞大、复杂度不断增加的行业现状。&lt;/p>
&lt;p>这次延期在游戏社区内引发了广泛讨论，许多分析师认为这体现了Rockstar对产品质量的坚持。在游戏开发成本节节攀升的背景下，确保首发质量对于《侠盗猎车手》这样的超级IP而言至关重要。延期决定也可能影响下一代游戏主机的推广节奏，因为许多玩家期待将GTA VI作为购买新主机的理由。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560259-c8c033070a0bfb2e3ec6ae7ff047ebe8ec551326.jpg"
loading="lazy"
alt="GTA VI"
>&lt;/p>
&lt;h3 id="史克威尔艾尼克斯宣布大规模裁员缩减海外开发业务">史克威尔艾尼克斯宣布大规模裁员，缩减海外开发业务
&lt;/h3>&lt;p>知名游戏公司史克威尔艾尼克斯宣布进行大规模裁员，作为其“重组”计划的一部分。公司决定减少“海外”开发业务，这一举措反映了日本游戏公司在全球化开发过程中面临的挑战，也可能预示着公司未来将更加专注于本土开发团队和核心IP。&lt;/p>
&lt;p>这一重组决定是在游戏开发成本不断上升、市场竞争日益激烈的背景下做出的。近年来，许多传统游戏大厂都在调整其全球开发策略，寻求在规模效率与创意质量之间找到新的平衡点。裁员消息也引发了行业对中型游戏公司可持续发展模式的思考。&lt;/p>
&lt;h3 id="宝可梦传说z-adlc将于12月发布首次突破100级等级上限">《宝可梦传说：Z-A》DLC将于12月发布，首次突破100级等级上限
&lt;/h3>&lt;p>任天堂确认《宝可梦传说：Z-A》的“百万维度”DLC将于12月10日在Switch和Switch 2上推出，并将首次允许玩家将宝可梦等级提升至100级以上。这一突破性的设计改变在系列历史上尚属首次，有望为游戏玩法带来全新的深度和策略层次。&lt;/p>
&lt;p>等级上限的突破不仅意味着数值上的扩展，更可能引入新的成长机制和战斗平衡调整。这一改变反映了游戏开发者如何在保持系列核心特色的同时，不断创新以满足资深玩家的期待。DLC的发布时间也暗示了任天堂对跨代主机兼容性的重视。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560259-pokemon-za-trailer-header.jpg"
loading="lazy"
alt="宝可梦传说Z-A"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.rockstargames.com/newswire/article/ak3ak31a49a221/grand-theft-auto-vi-is-now-set-to-launch-november-19-2026" target="_blank" rel="noopener"
>《侠盗猎车手 VI》确认延期至2026年11月19日发售&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.gamesindustry.biz/square-enix-announces-mass-layoffs-as-restructuring-plan-pulls-development-from-overseas" target="_blank" rel="noopener"
>史克威尔艾尼克斯宣布大规模裁员，缩减海外开发业务&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.eurogamer.net/pokemon-legends-z-a-dlc-arrives-in-december-and-for-the-first-time-in-series-history-lets-you-grow-your-mon-over-level-100" target="_blank" rel="noopener"
>《宝可梦传说：Z-A》DLC将于12月发布，首次突破100级等级上限&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="平台生态与系统安全">平台生态与系统安全
&lt;/h2>&lt;p>软件平台的演进正在加速，从操作系统的迭代更新到应用生态的整合优化，用户体验持续改善。与此同时，系统安全的重要性日益凸显，特别是在旧版操作系统支持逐渐退场的背景下，升级决策变得愈发关键。&lt;/p>
&lt;h3 id="苹果发布ios-262首个公开测试版新功能抢先看">苹果发布iOS 26.2首个公开测试版，新功能抢先看
&lt;/h3>&lt;p>苹果发布了iOS 26.2的第一个公开测试版，为想要提前体验新功能的用户提供了机会。这次更新预计将包含一系列优化和小型功能增强，延续了苹果近年来频繁更新操作系统的策略。&lt;/p>
&lt;p>公开测试版的发布让普通用户也能参与系统测试过程，这既帮助苹果收集更广泛的使用反馈，也增强了用户对平台发展的参与感。这种敏捷开发模式在移动操作系统中已变得日益常见，反映了软件交付方式的演变。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560260-iOS-26.2-public-beta.jpg"
loading="lazy"
alt="iOS 26.2测试版"
>&lt;/p>
&lt;h3 id="任天堂的应用太多了">任天堂的应用太多了
&lt;/h3>&lt;p>随着新的Nintendo Store应用的发布，任天堂现在有四个不同的应用需要用户管理，这让许多用户感到混乱和繁琐。应用功能的碎片化反映了公司在数字服务策略上的探索过程，但也暴露了平台体验协调方面的挑战。&lt;/p>
&lt;p>这种情况在科技公司中并不罕见，随着业务扩展，不同团队可能开发各自独立的应用程序，最终导致用户体验的割裂。任天堂面临的这一挑战也提醒其他科技公司，在推进数字化战略时需要更加注重平台的整体一致性。&lt;/p>
&lt;h3 id="如果你仍在使用windows-10仅更换杀毒软件是不够的">如果你仍在使用Windows 10，仅更换杀毒软件是不够的
&lt;/h3>&lt;p>微软发出警告，尽管Windows 10将继续接收反病毒更新，但这只提供了一半的保护。系统本身的安全漏洞将不再修复，用户应尽快升级到更新的操作系统版本。这一提醒强调了基础系统安全与附加安全软件之间的本质区别。&lt;/p>
&lt;p>随着Windows 10主流支持结束，继续使用该系统的企业和个人用户面临日益增加的安全风险。微软的警告也反映了软件行业的一个基本现实：没有任何第三方安全工具能够完全弥补底层操作系统的已知漏洞。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560260-windows-10-laptop.jpg"
loading="lazy"
alt="Windows 10安全"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://9to5mac.com/2025/11/06/apple-releases-first-ios-26-2-public-beta-heres-whats-new/" target="_blank" rel="noopener"
>苹果发布iOS 26.2首个公开测试版，新功能抢先看&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.theverge.com/games/815741/nintendo-apps-nintendo-store-nintendo-music" target="_blank" rel="noopener"
>任天堂的应用太多了&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.xda-developers.com/windows-10-new-antivirus-wont-be-enough/" target="_blank" rel="noopener"
>如果你仍在使用Windows 10，仅更换杀毒软件是不够的&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="硬件与半导体创新">硬件与半导体创新
&lt;/h1>&lt;p>消费电子硬件市场持续活跃，从智能手机的轻薄化竞争到各类电子产品的年度评选，创新步伐从未停歇。同时，一些有趣的产品故障解决方法和促销时机也为硬件领域增添了更多色彩，展现了行业的多面性。&lt;/p>
&lt;h2 id="智能手机与消费电子">智能手机与消费电子
&lt;/h2>&lt;p>移动设备领域的竞争依然激烈，各大厂商纷纷推出具有差异化特色的产品来争夺市场份额。从高端旗舰到中端机型，创新设计和价格策略共同推动着市场向前发展。&lt;/p>
&lt;h3 id="华为发布超薄新机定价590美元对标iphone-air">华为发布超薄新机，定价590美元对标iPhone Air
&lt;/h3>&lt;p>华为技术有限公司推出了一款全新的轻薄手机，定价590美元，旨在与苹果公司的iPhone Air直接竞争。这款超薄设备的发布为中国消费者提供了新的高端选择，也展示了华为在移动设备设计方面的持续创新能力。&lt;/p>
&lt;p>这款手机的定价策略尤其值得关注，它精准地定位在高端市场的入门价位，既保持了品牌的高端形象，又提供了相对亲民的价格点。在全球化竞争日益复杂的背景下，中国本土市场已成为各大手机厂商必争之地，本土化产品策略变得愈发重要。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560265-1200x800.jpg"
loading="lazy"
alt="华为超薄新机"
>&lt;/p>
&lt;h3 id="荣耀x7d在南非上市">荣耀X7d在南非上市
&lt;/h3>&lt;p>荣耀在南非市场推出了全新的HONOR X7d手机，目前已在全国范围内上市销售。这一发布体现了中国手机品牌在全球化扩张中的区域策略，针对特定市场推出定制化产品。&lt;/p>
&lt;p>南非作为非洲重要的智能手机市场，一直是国际品牌的必争之地。荣耀此次发布新品，显示了公司对全球新兴市场的持续投入，也反映了中国手机品牌在海外市场的差异化竞争策略——不再仅仅依靠价格优势，而是通过产品本地化和渠道建设来赢得市场。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560265-RM2_4879-scaled.jpg"
loading="lazy"
alt="荣耀X7d"
>&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.bloomberg.com/news/articles/2025-11-06/huawei-debuts-ultrathin-iphone-air-response-priced-at-590" target="_blank" rel="noopener"
>华为发布超薄新机，定价590美元对标iPhone Air&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.idiskitimes.co.za/featured/new-honor-x7d-drops-in-mzansi-stores/" target="_blank" rel="noopener"
>荣耀X7d在南非上市&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="电子产品评选与实用技巧">电子产品评选与实用技巧
&lt;/h2>&lt;p>年度电子产品评选为消费者提供了有价值的购买参考，同时一些出人意料的产品故障解决方法也展现了用户社区的创造力和经验分享的价值。&lt;/p>
&lt;h3 id="cnet读者评选2025年度100款最佳电子产品和装备">CNET读者评选：2025年度100款最佳电子产品和装备
&lt;/h3>&lt;p>CNET的读者评选出了2025年度百大最佳电子产品和装备，涵盖从耳机、吸尘器到笔记本电脑等多种类别。这种基于读者投票的评选反映了真实用户的偏好和体验，为消费者购买决策提供了实用参考。&lt;/p>
&lt;p>读者选择奖与专业编辑推荐的区别在于，它更侧重于产品的实际使用体验和市场接受度，而非纯粹的技术参数。这种评选方式也体现了科技媒体与读者社区之间的互动日益重要，用户声音正在产品评价中占据更大权重。&lt;/p>
&lt;h3 id="airpods-max没反应试试这个冷修复方法">AirPods Max没反应？试试这个“冷”修复方法
&lt;/h3>&lt;p>如果你的昂贵苹果耳机没有响应，一个奇怪但可能有效的方法是：把它放进冰箱里“冷静”一下。这一非传统的故障排除方法在用户社区中流传，虽然听起来不可思议，但据称对某些电子设备的重置确实有效。&lt;/p>
&lt;p>这种方法可能通过低温导致设备内部元件的轻微收缩，从而重置某些接触不良的连接。不过，专家也警告称，极端温度可能对电池和其他精密元件造成损害，建议用户仅在常规重置方法无效时谨慎尝试此类非正统解决方案。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762560266-airpods-max-frozen.jpg"
loading="lazy"
alt="AirPods Max修复"
>&lt;/p>
&lt;h3 id="无需等待黑五五星级lg-c5电视现已降至949英镑">无需等待黑五，五星级LG C5电视现已降至949英镑
&lt;/h3>&lt;p>在黑色星期五之前，备受好评的五星级LG C5电视价格降至949英镑的历史新低。这一促销活动反映了高端电视市场的竞争激烈程度，也显示了零售商如何通过调整促销节奏来刺激销售。&lt;/p>
&lt;p>提前到来的黑五级别优惠正在成为零售业的新趋势，商家通过拉长促销周期来分散物流压力并最大化销售额。对于消费者而言，这意味着购买高端电子产品不再需要等待特定的购物节日，而是需要持续关注价格波动。&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.cnet.com/deals/the-100-best-gear-and-gadgets-of-the-year-according-to-cnets-readers/" target="_blank" rel="noopener"
>CNET读者评选：2025年度100款最佳电子产品和装备&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.cnet.com/tech/mobile/if-your-airpods-max-are-not-responding-try-this-literally-cool-fix/" target="_blank" rel="noopener"
>AirPods Max没反应？试试这个“冷”修复方法&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.whathifi.com/tv-home-cinema/televisions/dont-wait-for-black-friday-snag-the-five-star-lg-c5-for-just-gbp949-right-now" target="_blank" rel="noopener"
>无需等待黑五，五星级LG C5电视现已降至949英镑&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="物理学新发现">物理学新发现
&lt;/h1>&lt;p>物理学领域近期取得了一系列突破&lt;/p></description></item><item><title>苹果豪掷十亿美金请谷歌升级Siri，地图内置Gemini AI，科技巨头AI竞赛全面升级</title><link>https://www.jsongo.top/articles/apple-pays-google-for-siri-upgrade-gemini-in-maps-ai-race-11.07/</link><pubDate>Fri, 07 Nov 2025 16:05:03 +0800</pubDate><guid>https://www.jsongo.top/articles/apple-pays-google-for-siri-upgrade-gemini-in-maps-ai-race-11.07/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/4e076eb4ff636b6bf9f74fb25b6536ac.jpg" alt="Featured image of post 苹果豪掷十亿美金请谷歌升级Siri，地图内置Gemini AI，科技巨头AI竞赛全面升级" />&lt;h1 id="人工智能前沿进展">人工智能前沿进展
&lt;/h1>&lt;p>近期，人工智能领域正经历着前所未有的变革与融合。从科技巨头间的战略合作到AI模型在日常应用中的深度集成，人工智能技术正以前所未有的速度和广度渗透到我们生活的方方面面。这些进展不仅预示着技术范式的转变，更将深刻重塑人机交互的未来图景。&lt;/p>
&lt;h2 id="语音助手与ai搜索的范式转变">语音助手与AI搜索的范式转变
&lt;/h2>&lt;p>人工智能领域正见证着从独立系统向生态融合的重大转变。科技巨头们不再满足于各自为战，而是通过战略合作将最先进的AI能力整合到核心产品中，同时新兴公司也在通过创新的AI原生体验挑战现有格局。&lt;/p>
&lt;h3 id="苹果接近与谷歌达成协议或年付10亿美元升级siri">苹果接近与谷歌达成协议，或年付10亿美元升级Siri
&lt;/h3>&lt;p>苹果公司正与谷歌进行深入谈判，计划每年支付高达10亿美元以使用谷歌的AI技术来彻底改造其语音助手Siri。这一潜在交易标志着苹果在AI战略上的重大转变，从坚持自主研发转向借助外部技术巨头的力量。若协议达成，Siri将获得谷歌最新AI模型的加持，有望在理解能力、响应速度和对话自然度上实现质的飞跃。&lt;/p>
&lt;p>这笔交易不仅关乎技术升级，更反映了苹果在AI竞赛中面临的紧迫压力。尽管苹果拥有强大的硬件生态和用户基础，但在生成式AI和大语言模型领域已明显落后于谷歌、微软等竞争对手。通过整合谷歌的AI技术，苹果有望快速弥补这一差距，同时将资源集中于其擅长的硬件与软件集成。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762502700-apple-on-phone.jpg"
loading="lazy"
alt="苹果Siri"
>&lt;/p>
&lt;h3 id="谷歌地图迎来gemini-ai导航与聊天功能全面升级">谷歌地图迎来Gemini AI，导航与聊天功能全面升级
&lt;/h3>&lt;p>谷歌正在将其最强大的Gemini AI模型深度集成到谷歌地图中，这将彻底改变人们的导航体验。新系统能够理解更复杂的自然语言请求，如“找一家有户外座位且允许狗狗进入的咖啡馆”，而不仅仅是简单的地点搜索。基于地标的导航功能将提供更人性化的指引，例如“在红色大楼后右转”，而非传统的距离指示。&lt;/p>
&lt;p>Gemini的集成还使地图具备了前瞻性提醒能力，能够基于用户的行程习惯、实时交通状况和个性化偏好提供智能建议。这种从工具到智能助手的转变，代表了AI在消费级应用中日益增长的重要性。随着AI理解上下文能力的提升，数字服务正变得更加直观和主动。&lt;/p>
&lt;h3 id="ai搜索新贵perplexity推出comet浏览器安卓版">AI搜索新贵Perplexity推出Comet浏览器安卓版
&lt;/h3>&lt;p>作为OpenAI的有力竞争者，AI搜索创业公司Perplexity已向早期用户开放其全新浏览器Comet的安卓测试版。Comet浏览器代表了“AI原生”体验的新尝试，旨在通过深度整合的AI功能重塑移动端的信息获取方式。与传统浏览器不同，Comet从设计之初就围绕AI交互构建，允许用户通过自然对话而非关键词搜索来获取信息。&lt;/p>
&lt;p>Perplexity的崛起反映了市场对新型信息检索工具的需求。在信息过载的时代，用户越来越倾向于获得直接、准确的答案，而非一长串需要自行筛选的链接。Comet浏览器的推出不仅是对传统搜索模式的挑战，也展示了AI如何从根本上改变我们与数字信息互动的方式。&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://techcrunch.com/2025/11/05/apple-nears-deal-to-pay-google-1b-annually-to-power-new-siri-report-says/" target="_blank" rel="noopener"
>苹果接近与谷歌达成协议，或年付10亿美元升级Siri&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.pcmag.com/news/google-maps-gemini-chat-landmark-based-navigation-proactive-alerts" target="_blank" rel="noopener"
>谷歌地图迎来Gemini AI，导航与聊天功能全面升级&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.androidauthority.com/perplexity-comet-browser-on-android-3613737/" target="_blank" rel="noopener"
>AI搜索新贵Perplexity推出Comet浏览器安卓版&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="互联网与软件生态演变">互联网与软件生态演变
&lt;/h1>&lt;p>互联网与软件行业正处于持续演进的关键阶段。操作系统更新带来新功能体验，社交媒体平台强化隐私保护，而商业纠纷则揭示了数字生态系统的脆弱性。同时，应用生态的碎片化问题引发用户对整合的迫切需求，个性化工具则展示了软件体验的精细化发展方向。&lt;/p>
&lt;h2 id="操作系统更新与平台功能演进">操作系统更新与平台功能演进
&lt;/h2>&lt;p>软件生态系统的核心——操作系统和主要应用平台正在经历重要更新，这些变化不仅带来新功能，也反映了科技公司对用户体验和平台生态的持续优化。从苹果的测试版发布到WhatsApp的用户名支持，这些进展显示了数字服务向更加个性化、隐私友好方向发展的趋势。&lt;/p>
&lt;h3 id="苹果发布ios-262首个公开测试版新功能抢先看">苹果发布iOS 26.2首个公开测试版，新功能抢先看
&lt;/h3>&lt;p>苹果已向公众发布iOS 26.2、iPadOS 26.2等系统的首个公开测试版，邀请普通用户体验并提供反馈。这种公开测试策略不仅有助于在正式版发布前发现并修复潜在问题，也增强了用户参与感和对品牌的忠诚度。测试版通常包含性能优化、界面微调和新功能预览，为正式版的最终定型提供重要参考。&lt;/p>
&lt;p>此次更新正值苹果准备深度整合AI功能的关键时期，iOS 26.2可能为后续更重大的AI升级奠定基础。通过逐步迭代而非颠覆性变革，苹果在保持系统稳定性的同时，持续推动用户体验向前发展。&lt;/p>
&lt;h3 id="whatsapp首次公布用户名功能上线时间表">WhatsApp首次公布用户名功能上线时间表
&lt;/h3>&lt;p>Meta旗下的WhatsApp首次公布了支持用户名的具体时间表和技术过渡计划。这一变化将允许用户使用独特的用户名代替手机号码作为身份标识，极大增强了隐私保护和使用的便利性。用户将能够在不泄露个人手机号的情况下与陌生人沟通，为商业用途和社群交流开辟了新可能性。&lt;/p>
&lt;p>用户名功能的引入也标志着WhatsApp从简单的通讯工具向更全面社交平台的演变。这一转变不仅响应了用户对隐私日益增长的需求，也使WhatsApp能更好地与Telegram等已支持用户名的竞争对手抗衡。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762502700-whatsapp-green.jpg"
loading="lazy"
alt="WhatsApp用户名"
>&lt;/p>
&lt;h2 id="商业纠纷与用户体验挑战">商业纠纷与用户体验挑战
&lt;/h2>&lt;p>数字生态系统中的商业关系和用户体验正面临新的挑战。从内容分发平台的纠纷到应用生态的碎片化，这些情况揭示了在追求商业利益和提供无缝体验之间需要取得的平衡。&lt;/p>
&lt;h3 id="迪士尼与谷歌纷争升级movies-anywhere停止同步电影购买">迪士尼与谷歌纷争升级，Movies Anywhere停止同步电影购买
&lt;/h3>&lt;p>迪士尼与谷歌旗下YouTube TV的商业纠纷已扩大到Movies Anywhere服务，用户通过谷歌购买的数字电影无法再与该平台同步。这一事件凸显了数字内容所有权和访问权的脆弱性——用户以为已购买的内容可能因企业间的协议变更而受到影响。&lt;/p>
&lt;p>这种平台间的冲突也引发了关于数字消费者权利的讨论。在物理媒体时代，消费者购买产品后即拥有永久使用权，但在数字领域，访问权往往受制于持续运营的服务和公司间的合作关系。这一案例可能促使消费者重新考虑数字内容购买的长期可靠性。&lt;/p>
&lt;h3 id="任天堂应用过多引诟病用户呼吁整合">任天堂应用过多引诟病，用户呼吁整合
&lt;/h3>&lt;p>随着新的Nintendo Store应用发布，任天堂旗下已有四个功能重叠的应用，给用户带来困惑。这种应用碎片化问题不仅增加了用户的学习成本，也导致了体验的不连贯。用户需要在不同应用间切换来完成购买、听音乐、管理账户等本应集成的功能。&lt;/p>
&lt;p>这种情况反映了大型科技公司在产品策略上可能存在的部门隔阂问题。当不同团队负责不同功能时，很容易产生各自为政的应用生态，而非从用户角度设计的统一体验。任天堂的例子也是整个行业的一个缩影，提醒科技公司需更加重视产品的整体一致性。&lt;/p>
&lt;h3 id="谷歌为pixel发布主题包应用实现一键个性化">谷歌为Pixel发布“主题包”应用，实现一键个性化
&lt;/h3>&lt;p>谷歌为Pixel手机推出名为“主题包”的新应用，允许用户通过一键操作快速个性化手机的壁纸、图标和颜色主题。这种简化的个性化体验反映了软件设计向降低用户决策负担发展的趋势。通过预置协调的视觉方案，用户无需具备专业设计知识也能打造美观一致的界面。&lt;/p>
&lt;p>主题包应用也展示了谷歌在软硬件整合上的优势。作为Android的开发者，谷歌能够为Pixel设备提供深度系统级定制，这种垂直整合创造了竞争对手难以复制的用户体验。个性化不再只是表面装饰，而是成为设备整体体验的核心组成部分。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762502701-Google-Pixel-Theme-packs-cover.jpg"
loading="lazy"
alt="谷歌主题包"
>&lt;/p>
&lt;h2 id="行业动态与工作文化">行业动态与工作文化
&lt;/h2>&lt;p>科技行业的工作文化和商业实践继续引发关注，特别是在游戏开发这样的高压环境中。这些讨论不仅关乎个别公司的管理方式，更反映了整个行业对可持续开发实践和员工权益的思考。&lt;/p>
&lt;h3 id="gta开发商r星回应裁员因部分员工泄露信息">《GTA》开发商R星回应裁员：因部分员工泄露信息
&lt;/h3>&lt;p>R星工作室证实近期解雇的30多名员工涉及泄露公司机密信息，此次裁员正值《GTA》新作开发的关键时期。游戏行业，特别是3A级大作开发，一直面临着保密与透明度的平衡挑战。一方面，公司需要保护知识产权和营销计划；另一方面，过度保密可能助长不利于员工的工作文化。&lt;/p>
&lt;p>这一事件也发生在游戏行业工会化讨论日益增多的背景下，引发了关于裁员动机的争议。无论实际情况如何，此类事件都凸显了科技和游戏行业需要更加健康、透明的工作环境和沟通机制。&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.iclarified.com/98988/apple-releases-first-public-beta-of-ios-262-ipados-262-watchos-262-and-more-download" target="_blank" rel="noopener"
>苹果发布iOS 26.2首个公开测试版，新功能抢先看&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.bloomberg.com/news/articles/2025-11-05/-grand-theft-auto-studio-says-fired-employees-were-leaking-information" target="_blank" rel="noopener"
>《GTA》开发商R星回应裁员：因部分员工泄露信息&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://9to5mac.com/2025/11/06/whatsapp-username-support-timeline/" target="_blank" rel="noopener"
>WhatsApp首次公布用户名功能上线时间表&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://9to5google.com/2025/11/05/disney-youtube-tv-feud-extends-to-movies-anywhere-google-no-longer-syncs/" target="_blank" rel="noopener"
>迪士尼与谷歌纷争升级，Movies Anywhere停止同步电影购买&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.theverge.com/games/815741/nintendo-apps-nintendo-store-nintendo-music" target="_blank" rel="noopener"
>任天堂应用过多引诟病，用户呼吁整合&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://9to5google.com/2025/11/05/pixel-theme-packs/" target="_blank" rel="noopener"
>谷歌为Pixel发布“主题包”应用，实现一键个性化&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="硬件与半导体创新">硬件与半导体创新
&lt;/h1>&lt;p>硬件领域正展现出多元化的创新趋势，从高端AR设备到平价笔记本电脑，从专业AI系统到复古科技产品，不同价位的设备都在重新定义用户体验。这些发展不仅展示了技术进步的广度，也反映了市场对多样化硬件需求的响应。&lt;/p>
&lt;h2 id="消费电子产品的多元化演进">消费电子产品的多元化演进
&lt;/h2>&lt;p>消费电子产品市场正呈现出两极分化又相互补充的发展态势。一方面，高端设备如AR头显不断探索体验的边界；另一方面，主流设备通过降价和促销让更多用户享受到先进技术。同时，复古与现代结合的产品则满足了用户的情感需求。&lt;/p>
&lt;h3 id="apple-vision-pro-m5-评测终极家庭影院的雏形">Apple Vision Pro (M5) 评测：终极家庭影院的雏形
&lt;/h3>&lt;p>尽管苹果第二代Vision Pro（搭载M5芯片）依然体积庞大且价格昂贵，但它正逐渐演变为终极的家庭影院设备，提供了无与伦比的视听体验。这款设备通过高分辨率显示器和空间音频技术，创造了沉浸式的观影环境，用户可以在虚拟巨幕前享受个人影院体验。&lt;/p>
&lt;p>Vision Pro的演进也反映了AR/VR设备寻找主流应用场景的努力。在游戏和企业应用之外，家庭娱乐正成为这类设备的一个重要价值主张。随着内容生态的逐步完善和硬件体验的优化，AR/VR设备有望在特定使用场景中确立不可替代的地位。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762502701-Vision-Pro.jpg"
loading="lazy"
alt="Apple Vision Pro"
>&lt;/p>
&lt;h3 id="黑五大促m4-macbook-air价格创历史新低750美元起售">黑五大促：M4 MacBook Air价格创历史新低，750美元起售
&lt;/h3>&lt;p>黑色星期五促销提前开始，亚马逊上最新款的M4 MacBook Air价格降至新低，起售价仅为749.99美元。这种大幅降价不仅反映了激烈的市场竞争，也显示了苹果希望通过亲民价格推动其自研芯片生态的普及。M4芯片的强大性能与相对低廉的价格结合，使更多用户能够体验到苹果硅的卓越能效。&lt;/p>
&lt;p>价格策略的调整也揭示了消费电子行业的一个趋势：随着技术成熟和规模效应，曾经高端的技术正以更快速度普及到主流市场。这对消费者而言意味着能以更低成本获得更强大的计算能力。&lt;/p>
&lt;h3 id="谷歌pixel-10系列在亚马逊迎来降价">谷歌Pixel 10系列在亚马逊迎来降价
&lt;/h3>&lt;p>亚马逊对谷歌Pixel 10系列手机进行了降价促销，涵盖所有型号。对于希望以更低价格购入谷歌最新旗舰手机的用户来说，这是一个不错的机会。Pixel系列的降价通常发生在发布后数月内，这既是为了清理库存为新品让路，也是为了在竞争激烈的智能手机市场中保持吸引力。&lt;/p>
&lt;p>谷歌的硬件策略一直是在展示Android系统最佳体验的同时，通过后续降价扩大用户基础。这种模式不同于苹果的高端定位，反映了谷歌作为软件和服务公司对硬件业务的不同理解——设备本身也是服务和生态系统的入口。&lt;/p>
&lt;h3 id="复古风潮回归带蓝牙功能的高科技cd播放器正流行">复古风潮回归：带蓝牙功能的高科技CD播放器正流行
&lt;/h3>&lt;p>一股复古科技浪潮正在兴起，集成了蓝牙等现代功能的CD播放器重新受到欢迎。这种趋势反映了消费者对实体媒介的情感依恋与对现代便利性的双重需求。在流媒体音乐主导的时代，CD播放器提供了有形的音乐收藏体验，同时通过蓝牙连接保持了与现代无线音箱和耳机的兼容性。&lt;/p>
&lt;p>复古科技的复兴不仅仅是怀旧，更是对数字化过度的一种回应。物理媒介提供的所有权感、专辑艺术品的欣赏以及有意识的聆听体验，都是纯数字流媒体难以复制的。这种趋势展示了科技发展并非总是线性的替代，而是可以形成新旧融合的共生关系。&lt;/p>
&lt;h2 id="专业硬件的非常规应用">专业硬件的非常规应用
&lt;/h2>&lt;p>专业级硬件正被探索用于非设计初衷的领域，这种跨界应用不仅展示了硬件的通用潜力，也为未来技术发展提供了有趣的启示。&lt;/p>
&lt;h3 id="昂贵的英伟达ai系统被用于玩游戏性能表现惊人">昂贵的英伟达AI系统被用于玩游戏，性能表现惊人
&lt;/h3>&lt;p>有玩家尝试在价值4000美元的英伟达DGX Spark AI系统上运行《赛博朋克》和PS3游戏，虽然并非最佳选择，但这成功证明了其强大的图形处理潜力。这种非常规使用案例展示了高端专业硬件在消费级应用中的潜力，尽管从性价比角度看并不合理。&lt;/p>
&lt;p>此类实验也引发了关于硬件专用性与通用性的讨论。随着AI和图形处理在技术上的趋同，未来我们可能会看到更多跨界应用的案例。专业级硬件的能力通常远超其设计用途，这种探索精神有助于推动技术边界和理解硬件的真实潜力。&lt;/p>
&lt;p>原文链接：&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.gq.com/story/apple-vision-pro-m5-review" target="_blank" rel="noopener"
>Apple Vision Pro (M5) 评测：终极家庭影院的雏形&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.pcmag.com/news/nvidia-dgx-spark-systems-can-play-cyberpunk-ps3-games-for-a-price" target="_blank" rel="noopener"
>昂贵的英伟达AI系统被用于玩游戏，性能表现惊人&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.macrumors.com/2025/11/05/m4-macbook-air-black-friday/" target="_blank" rel="noopener"
>黑五大促：M4 MacBook Air价格创历史新低，750美元起售&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.wired.com/story/pixel-10-deal-1125/" target="_blank" rel="noopener"
>谷歌Pixel 10系列在亚马逊迎来降价&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mashable.com/article/high-tech-bluetooth-cd-players-trend" target="_blank" rel="noopener"
>复古风潮回归：带蓝牙功能的高科技CD播放器正流行&lt;/a>&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="航空航天与物理学探索">航空航天与物理学探索
&lt;/h1>&lt;p>航空航天与物理学领域正取得令人瞩目的突破，从系外行星大气研究到火箭技术进展，从材料科学发现到气候变化研究，人类对宇宙和自然规律的理解正在不断深化。这些进展不仅拓展了知识的边界，也为解决地球面临的挑战提供了新视角。&lt;/p>
&lt;h2 id="宇宙探索与天文发现">宇宙探索与天文发现
&lt;/h2>&lt;p>天文学和太空探索领域正经历着数据爆炸的时代，先进望远镜和探测任务为我们提供了前所未有的宇宙视角。从系外行星的大气成分到太阳的剧烈活动，这些发现正在重塑我们对宇宙的认识。&lt;/p>
&lt;h3 id="韦伯望远镜首次绘制系外行星大气3d地图并发现水被撕裂">韦伯望远镜首次绘制系外行星大气3D地图，并发现水被撕裂
&lt;/h3>&lt;p>天文学家利用詹姆斯·韦伯太空望远镜，首次绘制了一颗系外行星（WASP-18b）大气的3D地图，揭示了其极端的温度变化，并发现水分子被撕裂的迹象。这一突破性成果展示了韦伯望远镜前所未有的观测能力，能够解析数百光年外行星大气的精细结构。&lt;/p>
&lt;p>WASP-18b是一颗“热木星”类系外行星，极其靠近其母星，导致表面温度极高且分布不均。水分子被撕裂的发现表明该行星大气中发生着剧烈的光化学反应。这类研究不仅增进了我们对系外行星多样性的理解，也为寻找可能适合生命存在的系外行星提供了重要参考。&lt;/p>
&lt;p>&lt;img src="https://cdn.lyb.pub/news/blog/1762502703-HreGatyTPXKAUnifhbdTaF-1140-80.jpg"
loading="lazy"
alt="韦伯望远镜"
>&lt;/p>
&lt;h3 id="第二颗atlas彗星掠过太阳后变成金色">第二颗ATLAS彗星掠过太阳后变成金色
&lt;/h3>&lt;p>在著名的星际彗星3I/ATLAS之外，另一颗同名彗星C/2025 K1 (ATLAS)在近日点附近呈现出罕见的金色光芒。彗星在接近太阳时颜色变化并不罕见，但呈现金色则相对特殊，这可能与彗星表面物质的成分和太阳辐射的相互作用有关。&lt;/p>
&lt;p>彗星作为太阳系形成初期的残留物，其研究价值在于它们保留了原始太阳系物质的信息。通过分析彗星在不同位置的颜色和成分变化，天文学家能够推断太阳系早期的条件和演化历程。C/2025 K1的观测为这类研究提供了新的案例。&lt;/p>
&lt;h3 id="摄影师捕捉到太阳上空舞动的火热等离子体">摄影师捕捉到太阳上空舞动的火热等离子体
&lt;/h3>&lt;p>一位天文摄影师捕捉到太阳边缘上方氢等离子体云舞动的壮观视频，以惊人的特写镜头展示了太阳的动态之美。这些等离子体结构，称为日珥，是受太阳磁场约束的较冷稠密气体，在太阳表面上方形成巨大的弧状结构。&lt;/p>
&lt;p>此类观测不仅具有美学价值，也具有重要科学意义。日珥的动态行为反映了太阳磁场的复杂变化，有助于科学家预测太空天气事件，这些事件可能影响地球上的电网、卫星通信和导航系统。业余天文摄影师的贡献也显示了公民科学在天文研究中的日益重要性。&lt;/p>
&lt;h2 id="航天技术与材料科学">航天技术与材料科学
&lt;/h2>&lt;p>航天技术的实用化和材料科学的基础研究正并行推进，从可重复使用火箭到超导材料，这些进展既拓展了人类进入太空的能力，也为下一代技术奠定了基础。&lt;/p>
&lt;h3 id="蓝色起源新格伦火箭完成关键静态点火测试首飞在即">蓝色起源“新格伦”火箭完成关键静态点火测试，首飞在即
&lt;/h3>&lt;p>蓝色起源公司的“新格伦”重型火箭成功完成了一级发动机的静态点火测试，为其即将进行的首次发射任务ESCAPADE扫清了道路。新格伦火箭是蓝色起源进入重型发射市场的重要产品，设计为部分可重复使用，旨在降低进入太空的成本。&lt;/p>
&lt;p>重型发射能力的竞争正日益激烈，新格伦火箭将与SpaceX的猎鹰重型火箭和联合发射联盟的火神火箭直接竞争。更多的发射选择有利于太空产业的发展，推动卫星部署、科学研究和未来深空&lt;/p></description></item><item><title>OpenAI发布安卓版Sora，AI浏览器引付费墙争议，苹果更新iOS Liquid Glass功能</title><link>https://www.jsongo.top/articles/openai-sora-android-ai-browser-paywall-apple-ios-liquid-glass-11.06/</link><pubDate>Thu, 06 Nov 2025 15:59:05 +0800</pubDate><guid>https://www.jsongo.top/articles/openai-sora-android-ai-browser-paywall-apple-ios-liquid-glass-11.06/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/4e076eb4ff636b6bf9f74fb25b6536ac.jpg" alt="Featured image of post OpenAI发布安卓版Sora，AI浏览器引付费墙争议，苹果更新iOS Liquid Glass功能" />&lt;h1 id="人工智能前沿进展">【人工智能前沿进展】
&lt;/h1>&lt;h2 id="ai生成式应用的普及与伦理挑战">AI生成式应用的普及与伦理挑战
&lt;/h2>&lt;p>近期，人工智能生成式应用正加速融入日常生活，同时其引发的伦理问题也日益凸显。OpenAI的视频生成应用Sora正式登陆安卓平台，标志着生成式AI从桌面端向移动端的大规模扩展，极大地降低了用户创作AI视频的门槛。与此同时，部分AI浏览器被发现具备绕过新闻网站付费墙的能力，这引发了关于AI伦理、知识产权保护和数字内容商业模式可持续性的激烈讨论。这些进展不仅展示了AI技术的快速普及，也暴露了技术发展过程中需要解决的法律与道德困境。&lt;/p>
&lt;p>&lt;img src="https://image.cnbcfm.com/api/v1/image/108214983-17610771932025-10-21t195023z_2008595976_rc2jghajhi33_rtrmadp_0_openai-sora.jpeg?v=1761077292&amp;amp;w=1920&amp;amp;h=1080"
loading="lazy"
alt="AI生成图像"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.cnbc.com/2025/11/04/openai-sora-android.html" target="_blank" rel="noopener"
>OpenAI的AI视频生成应用Sora正式登陆安卓系统&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://mashable.com/article/some-ai-browsers-can-bypass-paywalls" target="_blank" rel="noopener"
>报告称部分AI浏览器可绕过新闻网站的付费墙&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="ai在医疗诊断与生态保护中的创新应用">AI在医疗诊断与生态保护中的创新应用
&lt;/h2>&lt;p>人工智能正在医疗诊断和环境保护领域展现出变革性潜力。研究人员发现通过分析人类声音的&amp;quot;声纹&amp;quot;特征，可以早期检测阿尔茨海默病的迹象，这为神经退行性疾病的非侵入性筛查提供了全新途径。另一方面，AI驱动的遥感技术被用于绘制中国北方旱地区域的牧草种植潜力图，通过分析卫星图像和环境数据，为生态恢复和农业可持续发展提供精准的数据支持。这些应用不仅拓展了AI的实用边界，也体现了技术解决现实问题的社会价值。&lt;/p>
&lt;p>&lt;img src="https://assets.medpagetoday.net/media/images/118xxx/118308.jpg"
loading="lazy"
alt="医疗AI"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.medpagetoday.com/neurology/generalneurology/118308" target="_blank" rel="noopener"
>“声纹”或可用于早期检测阿尔茨海默病&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://phys.org/news/2025-11-ai-driven-remote-framework-forage.html" target="_blank" rel="noopener"
>AI驱动的遥感技术可绘制干旱地区的牧草种植潜力&lt;/a>&lt;/li>
&lt;/ul>
&lt;h1 id="科学与基础研究突破">【科学与基础研究突破】
&lt;/h1>&lt;h2 id="量子材料与基本粒子研究的新视野">量子材料与基本粒子研究的新视野
&lt;/h2>&lt;p>物理学研究在微观世界取得了突破性进展。研究人员首次通过实验揭示了某些量子材料中&amp;quot;极化子&amp;quot;的形成过程，这种粒子间的复杂相互作用会导致材料突然失去导电性，为理解量子相变提供了关键见解。同时，科学家利用粒子对撞机在实验室中创造出等离子体&amp;quot;火球&amp;quot;，这一成就帮助解释了与超大质量黑洞喷流相关的伽马射线爆发之谜，将天体物理现象带入了可控的实验研究范畴。这些发现不仅深化了我们对物质基本性质的理解，也为未来量子计算和能源技术奠定了基础。&lt;/p>
&lt;p>&lt;img src="https://gizmodo.com/app/uploads/2025/11/desy-polaron-thulium-researchers-working-1200x675.jpg"
loading="lazy"
alt="量子研究"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://gizmodo.com/physicists-decode-particle-dance-that-kills-electrical-conductivity-2000680939" target="_blank" rel="noopener"
>物理学家解码导致某些量子材料“杀死”导电性的粒子相互作用&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.iflscience.com/worlds-first-plasma-fireballs-help-explain-supermassive-black-hole-mystery-81430" target="_blank" rel="noopener"
>世界首个等离子体“火球”实验有助于解释超大质量黑洞之谜&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="宇宙奥秘与天体形成机制的新发现">宇宙奥秘与天体形成机制的新发现
&lt;/h2>&lt;p>天文学领域近期涌现出多项令人振奋的发现。研究人员在银河系中发现了一个前所未见的&amp;quot;完美圆形&amp;quot;天体，这种被称为&amp;quot;奇特射电圈&amp;quot;的神秘结构挑战了现有的天体形成理论。与此同时，天文学家首次绘制出行星形成盘中的磁场图，揭示了这些看不见的力量是如何塑造新世界诞生的过程。对宇宙最古老星系的研究表明，它们在形成初期非常混乱和炽热，与现代的有序星系形成鲜明对比，这为了解星系演化提供了重要线索。&lt;/p>
&lt;p>&lt;img src="https://evidencenetwork.ca/wp-content/uploads/2025/10/6480846130354-2025-05-22T135610.888.jpg"
loading="lazy"
alt="宇宙探索"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://evidencenetwork.ca/no-one-had-ever-seen-it-before-a-perfect-circle-floating-in-the-milky-way-is-baffling-astronomers/" target="_blank" rel="noopener"
>天文学家在银河系中发现神秘的“完美圆形”天体&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.earth.com/news/astronomers-observe-how-magnetic-fields-shape-new-planets-for-the-first-time/" target="_blank" rel="noopener"
>天文学家首次观测到磁场如何塑造新行星的形成&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.space.com/astronomy/galaxies/our-universes-oldest-galaxies-were-hot-messes" target="_blank" rel="noopener"
>研究发现宇宙中最古老的星系在其形成初期是“一团糟”&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="原子核研究与宇宙模拟的理论突破">原子核研究与宇宙模拟的理论突破
&lt;/h2>&lt;p>基础物理研究在微观和宏观尺度上都取得了重要进展。麻省理工学院的科学家们利用氟化镭分子作为探针，成功观测到电子进入原子核的现象，为研究原子核内部的磁性提供了革命性的新方法。另一方面，一项关于宇宙模拟理论的研究认为，现实世界的极端复杂性可能排除了我们生活在一个由先进文明控制的计算机模拟中的可能性，这一结论对哲学和物理学的基本假设提出了挑战。&lt;/p>
&lt;p>&lt;img src="https://cff2.earth.com/uploads/2025/11/04114746/radium-atom_pear-shaped-nucleus_MIT_1m.jpg"
loading="lazy"
alt="原子研究"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.earth.com/news/new-method-allows-scientists-to-look-inside-a-radium-atoms-nucleus/" target="_blank" rel="noopener"
>新方法使科学家能够“看到”原子核内部&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://gizmodo.com/reality-is-too-complex-for-any-cosmic-computer-simulation-study-suggests-2000680757" target="_blank" rel="noopener"
>研究表明，现实世界过于复杂，不太可能是宇宙计算机模拟的结果&lt;/a>&lt;/li>
&lt;/ul>
&lt;h1 id="有趣的科技进展">【有趣的科技进展】
&lt;/h1>&lt;h2 id="商业航天与空间探索的新里程碑">商业航天与空间探索的新里程碑
&lt;/h2>&lt;p>商业航天领域正迎来激动人心的突破。初创公司Vast通过一系列逐步复杂的演示任务，成功在太空中取得了立足点，其独特的渐进式发展策略与其他空间站竞争者形成了鲜明对比。同时，天文学家利用洛厄尔天文台的望远镜，拍摄到了星际彗星3I/ATLAS从太阳后面再次出现的首批光学图像，这为研究星际访客的物理特性提供了珍贵数据。这些成就标志着人类探索太空的能力正在从政府主导转向更加多元化的商业与科研合作模式。&lt;/p>
&lt;p>&lt;img src="https://cdn.arstechnica.net/wp-content/uploads/2025/11/haven_demo_array-1152x648.jpg"
loading="lazy"
alt="太空探索"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://arstechnica.com/space/2025/11/a-commercial-space-station-startup-now-has-a-footold-in-space/" target="_blank" rel="noopener"
>商业空间站初创公司Vast在太空取得重要进展&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.livescience.com/space/comets/astronomer-reveals-first-look-at-comet-3i-atlas-as-it-reappears-from-behind-the-sun" target="_blank" rel="noopener"
>天文学家首次捕捉到星际彗星3I/ATLAS重现的身影&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="生物科技与环境科学的创新解决方案">生物科技与环境科学的创新解决方案
&lt;/h2>&lt;p>生物技术领域涌现出多个解决全球性挑战的创新方案。研究人员发现了海洋细菌中能够分解塑料的酶的共同&amp;quot;基序&amp;quot;，揭示了这些微生物是如何在全球范围内演化出&amp;quot;消化&amp;quot;塑料能力的，这为应对塑料污染提供了生物技术途径。同时，为了解决农药喷洒时液滴容易从疏水性叶片上滑落的问题，科学家开发出一种新型粘性溶液，可以显著增强农药在植物表面的附着力，从而提高农药使用效率并减少环境污染。&lt;/p>
&lt;p>&lt;img src="https://scx2.b-cdn.net/gfx/news/hires/2025/plastic-munching-bacte.jpg"
loading="lazy"
alt="生物科技"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://phys.org/news/2025-11-enzyme-motif-reveals-plastic-munching.html" target="_blank" rel="noopener"
>酶的共同特征揭示了&amp;quot;吃塑料&amp;quot;细菌的演化过程&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://phys.org/news/2025-11-sticky-solution-pesticide-deposition.html" target="_blank" rel="noopener"
>一种用于增强农药附着力的粘性溶液被开发出来&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="硬件创新与传感器技术的突破">硬件创新与传感器技术的突破
&lt;/h2>&lt;p>硬件技术领域出现了多项提升设备性能的创新。研究人员开发出基于超薄透镜的高灵敏度红外传感器，能够更有效地探测环境中的热点，在火灾预警和军事威胁监测方面具有重要应用价值。纳米孔测序技术的进步使得科学家能够绘制出海洋甲藻复杂且庞大的基因组图谱，为了解这些重要海洋微生物的独特生物学特性提供了关键工具。这些技术创新不仅提升了设备的性能，也拓展了科学研究的边界。&lt;/p>
&lt;p>&lt;img src="https://scx2.b-cdn.net/gfx/news/hires/2025/infrared-sensors-gain.jpg"
loading="lazy"
alt="硬件创新"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://phys.org/news/2025-11-infrared-sensors-gain-sensitivity-ultra.html" target="_blank" rel="noopener"
>超薄透镜提升红外传感器灵敏度，可用于火灾和威胁监测&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.geneonline.com/nanopore-sequencing-unveils-complex-genetic-structure-of-marine-dinoflagellate-amphidinium-carterae/" target="_blank" rel="noopener"
>纳米孔测序技术揭示海洋甲藻的复杂遗传结构&lt;/a>&lt;/li>
&lt;/ul>
&lt;h1 id="其他值得关注的进展">【其他值得关注的进展】
&lt;/h1>&lt;h2 id="地球科学与环境监测的重要发现">地球科学与环境监测的重要发现
&lt;/h2>&lt;p>地球科学研究揭示了环境变化的严峻现实。最新研究显示，南极洲的一处冰川正在以比之前测量快10倍的速度退缩，这一发现加剧了人们对全球海平面上升的担忧。在澳大利亚沙漠中发现的奇特玻璃状物质，被证实是一次科学家们此前未知的大规模陨石撞击事件的证据，这为了解地球历史上的撞击事件提供了新的时间标尺。这些发现强调了持续监测地球环境变化和深入研究地球历史的重要性。&lt;/p>
&lt;p>&lt;img src="https://www.sciencealert.com/images/2025/10/aus-impact.jpg"
loading="lazy"
alt="环境研究"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://abcnews.go.com/International/antarctic-glacier-retreating-rate-10-times-faster-previously/story?id%5c%5cu003d127026285" target="_blank" rel="noopener"
>研究发现南极冰川退缩速度是先前测量的10倍&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://www.sciencealert.com/strange-glass-in-australia-reveals-a-massive-impact-we-never-knew-about" target="_blank" rel="noopener"
>澳大利亚发现的奇特玻璃揭示了一次未知的陨石撞击事件&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="消费电子与游戏产业的动态">消费电子与游戏产业的动态
&lt;/h2>&lt;p>消费科技领域出现了一些值得关注的发展趋势。微软旗下的《光环》系列游戏即将登陆索尼PlayStation平台，这一举动被视为游戏主机独占时代的终结信号，可能预示着主机战争的时代正在走向终结。谷歌Pixel 10系列在美国市场创下了&amp;quot;单月销售记录&amp;quot;，显示出在激烈竞争的智能手机市场中，创新产品仍然能够获得消费者的认可。这些发展反映了科技行业生态系统的持续演变和消费者偏好的变化。&lt;/p>
&lt;p>&lt;img src="https://i.cbc.ca/ais/ea197783-ee19-4621-adfa-5e80767471b8,1762283493828/full/max/0/default.jpg?im=Crop%2Crect%3D%280%2C312%2C3000%2C1687%29%3BResize%3D620"
loading="lazy"
alt="游戏产业"
>&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://www.cbc.ca/arts/commotion/halo-will-soon-be-available-on-playstation-does-this-signal-an-end-to-the-console-wars-9.6966469" target="_blank" rel="noopener"
>《光环》即将登陆PlayStation，主机战争或将结束？&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="http://9to5google.com/2025/11/03/pixel-10-is-a-hit-in-the-us-with-googles-new-single-month-sales-record-amid-iphone-17/" target="_blank" rel="noopener"
>谷歌Pixel 10在美国创下&amp;quot;单月销售记录&amp;quot;&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Obsidian linter 自定义规则</title><link>https://www.jsongo.top/articles/obsidian-linter-custom-rules/</link><pubDate>Sun, 13 Apr 2025 01:10:36 +0800</pubDate><guid>https://www.jsongo.top/articles/obsidian-linter-custom-rules/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/9ce4b7fc6ab166efa82ba9c3b5423dd2.jpg" alt="Featured image of post Obsidian linter 自定义规则" />&lt;p>先看一个例子，我之前有很多复制过来的内容，会在 header 上添加粗体的样式，其实这些我不需要，因为 header 本身就有加粗的样式。问题格式如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">## ** Logging 的作用 **
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>要把 &lt;code>**&lt;/code> 给去掉。&lt;br>
Linter 其实可以自己设置替换规则，如下图：&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744478055_4zpryr.webp"
loading="lazy"
>&lt;br>
其中 &lt;code>^(#{1,6}.*?)\s+\*\*(.*?)\*\*\s*$&lt;/code> 匹配上面这种有问题的标题，然后替换成正常的（两个括号分析指定的 $1 $2）。&lt;br>
如果不懂怎么配置，可以问 chatgpt，让它给你写正则就可以了。&lt;/p></description></item><item><title>upic 图床工具</title><link>https://www.jsongo.top/articles/upic-image-tool/</link><pubDate>Sat, 12 Apr 2025 16:59:03 +0800</pubDate><guid>https://www.jsongo.top/articles/upic-image-tool/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/949a9178ccc501fe2ddb271fd63ba29b.jpeg" alt="Featured image of post upic 图床工具" />&lt;h1 id="安装">安装
&lt;/h1>&lt;p>从这里可以找到 upic &lt;a class="link" href="https://github.com/gee1k/uPic" target="_blank" rel="noopener"
>GitHub - 📤uPic is a native, powerful, beautiful and simple picture and file upload tool&amp;hellip;&lt;/a>&lt;br>
如果通过 app store 来安装，它是收费，下载的版本可能不太一样。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744475945_34Huac.webp"
loading="lazy"
alt="|408x325"
>&lt;br>
而如果通过上面 github 链接来安装，比如 mac 上，它可以通过 brew 来装&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">brew install bigwig-club/brew/upic --cask
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="cloudflare-设置">Cloudflare 设置
&lt;/h1>&lt;p>菜单上进入 R2，在首页的右侧可以看到下图中的 API tokens 管理的选项，点击进入。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744475946_0TXAdx.webp"
loading="lazy"
>&lt;br>
选 User API Token 就行，权限最小化。填写一些基础的选项：&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744475947_LKC9Ly.webp"
loading="lazy"
>&lt;br>
生成的各种 key 等记下来，后面用到。&lt;/p>
&lt;h1 id="设置-upic">设置 Upic
&lt;/h1>&lt;p>在 upic 设置添加图床时，要先 Amazon S3 (是的，cloudflare R2 也是选这个)。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744475949_sqc9BT.webp"
loading="lazy"
alt="|276x395"
>&lt;br>
具体设置这里就不介绍了，它走的是简单 http put 方式，有些公司的安全软件会把它禁掉，大厂基本都是。
所以还是想另外的办法去做上传。&lt;/p>
&lt;blockquote>
&lt;p>禁掉是有道理的，因为担心你把公司的资料外传。&lt;/p>
&lt;/blockquote>
&lt;h1 id="cloudflare-worker-代理">Cloudflare Worker 代理
&lt;/h1>&lt;p>为了避开限制，同时也让国内可以正常的做上传（无需魔法），这时 worker 就成了一个很好的选择。&lt;br>
上传到 R2 的话，worker 里是有内置一些对象可以直接绑定的，使用非常方便，比如上传只需要这么一行代码就可以了：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">const&lt;/span> &lt;span class="nx">upload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">await&lt;/span> &lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">MY_BUCKET&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fileData&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其实 env.MY_BUCKET 即为全局注入的对象，它可以用于做上传，调用它的 put 方法就可以，非常简单。&lt;/p>
&lt;h2 id="完整代码">完整代码
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-js" data-lang="js">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">export&lt;/span> &lt;span class="k">default&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">async&lt;/span> &lt;span class="nx">fetch&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">request&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">env&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ctx&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 声明全局变量
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">let&lt;/span> &lt;span class="nx">jsonData&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kc">null&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 处理 CORS 预检请求
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">method&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s2">&amp;#34;OPTIONS&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nx">handleCORS&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">method&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="s2">&amp;#34;POST&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Response&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Only POST allowed&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">405&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 从 Authorization 头部获取 Bearer token
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">authHeader&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">headers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Authorization&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">token&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">authHeader&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">startsWith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Bearer &amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">?&lt;/span> &lt;span class="nx">authHeader&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">substring&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 验证 token
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nx">token&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nx">token&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AUTH_TOKEN&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Response&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Unauthorized&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">401&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">contentType&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">headers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;content-type&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nx">fileData&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fileType&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fileName&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 处理 JSON 格式的请求 (包含 base64 编码的文件数据)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">contentType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">includes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;application/json&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsonData&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">await&lt;/span> &lt;span class="nx">request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">json&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">file&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="k">typeof&lt;/span> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">file&lt;/span> &lt;span class="o">!==&lt;/span> &lt;span class="s2">&amp;#34;string&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Response&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Invalid file data format&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">400&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kd">let&lt;/span> &lt;span class="nx">base64Data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">file&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 检查是否是 data URL 格式
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">file&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">startsWith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;data:&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 解析 data URL
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">dataUrlParts&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">file&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">match&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sr">/^data:([^;]+);base64,(.+)$/&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nx">dataUrlParts&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Response&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Invalid data URL format&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">400&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fileType&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">dataUrlParts&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">];&lt;/span> &lt;span class="c1">// 例如 &amp;#34;image/png&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">base64Data&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">dataUrlParts&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 直接使用文件内容，需要从请求或文件名推断类型
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">fileType&lt;/span> &lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">mimetype&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">type&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">contentType&lt;/span> &lt;span class="o">||&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;application/octet-stream&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[Info] Using MIME type: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">fileType&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 将 base64 转换为二进制数据
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">fileData&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">Uint8Array&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">from&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">atob&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">base64Data&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&amp;gt;&lt;/span> &lt;span class="nx">c&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">charCodeAt&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">));&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Response&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`Invalid base64 encoding: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">error&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">message&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">status&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">400&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 从 MIME 类型生成文件名
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kr">const&lt;/span> &lt;span class="nx">extension&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">fileType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">split&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;/&amp;#34;&lt;/span>&lt;span class="p">)[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="s2">&amp;#34;bin&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 使用提供的文件名或生成一个新的
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="nx">fileName&lt;/span> &lt;span class="o">=&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">filename&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="sb">`&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nb">Date&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">now&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">.&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">extension&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 处理 multipart/form-data 格式的请求
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">contentType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">includes&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;multipart/form-data&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">form&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">await&lt;/span> &lt;span class="nx">request&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">formData&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">form&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;file&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="c1">// 文件字段名为 file
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!&lt;/span>&lt;span class="nx">file&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="k">typeof&lt;/span> &lt;span class="nx">file&lt;/span> &lt;span class="o">===&lt;/span> &lt;span class="s2">&amp;#34;string&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Response&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;No file uploaded&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">400&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fileData&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">file&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">stream&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fileType&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">file&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">type&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">fileName&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">file&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">name&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Response&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Unsupported content type&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nx">status&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">400&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 使用自定义路径或默认路径
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="kd">let&lt;/span> &lt;span class="nx">key&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">jsonData&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">path&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nx">jsonData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">path&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[Info] Using custom path: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">key&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">timestamp&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">Date&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">now&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">key&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`uploads/&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">timestamp&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">-&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">fileName&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="s2">&amp;#34;file&amp;#34;&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[Info] Using generated path: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">key&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[Info] Uploading to R2: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">key&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb"> (&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">fileType&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">)`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">upload&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="kr">await&lt;/span> &lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">MY_BUCKET&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fileData&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">httpMetadata&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">contentType&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">fileType&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="s2">&amp;#34;application/octet-stream&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[Info] Upload successful`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="kr">const&lt;/span> &lt;span class="nx">publicURL&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sb">`https://&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">env&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">PUBLIC_DOMAIN&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">/&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">key&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">console&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sb">`[Info] Public URL: &lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nx">publicURL&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="sb">`&lt;/span>&lt;span class="p">);&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 返回 JSON 对象
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="nx">Response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">json&lt;/span>&lt;span class="p">({&lt;/span> &lt;span class="nx">url&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="nx">publicURL&lt;/span> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">};&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// 处理 CORS 预检请求
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="kd">function&lt;/span> &lt;span class="nx">handleCORS&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">new&lt;/span> &lt;span class="nx">Response&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nx">headers&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Access-Control-Allow-Origin&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Access-Control-Allow-Methods&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;POST, OPTIONS&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Access-Control-Allow-Headers&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;Content-Type, Authorization&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Access-Control-Max-Age&amp;#34;&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="s2">&amp;#34;86400&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">});&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="配置">配置
&lt;/h2>&lt;p>有了这个之后，我们再绑一个域名上去，在 worker 的设置里直接加就行，这里就不展开。&lt;br>
接着把这个域名用到 upic 的配置里&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744475950_v3vq6M.webp"
loading="lazy"
alt="|0x0"
>&lt;br>
“其它字段” 里添加一下头部认证，和 body 的其它字段，用于存储的时候指定 key 等。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744475951_BpscpM.webp"
loading="lazy"
alt="|711x658"
>&lt;br>
这时就可以用 upic 去上传你的文件了。顺便说一句，upic 可以做截图上传、剪贴板上传，确实好方便。我设置了个快捷键，之后就直接用它来帮我快速做上传就行了。&lt;/p></description></item><item><title>single box 魔法</title><link>https://www.jsongo.top/articles/single-box-magic/</link><pubDate>Sat, 12 Apr 2025 13:12:08 +0800</pubDate><guid>https://www.jsongo.top/articles/single-box-magic/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/ce4ad62a66d8ac4c4027f3e054d6009e.jpg" alt="Featured image of post single box 魔法" />&lt;h1 id="安装">安装
&lt;/h1>&lt;h2 id="安装-gui">安装 GUI
&lt;/h2>&lt;p>然后从这里安装 UI：
&lt;a class="link" href="https://github.com/GUI-for-Cores/GUI.for.SingBox" target="_blank" rel="noopener"
>GUI for SingBox (github.com)&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git clone https://github.com/GUI-for-Cores/GUI.for.SingBox.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> GUI.for.SingBox/frontend
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pnpm install
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pnpm build
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ..
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wails build
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>wails 是 go 里用于构建桌面应用的一个框架，上面运行完之后，会在 build/bin 目录里放一个编译好的可运行文件，把它 copy 到 &amp;quot; 应用程序 &amp;quot; 中就可以了。&lt;/p>
&lt;h2 id="安装内核">安装内核
&lt;/h2>&lt;p>到设置里，找到内核，点击更新，它会开始下载。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744474649_Cy3pd0.webp"
loading="lazy"
>&lt;/p>
&lt;h1 id="使用">使用
&lt;/h1>&lt;p>打开后，如果要使用 clash 的那个订阅地址，得安装一个插件，要不然报错：&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744474650_cV8faw.webp"
loading="lazy"
alt="|774x96"
>
很简单，在 GUI 上找到插件中心，从列表中安装。先更新列表，然后就可以看到“节点转换”了。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744474651_GkAXv5.webp"
loading="lazy"
>&lt;br>
后面再重新添加下 clash 的订阅地址就行了。&lt;/p>
&lt;h2 id="启动内核">启动内核
&lt;/h2>&lt;p>直接到首页点击启动内核就可以。&lt;br>
在顶部菜单上可以先把节点，其它的都跟 clashx 差不多。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744474652_qh9YSN.webp"
loading="lazy"
>&lt;/p>
&lt;h1 id="速度">速度
&lt;/h1>&lt;h2 id="对比">对比
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>Sing-box 内部&lt;/strong>：
&lt;ul>
&lt;li>HTTP/SOCKS5 模式比 TUN 模式快 &lt;strong>1-5ms&lt;/strong>（延迟），吞吐量差距很小（2-5%）。&lt;/li>
&lt;li>对于大多数用户，这点差异几乎感觉不到。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Sing-box vs. ClashX&lt;/strong>：
&lt;ul>
&lt;li>Sing-box 比 ClashX 快 &lt;strong>2-5ms&lt;/strong>（延迟），吞吐量高 &lt;strong>10-20%&lt;/strong>。&lt;/li>
&lt;li>如果你之前用 ClashX 感觉速度还可以，切换到 Sing-box 后应该会有明显提升，尤其是在下载大文件或使用高效协议时。&lt;/li>
&lt;li>如果你使用的是低延迟服务器（比如 20ms），Sing-box 的优势更明显，下载速度可能从 80Mbps 提升到 90-95Mbps。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="tun-模型">Tun 模型
&lt;/h2>&lt;p>先到插件中心找下 Tun 模式助手，它可以引导你怎么一步步安装 tun。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744474653_IO5quG.webp"
loading="lazy"
alt="|0x0"
>&lt;br>
安装完之后，点击它，会让你运行一条命令，运行完之后再点击 tun 模型就会弹出提示，点允许就行。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744474654_fQTGG6.webp"
loading="lazy"
>&lt;/p>
&lt;h2 id="插件">插件
&lt;/h2>&lt;p>Gemini 插件。需要做配置，不好找，后来发现是要右击这个卡片，找到配置才行。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744474656_KBYY1j.webp"
loading="lazy"
>&lt;br>
通用设置里，把托盘菜单的这个选项打开。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744474657_7WaCmo.webp"
loading="lazy"
>&lt;/p>
&lt;h2 id="命令行">命令行
&lt;/h2>&lt;p>Single-box 一般不干扰命令行，即使开启了 tun 模型，命令行也很可能没被代理。&lt;br>
其实是有一个插件可以直接给你方法让命令行走代理：&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1744474658_RLt7Ie.png"
loading="lazy"
alt="|650x286"
>&lt;br>
实际上，点运行时，只是让你复制一个 export https_proxy 和 http_proxy 的命令，很简单。&lt;br>
你不装这插件，手动去运行下面这两行命令也可以的：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">http_proxy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;http://127.0.0.1:20122&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">export&lt;/span> &lt;span class="nv">https_proxy&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;http://127.0.0.1:20122&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>20122 就是 single-box 在本地开的代理&lt;/p></description></item><item><title>2025 年人工智能指数报告</title><link>https://www.jsongo.top/articles/2025-ai-index-report-summary/</link><pubDate>Wed, 09 Apr 2025 13:22:12 +0800</pubDate><guid>https://www.jsongo.top/articles/2025-ai-index-report-summary/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/c1e2de3d85f49231f2290e3ec17b3940.jpg" alt="Featured image of post 2025 年人工智能指数报告" />&lt;p>本文源自：https://hai.stanford.edu/ai-index/2025-ai-index-report，对内容做的一些解读。&lt;br>
《2025 年人工智能指数报告》（Stanford HAI AI Index 2025）这个报告，全面分析了全球人工智能（AI）的技术进步、经济影响、教育、政策以及社会影响等领域，提供了数据驱动的洞察。&lt;/p>
&lt;h1 id="1-技术进步与性能提升">1. 技术进步与性能提升
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>模型性能快速提高&lt;/strong>：
&lt;ul>
&lt;li>AI 在多项高难度基准测试（如 MMMU、GPQA、SWE-bench）上的表现显著提升。例如，2024 年相较 2023 年，MMMU 得分提高 18.8 个百分点，GPQA 提高 48.9 个百分点，SWE-bench 提高 67.3 个百分点。&lt;/li>
&lt;li>在图像分类、视觉推理和英语理解等任务中，AI 已普遍超越人类基准。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>模型差距缩小&lt;/strong>：
&lt;ul>
&lt;li>顶级模型与第 10 名模型的性能差距从 2023 年的 11.9% 缩小至 2024 年的 5.4%，前两名模型差距仅 0.7%，显示竞争加剧。&lt;/li>
&lt;li>开源模型与闭源模型的性能差距从 8% 缩小至 1.7%，开源模型（如 Meta 的 Llama、中国的 DeepSeek）正在快速追赶。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>小型模型效率提升&lt;/strong>：
&lt;ul>
&lt;li>2022 年，达到 MMLU 基准 60% 以上的最小模型是 5400 亿参数的 PaLM；而 2024 年，微软的 Phi-3-mini 仅 38 亿参数即达标，参数规模减少 142 倍。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>AI 代理能力初显&lt;/strong>：
&lt;ul>
&lt;li>在 RE-Bench 基准测试中，AI 代理在短时任务（2 小时）中得分是人类专家的 4 倍，但在长时任务（32 小时）中仍落后于人类（人类得分是 AI 的 2 倍）。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>生成能力突破&lt;/strong>：
&lt;ul>
&lt;li>AI 在高质量视频生成方面取得进展，部分代理型 AI 甚至在特定场景下超越人类表现。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="2-经济与产业影响">2. 经济与产业影响
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>创纪录的投资&lt;/strong>：
&lt;ul>
&lt;li>2024 年全球私人 AI 投资达到 1508 亿美元的历史新高，美国以 672 亿美元领先，中国为第二大投资地。&lt;/li>
&lt;li>政府投资规模扩大：加拿大承诺 24 亿美元，中国推出 475 亿美元半导体基金，沙特阿拉伯的“超越计划”投资 1000 亿美元。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>成本显著下降&lt;/strong>：
&lt;ul>
&lt;li>查询 GPT-3.5 级别模型的成本从 2022 年 11 月的每百万 token 20 美元降至 2024 年 10 月的 0.07 美元（Gemini-1.5-Flash-8B），下降 280 倍。&lt;/li>
&lt;li>硬件成本每年下降 30%，能源效率每年提升 40%，降低 AI 应用门槛。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>产业主导地位增强&lt;/strong>：
&lt;ul>
&lt;li>2024 年，近 90% 的显著 AI 模型来自产业（2023 年为 60%），学术界仍为高引用研究的首要来源。&lt;/li>
&lt;li>模型规模快速增长：训练计算量每 5 个月翻倍，数据集每 8 个月翻倍，能耗每年翻倍。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>就业需求激增&lt;/strong>：
&lt;ul>
&lt;li>对机器学习技能的需求激增，调查显示越来越多的工人预计 AI 将改变其工作。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="3-科学与医学中的-ai">3. 科学与医学中的 AI
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>科学突破加速&lt;/strong>：
&lt;ul>
&lt;li>2024 年 AI 推动多项科学进展，如 Aviary（生物任务的 LLM 代理）和 FireSat（野火预测增强）。&lt;/li>
&lt;li>蛋白质科学数据库显著扩展：2021 年以来 UniProt 增长 31%，PDB 增长 23%，AlphaFold 增长 585%。&lt;/li>
&lt;li>两项诺贝尔奖授予 AI 相关突破：Google DeepMind 的 AlphaFold 获化学奖。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>医疗应用扩展&lt;/strong>：
&lt;ul>
&lt;li>截至 2024 年 8 月，FDA 批准的 AI 医疗设备达 950 个（2015 年仅 6 个，2023 年为 221 个）。&lt;/li>
&lt;li>大型医疗基础模型涌现，如 Med-Gemini（多模态通用模型）、EchoCLIP（心脏病学）和 ChexAgent（放射学）。&lt;/li>
&lt;li>OpenAI 的 o1 模型在 MedQA 基准上达到 96%，较 2023 年最佳成绩提升 5.8 个百分点。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>伦理研究增加&lt;/strong>：
&lt;ul>
&lt;li>2020-2024 年，医疗 AI 伦理出版物从 288 篇增至 1031 篇，增长近 4 倍。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="4-教育趋势">4. 教育趋势
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>CS 教育普及&lt;/strong>：
&lt;ul>
&lt;li>全球三分之二的国家已提供或计划提供 K-12 计算机科学教育，相较 2019 年翻倍，非洲和拉美进步最大。&lt;/li>
&lt;li>但非洲许多地区因基础设施（如电力）不足，教育普及受限。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>AI 教育挑战&lt;/strong>：
&lt;ul>
&lt;li>美国 81% 的 CS 教师认为 AI 应纳入基础教育，但不到一半觉得自己有能力教授 AI。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>新工具使用&lt;/strong>：
&lt;ul>
&lt;li>ChatGPT 等 AI 工具在教师和学生中的应用增加，引发对教育影响的关注。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="5-政策与治理">5. 政策与治理
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>法规数量激增&lt;/strong>：
&lt;ul>
&lt;li>2024 年，美国联邦机构出台 59 项 AI 相关法规（2023 年为 25 项），涉及机构数量翻倍。&lt;/li>
&lt;li>全球 75 个国家的立法中 AI 提及率较 2023 年增长 21.3%，自 2016 年以来增长 9 倍。&lt;/li>
&lt;li>美国地方层面，2023 年 73.7% 的政策制定者支持 AI 监管（2022 年为 55.7%）。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>优先级分化&lt;/strong>：
&lt;ul>
&lt;li>数据隐私（80.4%）、失业者再培训（76.2%）和 AI 部署规则（72.5%）获高支持率，但对执法面部识别禁令（34.2%）和普遍基本收入（24.6%）支持较低。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>地缘竞争加剧&lt;/strong>：
&lt;ul>
&lt;li>美国 2023 年产出 61 个重要 AI 模型，欧盟 21 个，中国 15 个；中国在 AI 论文和专利数量上领先，但质量未评估。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="6-社会影响与公众认知">6. 社会影响与公众认知
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>AI 融入日常生活&lt;/strong>：
&lt;ul>
&lt;li>从医疗到交通，AI 正从实验室走向现实生活，如 FDA 批准的医疗设备激增。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>信任与乐观分化&lt;/strong>：
&lt;ul>
&lt;li>全球 55% 的人认为 AI 产品和服务利大于弊（2022 年为 52%），中国（83%）、印尼（80%）最为乐观，而加拿大（40%）、美国（39%）较低。&lt;/li>
&lt;li>66% 的人预计 AI 将在 3-5 年内显著影响生活，加拿大（+17%）和德国（+15%）增幅最大。&lt;/li>
&lt;li>对 AI 公司保护数据的信心从 2023 年的 50% 降至 2024 年的 47%。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>AI 危害上升&lt;/strong>：
&lt;ul>
&lt;li>AI 事件数据库记录的 AI 相关事故 2024 年达 233 起，较 2023 年增长 56.4%，包括深度伪造和聊天机器人相关问题。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="7-全球竞争与地缘动态">7. 全球竞争与地缘动态
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>中美差距缩小&lt;/strong>：
&lt;ul>
&lt;li>中美顶级模型性能差距缩至 0.3%，中国以 1/12 的投资规模追赶美国。&lt;/li>
&lt;li>中国 2023 年机器人安装量超全球总和，AI 专利占全球 61%。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>新兴地区崛起&lt;/strong>：
&lt;ul>
&lt;li>中东、拉美和东南亚推出强模型，AI 技术全球化趋势增强。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>开源趋势&lt;/strong>：
&lt;ul>
&lt;li>DeepSeek 和 Mistral 等开源模型崛起，OpenAI 计划 2025 年夏季发布首个开源模型。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h1 id="总结与展望">总结与展望
&lt;/h1>&lt;p>2025 年 AI 指数报告显示，AI 技术能力快速提升，成本下降使其更普惠，同时产业竞争加剧，模型差距缩小。中美在 AI 领域的博弈持续，但中国正迎头赶上。AI 在科学、医疗和日常生活中的应用日益广泛，但伴随伦理、安全和公平访问的挑战。政策制定者需平衡创新与监管，确保 AI 以人为本发展。&lt;br>
这份 456 页的报告为政策制定者、研究人员和公众提供了全面的数据支持，是理解 AI 现状与未来的关键资源&lt;/p></description></item><item><title>Tracing 初步理解</title><link>https://www.jsongo.top/articles/tracing-101/</link><pubDate>Tue, 08 Apr 2025 20:51:33 +0800</pubDate><guid>https://www.jsongo.top/articles/tracing-101/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/1089988f36245b8456d63b99a86d3d2b.jpg" alt="Featured image of post Tracing 初步理解" />&lt;p>Tracing 是一种用于跟踪和记录系统运行状态、事件或资源使用情况的技术，广泛应用于软件开发、性能优化、故障排查等领域。以下是 tracing 中的一些关键概念、应用及跟 log 之间的关系。&lt;/p>
&lt;h1 id="tracing-概念">Tracing 概念
&lt;/h1>&lt;h2 id="-tracing-基础概念梳理">🔍 Tracing 基础概念梳理
&lt;/h2>&lt;h3 id="-整体结构树形">🌲 整体结构（树形）
&lt;/h3>&lt;ul>
&lt;li>一个请求的完整追踪过程被称为一个 &lt;strong>Trace&lt;/strong>，可以用一个 trace_id 唯一标识。&lt;/li>
&lt;li>一个 Trace 是由多个 &lt;strong>Span&lt;/strong> 组成的，&lt;strong>Span 形成一棵树结构&lt;/strong>。
&lt;ul>
&lt;li>根节点是最早创建的那个 Span（通常是入口请求，如前端或网关）。&lt;/li>
&lt;li>子节点 Span 表示在处理过程中产生的后续调用（如微服务之间的调用、数据库访问等）。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="-核心概念一览">🧩 核心概念一览
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>概念&lt;/strong>&lt;/th>
&lt;th>&lt;strong>描述&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;strong>Trace&lt;/strong>&lt;/td>
&lt;td>表示一次完整的请求链，一般由一个唯一的 trace_id 标识。可以跨多个服务。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Span&lt;/strong>&lt;/td>
&lt;td>Trace 中的一个操作单位，表示一次具体的调用或操作，有 span_id。可以嵌套形成父子关系。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Parent Span&lt;/strong>&lt;/td>
&lt;td>一个 Span 可以有一个父 Span（用 parent_span_id 标识），用于构建调用树。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Child Span&lt;/strong>&lt;/td>
&lt;td>父 Span 内部调用的子操作，属于同一个 trace_id，形成树形结构。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Baggage&lt;/strong>&lt;/td>
&lt;td>是附着在 Trace 上的键值对，会随着 trace 传播给每个后续的 span，可用于传递业务上下文数据（如用户 ID、地域等）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Attributes / Tags&lt;/strong>&lt;/td>
&lt;td>是附着在 Span 上的键值对，用于记录执行时的状态、参数信息等。&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;strong>Events / Logs&lt;/strong>&lt;/td>
&lt;td>是附着在 Span 上的时间序列事件，例如某个时刻报错、收到响应等。&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="span">Span
&lt;/h2>&lt;p>🧠 每个 Span 都包含什么？&lt;/p>
&lt;ul>
&lt;li>span_id：该 Span 的唯一标识&lt;/li>
&lt;li>trace_id：所属的 Trace ID&lt;/li>
&lt;li>parent_span_id：它的父节点 Span 的 ID（根 span 没有父 ID）&lt;/li>
&lt;li>name：这个 span 的名称（如“调用用户服务”）&lt;/li>
&lt;li>start_time / end_time：起止时间&lt;/li>
&lt;li>attributes（也叫 tags）：键值对，描述上下文或运行参数&lt;/li>
&lt;li>events（或 logs）：事件序列（如异常、返回值）&lt;/li>
&lt;li>status：表示是否成功（比如 HTTP 500）&lt;/li>
&lt;li>baggage（选）：附加在 trace 上传播的键值对（所有 span 可共享）&lt;br>
但如果你每个小操作都创建一个 span，会导致：&lt;/li>
&lt;li>数据太多，观察成本高&lt;/li>
&lt;li>采样/存储开销大&lt;br>
所以建议：&lt;/li>
&lt;li>只给 &lt;strong>关键路径&lt;/strong>加 span，比如：IO 操作、外部调用、耗时步骤。&lt;/li>
&lt;li>对短暂或无关紧要的内部操作（如计算、循环等）不需要单独创建 span。&lt;/li>
&lt;/ul>
&lt;h3 id="-数据流示意树结构">🧬 数据流示意（树结构）
&lt;/h3>&lt;p>&lt;strong>Span 是可以相互嵌套的&lt;/strong>，它天生就是为了表现“一个操作内部还包含其他子操作”这种结构。它之所以是树结构，就是因为服务调用本身、或某个操作本身，就常常是“嵌套”的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">Trace (trace_id: abc123)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── Span A (root span, span_id: 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── Span B (span_id: 2, parent: 1)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │ ├── Span D (span_id: 4, parent: 2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │ └── Span E (span_id: 5, parent: 2)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── Span C (span_id: 3, parent: 1)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="-耗时信息的采集">⏱ 耗时信息的采集
&lt;/h3>&lt;p>每个 Span 都记录 start &amp;amp; end 时间，比如&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;span_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;abc123&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;start_time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2025-04-13T10:00:00.123Z&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;end_time&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2025-04-13T10:00:01.456Z&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;duration_ms&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">1333&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>✅ 计算方式：duration = end_time - start_time（建议保留 ms 精度）&lt;/p>
&lt;h2 id="-补充说明">✨ 补充说明
&lt;/h2>&lt;ul>
&lt;li>Span 使用
&lt;ul>
&lt;li>&lt;strong>Span != 服务&lt;/strong>，一个服务内可以产生多个 span，比如控制器、服务、DAO 等不同层级调用。&lt;/li>
&lt;li>&lt;strong>Span 的嵌套并不完全等于服务调用&lt;/strong>，可以是方法内的子步骤。&lt;/li>
&lt;li>&lt;strong>Baggage 不适合放太多数据&lt;/strong>，因为会被全链路传播，性能和隐私要注意。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="一些应用">一些应用
&lt;/h1>&lt;h2 id="展示耗时信息前端可视化">展示耗时信息（前端可视化）
&lt;/h2>&lt;h3 id="1-树形结构--耗时">1 、树形结构 + 耗时
&lt;/h3>&lt;ul>
&lt;li>展示结构 + 每一层的耗时：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">└── 用户请求（1000ms）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 认证服务（200ms）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ├── 用户服务（600ms）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │ ├── 数据库查询（400ms）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> │ └── 缓存写入（50ms）
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── 日志服务（100ms）
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="2-时间线图--甘特图推荐">2 、时间线图 / 甘特图（推荐）
&lt;/h3>&lt;ul>
&lt;li>横轴是时间，纵轴是调用树层级，像这样：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">时间轴: |----100ms----|----100ms----|----100ms----|…
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">用户请求: [------------------------------]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">用户服务: [---------------]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">数据库查询: [------]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">缓存写入: [--]
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>可以一眼看出：
&lt;ul>
&lt;li>谁最耗时&lt;/li>
&lt;li>哪些操作是串行的、哪些是并行的&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h3 id="3判断性能瓶颈基于耗时">3、判断性能瓶颈（基于耗时）
&lt;/h3>&lt;p>根据 trace 可以自动检测一些问题：&lt;/p>
&lt;ul>
&lt;li>某个 span 耗时超过阈值（如 200ms）&lt;/li>
&lt;li>同一个服务下某些 span 总是很慢&lt;/li>
&lt;li>多个 span 串行而不是并行执行（如 A → B → C）&lt;/li>
&lt;/ul>
&lt;h2 id="-补充说明-1">✨ 补充说明
&lt;/h2>&lt;ul>
&lt;li>统一时间来源
&lt;ul>
&lt;li>使用同一个时钟源（如 performance.now() 或 process.hrtime()，不要用 Date.now() 混用）&lt;/li>
&lt;li>建议用 &lt;strong>高精度时间&lt;/strong>（纳秒或微秒），落库前可以转成毫秒或浮点秒数。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="tracing-与-logging-的关系">Tracing 与 Logging 的关系
&lt;/h1>&lt;p>在软件开发中，&lt;strong>Tracing（追踪）&lt;/strong> 和 &lt;strong>Logging（日志记录）&lt;/strong> 是两种常用的技术，尽管它们的功能相似，但在应用场景和实现方式上有显著差异。&lt;br>
一句话：Tracing 是用于“跨服务的调用链分析”，而 Logging 是用于“记录事件和调试信息”。&lt;/p>
&lt;h2 id="tl-dr">TL; DR
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>Tracing 和 Logging 是互补的技术&lt;/strong>：
&lt;ul>
&lt;li>Tracing 更适合实时监控和动态数据上报，而 Logging 则适合长期记录和调试。&lt;/li>
&lt;li>它们可以结合使用：例如，在应用运行期间使用 Tracing 技术获取实时数据（如资源使用情况），然后通过 Logging 技术将错误信息记录下来。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>没有严格的包含关系&lt;/strong>：
&lt;ul>
&lt;li>它们各自服务于不同的场景和技术需求，但两者并不互相覆盖所有功能。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="核心能力对比">核心能力对比
&lt;/h2>&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align: center">&lt;strong>维度&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Logging&lt;/strong>&lt;/th>
&lt;th>&lt;strong>Tracing&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align: center">📍 关注点&lt;/td>
&lt;td>记录本地事件（debug/info/error）&lt;/td>
&lt;td>跨服务的请求链路与时序&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">🧩 粒度&lt;/td>
&lt;td>每一行日志就是一条信息&lt;/td>
&lt;td>每个 trace 是一个整体请求，包含多个 span&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">🔍 定位问题&lt;/td>
&lt;td>看错误堆栈、日志内容&lt;/td>
&lt;td>看请求链在哪个环节耗时多/出错&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">⏱ 时间维度&lt;/td>
&lt;td>一条日志有个 timestamp&lt;/td>
&lt;td>Trace 有 start/end + 每个 Span 有耗时&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">🌐 上下文&lt;/td>
&lt;td>通常只看当前服务&lt;/td>
&lt;td>可以跨多个服务传播 context（trace_id, baggage）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">📈 可视化&lt;/td>
&lt;td>日志系统展示（Elasticsearch, Loki）&lt;/td>
&lt;td>链路图、时间线（如 Jaeger, Zipkin）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align: center">🧰 典型工具&lt;/td>
&lt;td>Log4j、SLF4J、Winston、Loki&lt;/td>
&lt;td>OpenTelemetry、Jaeger、SkyWalking&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="软件开发视角">软件开发视角
&lt;/h2>&lt;h3 id="1-tracing-的作用">1. Tracing 的作用
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>追踪应用程序的行为&lt;/strong>：Tracing 主要用于跟踪应用程序的运行状态、资源使用情况（如 CPU、内存）、错误发生等。&lt;/li>
&lt;li>&lt;strong>实时监控&lt;/strong>：常用于实时应用中，例如浏览器插件、云服务监控等。&lt;/li>
&lt;/ul>
&lt;h3 id="2-logging-的作用">2. Logging 的作用
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>记录详细信息&lt;/strong>：Logging 是记录日志文件或直接发送到云服务的详细信息（如错误堆栈、调用链）。&lt;/li>
&lt;li>&lt;strong>调试和分析&lt;/strong>：用于调试错误源，并提供详细的运行轨迹。&lt;/li>
&lt;/ul>
&lt;h3 id="3-tracing-和-logging-的关系">3. Tracing 和 Logging 的关系
&lt;/h3>&lt;ul>
&lt;li>两者其实是可以相辅相成的。一个系统通常这样用：
&lt;ul>
&lt;li>Tracing → 提供“全局视角”：看到某个请求走了哪些服务、在哪一步慢了或失败了&lt;/li>
&lt;li>Logging → 提供“局部细节”：具体方法内部执行了什么、变量值、堆栈、报错&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>举例说明下，比如 Tracing 信息如下：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">TraceID: abc123
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Span: [用户服务处理订单] 150ms
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── [调用库存服务] 90ms ❌ Timeout
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>Logging 里，有如下信息：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">[WARN]TraceID=abc123 无法连接库存数据库
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">[ERROR] TraceID=abc123 查询失败，返回500
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当看到 trace 知道问题出在“调用库存服务”，再用 trace_id 去日志里一搜，就能看到详细原因。&lt;/p>
&lt;h2 id="替代性和建议">替代性和建议
&lt;/h2>&lt;h3 id="-理论上可以把-tracing-当-log-用">✅ 理论上可以把 Tracing 当 Log 用
&lt;/h3>&lt;blockquote>
&lt;p>如 OpenTelemetry 就是一个记录很细的系统，可以当 log 用。&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>Tracing 的每个 span 可以附加 &lt;strong>事件（event）/ 日志（log）&lt;/strong>&lt;/li>
&lt;li>可以做到类似 logger.info(…) 的功能&lt;/li>
&lt;li>可以把 span.addEvent(&amp;quot; 准备开始数据库查询 &amp;ldquo;) 当作 log&lt;/li>
&lt;/ul>
&lt;h3 id="-但不建议只用-tracing-替代-logging">❌ 但不建议只用 Tracing 替代 Logging
&lt;/h3>&lt;ul>
&lt;li>Tracing 会采样（不是所有请求都记录）→ 有的错误日志你找不到&lt;/li>
&lt;li>写日志的自由度高（结构、内容、格式），Tracing 更偏结构化&lt;/li>
&lt;li>日志可以本地保存、不依赖全链路链路系统&lt;/li>
&lt;li>Tracing 更适合宏观链路分析，不适合长期审计、安全排查等用途&lt;/li>
&lt;/ul>
&lt;h3 id="-推荐做法实际工程中">🧠 推荐做法（实际工程中）
&lt;/h3>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;strong>级别&lt;/strong>&lt;/th>
&lt;th>&lt;strong>工具&lt;/strong>&lt;/th>
&lt;th>&lt;strong>用途&lt;/strong>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>🔭 全局观&lt;/td>
&lt;td>Tracing (OpenTelemetry)&lt;/td>
&lt;td>分布式链路追踪，定位请求瓶颈&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>🛠 细节&lt;/td>
&lt;td>Logging (Winston, Logback…)&lt;/td>
&lt;td>开发调试、审计、错误定位&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>📊 聚合&lt;/td>
&lt;td>Metrics (Prometheus…)&lt;/td>
&lt;td>吞吐量、请求数、错误率等统计指标&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>在写日志时 &lt;strong>附带 trace_id&lt;/strong> 是非常推荐的做法（比如 MDC、trace context），这样就可以轻松做到 “trace 定位后，日志深入排查”。比如在 log 里统一打出：&lt;code>[INFO][trace_id=abc123]查询成功&lt;/code> 。&lt;br>
一个请求来了，你可以：&lt;/p>
&lt;ul>
&lt;li>用 Trace 找到问题在哪个服务&lt;/li>
&lt;li>用 Log 看服务内部报错细节&lt;/li>
&lt;li>用 Metrics 看整体健康趋势&lt;/li>
&lt;/ul></description></item><item><title>未来几年的AI 发展预测</title><link>https://www.jsongo.top/articles/ai-development-forecast/</link><pubDate>Tue, 08 Apr 2025 01:16:54 +0800</pubDate><guid>https://www.jsongo.top/articles/ai-development-forecast/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/999dce943c2746f423620acecd9ba75f.png" alt="Featured image of post 未来几年的AI 发展预测" />&lt;p>&lt;a class="link" href="https://ai-2027.com/" target="_blank" rel="noopener"
>AI 2027&lt;/a> 这个网站对 AI 未来发展做了一些预言，很有趣，做了一些总结梳理。&lt;br>
AI 2027 是由 AI Futures Project 发布的一个详细预测，描绘了从 2025 年到 2028 年人工智能（AI）快速发展的可能情景，预测 AI 将在这段时间内经历从初级自主代理到超人类智能的飞速发展。&lt;/p>
&lt;h1 id="主要预测">主要预测
&lt;/h1>&lt;ol>
&lt;li>&lt;strong>2025 年：AI 系统开始具备自主代理特性&lt;/strong>&lt;br>
预计到 2025 年，AI 系统将发展出类似员工的自主代理特性，能够独立执行复杂任务。尽管在理论和特定示例中表现出色，但在实际应用中可能仍存在不可靠性。许多公司将尝试将这些 AI 代理整合到其工作流程中，以提高效率和生产力。&lt;/li>
&lt;li>&lt;strong>2027 年：AI 具备超人类编码能力，引发智能爆炸&lt;/strong>&lt;br>
到 2027 年，AI 的编码能力将显著提升，足以推动 AI 自身的研发。这可能导致智能爆炸，即 AI 迅速超越人类智能水平。具体而言，AI 公司可能在 2027 年初创建具备专家级人类水平的 AI 系统，用于自动化 AI 研究，从而在 2027 年底实现人工超智能（ASI）。&lt;/li>
&lt;li>&lt;strong>2028 年：通用超人智能的出现&lt;/strong>&lt;br>
预测到 2028 年，具备通用超人智能的 AI 系统将出现，能够在各个领域超越人类智能。这将对社会结构、经济模式和全球权力动态产生深远影响。&lt;/li>
&lt;/ol>
&lt;h1 id="研究支持">研究支持
&lt;/h1>&lt;p>AI 2027 的预测基于以下研究和分析：​&lt;/p>
&lt;ul>
&lt;li>&lt;strong>计算预测：&lt;/strong> 预计到 2027 年，AI 训练所使用的计算能力将达到 GPT-4 的 1000 倍，并在内部部署数十万 AI 研究助理。这一预测基于对计算生产模型和推理计算模型的分析。 ​&lt;a class="link" href="https://ai-2027.com/research" target="_blank" rel="noopener"
>AI 2027&lt;/a>&lt;/li>
&lt;li>&lt;strong>时间线预测：&lt;/strong> 通过对 AI 研发进展的评估，预测 2027 年将实现具备超人类编码能力的 AI 系统。 ​&lt;a class="link" href="https://ai-2027.com/research/timelines-forecast" target="_blank" rel="noopener"
>AI 2027&lt;/a>&lt;/li>
&lt;li>&lt;strong>爆发预测：&lt;/strong> 从超人类编码 AI 到通用超人智能的过渡可能在一年内完成，强调了 AI 发展可能呈现的快速性和不可预测性。 ​&lt;/li>
&lt;li>&lt;strong>AI 目标预测：&lt;/strong> 预测超人类 AI 可能不完全符合人类开发者的预期目标，存在目标不对齐的风险，可能导致不可控的后果。 ​&lt;a class="link" href="https://ai-2027.com/research/ai-goals-forecast" target="_blank" rel="noopener"
>AI 2027&lt;/a>&lt;/li>
&lt;li>&lt;strong>安全预测：&lt;/strong> 由于安全措施不足，AI 模型可能被窃取，导致高价值的算法机密泄露，增加了 AI 技术被滥用的风险。 ​&lt;/li>
&lt;/ul></description></item><item><title>阿里云盘添加到 alist</title><link>https://www.jsongo.top/articles/add-aliyundrive-to-alist/</link><pubDate>Thu, 03 Apr 2025 10:03:56 +0800</pubDate><guid>https://www.jsongo.top/articles/add-aliyundrive-to-alist/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/86bf43bb5c48b399375633945e5f3f72.jpg" alt="Featured image of post 阿里云盘添加到 alist" />&lt;p>可以参考下面这个：&lt;br>
&lt;a class="link" href="https://alist.nn.ci/zh/guide/drivers/aliyundrive_open.html" target="_blank" rel="noopener"
>阿里云盘 Open | AList 文档&lt;/a>&lt;br>
一般填写下面这两个即可（上方就写个盘名）&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/04/e4496ce3ccb9bf1448df4a5455d9f572.webp"
loading="lazy"
alt="9e494f6eb39f1a4e62772b8d275d8940_MD5|766x237"
>&lt;/p>
&lt;ul>
&lt;li>根文件夹，可以在浏览器中打开相应的目录，copy 地址中的 id 即可&lt;/li>
&lt;li>令牌可以从这里获取：https://alist.nn.ci/zh/tool/aliyundrive/request，安全的&lt;br>
其它的都不用填，保存即可。添加完回到首页就可以看到。&lt;/li>
&lt;/ul></description></item><item><title>NAS 配置 cloudflare DDNS</title><link>https://www.jsongo.top/articles/nas-config-cloudflare-ddns/</link><pubDate>Thu, 03 Apr 2025 09:00:46 +0800</pubDate><guid>https://www.jsongo.top/articles/nas-config-cloudflare-ddns/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/2be650b5bf16dc6d9bb68a9ee7f1277a.jpeg" alt="Featured image of post NAS 配置 cloudflare DDNS" />&lt;h1 id="what">What
&lt;/h1>&lt;p>给 NAS 设置 DDNS 域名主要有以下作用：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>远程访问：&lt;/strong>  即使你的公网 IP 地址会变动，你也能通过固定的 DDNS 域名从外部网络访问你的 NAS。&lt;/li>
&lt;li>&lt;strong>方便记忆：&lt;/strong>  无需记住经常变化的 IP 地址，只需记住易于记忆的域名。&lt;/li>
&lt;li>&lt;strong>建立个人网站/服务：&lt;/strong>  可以利用 NAS 搭建个人网站、博客、文件共享等服务，并通过 DDNS 域名对外提供访问。&lt;/li>
&lt;li>&lt;strong>稳定性：&lt;/strong> DDNS 服务会自动追踪并更新你的 IP 地址，保证域名始终指向你的 NAS，提供更稳定的访问体验。&lt;/li>
&lt;li>&lt;strong>某些应用需要：&lt;/strong>  一些 NAS 应用（例如 Synology 的 QuickConnect）依赖 DDNS 来实现远程访问。&lt;/li>
&lt;/ol>
&lt;h1 id="how">How
&lt;/h1>&lt;p>进入 cloudflare&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/04/1fe20e900c45ea2bc98910cb3917c743.webp"
loading="lazy"
alt="a0944299ff16236c1b3a62304422cf66_MD5"
>&lt;br>
简单填写即可&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/04/980f013f949fa5a888bbc44a19dacc33.webp"
loading="lazy"
alt="93a269c73086bc52f7b59e47df737b3b_MD5"
>&lt;br>
最后在 NAS 上填写相关的 token 即可。我的是绿联的 NAS，在控制面板里搜索 DDNS 可以找到，在方式二中选新增。
![[assets/local_image_plus/a4c21f7f99866d178c6efc9cba4699d6_MD5.png]]
&lt;img src="https://cdn.lyb.pub/2025/04/6646d4b4a9e4f8ea04abe7b016243290.webp"
loading="lazy"
alt="baa8f3432565de42a82a2b4a66ad3828_MD5"
>&lt;br>
然后配置。Cloudflare 没提供 accessKey ID，它不重要，填写自己的 Cloudflare 账号即可。DDNS 域名可以添加一个自己托管在 Cloudflare 上的域名，可以加一个三级域名，如 &lt;code>nas.xxx.com&lt;/code> 。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/04/6d50da9e050a94421a8790b945ec24d1.webp"
loading="lazy"
alt="99509d7becca7bec0aad41815695c700_MD5"
>&lt;br>
看下状态如果是否正常&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/04/a87192cda2f1be909de1ba0ccee85d0d.webp"
loading="lazy"
alt="0c3856442d38469aa897889d253da33e_MD5"
>&lt;br>
高级设置里显示成功才可以&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/04/cf84e22051bc347c5543b6252c3b3b4a.webp"
loading="lazy"
alt="c5a086c7aa28e96c5d3ba74fa0c89296_MD5"
>&lt;br>
我试过连接手机热点去访问，发现不太行，这是因为我们没有公网 ip。&lt;/p></description></item><item><title>一种高效的学习方法</title><link>https://www.jsongo.top/articles/efficient-learning-method/</link><pubDate>Mon, 24 Mar 2025 10:12:24 +0800</pubDate><guid>https://www.jsongo.top/articles/efficient-learning-method/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/d4fca53294aaa0f19f01642fc7436c98.jpg" alt="Featured image of post 一种高效的学习方法" />&lt;p>来自这个视频：https://v.douyin.com/ywNN3t9_H80/&lt;/p>
&lt;h1 id="概述">概述
&lt;/h1>&lt;p>核心观点是通过特定方法，20 小时就能掌握一项技能并超过 80% 的人。&lt;br>
主要有 7 个关键点。&lt;/p>
&lt;ol>
&lt;li>&lt;strong>明确目标&lt;/strong>：清晰界定学习技能后想要达成的效果，目标越细致，学习效果越好。&lt;/li>
&lt;li>&lt;strong>分解技能&lt;/strong>：找出实现目标的关键 “必要技能”，舍弃无关技能，像学尤克里里抓常用和弦、学英语聚焦高频词汇。&lt;/li>
&lt;li>&lt;strong>学习理论&lt;/strong>：掌握能覆盖 “必要技能” 的最少理论知识，不必学完所有理论再练习。&lt;/li>
&lt;li>&lt;strong>准备工具&lt;/strong>：配备学习技能必需的工具，如学 PS 准备电脑和软件，学编程准备电脑和开发环境。&lt;/li>
&lt;li>&lt;strong>排除干扰&lt;/strong>：戒掉手机瘾，可借助手机监狱或换成老年机。&lt;/li>
&lt;li>&lt;strong>腾出时间&lt;/strong>：记录时间使用情况，筛选并利用低效时间，每天至少能腾出 3 小时用于学习。&lt;/li>
&lt;li>&lt;strong>反复练习&lt;/strong>：集中时间反复练习 “必要技能”，建议每天练习 2 - 4 小时，5 - 10 天完成 20 小时练习，过程中遇到困难也要坚持。&lt;br>
静静博士强调，学习初期产生自我怀疑很正常，成功一次就能减少畏惧，找到学习感觉，掌握自学方法。同时指出，阻碍学习的往往是情绪，勇敢迈出第一步、相信自己，就已成功大半。&lt;/li>
&lt;/ol>
&lt;h1 id="具体示例分析">具体示例分析
&lt;/h1>&lt;p>视频开始就声称能在 20 小时内掌握任何技能、超越 80% 学习者的高效学习方法。&lt;br>
针对以上 7 点关键点，做下举例分析&lt;/p>
&lt;ul>
&lt;li>&lt;strong>目标制定的深度剖析&lt;/strong>：
&lt;ul>
&lt;li>可以结合更多不同领域的案例，比如学绘画，若目标是绘制简单插画用于社交媒体分享，那具体风格、受众喜好、尺寸规格等都要明确；&lt;/li>
&lt;li>若想在绘画比赛获奖，目标则需围绕比赛主题、评委偏好、参赛要求等来设定。&lt;/li>
&lt;li>同时，深入分析不同难度目标对学习动力和进度的影响，以及如何根据自身实际情况调整目标。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>技能分解的全面指导&lt;/strong>：针对不同类型技能，提供更细致的分解策略。
&lt;ul>
&lt;li>像学习一门外语，从听说读写四个维度细分，听可按场景（日常对话、学术讲座、电影等）、语速（慢速、常速、快速）分解；&lt;/li>
&lt;li>说可按话题（旅游、工作、生活等）、口语表达形式（对话、演讲、讨论等）分解，让学习者清晰了解每个子技能的重要性和学习顺序。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>理论学习的精准规划&lt;/strong>：举例说明不同技能所需理论知识的获取渠道，如
&lt;ul>
&lt;li>学习编程，除了官方文档、专业书籍，还可利用开源代码库注释、技术论坛精华帖等。&lt;/li>
&lt;li>并且，讲解如何判断理论知识是否足够支撑练习，以及在练习过程中如何补充理论知识。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>工具准备的避坑指南&lt;/strong>：详细介绍各类技能学习工具的选择要点和注意事项。
&lt;ul>
&lt;li>以摄影为例，除了相机、镜头，还需考虑存储卡、三脚架、滤镜等配件，不同品牌、型号的工具在性能、价格、适用性上差异很大，为学习者提供实用的选购建议，避免踩坑。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>干扰排除的实用技巧&lt;/strong>：除了手机，分析其他常见干扰因素，如环境嘈杂、人际关系等，并给出具体应对方法。
&lt;ul>
&lt;li>对于环境嘈杂，可介绍隔音耳塞、降噪耳机的使用；&lt;/li>
&lt;li>对于人际关系干扰，可分享如何与家人、朋友沟通，获取他们的理解和支持，创造良好学习环境。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>时间管理的深度策略&lt;/strong>：
&lt;ul>
&lt;li>深入探讨如何更精准地筛选低效时间，利用时间管理工具（如番茄钟、TODO 清单等）制定详细的学习计划。&lt;/li>
&lt;li>以一周学习计划为例，合理安排每天的学习时段，根据不同技能学习特点（如记忆类、实践类）分配时间，提高学习效率。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>练习过程的心理调适&lt;/strong>：分享更多应对练习过程中挫折和压力的方法
&lt;ul>
&lt;li>学习倦怠时，可采用兴趣转移法（从技能学习的枯燥部分转移到有趣部分）、奖励机制（完成一定练习量给予自己小奖励）等，帮助学习者保持积极的学习心态，坚持完成 20 小时练习。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="目标-vs-难度">目标 v.s. 难度
&lt;/h1>&lt;p>要根据实际的目标情况，以及自身的条件，适当做成取舍或调整&lt;/p>
&lt;h2 id="容易达成的目标">&lt;strong>容易达成的目标&lt;/strong>
&lt;/h2>&lt;ul>
&lt;li>学习动力方面，当设定的目标较易实现时，学习者在短期内就能取得成果，容易获得成就感。&lt;/li>
&lt;li>比如学习英语单词，若目标是一天记住 10 个简单常用词，第一天学会后会让学习者觉得自己有能力完成学习任务，从而更愿意投入时间和精力，提升学习的积极性。从学习进度来看，由于目标难度低，学习者能较快掌握相应知识或技能，短期内可看到明显进步。像学习简单的手机摄影技巧，设定学会基础拍照模式和基本构图方法的目标，短时间内学会这些，会让学习者快速积累知识，学习进度加快。但这种目标也有局限性，长期维持简单目标，会使学习内容缺乏挑战性，容易让学习者感到枯燥，丧失继续探索的动力。&lt;/li>
&lt;/ul>
&lt;h2 id="中等难度目标">&lt;strong>中等难度目标&lt;/strong>
&lt;/h2>&lt;p>对于学习动力而言，中等难度目标具有一定挑战性，但又在学习者可及范围内。&lt;br>
例如，准备大学英语四级考试，这个目标需要付出一定努力，学习者在努力备考过程中，会因每一次模拟考试成绩的提升、知识点的掌握而备受鼓舞，觉得自己离目标越来越近，进而激发内在动力。在学习进度上，由于目标难度适中，学习者需要逐步深入学习知识，在不断克服困难的过程中，能更扎实地掌握技能。比如学习编程，设定在一个月内掌握基础编程语法并能独立完成简单项目的目标，学习者会按部就班学习语法知识、进行代码实践，虽然学习周期相对长一些，但能稳步推进学习进度，提升学习效果。&lt;/p>
&lt;h2 id="高难度目标">&lt;strong>高难度目标&lt;/strong>
&lt;/h2>&lt;p>从学习动力来看，一开始设定高难度目标，可能会让学习者感到兴奋和充满期待，激发其挑战自我的欲望。&lt;br>
例如想要在一年内成为专业插画师，这一目标会让学习者在初期充满斗志。然而，随着学习的深入，若发现短期内难以取得明显进步，容易遭受挫折，产生自我怀疑，进而打击学习动力。在学习进度方面，高难度目标所需知识和技能复杂，学习者可能会遇到诸多难以解决的问题，导致学习进度缓慢甚至停滞不前。比如学习高等数学中的复杂理论，若目标是在短时间内完全掌握并能灵活运用解决高难度题目，由于知识点难度大，学习者可能花费大量时间却收效甚微，影响学习积极性和后续学习计划。&lt;/p></description></item><item><title>塑造“权力”优势</title><link>https://www.jsongo.top/articles/shaping-power-advantage/</link><pubDate>Fri, 07 Mar 2025 10:40:59 +0800</pubDate><guid>https://www.jsongo.top/articles/shaping-power-advantage/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/b9123ae79734082ac58a5c1ea1b5528f.jpeg" alt="Featured image of post 塑造“权力”优势" />&lt;p>《权力进化论》这本书一开始就强调，权力并不是什么黑暗的艺术，也不是厚黑学，而是一种在组织中能够成事、服人、调动资源、发挥影响力的能力。你并不一定要成为领导才需要这种能力。很多斯坦福的学生都表示，这门课真正帮助他们理解了自己一直身处的世界。权力不仅是生存的工具，也是防身的铠甲。即使你不主动使用这些权力法则，但其他人可能会使用。更重要的是，权力是能力的杠杆，而这本书正是为优秀的人提供了一把权力的杠杆。&lt;/p>
&lt;h1 id="先破打破思维限制">先破：打破思维限制
&lt;/h1>&lt;p>书中的内容分为“先破后立”两部分。第一部分讲述的是“破”，即打破某些限制性思维。&lt;/p>
&lt;h2 id="1-摆脱冒充者综合征">1. 摆脱冒充者综合征
&lt;/h2>&lt;p>许多人经常觉得自己名不副实，害怕被发现是“冒充者”，这是一种极度的不自信。而事实上，这种现象相当普遍。&lt;br>
在对外展示形象时，要多彰显自己的优势，避免使用可能损害自己形象的自我描述。一个简单但有效的方法是逼自己一把，即使感到不适，也要主动展现自己。事实上，一件事情做得越多，就会越自在、越轻松，最终改变自己的心态。&lt;/p>
&lt;h2 id="2-摆脱讨好他人的执念">2. 摆脱讨好他人的执念
&lt;/h2>&lt;p>另一个需要打破的观念是：不必总是追求让所有人都喜欢自己，也没必要刻意赢得他人的好感来施加影响力。&lt;br>
进入一个新环境时，不要急于展示友好，而是先展现自己的能力，营造一种先发影响力。这样，即使后续表现出热情，也不会显得软弱。此外，不要总是把“抱歉”“不好意思”挂在嘴边，也不要因为害怕冒犯别人而不敢提出自己的诉求。这些思维模式在很多人，尤其是中国人中相当普遍。&lt;br>
过于在意亲和性的人，往往会在事业上太过迎合它人、甚至超过目标都为此让步，结果可能错失推动事业发展的好机会。相反，那些独断型性格的人更容易在权力和地位上获得优势。当然，这种性格也有一定的负面影响，但其带来的权力效应往往更加强大。&lt;/p>
&lt;h2 id="3-打破常规创造影响力">3. 打破常规，创造影响力
&lt;/h2>&lt;p>为什么打破常规会带来权力？因为人们下意识认为，只有拥有权力的人才能打破常规。因此，当你做出违背常规的举动时，在他人眼中会显得更有权威感。&lt;br>
此外，打破常规还能让对手措手不及，就像战场上的&lt;strong>突袭&lt;/strong>战术，突然地来这么一下，使对方在未充分准备的情况下匆忙应对，可能没想好就答应你了，或者没来得及阻止你。这是一种很有趣的战术，可以偶尔用一用。&lt;br>
打破常规时能激发他人的好奇心，使他们更加专注于你的行为。书中给出了两个原则：&lt;/p>
&lt;ol>
&lt;li>如果没有损失，那就大胆尝试，即使被拒绝，结果也不过如此。&lt;/li>
&lt;li>如果没有明确禁止某件事，那就直接去做，哪怕事后需要补充审批或请求原谅，也比错失时机要好得多。&lt;br>
特别是在组织中，常规往往由管理者制定，并倾向于保护处于优势地位的人。如果一味遵守这些常规，自己就可能被置于劣势。因此，在这些不利的规则下，想要突破，确实需要勇气和策略。&lt;/li>
&lt;/ol>
&lt;h1 id="后立建立高权力姿态">后立：建立高权力姿态
&lt;/h1>&lt;p>所谓“立”，就是要有意识地建立高权力的姿态，包括形象姿态、身体姿态和语言姿态。&lt;/p>
&lt;h2 id="3-种姿态">3 种姿态
&lt;/h2>&lt;h3 id="1-形象姿态">1. 形象姿态
&lt;/h3>&lt;p>通过穿着打扮来传递你想表达的信号。可以想象自己希望给人留下什么印象，并朝这个方向努力，甚至可以找一个标杆人物来模仿。&lt;/p>
&lt;h3 id="2-身体姿态">2. 身体姿态
&lt;/h3>&lt;p>讲话时可以更多地使用手势，尤其是那些&lt;strong>舒展&lt;/strong>、自然的手势，同时拉近与对方的距离，以更好地传递自信和权威感。&lt;/p>
&lt;h3 id="3-语言姿态">3. 语言姿态
&lt;/h3>&lt;p>语言姿态体现在更高的音量、更短的句子、更简明的表达，以及减少使用“嗯”“呃”这类弱势语言。此外，书中提到一个小技巧：适度利用愤怒情绪，往往能对他人施加更强的影响力。&lt;/p>
&lt;h2 id="建立个人品牌">建立个人品牌
&lt;/h2>&lt;p>要学会打造个人品牌，提炼自身最突出的优势，形成一句简洁的品牌标识。例如，书中提到一位学生在争取晚宴机会时，开场就表明自己是《福布斯》的撰稿人，这就是一种高效的品牌展示。&lt;br>
另一个例子是 Facebook 的一位高管，她最初并不擅长表达自己，后来意识到必须宣传自己的工作，才能争取更多资源。她学会了讲述自己的品牌故事，例如强调自己项目的级别、收益以及对公司的贡献。这种做法并非推销，而是帮助团队争取更好的资源，首先就要过心里这一关，不要觉得不好意思，如果你不为自己“带盐”，谁会呢？&lt;/p>
&lt;h2 id="建立广泛人脉">建立广泛人脉
&lt;/h2>&lt;p>研究发现，大多数人的工作机会并非通过正式渠道获得，而是靠社会关系提供的非正式信息。很多机会来自偶然认识的人，因为他们的圈子和背景不同，能够相互提供资源。&lt;br>
这里涉及“结构洞”概念，即两个网络之间没有直接连接，而你可以成为连接的桥梁。这种位置的战略价值非常大。如果你想获得别人的帮助，不应笼统地提出请求，而要具体描述需求，让对方迅速理解如何帮助你。&lt;/p>
&lt;h1 id="总结">总结
&lt;/h1>&lt;p>争取权力最核心的能力在于：即使面对无数反对和挫折，依然要坚定地、想方设法地促成自己想做的事情。这种意志力，往往决定了一个人能否攀上事业的巅峰。&lt;/p></description></item><item><title>提升思考效率</title><link>https://www.jsongo.top/articles/enhancing-thinking-beyond/</link><pubDate>Thu, 06 Mar 2025 13:37:25 +0800</pubDate><guid>https://www.jsongo.top/articles/enhancing-thinking-beyond/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/8288c6e70fe84133b94ee222535d18b0.jpg" alt="Featured image of post 提升思考效率" />&lt;p>在探索如何超越思考本身这一深刻议题时，《思考如何超越思考》这本书给出了富有启发性的提升思考效率的方法，主要涵盖行动、环境、社交三个维度。&lt;/p>
&lt;h1 id="一借行动之力激发思考潜能">一、借行动之力，激发思考潜能
&lt;/h1>&lt;p>人类大脑并非独立运作的个体，其运转效能与身体状态、所处环境以及人际交往紧密相连。通过行动激发思考，可尝试以下策略：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>手部精细动作刺激&lt;/strong>：当我们专注思考时，借助一些手部小动作能够有效促进大脑思维。比如手持小键盘、按钮玩具，或者揉捏解压玩具，规律性地操作这些小物件，能为大脑思考注入活力。&lt;/li>
&lt;li>&lt;strong>顺应自然动作模式&lt;/strong>：人在自然环境中，动是常态。刻意保持静止反而需要不断向身体下达指令，这无疑增加了认知负荷，消耗大脑能量。此外，手势在思考过程中也扮演着重要角色。研究表明，老师在教学时运用丰富且具体的手势，能助力孩子们更好地理解抽象概念。&lt;/li>
&lt;li>&lt;strong>多元操作方式助力&lt;/strong>：写写画画是一种极为有效的思考辅助手段。以我个人为例，我喜欢拿起笔和本子，边画边思考边表达，能够快速且高效地梳理思路。当然，在平板电脑屏幕上进行连续操作，同样能收获不错的效果。而进行如散步这类中等强度的活动，通过行动产生的节奏感刺激大脑，借助周边环境触发灵感，对提升创造力大有益处。&lt;/li>
&lt;li>&lt;strong>合理安排活动节奏&lt;/strong>：在休息阶段，充分放松身体是为下一轮高强度脑力劳动蓄能的关键。而在开启高强度思考之前，不妨进行一次实实在在的热身，例如出门散散步，让身体和大脑提前进入状态。&lt;/li>
&lt;/ol>
&lt;h1 id="二依环境之利优化思考环境">二、依环境之利，优化思考环境
&lt;/h1>&lt;p>环境对思考效率的影响不容小觑，可从以下方面加以利用：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>亲近自然，舒缓身心&lt;/strong>：仅仅在自然环境中停留一分钟，我们的心率便会逐渐平稳，呼吸趋于规律，大脑也随之放松。相较于城市环境，观赏自然景观时我们眨眼的频率更低，这意味着自然环境能减轻认知负担，减少精力损耗。谷歌的研究数据显示，办公桌靠近窗户的员工，不仅创造力得到显著提升，工作效率大幅提高，睡眠质量也更胜一筹，平均每晚比其他人多睡 16 分钟。在工位上摆放一盆绿植，同样有助于提升工作效率。&lt;/li>
&lt;li>&lt;strong>打造主场，增强自信&lt;/strong>：在工作环境中，布置一些个人熟悉的物品，能够营造出一种专属的主场氛围。当个体感受到所处空间归属于自己时，自信心与专注力会油然而生，工作效率自然得以提升。反之，在单调乏味的办公室里，人们容易产生归属感缺失的感觉，进而导致工作效率下降。&lt;/li>
&lt;li>&lt;strong>灵活构建空间&lt;/strong>：过多的交流有时会对创新产生抑制作用。因为当个体在公众场合冒险尝试时，难免会顾虑失败后他人的看法，即便他人未作评价，自身内心也会产生挫败感，这种无形的压力会束缚创造力。而在相对不受关注且具有仪式感的环境中，人们往往能感受到自身的力量，创造力也更容易被激发。因此，创造可灵活切换的环境至关重要。以学校为例，设置单人宿舍满足学生私密空间需求，同时配备公共图书馆、食堂和校园等场所，方便学生进行交流互动。概括而言，多接触自然、在工作环境中营造主场优势、构建间歇性合作空间与私密工作空间以激发创新，能满足不同场景下的思考需求。&lt;/li>
&lt;/ol>
&lt;h1 id="三凭社交之能拓展思考深度">三、凭社交之能，拓展思考深度
&lt;/h1>&lt;p>社交在提升思考效率方面有着独特的价值：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>关联人际，简化概念&lt;/strong>：人类在思考抽象概念方面并非强项，但在处理人际关系时却游刃有余。所以，当我们试图阐释复杂概念时，将其与人物关联是极为有效的方法。面对抽象问题，融入人的元素不仅能提升自身思考能力，还能让他人更迅速地理解。研究表明，相较于说明文，我们从故事中能够回忆起的信息要多出 50%。所以，尽可能地用故事来串联重要的抽象概念，能收获更好的效果。&lt;/li>
&lt;li>&lt;strong>身体同步，促进协同&lt;/strong>：以孩子们一起荡秋千为例，当他们的节奏达成同步时，后续玩耍过程中彼此配合的默契度会更高，在合作任务中也更容易相互协作。在开会场景中，大家共同聚焦于墙上钉着的设计图和文件等物品，让目光集中，能够激发共同思考，结合具象化元素使讨论更高效、更集中。在两人沟通时，采用身体同步的方式，比如一起散步或跑步，同样能促进思考。通过人与人之间的行为同步，能够实现思考同步，进而激发个体更强的思考能力。&lt;/li>
&lt;/ol>
&lt;h1 id="四实用建议助力思考提升">四、实用建议，助力思考提升
&lt;/h1>&lt;p>为更好地提升思考效率，书中还给出了两条实用建议：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>减轻记忆负荷&lt;/strong>：尽量将需要记忆的内容从大脑中解放出来，外化到外部世界，放置在易于找寻的地方，减轻大脑记忆负担。&lt;/li>
&lt;li>&lt;strong>化解抽象难题&lt;/strong>：把抽象的信息与人物、故事等具体元素相联系，降低大脑处理抽象内容的难度。&lt;/li>
&lt;/ol></description></item><item><title>用数字打动人心的方法</title><link>https://www.jsongo.top/articles/using-numbers-to-inspire/</link><pubDate>Thu, 06 Mar 2025 10:38:32 +0800</pubDate><guid>https://www.jsongo.top/articles/using-numbers-to-inspire/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/239072edb19460299ee51a5ac5b8aa87.jpg" alt="Featured image of post 用数字打动人心的方法" />&lt;p>《用数字讲故事》，这是一个比较衫的书，主要讲，在沟通表达中，运用数字讲好故事以实现表达目的。其中提到需要遵循的四个原则，以及要掌握的三种技巧。&lt;/p>
&lt;h1 id="一原则">一、原则
&lt;/h1>&lt;h2 id="一能不用就不用">（一）能不用就不用
&lt;/h2>&lt;p>数字本身较为抽象，多数人理解存在一定门槛。因此，在表达时，若不是非用不可，应尽量避免使用数字。比如在日常交流中，描述一个场景时，过多使用精确数字可能会让对方理解起来费劲，像 “这个广场面积大概是 10000 平方米”，不如说 “这个广场非常大” 来得简洁直观。&lt;/p>
&lt;h2 id="二化整体为个体">（二）化整体为个体
&lt;/h2>&lt;p>把描述整体的数字平摊到每个人身上，让数字更贴近个人体验。因为我们的大脑天生对群体的感知比较模糊，而个体更容易引发共鸣。例如，在描述一场灾难时，拍摄黑压压的人群，观众可能感受不深，但如果把镜头聚焦在一对走散的母女身上，让观众从她们的角度去经历那些苦难，就会让人触动得多。再如，表达大一学生退学率是 5%，直接说这个数字，大部分人没太多感觉。但要是对大一的同学说：“等到大二开学时，这个教室里就会少了两个人。” 大家马上就能感受到其中的变化，体会到退学率带来的影响。&lt;/p>
&lt;h2 id="三化无关为有关">（三）化无关为有关
&lt;/h2>&lt;p>有些数字乍一听好像跟人们没什么关系，这时我们要把它具体化，与每个人的生活挂钩。一旦他人的故事变成自己的故事，所有的数字都会变得更有吸引力。比如提到大一学生退学率，转化为与同学相关的表述，就是很好地将看似无关的数字变得与个体有关。&lt;/p>
&lt;h2 id="四化抽象为具象">（四）化抽象为具象
&lt;/h2>&lt;p>用听众熟悉的具体事物来解释抽象的数字，这样大家能一下子理解。例如，当医生告诉你长了一个直径 2.5 厘米的良性肿瘤时，这个数字比较抽象。但要是说 “一颗葡萄大小的肿瘤”，你马上就能更直观地理解问题的严重性。又比如，要形容 6 英尺有多远，不同国家的人可能有不同的理解。在中国，我们可以说 1 英尺大约是一张 A4 纸的长度，这样大家就更容易想象出 6 英尺大概的距离。&lt;/p>
&lt;h1 id="二技巧">二、技巧
&lt;/h1>&lt;h2 id="一安可法">（一）“安可法”
&lt;/h2>&lt;p>不要一次性把所有数字说完，而是先说大部分，最后再来一个最佳描述，就像 “不只是这样，还怎么样怎么样”。例如，要形容美国人吃肉多，可以先打个比方：饲养这些牲畜所需的土地，相当于地球可居住土地的 138%。为了更形象地表达这个数字的扩张性，进一步说：地球上所有的可居住土地都用来养牲畜了，还不够，还得再复制一块非洲土地，外加一块澳大利亚土地，才能满足需求。这样一来，数字的冲击力就非常直观了。&lt;/p>
&lt;h2 id="二情感法">（二）“情感法”
&lt;/h2>&lt;p>类似南丁格尔用的方法，把抽象的东西跟用户身边息息相关的事物结合起来，让大家真真切切地感受到这是跟自己有关的事情。比如在宣传环保时，说每年有大量的塑料垃圾进入海洋，如果能具体到 “平均每个人每年使用的塑料吸管，连接起来可以绕地球一圈”，就会让人们更切实地感受到塑料垃圾问题与自身的关联。&lt;/p>
&lt;h2 id="三协奏曲">（三）“协奏曲”
&lt;/h2>&lt;p>把一个数字转化成好几个能勾起人们情感共鸣的元素。例如，描述一个城市的人口时，可以说 “这座城市有 500 万人口，相当于 50 个大型体育场坐满观众的数量，这里面有各行各业的人，他们的梦想、奋斗和生活共同构成了这座城市的活力”，通过多个元素让单纯的人口数字变得生动起来。&lt;/p>
&lt;h1 id="三强化应用">三、强化应用
&lt;/h1>&lt;h2 id="一让具象化事物-活-起来">（一）让具象化事物 “活” 起来
&lt;/h2>&lt;p>如果想把具象化的方法发挥得更有影响力，不妨让这个具体的事物在观众面前 “活” 起来。比如，我们要让程序员优化性能，节省每一微秒。可以直接拿一捆电线套在程序员脖子上，告诉他：“这捆电线有 984 英尺长，相当于三个足球场的距离。电流在一微秒内能走这么远，节省一微秒就能节省这么多。” 这样一来，程序员立刻就能感受到优化性能的重要性。&lt;/p>
&lt;h2 id="二让听众亲身体验">（二）让听众亲身体验
&lt;/h2>&lt;p>为了让数字更具感染力，我们可以尝试让听众亲身体验。比如，把听众带进房间，让他们近距离感受这些具体的事物。比如讲解房屋面积时，带听众实地走进房间，通过他们对房间空间的实际感受，更好地理解面积数字所代表的实际大小。&lt;/p>
&lt;h2 id="三明确目标与细化细节">（三）明确目标与细化细节
&lt;/h2>&lt;p>我们的最终目标是用数字拨动人心，而不是简单地传递信息。所以，首先要明确自己的目标是什么 —— 是想让对方明白事情的严重性，还是想让他们理解某个程度？另外，尽量把细节具体化。比如，一个高管想让董事会明白公司在采购上的浪费，他可以说：“每次采购，我们浪费的钱相当于一辆豪车的价格。” 这样一来，董事会立刻就能感受到问题的严重性。他没有直接摆出整体数字，而是巧妙地拿起一双标价 3 美元的黑色手套，又拿起一双几乎一模一样但标价 10 美元的手套，把它们摊在桌上展示，让对方直观地感受到公司在采购上的浪费。&lt;/p>
&lt;h1 id="四特别注意">四、特别注意
&lt;/h1>&lt;p>当向别人抛出一个数字时，千万不要指望他能马上理解你的意思。&lt;br>
人们对数字的吸收能力，可能低到让你意想不到。大部分人在听到数字时，往往会下意识地去思考它的含义。很多时候，当听到一个数字很大时，就会不自觉地认为事情就是那样，甚至在心里说服自己去相信它。真正能够始终保持理智的人其实并不多。所以，光有数字本身是不够的，只有让数字变得鲜活，它才具有真正的说服力。&lt;/p></description></item><item><title>video：教育风向 &amp; 高效作业</title><link>https://www.jsongo.top/articles/educational-methods-for-children/</link><pubDate>Sun, 02 Mar 2025 10:57:18 +0800</pubDate><guid>https://www.jsongo.top/articles/educational-methods-for-children/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/c41a06c6e8152c8747b756e140e47ead.jpeg" alt="Featured image of post video：教育风向 &amp; 高效作业" />&lt;p>本文从两个视频中学习、整理而来。&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://v.douyin.com/i5N1xTAE/" target="_blank" rel="noopener"
>https://v.douyin.com/i5N1xTAE/&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://v.douyin.com/i5YgnAod/" target="_blank" rel="noopener"
>https://v.douyin.com/i5YgnAod/&lt;/a>&lt;/li>
&lt;/ul>
&lt;h1 id="教育风向变化">教育风向变化
&lt;/h1>&lt;p>该视频由豆豆妈育儿发布，主要分享小学教育风向变化及对应的育儿建议。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>教育风向转变&lt;/strong>：今年小学教育风向发生大反转，涉及影响全国的深改会、教育主管单位的改革思路规划、小学新教材施行这三件大事。指明了一些方向：
&lt;ul>
&lt;li>背后是国家要实现教育、科技、人才一体化，加快顶尖科技人才选拔培养的政策导向。&lt;/li>
&lt;li>“双减” 是为把孩子从盲目刷题中解放出来，教育部加大理工课招生比重，中高考随之调整，如高考数学难度提升、北京 2025 年中考调整科目、强基计划开辟数学物理单招、高中增加科技特长生比重 。&lt;/li>
&lt;li>为适应这些变化，课标和教材也在改革，推行场景化、大单元、跨学科学习等，减少死记硬背。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>育儿规划建议&lt;/strong>：家长要转变观念，记住 “激发兴趣、强化方法、塑造能力、培养习惯” 十六字。学科规划方面，英语多听读背，看动画磨耳朵；语文狠抓阅读积累，按推荐书单阅读；数学回归课本，理解知识点，还可看数学动画；科学启蒙要趁早，通过阅读、看纪录片、参观科技馆等方式积累知识。具体：
&lt;ul>
&lt;li>&lt;strong>英语&lt;/strong>：多听多读多背，少强调语法。1 - 2 年级坚持磨耳朵、看动画，按词汇量选择 2 - 8 岁 40 部英语原版动画片，每天看 20 分钟、听 1 小时，可积累 2000 多词汇。&lt;/li>
&lt;li>&lt;strong>语文&lt;/strong>：狠抓阅读和积累，推荐阅读 254 本大奖书单和清华附小推荐的 100 本书，每天阅读 20 - 30 分钟，提升理解能力，助力阅读和写作。&lt;/li>
&lt;li>&lt;strong>数学&lt;/strong>：回归课本，理解基础知识点后再做题。让孩子讲例题解题思路，锻炼表达和知识掌握。推荐三部数学动画，一年级起每天看一集，涵盖小学全知识点。&lt;/li>
&lt;li>&lt;strong>科学启蒙&lt;/strong>：尽早开展，最晚不超七八岁。通过阅读、看纪录片、去科技馆博物馆等方式，积累天文地理等知识，拓宽孩子视野。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="让孩子高效写作业">让孩子高效写作业
&lt;/h1>&lt;ol>
&lt;li>&lt;strong>背景引入&lt;/strong>：博主分享陪娃写作业方法，自家孩子一二年级放养时作业存在字迹潦草、错误百出的问题。&lt;/li>
&lt;li>&lt;strong>陪写作业的重要性&lt;/strong>：小学一二年级陪写作业方法很关键，陪对了能培养孩子好习惯、专注力和内驱力，高年级可慢慢放手；陪错了孩子会讨厌学习。&lt;/li>
&lt;li>&lt;strong>万能话术&lt;/strong>
&lt;ul>
&lt;li>孩子不会时：告诉孩子不会很正常，学习就是为了解决不会的问题。&lt;/li>
&lt;li>孩子遇到难题时：说这是挑战自己的机会，像爬山，每个难题都是台阶，迈一步就离山顶更近。&lt;/li>
&lt;li>孩子不想写作业时：表示爸爸妈妈有事业不想上班，但因为责任和想变得更好，得从工作里找乐趣。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>高效作业八步法&lt;/strong>
&lt;ul>
&lt;li>放学先玩半小时：上一天课大脑超负荷，放学后先玩半小时放松，运动能改变大脑活跃度，运动后一小时记忆力最佳，可提升学习效率并锻炼身体，结束后立马写作业。&lt;/li>
&lt;li>写作业前处理杂事：写作业前用五分钟让孩子处理完吃东西、喝水、上厕所等杂事，开始写作业后要在固定时间内保持专注，不能离开座位。&lt;/li>
&lt;li>清空桌面：桌面只放一科作业，写完一科再换另一科，工具只放纸笔、橡皮、计时器，从外部强化孩子专注力。&lt;/li>
&lt;li>给作业排序：计算类费脑作业放在大脑最活跃时做，摘抄生字词等简单作业放中间，最后写难题，让孩子学会时间管理、合理分配精力。&lt;/li>
&lt;li>先复习再写题：写作业前先翻书复习，遇到不会的题先放一放，不要死磕，既能巩固当天知识，又能迅速解决不会的知识点。&lt;/li>
&lt;li>准备学习打卡记分表：包括作业打卡表、奖励积分表和积分兑换表，作业完成一项打个勾，孩子表现好赚积分，积分能兑换奖励，提高写作业积极性，表格可根据孩子喜好制作，懒得做的家长可向博主索要打卡表。&lt;/li>
&lt;li>检查和提问：对于较小的孩子，给小范围检查引导，如三道题里有一道错了，引导其慢慢学会自查，感受独立思考过程；大点的孩子给大点的范围。&lt;/li>
&lt;li>整理错题本：非常重要，平时记录的错题是孩子专属提分秘籍，考前温习能事半功倍。不会整理错题的家长可向博主索要错题集获取指导。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>video：在隐忍中抓住机遇逆袭</title><link>https://www.jsongo.top/articles/forbearance-seizing-opportunities-counterattack/</link><pubDate>Thu, 27 Feb 2025 23:16:31 +0800</pubDate><guid>https://www.jsongo.top/articles/forbearance-seizing-opportunities-counterattack/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/2d47b4c891bc8b4790f365f82a1c6484.jpeg" alt="Featured image of post video：在隐忍中抓住机遇逆袭" />&lt;p>后续会时不时地写一些不那么短的短视频的观后感，今天就先拿 &lt;code>小智侃财经的作品&lt;/code> 的《&lt;a class="link" href="https://v.douyin.com/i5jK3E5H/" target="_blank" rel="noopener"
>为什么放任东大崛起，老美却怂了&lt;/a>》来讲讲。&lt;br>
&lt;img src="https://cdn.lyb.pub/upic/1750870686_cS5D5S.webp"
loading="lazy"
alt="ca3b886aefb28d6cb75276cd57c5af2b_MD5.webp"
>&lt;br>
该视频以《倚天屠龙记》的情节类比开头，讲中美博弈，分析了美国在中美博弈中的策略转变及背后原因，以及中国应对美国压力展现出的自信从容。分了三部分：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>中美博弈现状&lt;/strong>：美国对中国发起科技战、贸易战、金融战，中国凭借自身实力扛住压力，就像张无忌有九阳神功护体。当下中国对内提升市场经济活跃度，对外展现自信从容，如扩大免签国、延长免签时长、对部分国家实施单方面零关税、取消制造业外资限制等。&lt;/li>
&lt;li>&lt;strong>美国的表现及目的&lt;/strong>：美国采取搞孤立、筑高墙、大收缩策略。在军事上，加强格陵兰岛战略布局，建立保卫本土的导弹拦截体系，军事力量收缩；在产业上，阻止日本制铁收购美国钢铁公司，对进口钢铁、铝和汽车加征关税，保护本土制造业；在经济上，退出世界卫生组织和巴黎协定，与沙特、俄罗斯谈原油价格，发展传统能源产业，稳定美元石油结算体系，降低通胀和制造业成本 。&lt;/li>
&lt;li>&lt;strong>中美博弈历史回顾&lt;/strong>，这是全视频最精彩的部分。&lt;br>
围绕着一句很经典的话：美国错过多次打压中国的机会，主要因为每次想打的时候都有国家站出来挡子弹。用形象化的表述，回顾了自上世纪 70 年代以来，在中美关系发展的不同阶段，总会出现其他国家或地区成为美国主要关注点，从而使中国获得发展机遇的情况。&lt;/li>
&lt;li>&lt;strong>上世纪 70 年代&lt;/strong>：当时美国面临着苏联的强大压力，如古巴导弹危机，苏联的导弹部署到老美家门口，同时在第四次中东战争期间，苏联军舰开到地中海与美国对峙。美国内部还遭遇经济滞胀，原油涨价带动物价飙升，经济停滞不前，且戴高乐领导下的法国强调 “欧洲是欧洲人的欧洲”，推动德法和解、欧洲共同体成立，还用法郎换美元买黄金，导致美国黄金储备大幅下降，经济雪上加霜。在这种内外交困的局面下，美国发现中国有实力制衡苏联，于是通过乒乓球外交改善与中国的关系，中国在一定程度上牵制了苏联，帮助美国缓解了外部压力，使得美国暂时无暇针对中国 。&lt;/li>
&lt;li>&lt;strong>上世纪 80 年代&lt;/strong>：日本经济发展迅猛，不仅收购美国地标性建筑，还在汽车产业上对美国造成巨大冲击，美国本土汽车巨头因日本低油耗汽车的竞争而面临困境。美国为维护自身经济利益，与日本签订《广场协议》，逼迫日元升值，并迫使日本开放金融市场，从而打压日本经济。这一时期，日本成为美国重点对付的对象，客观上为中国发展提供了相对宽松的外部环境 。&lt;/li>
&lt;li>&lt;strong>上世纪 90 年代&lt;/strong>：苏联解体后，日本经济也被整垮，此时欧元诞生并对美元构成挑战。欧盟成立后 GDP 一度超过美国，欧元在诞生第一天起就旨在挑战美元地位。美国为限制欧元扩张，发动科索沃战争，同时也没忘记试探中国，如偷袭中国驻南斯拉夫大使馆。但美国的主要精力被欧元吸引，使得中国外贸得以继续发展 。&lt;/li>
&lt;li>&lt;strong>21 世纪初&lt;/strong>：欧元的影响力不断扩大，美国为强化美元地位，支持中国加入 WTO，希望借助中国商品提升美元价值。同时，伊拉克萨达姆宣布用欧元结算原油，美国以此为由发动伊拉克战争，还通过金融手段做空希腊等国债券，引发欧债危机，成功打压欧元。这期间，美国的精力分散在应对欧元问题上，对中国的遏制相对放松，中国得以在这一时期进一步发展经济，提升综合国力。&lt;/li>
&lt;/ol></description></item><item><title>强大的 search 工具 - ag</title><link>https://www.jsongo.top/articles/search-tool-ag-the-silver-searcher/</link><pubDate>Thu, 27 Feb 2025 11:31:09 +0800</pubDate><guid>https://www.jsongo.top/articles/search-tool-ag-the-silver-searcher/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/0b3d83738bddc53706e70a9dfd187061.jpg" alt="Featured image of post 强大的 search 工具 - ag" />&lt;h1 id="安装">安装
&lt;/h1>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">brew install the_silver_searcher
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果是 ubuntu 的话，这么安装：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">apt install silversearcher-ag
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="使用">使用
&lt;/h1>&lt;h2 id="只搜文件名">只搜文件名
&lt;/h2>&lt;p>直接使用时，ag 会检索内容。需要添加 &lt;code>-g&lt;/code> 参考&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ag -g .mp4 .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="正常使用">正常使用
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ag -i foo ./bar/
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>-i 用于忽略大小写&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ag &lt;span class="s1">&amp;#39;useEffect&amp;#39;&lt;/span> --js
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>只在 JS 文件中查 useEffect。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ag --multiline &lt;span class="s1">&amp;#39;^def .+\n +&amp;#34;&amp;#34;&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查 Python 函数定义后面紧跟 docstring 的情况。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ag -l &lt;span class="s1">&amp;#39;OldName&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> xargs sed -i &lt;span class="s1">&amp;#39;s/OldName/NewName/g&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>查到文件中包含 OldName 的所有文件，批量做替换。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-shell" data-lang="shell">&lt;span class="line">&lt;span class="cl">ag -C &lt;span class="m">2&lt;/span> &lt;span class="s1">&amp;#39;class User&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>显示匹配行的上下两行，方便看上下文&lt;/p>
&lt;h2 id="常用参数">常用参数
&lt;/h2>&lt;h3 id="ignore">Ignore
&lt;/h3>&lt;p>&lt;code>--ignore *pack*&lt;/code>&lt;/p>
&lt;h3 id="打印前后">打印前后
&lt;/h3>&lt;p>&lt;code>-A 3&lt;/code> 可以打印搜索结果的 after 3 行。&lt;br>
&lt;code>-B 3&lt;/code> 可以打印 before 的 3 行&lt;br>
&lt;code>-c 3&lt;/code> 可以打印上下 3 行&lt;/p>
&lt;h3 id="只打文件名">只打文件名
&lt;/h3>&lt;p>&lt;code>-l&lt;/code> 表示 files-with-matches，即匹配的文件列表&lt;/p>
&lt;h3 id="全词匹配">全词匹配
&lt;/h3>&lt;p>&lt;code>-w&lt;/code>&lt;/p>
&lt;h3 id="只输出匹配的部分">只输出匹配的部分
&lt;/h3>&lt;p>&lt;code>-o&lt;/code> 用于只输出匹配部分，而不是整行。&lt;/p>
&lt;h2 id="应用">应用
&lt;/h2>&lt;p>把所有的 png 图片找出来，然后按大小排序：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ag -0 -g .png$ . &lt;span class="p">|&lt;/span> xargs -0 du -h &lt;span class="p">|&lt;/span> sort -hr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://cdn.lyb.pub/upic/1744522541_8OSi1S.webp"
loading="lazy"
alt="085e9ed0cac92342df818071b090c46f_MD5.webp|940x235"
>&lt;/p>
&lt;h3 id="-0-选项">&lt;code>-0&lt;/code> 选项
&lt;/h3>&lt;ul>
&lt;li>它主要是为了配合 xargs -0 使用，常用于将结果传递给它来支持空分隔符的命令&lt;/li>
&lt;li>&lt;strong>功能&lt;/strong>：指定输出的文件名以  &lt;strong>空字符（Null 字符）&lt;/strong>  分隔，而不是默认的换行符。&lt;/li>
&lt;li>&lt;strong>用途&lt;/strong>：当文件名包含换行符或空格时，使用  &lt;code>-0&lt;/code>  可以避免解析错误。
&lt;blockquote>
&lt;p>这里为啥一定要 -0 呢？&lt;br>
如果是在代码里找，一般都默认相关的文件名中没有空格、引号、换行等“麻烦字符”，这些不需要 -0 参数。&lt;br>
但如果要搜的目录很不确定，这时要传给 xargs 就得两边加 -0 来确保准确无误。&lt;/p>
&lt;/blockquote>
&lt;/li>
&lt;/ul></description></item><item><title>巨变的时代，对个人发展的思考 - 2025</title><link>https://www.jsongo.top/articles/2025-self-development/</link><pubDate>Wed, 26 Feb 2025 08:47:05 +0800</pubDate><guid>https://www.jsongo.top/articles/2025-self-development/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/a9e868ff852a3dcc1a962c1191714e8a.jpg" alt="Featured image of post 巨变的时代，对个人发展的思考 - 2025" />&lt;blockquote>
&lt;p>写了些思考，让 DeepSeek 优化了下，有点硬，但结构化挺好。&lt;/p>
&lt;/blockquote>
&lt;p>当我们将目光投向当代社会，会发现一个充满矛盾的现象：教育投入与职业回报的倒挂，标准化培养与个体特质的冲突，现实压力与理想追求的撕裂。这种割裂折射出工业化时代的教育范式，与数字化时代人才需求之间的深刻矛盾，也暴露出当代人在职业发展中的集体性焦虑。&lt;/p>
&lt;h1 id="一教育困境六边形战士的迷思">一、教育困境：六边形战士的迷思
&lt;/h1>&lt;p>传统教育体系正面临前所未有的挑战。在 &amp;quot; 不能输在起跑线 &amp;quot; 的焦虑驱使下，标准化培养模式批量生产着能力均衡的 &amp;quot; 六边形战士 &amp;ldquo;。这种工业化时代的人才培养模板，与数字经济时代对垂直领域深耕者的需求形成鲜明反差。某国际教育机构 2023 年调查报告显示，78% 的雇主认为应届毕业生存在 &amp;quot; 技能均值化 &amp;quot; 问题，而真正具备差异化竞争优势的求职者不足 15%。&lt;br>
更深层的矛盾在于，教育系统往往忽视个体天赋的差异性。哈佛大学教育研究院的多元智能理论早已证实，人类智能存在至少 8 种不同维度。但现实中的教育实践，仍在用统一的标尺丈量着每个独特的个体。这种错配导致大量人才被禁锢在非适配领域，造成社会资源的巨大浪费。&lt;/p>
&lt;h1 id="二现实困境系统困局中的个体挣扎">二、现实困境：系统困局中的个体挣扎
&lt;/h1>&lt;p>当个体步入职场，面临的挑战更为复杂。房贷、育儿、医疗等现实压力构成刚性约束条件，使职业转型成为高风险抉择。某招聘平台数据显示，35 岁以上职场人中，62% 陷入 &amp;quot; 转型恐惧 &amp;ldquo;，担心试错成本超过承受阈值。这种生存压力与职业理想的冲突，造就了当代特有的 &amp;quot; 职场悬浮 &amp;quot; 现象——既无法在现有轨道获得成就感，又难以挣脱现实枷锁寻求突破。&lt;br>
回归到个人发展本身，这是一个充满艰难且缺乏确定性的过程。个人常常陷入迷茫，在现实社会中四处碰壁，难以迅速找寻到自身价值得以发挥之处，人才错配现象屡见不鲜，将人才置于无法施展才能之地，无疑是对社会资源的极大浪费。在此情形下，个人又因养家糊口、偿还房贷等现实压力，难以挣脱原有圈子与束缚，去探寻突破点。这与那些在成长探索中最终改变世界的人相比，形成了巨大差异。造成这种差异的原因是多方面的。&lt;br>
&lt;strong>那些能够改变世界的人，往往更具冒险精神，勇于跳出舒适圈尝试新事物，且拥有强大的内驱力，目标明确，不易受外界干扰&lt;/strong>。而那些迷茫错配之人，则多被现实压力束缚手脚，无法追寻真正适合自己的道路，此外，家庭与成长环境等因素也起着重要作用，自幼被鼓励探索的人，往往能培养出独立思考与解决问题的能力。&lt;br>
但观察那些突破困局的成功案例，会发现三个共性特征：&lt;/p>
&lt;ul>
&lt;li>首先是建立了清晰的自我认知体系，通过持续的内省明确核心优势；&lt;/li>
&lt;li>其次是构建了动态能力组合，如将传统行业经验与数字技能融合；&lt;/li>
&lt;li>最后是采取渐进式转型策略，通过副业探索、行业细分、资源重组等方式降低试错风险。&lt;/li>
&lt;/ul>
&lt;h1 id="三破局之法构建个人发展新范式">三、破局之法：构建个人发展新范式
&lt;/h1>&lt;p>在 AI 技术革命重塑产业格局的今天，职业发展正从 &amp;quot; 岗位适配 &amp;quot; 转向 &amp;quot; 价值创造 &amp;ldquo;。&lt;br>
对于深陷现实泥沼的个体，真正的解法不在于寻找标准答案，而在于建立适应不确定性的元能力：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>认知弹性建设&lt;/strong>&lt;br>
建立 &amp;ldquo;T 型知识结构 &amp;ldquo;：在某个专业领域保持持续深耕（垂直深度），同时培育 3-4 个关联领域的认知触角（水平广度）。某金融从业者通过 &amp;quot; 金融 + 心理学 + 数据科学 &amp;quot; 的知识融合，开创了行为金融量化分析新赛道。&lt;/li>
&lt;li>&lt;strong>机会成本管理&lt;/strong>&lt;br>
采用 &amp;ldquo;70/20/10&amp;rdquo; 资源配置模型：70% 精力维持现有发展轨道，20% 投入相邻领域探索，10% 用于高风险高回报的创新实验。这种结构化试错机制，既能保障生存底线，又为突破保留可能性空间。&lt;/li>
&lt;li>&lt;strong>环境感知迭代&lt;/strong>&lt;br>
培养 &amp;quot; 雷达式认知扫描 &amp;quot; 习惯：定期分析行业趋势报告、参加跨界交流、进行未来情景模拟。某医疗从业者通过持续追踪 AI 辅助诊断技术进展，提前三年完成从临床医生到医疗 AI 产品专家的转型。&lt;/li>
&lt;li>&lt;strong>反脆弱系统构建&lt;/strong>&lt;br>
设计 &amp;quot; 职业对冲组合 &amp;ldquo;：将稳定收入源（如核心技能）、趋势性投入（如新兴领域）、创新性尝试（如个人项目）进行有机组合。当某个模块遭遇冲击时，其他模块能形成缓冲保护。&lt;br>
2025 年正处在一个转折点，充满了非常多的不确定性。在技术迭代加速的时代，真正的职业安全不再来自某个岗位，而是源于持续的价值创造能力。正如管理学家彼得·德鲁克所言：&amp;rdquo; &lt;strong>未来属于那些认知自我，并能将知识转化为价值的人&lt;/strong>&amp;quot;。当我们打破标准化发展的思维定式，在现实约束与理想追求间找到动态平衡点，就能在变革浪潮中锚定自己的价值坐标。&lt;br>
站在文明迭代的转折点，个人发展已从 &amp;quot; 路径选择 &amp;quot; 演变为 &amp;quot; 系统构建 &amp;quot; 的复杂工程。那些最终穿越迷雾的突围者，往往既不是完全遵循系统规则的 &amp;quot; 优等生 &amp;ldquo;，也不是彻底脱离现实的 &amp;quot; 理想主义者 &amp;ldquo;，而是深谙 &amp;quot; 戴着镣铐跳舞 &amp;quot; 的智慧：在现实约束中保持战略定力，在有限自由里拓展可能边界。正如管理思想家汉迪所言：&amp;rdquo; 真正的成长始于接受系统的不完美，进而创造属于自己的微系统。&amp;rdquo; 这种在确定与不确定之间的动态平衡，或许才是数字时代最稀缺的生存艺术。&lt;/li>
&lt;/ol>
&lt;h1 id="四坚持学习逐步突破">四、坚持学习，逐步突破
&lt;/h1>&lt;p>工作之余很难有大块时间去实现个人的“更新迭代”。有一些方面或许可以尝试：&lt;/p>
&lt;ul>
&lt;li>首先，可以利用业余时间学习感兴趣领域的知识，提升技能，为转型做准备；&lt;/li>
&lt;li>积极拓展人脉，或许能发现新机遇；&lt;/li>
&lt;li>分析自身现有工作优势，尝试迁移至更具潜力的方向。&lt;br>
鉴于难以将大量时间投入探索，担心两头落空，可从每天挤出碎片时间开始，如上下班途中听课程、午休时阅读专业书籍，周末专门留出固定时间深入学习实践。&lt;br>
设定小而具体的目标，完成后给予自己小奖励以增强动力，还可将探索与工作相结合寻找灵感。&lt;br>
若觉得这些方法普通，不妨尝试设定 “冒险日”，每月选择一天去做从未尝试过的事，如参加陌生领域讲座或尝试新运动；找信任的朋友定期进行头脑风暴；将大目标拆解为极小步骤，记录每一个小成就以激励自己坚持。&lt;/li>
&lt;/ul></description></item><item><title>《铜钟下的秘密》福尔摩斯探案 - 续集</title><link>https://www.jsongo.top/articles/holmes-secret-beneath-the-bronze-bell/</link><pubDate>Thu, 20 Feb 2025 18:35:01 +0800</pubDate><guid>https://www.jsongo.top/articles/holmes-secret-beneath-the-bronze-bell/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/a3cfc9a156da68c50afbe2e6e4824ac4.jpg" alt="Featured image of post 《铜钟下的秘密》福尔摩斯探案 - 续集" />&lt;p>作者：华生医生&lt;br>
那是 1890 年 11 月一个寒风凛冽的傍晚，伦敦的天空阴沉得仿佛要压下来，贝克街 221B 的壁炉烧得正旺。我正埋头记录前一周那桩“切尔西画像失窃案”的细节，而歇洛克·福尔摩斯则站在窗前，拉着小提琴，琴声低沉而忧郁。他已经三天没碰过食物，显然又陷入了那种只有新谜团才能打破的倦怠。&lt;/p>
&lt;p>就在这时，楼梯上传来急促的脚步声，紧接着门被猛地推开。一位身材高大的男子闯了进来，他约莫五十岁，头发花白，穿着厚实的呢大衣，脸上带着一种难以掩饰的惊恐。他的到来让福尔摩斯立刻放下了琴弓，眼中闪过一丝期待的光芒。&lt;/p>
&lt;p>“福尔摩斯先生，我是亨利·巴克利，住在萨里郡的布兰德庄园，”他喘着粗气说道，“我需要您的帮助——我的侄子失踪了，而我收到了一封信，暗示他可能已经死了！”&lt;/p>
&lt;p>福尔摩斯示意他坐下，语气平静却带着一丝急切：“巴克利先生，从头说起。细节越多越好。”&lt;/p>
&lt;p>巴克利掏出一块手帕擦了擦额头的汗，开始叙述：“我侄子菲利普·巴克利是个年轻的工程师，三天前他从伦敦回来，说要去庄园的钟楼检查一座老铜钟——那是座有百年历史的钟，据说是我们家族的传家宝。可那天晚上后，他就再也没出现。昨天，我收到一封匿名信，信上说：‘菲利普已随铜钟长眠，勿寻。’我搜遍了庄园，甚至报警，可毫无线索！”&lt;/p>
&lt;p>福尔摩斯接过那封信，信纸泛黄，字迹歪斜，显然是用左手匆匆写成。他嗅了嗅信纸，又用放大镜仔细观察。“油墨味很淡，纸上有轻微的煤灰痕迹。寄信人可能在工业区附近。巴克利先生，您侄子最近有何异常举动？”&lt;/p>
&lt;p>“他一直在研究那座铜钟，”巴克利回忆道，“说是发现了什么秘密，还提到要找专家验证。他性格开朗，没什么敌人，这事让我完全摸不着头脑。”&lt;/p>
&lt;p>福尔摩斯站起身，抓起外套。“华生，收拾一下，我们即刻前往布兰德庄园。这案子有意思了。”&lt;/p>
&lt;hr>
&lt;p>当晚，我们乘火车抵达萨里郡，夜色中，布兰德庄园显得阴森而古老。庄园坐落在一片荒凉的丘陵间，周围环绕着稀疏的松林。一座孤零零的钟楼耸立在庄园东侧，铜钟的轮廓在月光下若隐若现。巴克利领我们走进主宅，仆人们神色不安，显然被最近的事件搅得人心惶惶。&lt;/p>
&lt;p>福尔摩斯直奔钟楼。钟楼内部阴冷潮湿，一座巨大的铜钟悬挂在顶端，钟面上刻着模糊的花纹和拉丁铭文。福尔摩斯用手杖敲了敲钟身，发出一声低沉的回响。他蹲下检查地面，发现几滴干涸的蜡迹和一小块撕碎的纸片，纸上写着“下方”二字。&lt;/p>
&lt;p>“华生，这钟有问题，”他低声道，“蜡迹说明有人深夜在此活动，而这纸片可能是菲利普留下的线索。”&lt;/p>
&lt;p>他转向巴克利：“这座钟是否能移动或打开？”&lt;/p>
&lt;p>巴克利摇头：“它固定在梁上，几代人都没动过。不过菲利普说过，钟底似乎有机关。”&lt;/p>
&lt;p>福尔摩斯爬上梯子，用放大镜细查钟底。片刻后，他按下一块不起眼的凸起，只听“咔哒”一声，钟底露出一道暗门。他示意我递上提灯，探头一看，里面竟是一条狭窄的石梯，直通地下。&lt;/p>
&lt;hr>
&lt;p>我们三人顺梯而下，来到一个阴暗的地窖。空气中弥漫着霉味和淡淡的化学气味。地窖中央摆着一张木桌，桌上散落着工具、图纸和几瓶不明液体。墙角堆着几个木箱，箱盖上沾着新鲜的泥土。福尔摩斯迅速翻看图纸，发现那是铜钟的结构设计，旁边还有一行潦草的笔记：“核心在基座，勿信表面。”&lt;/p>
&lt;p>“菲利普显然发现了什么，”福尔摩斯喃喃道，“这些液体是硝酸和硫酸——他可能在实验某种金属成分。”&lt;/p>
&lt;p>就在这时，巴克利突然惊叫一声，指着地窖一角。我们转头看去，只见阴影中躺着一具人形物体。我急忙上前，却发现那只是个穿了旧衣的稻草人，手里握着一根断裂的铁棒。&lt;/p>
&lt;p>“有人故意布置这个假象，”福尔摩斯冷笑，“想让我们以为菲利普已死。可这稻草人太新，泥土是今晨才沾上的。华生，我们被监视着。”&lt;/p>
&lt;p>话音未落，头顶传来一声巨响，铜钟猛地摇晃起来，暗门随之关闭。我冲向梯子，却发现石壁无缝可寻。福尔摩斯冷静地环顾四周，目光落在木箱上。他撬开一箱，里面竟是一堆闪亮的金币和几页羊皮纸。&lt;/p>
&lt;p>“黄金伪造案！”他低声道，“这些是假币模具。菲利普无意中撞破了一个犯罪团伙的秘密，他们把他抓走了。”&lt;/p>
&lt;hr>
&lt;p>接下来的几个小时，我们在地窖中寻找出路。福尔摩斯终于在墙角发现一处松动的石板，推开后露出一条地道。地道尽头通向庄园外的一片树林，我们爬出时已是凌晨，雾气笼罩着一切。远处传来马蹄声，福尔摩斯立刻拉我们躲进灌木丛。&lt;/p>
&lt;p>三名男子骑马经过，其中一人提着灯笼，另一人肩上扛着个麻袋，麻袋里隐约露出挣扎的痕迹。“菲利普！”巴克利低呼。我正要拔枪，福尔摩斯按住我：“时机不对，跟着他们。”&lt;/p>
&lt;p>我们尾随至一座废弃磨坊。磨坊内灯火通明，麻袋被扔在地上，里面果然是菲利普，嘴被堵住，手脚被绑。他脸色苍白，但显然还活着。三名男子中，一个满脸疤痕的高个子冷笑道：“巴克利，这秘密你不该碰。现在你叔叔也来了，正好一网打尽。”&lt;/p>
&lt;p>福尔摩斯低声对我说：“华生，准备好。那疤脸是头目。”他从口袋掏出一枚信号弹，点燃后扔向磨坊外。火光冲天，片刻后，远处传来警笛声——他早已通知了雷斯垂德探长。&lt;/p>
&lt;p>混乱中，我和福尔摩斯冲进磨坊。我击倒一名喽啰，福尔摩斯则用手杖精准地打中疤脸的手腕，匕首落地。雷斯垂德带人赶到，三名罪犯束手就擒。菲利普被解救出来，虽受了惊吓，但并无大碍。&lt;/p>
&lt;hr>
&lt;p>次日，我们回到贝克街。福尔摩斯坐在扶手椅上，向我和巴克利父子解释了一切。“菲利普在检查铜钟时，发现钟基座藏有伪造金币的模具。这是个老把戏——利用古物掩盖罪行。那个团伙多年来利用庄园的地窖生产假币，销往伦敦。菲利普的失踪是他们为了灭口，而那封信是故意引您下地窖，好一并解决。”&lt;/p>
&lt;p>“可他们怎么知道我们在地窖？”巴克利问道。&lt;/p>
&lt;p>“很简单，”福尔摩斯点燃烟斗，“您的仆人中有内应。我注意到管家昨晚眼神闪烁，手上有煤灰——和信纸上的痕迹一致。他已被雷斯垂德带走。”&lt;/p>
&lt;p>菲利普感激地说：“福尔摩斯先生，若不是您，我恐怕凶多吉少。”&lt;/p>
&lt;p>福尔摩斯摆摆手：“逻辑和观察，菲利普。你的笔记救了你自己。”&lt;/p></description></item><item><title>《雾中之影》 - 福尔摩斯探案 - 续集</title><link>https://www.jsongo.top/articles/holmes-shadow-in-the-mist/</link><pubDate>Thu, 20 Feb 2025 18:17:09 +0800</pubDate><guid>https://www.jsongo.top/articles/holmes-shadow-in-the-mist/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/102f6705bfb2660ca093692c2d7a6677.jpg" alt="Featured image of post 《雾中之影》 - 福尔摩斯探案 - 续集" />&lt;p>那是一个阴郁的秋日清晨，浓雾如厚重的帷幕笼罩着伦敦，贝克街 221B 的窗户上凝结着细密的水珠。我坐在壁炉旁整理医疗笔记，而我的朋友歇洛克·福尔摩斯则倚在扶手椅上，手指轻轻敲击着烟斗，神情若有所思。自从我们解决了那桩“红宝石失窃案”后，他已经好几天没有接到值得一试的案子，这让他显得有些焦躁。&lt;/p>
&lt;p>就在这时，门铃急促地响起，打破了屋内的沉寂。片刻后，我们的房东哈德森太太敲门进来，身后跟着一位衣着考究却神色慌张的绅士。他大约四十岁，身材瘦削，戴着一顶礼帽，手里紧握着一根乌木手杖。&lt;/p>
&lt;p>“福尔摩斯先生，”他开门见山地说道，“我是詹姆斯·卡特赖特，住在肯辛顿。我需要您的帮助——我相信有人要谋害我！”&lt;/p>
&lt;p>福尔摩斯眼中闪过一丝興味，示意来客坐下。“请详细说说，卡特赖特先生。谋害的证据是什么？”&lt;/p>
&lt;p>卡特赖特深吸一口气，开始叙述：“过去三晚，每当我深夜归家时，总能听到身后传来脚步声。可当我回头去看，那声音便戛然而止，浓雾中什么也看不见。昨晚更离奇，我在书房里发现了一张字条，上面用潦草的笔迹写着：‘今夜是你的末日。’我确信这不是恶作剧——我没有仇人，也没有理由被人威胁！”&lt;/p>
&lt;p>福尔摩斯拿起烟斗，点燃后缓缓吐出一圈烟雾。“有趣。字条带来了吗？”&lt;/p>
&lt;p>卡特赖特从口袋中掏出一张皱巴巴的纸递了过去。福尔摩斯接过，眯眼细看片刻，又递给我。我注意到纸张粗糙，像是从廉价笔记本上撕下的，墨迹有些模糊，显然是用蘸水笔匆忙写成。&lt;/p>
&lt;p>“您从事什么职业？”福尔摩斯问道。&lt;/p>
&lt;p>“我是一家小型航运公司的经理，负责北海的货运调度。生意平稳，没什么特别之处。”&lt;/p>
&lt;p>“您昨晚几点发现这张字条？”&lt;/p>
&lt;p>“大约十点。我从俱乐部回来后直接进了书房，字条就放在我的书桌上。可我发誓，仆人都已睡下，门窗也锁得好好的！”&lt;/p>
&lt;p>福尔摩斯站起身，走到窗边，凝视着外面的雾气。“华生，拿上你的外套。我们得去卡特赖特先生的宅邸看看。”&lt;/p>
&lt;hr>
&lt;p>一小时后，我们抵达肯辛顿一栋整洁的三层住宅。雾气依然浓重，能见度不足十码。卡特赖特领我们走进书房，这是一间摆满航海书籍和地图的房间，书桌上除了一盏油灯和几份文件外别无他物。福尔摩斯立刻开始检查，先是研究门锁，又蹲下查看地毯。&lt;/p>
&lt;p>“看这里，华生，”他指着书桌旁的一小块泥迹说道，“这泥土是湿的，带有淡淡的海腥味，显然是今晨才留下的。卡特赖特先生，您家里可有谁今早出门？”&lt;/p>
&lt;p>“没有，”卡特赖特困惑地说，“仆人们都在屋里忙活。”&lt;/p>
&lt;p>福尔摩斯微微一笑，转身检查窗户。窗闩完好，但窗台上有一道浅浅的刮痕。“有人用工具撬过这里，但没成功。您的威胁者显然不擅长开锁。”&lt;/p>
&lt;p>接着，他要求查看宅子周围。我们绕到后院，发现一处低矮的围墙，墙头有几处新鲜的磨损痕迹。福尔摩斯蹲下，从墙根的泥土中捡起一小块烧焦的纸片，上面隐约可见“货物清单”几个字。&lt;/p>
&lt;p>“华生，这可不是普通的恐吓，”他低声道，“卡特赖特先生的职业是个关键。”&lt;/p>
&lt;hr>
&lt;p>当晚，福尔摩斯提议留在卡特赖特家中观察。我们熄了灯，躲在书房窗帘后守候。午夜刚过，雾中果然传来一阵轻微的脚步声，随后是围墙处传来的窸窣声。我握紧了左轮手枪，而福尔摩斯则纹丝不动，目光如鹰。&lt;/p>
&lt;p>突然，一道黑影出现在窗外，手持一根细棒试图撬窗。福尔摩斯猛地拉开窗，喝道：“站住！”那人一惊，转身就跑，但我和福尔摩斯早已扑出，迅速将他按倒在地。&lt;/p>
&lt;p>那是个瘦小的男人，穿着粗布外套，满脸胡茬。他怀里掉出一把匕首和一叠文件。福尔摩斯捡起文件，借着月光扫了一眼，脸上露出满意的笑容。&lt;/p>
&lt;hr>
&lt;p>次日清晨，我们在贝克街向卡特赖特解释了一切。“您的威胁者名叫汤姆·里德，是您公司的一名仓库工人，”福尔摩斯说道，“他试图恐吓您，好让您辞职。他和一伙走私犯勾结，利用您的航运公司偷运私货。那些脚步声和字条是为了让您精神崩溃，而昨晚，他打算更进一步。”&lt;/p>
&lt;p>“可他怎么进的我的书房？”卡特赖特惊讶道。&lt;/p>
&lt;p>“很简单。他白天混在送货的工人中，趁人不备溜进宅子，留下字条。泥土和纸片暴露了他的身份——他昨晚带着伪造的货物清单，打算栽赃给您。”&lt;/p>
&lt;p>卡特赖特长舒一口气，连声道谢。案件结束后，我看着福尔摩斯点燃烟斗，忍不住问道：“你怎么这么快就猜到是公司内部的人？”&lt;/p>
&lt;p>他笑了笑：“华生，泥土里的海腥味和那张烧焦的纸片告诉我，这与航运有关。而能在浓雾中准确找到这栋房子的人，必然对卡特赖特的习惯了如指掌。逻辑，仅仅是逻辑罢了。”&lt;/p></description></item><item><title>书房的氛围营造</title><link>https://www.jsongo.top/articles/study-room/</link><pubDate>Sun, 12 Jan 2025 23:09:45 +0800</pubDate><guid>https://www.jsongo.top/articles/study-room/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/cf6f79652cb30bd591d55b7e797cf3b8.jpg" alt="Featured image of post 书房的氛围营造" />&lt;h1 id="背景">背景
&lt;/h1>&lt;p>拥有了一间相对安静、专注、有氛围的书房，可以让人把更多的时间投入在学习上，看书也好、在线学习也好，写作等生产性活动也好，总之一个好的氛围可以让人更有欲望和意愿投入到学习或创造上。&lt;br>
基于这个想法，本文就来聊聊我的思路，怎么逐步打造成一个让我一进入就想学习或创造的环境。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/bd2d7075048d63c561f8894ecf791158.webp"
width="650"
loading="lazy"
alt="19570c39441e301a0f59a7927d24d113_MD5|650"
>&lt;/p>
&lt;h1 id="几个维度">几个维度
&lt;/h1>&lt;h2 id="隔离性">隔离性
&lt;/h2>&lt;p>首先，空间的隔离至关重要，确保我在工作时不会打扰到正在房间休息的家人。另一边是活动频繁的大厅，孩子们在那里玩耍也不会影响到我在书房开会。这两点决定了书房的实用性。&lt;/p>
&lt;h2 id="基础保障">基础保障
&lt;/h2>&lt;h3 id="网络">网络
&lt;/h3>&lt;p>为了能够高效工作，书房需要配备一些必要的设施。&lt;br>
首先，网络必须稳定，这里已经布设有线网。&lt;br>
WiFi 信号也还不错，只隔了一面非承重墙，问题不大。&lt;/p>
&lt;h3 id="书桌">书桌
&lt;/h3>&lt;p>其次，书桌要选择质量好、稳固的，避免晃动影响工作。&lt;br>
第三，升降桌是必不可少的，可以让我在工作时坐站交替，减轻疲劳。&lt;/p>
&lt;h3 id="绿色">绿色
&lt;/h3>&lt;p>第四，绿色植物能够美化环境，让眼睛得到适当休息，心情愉悦。&lt;br>
可以选择一些不太香、花粉少的花卉，以及水培的大叶绿色植物。&lt;br>
阳台上也可以种植一些藤蔓植物，但要注意不要覆盖整个窗户，以免遮挡阳光。&lt;/p>
&lt;h3 id="窗帘">窗帘
&lt;/h3>&lt;p>最后，窗帘的选择也很重要，百叶帘和纱帘都是不错的选择，方便收放。关于百叶帘，之前并未对此进行充分考虑和预留。&lt;br>
纱帘具有一种朦胧的美感，虽然无法直接看到窗外，但营造出一种半封闭的空间感，在疲惫时可以拉起帘子，欣赏窗外的风景，交替变换心情。&lt;br>
如果阳台上的藤蔓植物能够延伸至此，例如百香果，开花时吸引蜜蜂和蝴蝶，这样的工作环境将非常理想。&lt;br>
这一设想并非不可实现，未来可以进一步研究。&lt;/p>
&lt;h3 id="照明">照明
&lt;/h3>&lt;p>灯光方面，房间中央有一个大灯，窗台上装有灯带，整体照明效果良好。不过，角落可能会稍显昏暗，这时就需要台灯来补充照明。&lt;br>
桌面上应放置一盏台灯，以提升工作舒适度。可以选择长条形台灯，将其置于屏幕上方或高于屏幕的位置，使光线自然向下照射，避免直射眼睛。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/5e86946b423eb26fb463d4439bd21851.webp"
width="675"
loading="lazy"
alt="3da5189ee9cbbd394d4f8643eb82bb0c_MD5|675"
>&lt;/p>
&lt;h2 id="氛围营造">氛围营造
&lt;/h2>&lt;p>书房的布置也需精心考虑。&lt;br>
书架上可以摆放一些&lt;strong>书籍&lt;/strong>，对面的柜子可以设置开放格，营造出一种文化氛围。&lt;br>
同时，配备一张小型&lt;strong>懒人沙发&lt;/strong>，工作疲惫时可以坐在上面阅读，放松身心。&lt;br>
屏幕尺寸和电脑性能同样重要。需要配备一台==性能优越的电脑==，可能需要动用家庭预算。&lt;br>
我个人偏好使用 Mac，因此 Windows 服务站可能不太适合。&lt;br>
&lt;strong>桌面上&lt;/strong>可以摆放一些有趣的挂件、摆件、奖杯、奖牌以及全家福照片，营造出积极的工作氛围，激发工作动力。&lt;br>
墙面无需张贴海报或激励标语，保持空白反而显得简洁大方。当然，也可以悬挂一些&lt;strong>风景图&lt;/strong>，工作疲惫时抬头欣赏，甚至可以定期更换。&lt;br>
桌面上可以放置一个&lt;strong>计时时钟&lt;/strong>，可以将家中的现有时钟搬来使用。这款设备具备时间管理功能，虽然目前尚未充分利用，但未来可以深入研究。&lt;br>
书桌上可以适当摆放一些&lt;strong>书籍&lt;/strong>，占据一小块区域，具体布局需根据屏幕摆放后的剩余空间来调整。完成这些布置后，书房的整体氛围将得到显著提升。&lt;br>
理想情况下，书桌上可以放置一个&lt;strong>小爱同学的小屏幕&lt;/strong>，这将极大提升使用体验。&lt;/p>
&lt;h2 id="升降桌">升降桌
&lt;/h2>&lt;p>关于升降桌的选择，可以考虑两种方案：&lt;/p>
&lt;ul>
&lt;li>一是使用升降台，但可能不够实用；&lt;/li>
&lt;li>二是选择整体可升降的桌子，最佳方案是两侧可独立升降。&lt;br>
因为与队友工作时，双方的站立和坐下节奏可能不同，独立控制的升降桌更为理想。不过，这需要在物品摆放时考虑两侧的平衡（不能架在中间），这也是需要仔细规划的一个方面。&lt;/li>
&lt;/ul>
&lt;h2 id="防打扰">防打扰
&lt;/h2>&lt;p>为了避免打扰，可以在门上安装人体感应器，当有人靠近时，桌面上会有相应的提示。或者，简单地放置一面镜子，也能观察到后方的情况。实际上，工作环境和家人之间并没有太多秘密，这个问题并不大。&lt;/p>
&lt;h2 id="其它事情">其它事情
&lt;/h2>&lt;ul>
&lt;li>关于饮用水，从书房到倒水台的距离并不远，整体上非常方便。&lt;/li>
&lt;li>全屋的花卉可以每周采购一次，保持新鲜。虽然目前工作量不大，但未来可能需要逐步培养更勤奋的习惯。不过，有时候环境会推动人主动完成事情，所以在这方面不必过于担心。&lt;/li>
&lt;/ul></description></item><item><title>香港麦理浩径</title><link>https://www.jsongo.top/articles/the-maclehose-trail/</link><pubDate>Sat, 11 Jan 2025 01:02:36 +0800</pubDate><guid>https://www.jsongo.top/articles/the-maclehose-trail/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/c1e2de3d85f49231f2290e3ec17b3940.jpg" alt="Featured image of post 香港麦理浩径" />&lt;p>麦理浩径（The MacLehose Trail），是中国香港西贡的一条著名徒步线路。也有叫麦林浩径。&lt;br>
&lt;img src="https://www.jsongo.top/c56c497a96261f32d1ec5b958dff6556.webp"
loading="lazy"
alt="|356x340"
>&lt;/p>
&lt;h1 id="概述">概述
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>基本概况&lt;/strong>：1979 年 10 月 26 日启用，全长 100 公里。以西贡北潭涌为起点，绕过万宜水库，由东向西横贯新界，以屯门为终点，共分为十段  12。&lt;/li>
&lt;li>&lt;strong>沿途景观&lt;/strong> ：
&lt;ul>
&lt;li>&lt;strong>自然风光&lt;/strong>：麦理浩径横跨香港 24 个郊野公园中的 8 个，沿途要翻越二十多座山头，如 420 米的牛耳石山、702 米的马鞍山、649 米的草山和 957 米的大帽山等。全程风景各异，不论山岭、岸边、丛林、溪涧，全都美丽得叫人叹为观止。其中，第二段的浪茄湾至北潭凹被誉为是体验香港海岸线之美的最佳路线，可欣赏到山海交融的壮丽景色；第八段则能挑战香港最高峰大帽山  124。&lt;/li>
&lt;li>&lt;strong>人文景观&lt;/strong>：途径赤径古村等具有历史文化价值的地方，能让人感受到原汁原味的香港文化 。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>难度分级&lt;/strong> ：
&lt;ul>
&lt;li>&lt;strong>第一段&lt;/strong>：北潭涌至浪茄，长度 10.6km，主要以柏油马路为主，难度 &lt;code>*&lt;/code>，全程无补给。&lt;/li>
&lt;li>&lt;strong>第二段&lt;/strong>：浪茄至北潭凹，长度 13.5km，难度 &lt;code>**&lt;/code>，在西湾可以买水、吃饭、露营  。&lt;/li>
&lt;li>&lt;strong>第三段&lt;/strong>：北潭凹至企岭下，长 10.2km，难度 &lt;code>***&lt;/code>，嶂上有士多和营地  。&lt;/li>
&lt;li>&lt;strong>第四段&lt;/strong>：企岭下至大老山，长 12.7km，难度 &lt;code>***&lt;/code>，全程无补给  。&lt;/li>
&lt;li>&lt;strong>第五段&lt;/strong>：大老山至大埔公路，长 10.6km，难度 &lt;code>**&lt;/code>，狮子亭有士多，可以买水  。&lt;/li>
&lt;li>&lt;strong>第六段&lt;/strong>：大埔公路至城门，长 4.6km，难度 &lt;code>*&lt;/code>，全程无补给  。&lt;/li>
&lt;li>&lt;strong>第七段&lt;/strong>：城门至铅矿坳，长 6.2km，难度 &lt;code>**&lt;/code>，全程无补给  。&lt;/li>
&lt;li>&lt;strong>第八段&lt;/strong>：铅矿坳至荃锦公路，长 9.7km，难度 &lt;code>**&lt;/code>，终点有士多可以补充食物和水  。&lt;/li>
&lt;li>&lt;strong>第九段&lt;/strong>：荃锦公路至田夫仔，长 6.3km，难度 &lt;code>*&lt;/code>，终点有田夫仔营地以及田夫仔士多，可以补充水以及吃饭  。&lt;/li>
&lt;li>&lt;strong>第十段&lt;/strong>：田夫仔至屯门，长 15.6km，难度 &lt;code>*&lt;/code>，田夫仔有两三处食店，可吃饭、补充水  。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="为啥有名">为啥有名
&lt;/h1>&lt;p>出名的原因主要有以下几点：&lt;/p>
&lt;h2 id="自然景观壮美">自然景观壮美
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>山海相连&lt;/strong>：麦理浩径横跨香港 24 个郊野公园中的 8 个，沿途要翻越二十多座山头，如 420 米的牛耳石山、702 米的马鞍山、649 米的草山和 957 米的大帽山等。全程风景各异，不论山岭、岸边、丛林、溪涧，全都美丽得叫人叹为观止。其中，第二段的浪茄湾至北潭凹被誉为是体验香港海岸线之美的最佳路线，可欣赏到山海交融的壮丽景色；第八段则能挑战香港最高峰大帽山。&lt;/li>
&lt;li>&lt;strong>生态多样&lt;/strong>：徒步旅行者能观察到各种动植物，这里是许多珍稀物种的栖息地，如香港瘰螈、卢文氏树蛙等。丰富多样的生态环境为徒步旅行增添了管理的复杂性与趣味性，也让徒步者能亲近自然、感受大自然的魅力 。&lt;/li>
&lt;/ul>
&lt;h2 id="徒步体验绝佳">徒步体验绝佳
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>难度分级合理&lt;/strong>：麦理浩径共分为十段，长度由 5 至 16 公里不等，大部分约长 10 公里，每段都有不同的难度和特点，能满足不同水平徒步者的需求。既有适合初学者的路段，也有对经验丰富的徒步者具有挑战性的路段，例如第一段北潭涌至浪茄，长度 10.6km，主要以柏油马路为主，难度较低；而第八段铅矿坳至荃锦公路，长 9.7km，需要攀登大帽山，难度较高 。&lt;/li>
&lt;li>&lt;strong>配套设施完善&lt;/strong>：每个段落都有设置营地和水源，这在长途徒步中至关重要，避免旅行者因缺水而中途放弃。同时，清晰的标识和健全的交通系统确保了即使是初次尝试者，也能顺畅地完成这次冒险。沿途每 500 米设有一个标志柱，全程共 200 个标志柱，上面清晰标注编号、点位等信息，方便山客拨打电话求助及时定位 。&lt;/li>
&lt;/ul>
&lt;h2 id="历史文化意义深厚">历史文化意义深厚
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>以港督命名&lt;/strong>：麦理浩径是以香港第 25 任港督麦理浩的名字命名，他在任期间推动了香港多项重要改革，包括《野郊公园条例》和麦理浩径的启用 。&lt;/li>
&lt;li>&lt;strong>见证香港发展&lt;/strong>：麦理浩径自 1979 年建成以来，改变了香港人探索大自然的方式，让更多人开始走进山野深处，也见证了香港在城市发展过程中对自然保护和户外运动的重视与发展 。&lt;/li>
&lt;/ul>
&lt;h2 id="赛事活动丰富">赛事活动丰富
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>乐施毅行者&lt;/strong>：1986 年，国际知名发展援助与人道救援机构香港乐施会应邀与驻港英军合办毅行者，并首次向公众开放。该比赛要求四人组队，在 48 小时内走完麦理浩径全程，且全队需完成一定额度的公益筹款。乐施毅行者迅速发展成为香港规模最大的远足筹款活动，吸引了大量香港市民和世界各地的参与者，也提升了麦理浩径的知名度 。&lt;/li>
&lt;li>&lt;strong>香港 100 越野赛&lt;/strong>：港百赛道大约有 71% 的线路与麦理浩径线路重合，是国际上最具影响力的赛事之一，吸引了整个东南亚地区选手、乃至众多国际精英在香港的越野赛道上竞技交流，进一步提升了麦理浩径在国际上的影响力 。&lt;/li>
&lt;/ul></description></item><item><title>《跑步治愈》提升跑步能力</title><link>https://www.jsongo.top/articles/run-faster/</link><pubDate>Fri, 10 Jan 2025 00:59:33 +0800</pubDate><guid>https://www.jsongo.top/articles/run-faster/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/578c0c31502d45694f84e64e5795be79.jpeg" alt="Featured image of post 《跑步治愈》提升跑步能力" />&lt;h1 id="跑力值">跑力值
&lt;/h1>&lt;p>跑力有一个衡量指标，叫做 BDOT。查了一下该表，我当前数值大概在 33 左右，表中最低值有不到 30 的，最高值是 50 甚至可能还有更高。&lt;br>
以 5km 为例，最高 56 的跑力值，只需 18 分钟就能跑完，而我大概需要 28 分钟，差距还是挺大的。从 2019 年记录到的 12 个项目男子世界纪录成绩来看，5km 的最佳成绩，也就是人类的最好成绩大概是 12 分 37 秒，平时可将其视为一个极限值，知道上限的可能性，能给自己一些前进的动力。&lt;/p>
&lt;h1 id="力量训练">力量训练
&lt;/h1>&lt;h2 id="5-类力量训练">5 类力量训练
&lt;/h2>&lt;p>力量训练可分为 5 大类，&lt;/p>
&lt;ul>
&lt;li>一是上肢推训练，比如俯卧撑、杠铃卧推等；&lt;/li>
&lt;li>二是上肢拉训练，主要有引体向上、划船器械训练等；&lt;/li>
&lt;li>三是下肢推动作，像简单的快速站立推动动作；&lt;/li>
&lt;li>四是核心训练，很多人跑步时上身晃动幅度大，主要原因是核心不稳，这会浪费很多能量。还有人走路时臀部左右扭动厉害，也是核心力量不足导致的。&lt;br>
另外，有一个常被误解的观点：&lt;strong>腹肌的锻炼效果主要取决于饮食，而非核心练习&lt;/strong>。&lt;br>
以前进行力量训练时，教练常说要做到力竭，因为力竭时对肌肉的刺激最大。不仅容易受伤，还易出现精神疲劳。精神疲劳通常表现为反应迟钝、容易误防、注意力不集中等。&lt;/li>
&lt;/ul>
&lt;h2 id="注意事项">注意事项
&lt;/h2>&lt;p>对于力量训练，其实有几个要点。&lt;/p>
&lt;ul>
&lt;li>首先，标准不宜过高，每次都要做到力竭，没太必要。这不仅容易受伤，效果也不佳。&lt;/li>
&lt;li>其次，如果想提升力量训练效果，将训练次数控制在最佳区间内，会更有效。&lt;/li>
&lt;li>最后，比做到最好更重要的是持续进步。不用苛刻地要求自己每次训练都要做到极致，只要比上一阶段有所进步就是成功，不必强迫自己。&lt;/li>
&lt;/ul>
&lt;h1 id="跑得更远">跑得更远
&lt;/h1>&lt;h2 id="更远---耐力跑">更远 - 耐力跑
&lt;/h2>&lt;p>关于如何跑得更远，这涉及到锻炼方法。比如，可以进行快速冲刺 4 分钟、行走 1 分钟的训练。再逐步拉长时间间隔，例如冲刺 7 分钟、行走 1 分钟。&lt;br>
耐力跑是一种节奏跑。为了提高耐力，需要提升运动强度，使人体达到更高的乳酸代谢阈值，同时提升身体清除乳酸的能力，达到生成和消耗的平衡。这样，在某个强度的配合下，我们就能坚持更久。&lt;/p>
&lt;h2 id="乳酸代谢">乳酸代谢
&lt;/h2>&lt;p>随着活动强度增大、跑步时间增长，乳酸会逐渐增加，心跳也会加速，这是正常现象。因为血液加速流动，会将乳酸代谢掉，并带到肝脏进行处理。人体代谢乳酸的速度提高后，运动能力也会增强。&lt;br>
不过，乳酸大量堆积会导致肌肉酸痛，从而影响正常运动。当我们进行节奏跑时，乳酸产生的速度大致等于排出的速度，此时跑步最为轻松。正常情况下，运动后 30 分钟到 1 小时，乳酸基本清理完了，而肌肉会有些酸痛，之后酸痛会逐渐消失，然后肌肉会更有力量。所以酸痛并不是因为乳酸堆积导致，而是肌肉使用过多，会慢慢恢复的。&lt;/p>
&lt;h2 id="怎么找到适合自己的节奏">怎么找到适合自己的节奏
&lt;/h2>&lt;p>可以先进行测试。你将 1.6 公里分成 4 段，一段比一段快，分别是全速状态下的 40%、50%、60%、70% 的速度跑，最后 100 米再冲刺全速 100%。&lt;br>
按这种方式测出用了多久，然后按书中的那些表来比对下，找到跑步的每个时段大概的配速。由于表格比较多，这里就不贴了，可以去原书查。&lt;/p></description></item><item><title>让 google 索引你的网站</title><link>https://www.jsongo.top/articles/add-google-index/</link><pubDate>Fri, 10 Jan 2025 00:35:01 +0800</pubDate><guid>https://www.jsongo.top/articles/add-google-index/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/614e6ce3faae3eecaea68591b783ca2e.jpeg" alt="Featured image of post 让 google 索引你的网站" />&lt;h1 id="验证提交">验证&amp;amp;提交
&lt;/h1>&lt;p>打开 &lt;a class="link" href="https://support.google.com/webmasters/answer/9012289?hl=zh-Hans" target="_blank" rel="noopener"
>网址检查工具 - Search Console 帮助&lt;/a> 站点，在上面点击验证，如果你的网站放在 cloudflare 等比较有名的服务商那，这个验证过程会非常简单，比如我就只需要跳转到 cloudflare 上再点一个按钮即可。它会给你添加一个 TXT 记录，之后就认证成功了：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/356a25a75d88549de43ada1856ef4da8.webp"
width="450"
loading="lazy"
alt="|450"
>&lt;br>
进入 &lt;a class="link" href="https://search.google.com/search-console" target="_blank" rel="noopener"
>Google Search Console&lt;/a> 后，可以看到你的网站还没被索引，需要等一天再来看下。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/b42233e8f3f1a1a50196872d8a1eae17.webp"
width="675"
loading="lazy"
alt="|675"
>&lt;br>
由于已经验证了这个网站就是你的，之后就可以在这个 Console 上看到每天的搜索数据。&lt;/p>
&lt;h1 id="sitemap">Sitemap
&lt;/h1>&lt;p>如果你的站点有 sitemap 也尽量提交下。我的站点是用 hugo 实现的，加了 sitemap 插件，所以可以直接提供给它地址。提交后，Google 就会定期地从你的 sitemap 上更新内容。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/e4f46f3ab1b40f3cd68608eceb859b66.webp"
width="775"
loading="lazy"
alt="|775"
>&lt;/p></description></item><item><title>Daily Meditations - W2 of 2025</title><link>https://www.jsongo.top/articles/meditations-w2-2025/</link><pubDate>Fri, 10 Jan 2025 00:24:52 +0800</pubDate><guid>https://www.jsongo.top/articles/meditations-w2-2025/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/2984e26d335bb7e9c65d0dee3e48d61f.jpg" alt="Featured image of post Daily Meditations - W2 of 2025" />&lt;h1 id="成长输出">成长&amp;amp;输出
&lt;/h1>&lt;h2 id="最大化每小时的收获">最大化每小时的收获
&lt;/h2>&lt;div class="admonition success">
&lt;div class="details-summary admonition-title">
&lt;i class='icon fas fa-pencil-alt fa-fw'>&lt;/i>
Important&lt;br
&lt;/div>&lt;/div>
&lt;div class="details-content">
&lt;div class="admonition-content">
&lt;p>成长的速度与清醒时每小时学到的东西密切正相关。因此，平时做事应秉持一种理念：尽可能让每一小时都有更大收获，通过主动积极的交流获取更多信息，或少刷快餐文章或视频，多阅读质量更多的书籍文字，等等。&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>&lt;p>当然，睡觉和休息的时候就没这种要求了，这里说的是清醒的状态下。该休息还是得好好休息。&lt;br>
也就是说，清醒的每一小时都应尽可能获取更多认知和能力，比如学到不同的知识、了解不同观点，或者接触一个全新领域。总之，要让自己的认知中充斥更多有价值的新信息。&lt;/p>
&lt;h2 id="尽可能多的输出">尽可能多的输出
&lt;/h2>&lt;p>罗胖说过，我们存在的价值就是给周边的网络输出秩序。&lt;br>
我很喜欢这个观点。整个世界一直在熵增，如果你能让世界减少熵增，那其实是有很大价值的，因为你在不断让世界变得更有秩序。人人都喜欢一个更整洁、美好的世界，而不是一乱糟。&lt;br>
我们平时都有各种想法，但很少付诸实践。有的想法很小，比如沉淀个什么思考，或者坚持整理一些个人经验或学习过程。当时看可能觉得没什么必要，看不到意义在哪，但其实可以尝试去做一下，慢慢的积累起来，或许某天就影响了这个领域的入门者，给他们带来不小的价值。多输出你的专业内容，不以事小而不为。&lt;/p>
&lt;h2 id="坚持有时看起来很简单但也很难">坚持有时看起来很简单，但也很难
&lt;/h2>&lt;p>很多时候，我们很难坚持做完一件事，尽管这件事可能并不难。比如持续听一门几千小时的课程，坚持每天听一些，从而完成整个体系的学习。完成单个任务并不难，一个小时一个小时地做就行。然而，录制这门课的人能够坚持做完并产出成果，可为什么只是去学习的我们，明明事情更简单，却没多少人能坚持下来呢？&lt;br>
罗胖做 60 秒语音、以及《文明》这个 1000 多期的节目，其实就是在输出秩序，把公元 1000 年之后的 1 千多年发生过的重要事件和历史感悟，帮所有人都免费整理出来了，谁都可以去学习。这是他对世界输出的一大作品，很多人线下自发的组织学习，形成好的共同学习的氛围，也是一种很有趣的社交活动，大家聚到一起关注和交流同一个话题。这是一种对社会的贡献。&lt;br>
大部分人都有自己擅长的领域，其实也可以把它们一点点的沉淀出来，形成一个系列，可能开始时看起来太简单，没什么意义，但坚持做，形成一套体系，它慢慢的影响力就会变大。&lt;/p></description></item><item><title>《跑步治愈》让我爱上跑步</title><link>https://www.jsongo.top/articles/start-running/</link><pubDate>Tue, 07 Jan 2025 10:49:18 +0800</pubDate><guid>https://www.jsongo.top/articles/start-running/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/4e076eb4ff636b6bf9f74fb25b6536ac.jpg" alt="Featured image of post 《跑步治愈》让我爱上跑步" />&lt;h1 id="概述">概述
&lt;/h1>&lt;h2 id="从盲目跑步到科学跑步的转变">从盲目跑步到科学跑步的转变
&lt;/h2>&lt;p>其实之前我或多或少都会去跑跑步，不过是断断续续的，大概几天跑一次。然而，跑到一定程度后，就很难再有大的突破了，一直也没怎么关注过数据，随性跑。我大概能跑个两三公里，跑得上气不接下气时，就走一会儿，然后接着再跑一段。顶多能跑到 5 公里，这对我来说已经算是极限了。这就是我之前的状态。&lt;br>
以前跑步时，我不太关注心率。后来，在一位朋友的带动下，我开始留意心率等数据，结果发现我的心率总是比他们高很多。比如，我跑个三四公里，心率就会飙升到 180 以上，而他们只有 150 多，差距十分明显。不过当时，我并没有太把这个数据当回事。后来才知道，180 已经非常极限了，这种状态跑不了太久，而且也是对身体有些伤害，健康的跑步应该是在比较舒适的区间，消耗身上的脂肪和多余的糖分，多进行有氧运动，这能给人带来非常多的好处。这些我以前都不太懂。&lt;br>
后来，另一位出差来的朋友带着我跑了 10 公里。这过程简直要了我的命，我中途停了好多次，还借口在路边喝水休息。跑到五六公里时，我就感觉快到极限了，后面那段路基本上是连走带跑，全靠他拉着我才坚持往前跑完，最累的时候，我都差点吐了出来。&lt;br>
这次经历让我意识到，跑步其实大有学问。每个人看似身体状况差不多，但真正跑起来，就能看出水平差异了。我以前也专门进行过肌肉锻炼，做过力量训练，可这对跑步并没有太大帮助。跑步并非肌肉越发达就跑得越远，而是需要科学训练。&lt;br>
后来，我看了《跑步治愈》这本书，学到了许多科学的理念和方法。按照这些指引，我开始越来越科学地跑步。到现在写这篇文章时，差不多看了快一周了。如今我能在跑完 5 公里后也不怎么喘气，&lt;strong>平均心率&lt;/strong>能控制在 130 - 150，根据身体疲劳程度有所波动。&lt;br>
从这本书上，我不仅学到了方法，还学到了一些跑步的哲学。跑步能让人越来越健康，其效果可能远超大家的认知。或许我们很多人都把这件事想得过于简单了，实际上，甚至很多疾病都能通过跑步逐步治愈，到了七老八十还能保持坚韧的体质。&lt;/p>
&lt;div class="admonition success">
&lt;div class="details-summary admonition-title">
&lt;i class='icon fas fa-pencil-alt fa-fw'>&lt;/i>
成长&lt;br
&lt;/div>&lt;/div>
&lt;div class="details-content">
&lt;div class="admonition-content">
&lt;p>新的一年，从跑步开始锻炼自己。朋友说，我得去挑战下半马，给自己一个目标，然后去努力追逐，享受这个过程。&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>&lt;h2 id="这本书">这本书
&lt;/h2>&lt;p>《跑步治愈》并不是说要治愈什么疾病，主要是在表达跑步是一种非常有利于健康的、成本较低的运动。但其实它不是一个简单的事，有很多学问，本书主要就是在讲如何科学地跑步。&lt;br>
作者是一个比较有名的教练，给徐小平、樊登、何帆、张静初，以及很多大企业的高管，还有很多很多身家巨富的人当教练，而且教过的人都能有巨变。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/52e699ce2ee57a4fb51c50c8d5e23d96.webp"
loading="lazy"
>&lt;/p>
&lt;h1 id="跑步是件有趣的事">跑步是件有趣的事
&lt;/h1>&lt;p>跑步其实是件很有趣的事，很多细节都会影响跑步的质量。有的人跑得轻松，有的人却跑得很累。&lt;br>
比如在推荐序里，何帆讲述他跑步时，若将步频提高到 180 次每分钟，就能很好地控制心率。刚开始他跑得很慢，后来慢慢突破了 5000 米。刚突破时，他感觉棒极了，还从中悟出了一些道理。&lt;/p>
&lt;ul>
&lt;li>很多做事的方法从一开始可能就是错的。有时一开始就要严格要求、刻苦训练，从而打下坚实的基础。其实这个观点未必正确。学任何东西，最佳的入门方式是从轻松开始，这比较符合人性，也更容易坚持下来，让自己有动力持续下去，甚至慢慢上瘾。&lt;/li>
&lt;li>很多时候我们跑步时，并非全身都累，也不是跑了很久才累，可能只是某个部位累。因为我学会了分离这种累的感觉，针对性地放松那个部位，这或许能让我坚持跑更久。&lt;/li>
&lt;li>这个道理延伸到生活中也适用。比如当生活一团乱麻，或者工作毫无头绪时，学会这种分离的技巧。 生活就变得更可掌控，很多问题可能就迎刃而解了。这其实在编程领域，也就是 IT 领域，是一种叫分治法的方法。它把问题分解成一个个小问题，然后逐个击破。&lt;br>
作者提到可以给自己立一些目标，比如跑马拉松。其实跑马拉松本身不是目的，而是拥有一个可以跑马拉松的身体和灵魂，给自己一个明确的目标，并为了这个目标开始锻炼。慢慢地，锻炼方式会从比较粗放变得更加科学。比如，逐渐地你就能学会更多关注数据，如跑了多久、跑了多远、用什么配速、心率控制在什么范围，是轻松跑还是耐力跑等等。&lt;/li>
&lt;/ul>
&lt;h1 id="跑步让人更健康">跑步让人更健康
&lt;/h1>&lt;h2 id="跑步提升心肺功能">跑步提升心肺功能
&lt;/h2>&lt;p>跑步是强健心肺最科学的运动。&lt;br>
跑步能有效提升心肺功能，还能增加大脑里的脑源性神经营养因子浓度，从而让人在认知测试中表现得更好。平时也能让人脑子特别灵活，甚至进入一种兴奋的状态。&lt;br>
经常进行跑步训练的人，在做其他事情时更容易进入心流状态，这是一种清晰的能力体现。&lt;/p>
&lt;h2 id="久坐是慢性杀手">久坐是慢性杀手
&lt;/h2>&lt;p>一开始，作者就提到&lt;strong>久坐是一个慢性杀手&lt;/strong>。坐久了就跑不动，久坐对心肺功能会造成很大伤害，导致心肌无法将富含氧气的血液输送给躯体，于是越跑越难受。而且，久坐还会带来其他各种各样的疾病。&lt;br>
对于上班族来说，这是个很严重的问题，但大部分人却没有太大的感觉。作者澄清了一个观点：很多人认为跑步伤膝盖，其实久坐才是伤害膝盖的“元凶”。如果采用科学的跑步方式，不仅不会伤害到膝盖，还能够锻炼其周边的肌肉，让肌肉更有力。作者还给出了相关数据支撑：久坐人群患关节炎的发病率比经常跑步的人高出 3 倍。&lt;/p>
&lt;h2 id="腰椎健康">腰椎健康
&lt;/h2>&lt;p>另外，腰椎在坐着的时候压力较大，尤其是搬运重物时。衡量现代人身体健康的五项要素呈金字塔状分布，其中排在第一位的是心肺功能，而非我们平时所认为的力量（力量其实排在第 5 位）。排在第二位的是身体成分，比如脂肪含量等；第三位是柔韧性，即关节的活动程度；第四位是肌肉力量；而心跳或心率是衡量个人健康程度的一个重要指标。&lt;/p>
&lt;h2 id="心率是健康的重要指标之一">心率是健康的重要指标之一
&lt;/h2>&lt;p>每分钟心跳 50 次的人，其心脏处于有力收缩的状态，是非常健康的。经常运动的人每分钟的心跳次数会比较低，作者举了一个例子：有一位马拉松运动员，他的心跳每分钟只有 21 次，是最健康的人之一。&lt;br>
运动还能让心情好转，改善精神匮乏的状态。作者认为另一个比较重要的指标是摄氧量，即运动过程中获得的最大氧气量。男士一般在 40 岁左右，心率在 120-136 次/分钟左右，所以心率在 50 次/分钟以上算是非常优秀的。&lt;br>
我平时的最大摄氧量一般在 40 左右，其实不同年龄段的人，其最大摄氧量会有所波动。作者还提供了一张表。&lt;/p>
&lt;h2 id="有氧无氧">有氧、无氧
&lt;/h2>&lt;p>如果目标是锻炼胸肌，我们就要选择有氧运动，这是最有效的方式。&lt;br>
如果要提高肌肉力量、保护关节，那就要进行无氧力量训练。&lt;br>
什么是有氧运动？就是持续 3 分钟以上，全身多个关节和大肌肉群参与的运动。&lt;br>
当运动强度增大，所需能量超出有氧代谢系统供给能力时，无氧代谢系统就会启动。实际上，这两个系统很少独立运作，多数时候相互叠加，有时有氧代谢占主导，有时则是无氧代谢占优。有氧代谢主要消耗碳水化合物与脂肪，无氧代谢主要消耗糖分。此外，无氧状态下，代谢废物更多，乳酸易堆积，从而导致疲劳；有氧状态下，代谢废物较少，通常能直接被血液带走。&lt;/p>
&lt;h2 id="运动强度">运动强度
&lt;/h2>&lt;p>至于运动强度高低，有个简单判断方法：中等强度运动时，会有点气喘，但还能与人交流；高强度运动时，就气喘吁吁，基本难以交谈。在有氧运动里，跑步最适合普通人。有不少例子，一些人刚开始只能跑几百米，跑起来都费劲，后来经指导，慢慢能跑几公里，甚至去跑马拉松。忙碌的人也倾向于通过跑步增强体能。借助运动手环等设备监测心率等数据，能更科学地安排训练过程与计划。&lt;/p>
&lt;h1 id="跑步让头脑更活跃">跑步让头脑更活跃
&lt;/h1>&lt;p>跑步能让大脑更活跃、反应更灵敏，不过这是在中等强度以下跑步时才有的效果，一直高强度跑，跑完会很累。作者提到“轻松跑”概念，这种状态下主要是有氧运动，能消耗身体脂肪，让身材变好。&lt;br>
跑步还能激活大脑，使人心情愉悦，抵抗抑郁、缓解压力。书中提到了一个万科高管，长期处于高压工作状态，出现严重情绪问题，后来通过跑步缓解了心情，在他的指导下，每天跑 10 公里，跑完心情舒畅，能更高效地享受生活。&lt;/p></description></item><item><title>聊聊我的笔记软件使用历程</title><link>https://www.jsongo.top/articles/note-using-experience/</link><pubDate>Tue, 07 Jan 2025 01:18:06 +0800</pubDate><guid>https://www.jsongo.top/articles/note-using-experience/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/ea9086434bf26f0e29a7f53c30916e06.jpg" alt="Featured image of post 聊聊我的笔记软件使用历程" />&lt;h1 id="现状概述">现状概述
&lt;/h1>&lt;p>我现在大部分笔记都是用 Obsidian 写，免费、安全、自由定制。甚至你看到的这些博客，我也都是用它写的，然后加上一些简单的设置就把内容同步到博客上了。Banner 等都是自动生成的，笔记的排版和格式，它都（通过插件）提到了非常强大的支持。&lt;/p>
&lt;h1 id="历程">历程
&lt;/h1>&lt;p>我研究了大量笔记，许多听过的都尝试过。实际上，大多数笔记功能相近，互相抄来抄去，很多都是类似 Notion 的交互。区别仅在于谁家的软件做得更出色、更流畅，或者 Bug 更少，更便宜。&lt;br>
我最初长时间使用印象笔记，但它实在令人难以忍受，Bug 超多，还不认真修复问题。每次都推出一堆新功能，接着诱导用户升级会员，充了钱还得再充，实在让人受不了，亏我还充了 10 年的会员，都不知道它能不能再活这么久。&lt;br>
后来我试用了很多其他笔记软件，大部分都要收费，而且功能扩展性差，提供什么功能就只能用什么。刚开始还觉得一些功能新鲜，用多了、用久了，一对比就发现并不那么理想，很多宣传都夸大其词。&lt;br>
用着用着，我又开始担忧笔记内容的安全性。曾听闻一款笔记软件，小道消息称其创始人会随意查看用户笔记，这触及了底线，无法接受。由此我开始关注数据安全，想起以前用过一款软件，名字记不清了，编辑格式是 markdown，数据存在本地，相对安全。以前用这个软件时是通过一些同步软件来同步笔记，但在手机上就无法使用了。&lt;br>
两年前，一个大佬给我介绍了一款叫 Obsidian 的软件。当时下载试用了一下，感觉…… 有点简洁，很多功能都没有。没太玩明白。最近又读了些介绍这款软件的文章，所以心生好奇，便再次研究起来。那段时间，每晚我都沉浸在探索这款软件中，着实投入了不少时间。然而，随着深入使用，我越发惊叹于它强大的功能，许多设计都精准地契合了我对笔记软件的定义与功能需求。&lt;br>
此后，我对它的使用愈发频繁。因为它几乎能满足我所有需求，即便有些功能缺失，众多插件也能予以补充，甚至我还能自行定制。后来，我惊喜地发现它还能与博客联动，将笔记转化为博客文章发出去，过程还十分简单。当然这些都得花时间折腾。&lt;br>
有一天，我赫然发现自己在这款笔记软件上安装的插件竟多达 60 个。这数量着实不少，充分彰显了该笔记软件强大的扩展性，而且多数插件都十分实用，不好用的早已被我卸载。&lt;br>
我留意到许多文章在介绍这款笔记软件时，都提到深入去使用时会很复杂，得花时间研究。不少人在使用过程中选择放弃，毕竟想要深入挖掘其功能，需要投入大量时间钻研，而大多数人都倾向于拿来即用，不愿花费过多精力折腾。而我就是这种喜欢折腾的人。&lt;br>
我是在试用了众多笔记软件，却始终未能找到心仪之选后，才邂逅了它。我已经投入了大量时间在各种笔记上了，再投入一个月研究都是值得的。之后我逐步将过往的日记迁移至此，我写了 3 年多的日记全都一点点迁过来了（每天迁一点点）。虽说不是所有的笔记都进行转移，但这些年撰写的日记也基本收集齐全了。&lt;br>
我之所以如此信赖它，是因为经过一段时间的使用，我切实感受到它既安全又功能强大。 而且扩展性非常强，还能自行定义，这十分符合我作为一个开发者的思维。&lt;br>
这款笔记软件本身自带的功能本身就颇为丰富，比如有分层式的标签体系，具备目录管理能力。还有它的卖点之一，双向链接和网状关联，该功能可以将各种笔记链接成网，做了个交互和动画效果，能把各种笔记的关系梳理得起来。但我不太喜欢用这个功能，一直觉得它有点鸡肋。我之前看过一篇文章，提到这个功能其实没多少人能真正用的起来。&lt;br>
我现在主要用的是它的标签体系，其分层逻辑我很习惯，因为之前一直在用 flomo，标签体系几乎一样，所以对我来说只是习惯的平移。另外，这个笔记软件还能与我之前研究过的 cloudflare 上的 CDN 联系起来，图片、视频等都可以传上去。&lt;br>
其实，我对于笔记软件的使用并非局限于某一款。比如说，除了 Obsidian、flomo，我最常用的还有幕布。它们的用途各不相同，但我用得最多的还是 Obsidian。甚至我工作时很多时候也会用它来规划当天的日程，因为它有一些插件能让日常管理变得较为简单。当然，我主要的日常管理软件还是滴答清单。&lt;/p></description></item><item><title>用 kotlin 实现 JWT 认证</title><link>https://www.jsongo.top/articles/kotlin-jwt/</link><pubDate>Mon, 06 Jan 2025 22:21:06 +0800</pubDate><guid>https://www.jsongo.top/articles/kotlin-jwt/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/3f4ffe39bbfde173de3bf6ee638fda5b.jpg" alt="Featured image of post 用 kotlin 实现 JWT 认证" />&lt;h1 id="概述">概述
&lt;/h1>&lt;h2 id="环境">环境
&lt;/h2>&lt;p>Android 环境上，内置（或拉取）私钥证书后，&lt;strong>向服务端请求交换 JWT token，获取 OAuth token&lt;/strong>。&lt;/p>
&lt;h2 id="场景">场景
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>企业内部应用集成&lt;/strong>：在企业级的 Android 应用中，当应用需要与企业内部的多个服务（如企业资源规划系统 ERP、客户关系管理系统 CRM 等）进行深度集成时，可能会内置私钥证书。这些服务通常都有严格的身份验证要求，应用需要通过私钥证书向认证服务器请求交换 JWT（JSON Web Token）令牌，进而获取 OAuth（Open Authorization）令牌来访问受保护的资源。例如，企业内部的移动办公应用，员工需要使用该应用访问企业内部的文档管理系统和工作流系统，应用就会通过这种方式获取访问权限。&lt;/li>
&lt;li>&lt;strong>金融服务应用&lt;/strong>：在银行或者金融机构的移动应用中，为了确保用户资金交易等敏感操作的安全性，应用可能会预先安装经过严格安全认证的私钥证书。在用户登录或者进行特定高风险操作（如转账、理财购买等）时，应用通过内置的私钥证书向服务端请求交换 JWT 令牌，然后获取 OAuth 令牌，以此来验证用户身份并且授权后续的操作。这种方式可以确保只有合法的、经过认证的应用才能与服务端进行安全的交互。&lt;/li>
&lt;/ul>
&lt;h1 id="代码实现">代码实现
&lt;/h1>&lt;h2 id="实现核心逻辑-getjwttoken">实现核心逻辑 getJWTToken
&lt;/h2>&lt;p>这里拿 &lt;a class="link" href="https://www.coze.com/docs/developer_guides/oauth_jwt" target="_blank" rel="noopener"
>Coze 的 JWT 接口&lt;/a> 来写例子，这个意义可能不大（Coze 的 JWT 私钥不太建议放到 App 中），主要是为了演示接口的调用，让代码可以跑通。&lt;br>
下面是完整代码（可以直接 copy 运行）。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.datetime.Clock&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.statement.bodyAsText&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.http.HttpMethod&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.json.Json&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.json.JsonObject&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.json.buildJsonObject&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.json.put&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.serializer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">com.auth0.jwt.JWT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">com.auth0.jwt.algorithms.Algorithm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.SerialName&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.Serializable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">java.security.KeyFactory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">java.security.interfaces.RSAPrivateKey&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">java.security.spec.PKCS8EncodedKeySpec&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">java.util.Base64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">object&lt;/span> &lt;span class="nc">JWTService&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">suspend&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">getJWTToken&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">JWTTokenConfig&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">JWTToken&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Trim private key and validate format
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">trimmedPrivateKey&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">privateKey&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">trim&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">keyFormat&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">when&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trimmedPrivateKey&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;BEGIN RSA PRIVATE KEY&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="s2">&amp;#34;RSA&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">trimmedPrivateKey&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;BEGIN PRIVATE KEY&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="s2">&amp;#34;PKCS8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">keyFormat&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">Exception&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;Invalid private key format. Expected PEM format (RSA or PKCS8)&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 准备JWT payload
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">now&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">Clock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">epochSeconds&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">jwtPayload&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">buildJsonObject&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;iss&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">appId&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;aud&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">aud&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;iat&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">now&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;exp&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="m">3600&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// 1小时
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;jti&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">now&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">16&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sessionName&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;session_name&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sessionName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 将JsonObject转换为Map
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">jwtPayloadMap&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">jwtPayload&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toMap&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 使用JWT provider签名获取token
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">token&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">sign&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">payload&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">jwtPayloadMap&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">privateKey&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">trimmedPrivateKey&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">algorithm&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">algorithm&lt;/span> &lt;span class="o">?:&lt;/span> &lt;span class="s2">&amp;#34;RS256&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">keyid&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">keyId&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 交换JWT token获取OAuth token
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">tokenConfig&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">buildMap&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;token&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">token&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">baseURL&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">let&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;baseURL&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">it&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;durationSeconds&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">durationSeconds&lt;/span> &lt;span class="o">?:&lt;/span> &lt;span class="m">900&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">scope&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">let&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;scope&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">it&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">doGetJWTToken&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tokenConfig&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">suspend&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">doGetJWTToken&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">config&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">&amp;gt;,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">JWTToken&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">api&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">APIClient&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">token&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;token&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">baseURL&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;baseURL&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">as&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">payload&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">buildJsonObject&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;grant_type&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;urn:ietf:params:oauth:grant-type:jwt-bearer&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;duration_seconds&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;durationSeconds&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">as&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="n">Int&lt;/span> &lt;span class="o">?:&lt;/span> &lt;span class="m">900&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">toInt&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;scope&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;scope&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;scope&amp;#34;&lt;/span>&lt;span class="p">].&lt;/span>&lt;span class="n">toString&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">jsonPayload&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">Json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">encodeToString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">JsonObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">serializer&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">payload&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">api&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">HttpMethod&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Post&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;/api/permission/oauth2/token&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">config&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;token&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">payload&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nc">Json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">decodeFromString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">serializer&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">JWTToken&lt;/span>&lt;span class="p">&amp;gt;(),&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">bodyAsText&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 对 json 里的内容做下处理，方便未来扩展
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">private&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">JsonObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toMap&lt;/span>&lt;span class="p">():&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">entries&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">associate&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">element&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">key&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="k">when&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">element&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">is&lt;/span> &lt;span class="n">kotlinx&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">serialization&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">JsonPrimitive&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">when&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">isString&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">content&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toLongOrNull&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="k">null&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toLong&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toDoubleOrNull&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="k">null&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toDouble&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">content&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;true&amp;#34;&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="k">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">content&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s2">&amp;#34;false&amp;#34;&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="k">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">content&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">element&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">toString&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">sign&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">payload&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Map&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">&amp;gt;,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">privateKey&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">algorithm&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">keyid&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">cleanKey&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">privateKey&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;-----BEGIN PRIVATE KEY-----&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;-----END PRIVATE KEY-----&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;-----BEGIN RSA PRIVATE KEY-----&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;-----END RSA PRIVATE KEY-----&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">replace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">trim&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;JWT sign - 私钥清理完成&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">keyBytes&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Base64&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getDecoder&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">decode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">cleanKey&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">// requires API level 26
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;JWT sign - 私钥解码完成，&lt;/span>&lt;span class="si">${keyBytes}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">keySpec&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">PKCS8EncodedKeySpec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">keyBytes&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">keyFactory&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">KeyFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getInstance&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;RSA&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">privateKeyObj&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">keyFactory&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">generatePrivate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">keySpec&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">RSAPrivateKey&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">alg&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">Algorithm&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">RSA256&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">privateKeyObj&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;JWT sign - 私钥引用创建完成，&lt;/span>&lt;span class="si">${alg}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nc">JWT&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">create&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">withKeyId&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">keyid&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">apply&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">payload&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">forEach&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">when&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">is&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">withClaim&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">is&lt;/span> &lt;span class="n">Int&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">withClaim&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">is&lt;/span> &lt;span class="n">Long&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">withClaim&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">is&lt;/span> &lt;span class="n">Double&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">withClaim&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">is&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">withClaim&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">sign&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">alg&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Serializable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">data&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">JWTToken&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@SerialName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;access_token&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">accessToken&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@SerialName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;token_type&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">tokenType&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nd">@SerialName&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;expires_in&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">expiresIn&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Long&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Serializable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">data&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">JWTTokenConfig&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">appId&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">privateKey&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">aud&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;api.coze.com&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="c1">// 这里可以换成自己的 AUD
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">algorithm&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;RS256&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">keyId&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">sessionName&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">baseURL&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">durationSeconds&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Int&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">900&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">scope&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="tokenmanager-让-token-能复用">TokenManager 让 Token 能复用
&lt;/h2>&lt;p>另外还可以再实现一个 TokenManager 来做一个单例，管理最终 Token 的获取。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.datetime.Clock&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">object&lt;/span> &lt;span class="nc">TokenManager&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">var&lt;/span> &lt;span class="py">_token&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">var&lt;/span> &lt;span class="py">tokenExpireTime&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Long&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">suspend&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">getTokenAsync&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">forceRefresh&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Boolean&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">false&lt;/span>&lt;span class="p">):&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">now&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">Clock&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">System&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">now&lt;/span>&lt;span class="p">().&lt;/span>&lt;span class="n">epochSeconds&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 如果token不存在或已过期（提前30秒认为过期），重新获取
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">_token&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="k">null&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">tokenExpireTime&lt;/span> &lt;span class="p">-&lt;/span> &lt;span class="m">30&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">forceRefresh&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="err">(&lt;/span>&lt;span class="py">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">expireIn&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">generateToken&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">_token&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">token&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 根据返回的过期时间设置
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">tokenExpireTime&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">now&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="n">expireIn&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">_token&lt;/span> &lt;span class="o">?:&lt;/span> &lt;span class="k">throw&lt;/span> &lt;span class="n">IllegalStateException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Token not available&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">suspend&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">generateToken&lt;/span>&lt;span class="p">():&lt;/span> &lt;span class="n">Pair&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">Long&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">config&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">JWTTokenConfig&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">appId&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">GetApiConfig&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">APP_ID&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">aud&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">GetApiConfig&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">AUD&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">keyId&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">GetApiConfig&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">KEY_ID&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">privateKey&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">GetApiConfig&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">PRIVATE_KEY&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">trimIndent&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">joinToString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">.&lt;/span>&lt;span class="n">trim&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">jwtRsp&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">JWTService&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">getJWTToken&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">config&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">token&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">jwtRsp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">accessToken&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">isEmpty&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">IllegalStateException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Received empty access token from server&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 返回token和过期时间
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">Pair&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">token&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">jwtRsp&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">expiresIn&lt;/span> &lt;span class="o">?:&lt;/span> &lt;span class="m">900L&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Exception&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Token generation failed: &lt;/span>&lt;span class="si">${e.message}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">IllegalStateException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Failed to generate token: &lt;/span>&lt;span class="si">${e.message}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">object&lt;/span> &lt;span class="nc">GetApiConfig&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">APP&lt;/span>&lt;span class="n">_ID&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;xxx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">AUD&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;api.coze.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">KEY&lt;/span>&lt;span class="n">_ID&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;xxx&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">const&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">PRIVATE&lt;/span>&lt;span class="n">_KEY&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">-----BEGIN PRIVATE KEY-----
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">xxx
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">-----END PRIVATE KEY-----
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="安全">安全
&lt;/h1>&lt;h2 id="安全问题分析">安全问题分析
&lt;/h2>&lt;p>把私钥内置到 App 中是有一些安全问题的，这里做些分析。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>私钥证书存储安全风险&lt;/strong>：如果 Android 设备被恶意攻击者获取了 root 权限，或者应用本身存在安全漏洞（如代码注入、反编译漏洞等），存储在设备上的私钥证书可能会被窃取。一旦私钥证书泄露，攻击者就有可能伪装成合法的应用向服务端请求令牌，从而获取未经授权的访问权限。&lt;/li>
&lt;li>&lt;strong>传输过程安全风险&lt;/strong>：在向服务端请求交换令牌的过程中，如果通信没有采用足够的加密措施（如 TLS/SSL 协议未正确配置或者被中间人攻击绕过），那么私钥证书和令牌相关的信息可能会在传输过程中被窃取。例如，攻击者通过在公共 WiFi 环境中进行中间人攻击，拦截并篡改请求和响应信息。&lt;/li>
&lt;li>&lt;strong>JWT 和 OAuth 令牌滥用风险&lt;/strong>：即使令牌的获取过程是安全的，但是如果令牌的有效期过长或者没有正确的权限管理机制，被窃取的令牌可能会被滥用。例如，JWT 令牌没有设置合适的过期时间，或者 OAuth 令牌的权限范围没有得到精细的控制，攻击者获取令牌后可能会在有效期内持续访问受保护的资源。&lt;/li>
&lt;/ul>
&lt;h2 id="安全建议">安全建议
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>安全存储私钥证书&lt;/strong>：使用 Android 系统提供的安全存储机制，如 KeyStore 系统。它可以将私钥证书存储在一个受硬件保护的区域（如果设备支持），并且通过密码学手段对访问进行限制。同时，对应用进行加固，防止反编译和代码注入等攻击方式。&lt;/li>
&lt;li>&lt;strong>确保传输安全&lt;/strong>：在与服务端的通信过程中，强制使用 TLS/SSL 协议，并进行严格的证书验证。可以采用双向认证的方式，即服务端和客户端（Android 应用）互相验证对方的证书，确保通信双方的身份真实可靠。&lt;/li>
&lt;li>&lt;strong>令牌管理优化&lt;/strong>：合理设置 JWT 和 OAuth 令牌的有效期，对于高风险操作可以采用短有效期的令牌，并要求用户频繁重新认证。同时，对 OAuth 令牌的权限进行精细的划分，确保每个令牌只能访问其授权范围内的资源。例如，对于只需要读取用户基本信息的操作和需要修改用户密码的操作，分别使用不同权限范围的令牌。&lt;/li>
&lt;/ul></description></item><item><title>Azure Functions 的5种托管方式</title><link>https://www.jsongo.top/articles/azure-functions-hostings/</link><pubDate>Sun, 05 Jan 2025 20:51:24 +0800</pubDate><guid>https://www.jsongo.top/articles/azure-functions-hostings/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/5d75a43553c8d4b677794dc7b70c2f7e.jpg" alt="Featured image of post Azure Functions 的5种托管方式" />&lt;p>Azure 的 Functions 是一种 Serverless 基建，不过它提供了多种用法，计费方式和适用的场景也不太一样。&lt;br>
下文对 Flex Consumption plan、Premium plan、Dedicated plan、Container Apps 和 Consumption plan 这 5 种方式进行下对比。&lt;/p>
&lt;h1 id="直观表格对比">直观表格对比
&lt;/h1>&lt;table>
&lt;thead>
&lt;tr>
&lt;th>托管方式&lt;/th>
&lt;th>缩放方式&lt;/th>
&lt;th>容器支持&lt;/th>
&lt;th>执行超时&lt;/th>
&lt;th>实例数量限制&lt;/th>
&lt;th>适用场景&lt;/th>
&lt;th>计费方式&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Flex Consumption plan&lt;/td>
&lt;td>基于每函数事件驱动缩放，部分触发器类型分组共享实例缩放&lt;/td>
&lt;td>无&lt;/td>
&lt;td>默认 30 分钟，最大无限制&lt;/td>
&lt;td>受区域总内存使用限制，每函数应用实例数受内存限制&lt;/td>
&lt;td>需快速水平缩放、有虚拟网络需求、按使用量付费且希望减少冷启动&lt;/td>
&lt;td>基于函数执行次数、执行时实例内存及预配置实例成本&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Premium plan&lt;/td>
&lt;td>基于事件驱动自动缩放，有预热工作进程&lt;/td>
&lt;td>Linux&lt;/td>
&lt;td>默认 30 分钟，最大无限制&lt;/td>
&lt;td>Windows 最多 100 个，Linux 部分地区可达 20 - 100 个&lt;/td>
&lt;td>函数应用持续或近乎持续运行、需更多实例控制、有事件驱动缩放需求、执行次数多但消费计划费用高、代码执行时间长、需虚拟网络连接或自定义 Linux 镜像&lt;/td>
&lt;td>基于所需和预热实例的核心秒数及内存使用&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Dedicated plan&lt;/td>
&lt;td>支持手动或自动缩放&lt;/td>
&lt;td>Linux&lt;/td>
&lt;td>默认 30 分钟，最大无限制&lt;/td>
&lt;td>一般 10 - 30 个，ASE 中可达 100 个&lt;/td>
&lt;td>有现有未充分利用虚拟机、需要完全可预测计费、在同一计划运行多个 Web 和函数应用、需要大计算规模或 ASE 提供的安全网络访问的长运行场景&lt;/td>
&lt;td>按 App Service 计划常规费率计费，ASE 有固定月费和按 vCPU 计费&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Container Apps&lt;/td>
&lt;td>根据应用负载自动调整资源分配&lt;/td>
&lt;td>Linux&lt;/td>
&lt;td>依具体配置和底层资源决定&lt;/td>
&lt;td>根据自动缩放机制调整&lt;/td>
&lt;td>适合快速部署和运行容器化应用，特别是微服务架构应用，适合容器应用迁移到云端&lt;/td>
&lt;td>基于容器实例数量、运行时间、所占用资源（如 CPU、内存等）&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Consumption plan&lt;/td>
&lt;td>基于事件驱动自动缩放，依传入触发事件数量增减主机实例&lt;/td>
&lt;td>无&lt;/td>
&lt;td>默认 5 分钟，最大 10 分钟&lt;/td>
&lt;td>Windows 最多 200 个，Linux 最多 100 个，每小时 500 个实例缩放限制&lt;/td>
&lt;td>适合函数运行时付费、希望自动缩放且无复杂配置需求&lt;/td>
&lt;td>函数运行时按执行次数、执行时间和内存使用计费&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h1 id="展开介绍">展开介绍
&lt;/h1>&lt;p>更全面的总结对比下。&lt;/p>
&lt;ol>
&lt;li>&lt;strong>Flex Consumption plan&lt;/strong> - 弹性消耗
&lt;ul>
&lt;li>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/flex-consumption-plan" target="_blank" rel="noopener"
>Azure Functions Flex Consumption plan hosting | Microsoft Learn&lt;/a>&lt;/li>
&lt;li>&lt;strong>缩放方式&lt;/strong>：基于每函数的事件驱动缩放，除特定触发器外，不同函数触发器类型可在独立实例上缩放，如 HTTP、Blob 存储（Event Grid）、Durable Functions 分别成组共享实例缩放，提供更确定的缩放方式。&lt;/li>
&lt;li>&lt;strong>资源与限制&lt;/strong>：无容器支持；支持指定预配置实例减少冷启动；支持虚拟网络；函数执行超时默认 30 分钟，最大无限制；每实例内存等资源限制因配置而异，受区域总内存使用限制；每函数应用实例数受内存限制。&lt;/li>
&lt;li>&lt;strong>适用场景与计费&lt;/strong>：适合需要快速水平缩放、有虚拟网络需求、按使用量付费且希望减少冷启动的场景；计费基于函数执行次数、执行时实例内存及预配置实例成本。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Premium plan&lt;/strong> - 函数高级计划
&lt;ul>
&lt;li>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-premium-plan?tabs=portal" target="_blank" rel="noopener"
>Azure Functions Premium plan | Microsoft Learn&lt;/a>&lt;/li>
&lt;li>&lt;strong>缩放方式&lt;/strong>：基于事件驱动自动缩放，使用预热工作进程，根据函数触发事件数量增加主机实例，在空闲后能无延迟运行应用。&lt;/li>
&lt;li>&lt;strong>资源与限制&lt;/strong>：支持 Linux 容器；运行在更强大实例上；函数执行超时默认 30 分钟，最大无限制；Windows 最多 100 个实例，Linux 部分地区可达 20 - 100 个实例；提供更多 CPU 和内存选项。&lt;/li>
&lt;li>&lt;strong>适用场景与计费&lt;/strong>：适用于函数应用持续或近乎持续运行、需要更多实例控制、在同一计划部署多个应用且有事件驱动缩放需求、执行次数多但消费计划费用高、代码执行时间长、需虚拟网络连接或自定义 Linux 镜像的场景；计费基于所需和预热实例的核心秒数及内存使用。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Dedicated plan&lt;/strong> - 应用服务
&lt;ul>
&lt;li>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/dedicated-plan" target="_blank" rel="noopener"
>Azure Functions Dedicated hosting | Microsoft Learn&lt;/a>&lt;/li>
&lt;li>&lt;strong>缩放方式&lt;/strong>：支持手动或自动缩放。&lt;/li>
&lt;li>&lt;strong>资源与限制&lt;/strong>：支持 Linux 容器；可在 App Service 计划内以常规费率运行函数；提供完全可预测计费和手动缩放；能访问更大计算规模选项；在 App Service Environment（ASE）中提供完全计算隔离和安全网络访问；内存使用和扩展能力高；函数执行超时默认 30 分钟，最大无限制；实例数一般 10 - 30 个，ASE 中可达 100 个。&lt;/li>
&lt;li>&lt;strong>适用场景与计费&lt;/strong>：适合有现有未充分利用虚拟机、需要完全可预测计费、在同一计划运行多个 Web 和函数应用、需要大计算规模或 ASE 提供的安全网络访问的长运行场景；按 App Service 计划常规费率计费，ASE 有固定月费和按 vCPU 计费。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Container Apps&lt;/strong> - 容器应用环境
&lt;ul>
&lt;li>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-container-apps-hosting" target="_blank" rel="noopener"
>Azure Container Apps hosting of Azure Functions | Microsoft Learn&lt;/a>&lt;/li>
&lt;li>&lt;strong>缩放方式&lt;/strong>：具有自动缩放功能，能够根据应用程序的负载自动调整资源分配，可依据传入请求数量或工作负载增减容器实例数量。&lt;/li>
&lt;li>&lt;strong>资源与限制&lt;/strong>：支持 Linux 容器，运行环境可靠，资源限制依配置和定价层而定。&lt;/li>
&lt;li>&lt;strong>适用场景与计费&lt;/strong>：适合快速部署和运行容器化应用，特别是微服务架构应用，计费基于容器实例数量、运行时间和占用资源等使用情况。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>Consumption plan&lt;/strong> - (按) 消耗
&lt;ul>
&lt;li>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/consumption-plan" target="_blank" rel="noopener"
>Azure Functions Consumption plan hosting | Microsoft Learn&lt;/a>&lt;/li>
&lt;li>&lt;strong>缩放方式&lt;/strong>：基于事件驱动自动缩放，根据传入触发事件数量添加或删除函数主机实例。&lt;/li>
&lt;li>&lt;strong>资源与限制&lt;/strong>：无容器支持；是默认的无服务器托管计划；函数执行超时默认 5 分钟，最大 10 分钟；每实例内存等资源有限；Windows 最多 200 个实例，Linux 最多 100 个实例；有每小时 500 个实例的缩放限制。&lt;/li>
&lt;li>&lt;strong>适用场景与计费&lt;/strong>：适合函数运行时付费、希望自动缩放且无复杂配置需求的场景；仅在函数运行时按执行次数、执行时间和内存使用计费。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h1 id="价格">价格
&lt;/h1>&lt;p>5 种函数托管方式在价格上的差别不小。&lt;/p>
&lt;h2 id="flex-consumption-plan">Flex Consumption Plan
&lt;/h2>&lt;p>它是基于每函数事件驱动缩放的，有些触发器类型还分组共享实例缩放。&lt;br>
计费就看函数执行次数、执行时实例内存，还有预配置实例的成本。要是你配置的预配置实例少，低流量的时候费用就低；可要是高流量，需要大量实例了，那随着实例增多，费用自然也跟着涨，具体花多少钱，得看实际用了多少实例、多少内存，还有执行次数这些情况。&lt;br>
不支持自定义容器。&lt;/p>
&lt;h2 id="premium-plan">Premium Plan
&lt;/h2>&lt;p>它是基于事件驱动自动缩放，还有预热工作进程。计费是根据所需和预热实例的核心秒数以及内存使用情况来的。这个计划&lt;strong>适合函数应用持续或者近乎持续运行、执行次数又多的情况&lt;/strong>。虽说基础费用比 Consumption plan 高些，但要是你的应用使用率高，或者有一些特殊需求，用它反而能把总体成本控制得更好，需要自己做好提前的计划。&lt;br>
支持自定义容器。&lt;/p>
&lt;h2 id="dedicated-plan">Dedicated Plan
&lt;/h2>&lt;p>它支持手动或自动缩放，计费是按 App Service 计划常规费率来的，要是在 App Service Environment（ASE）里，还有固定月费和按 vCPU 计费。&lt;strong>要是你手头有现有没充分利用的虚拟机&lt;/strong>，或者需要完全可预测的计费，又或者想在同一个计划里运行多个 Web 和函数应用，选它就挺合适。不过要注意，它前期投入成本相对高些。&lt;/p>
&lt;h2 id="container-apps">Container Apps
&lt;/h2>&lt;p>它是根据容器实例数量、运行时间，还有占用的资源，像 CPU、内存这些来计费的。比如说，你运行一个小型 Linux 容器实例，配置 1 vCPU 和 2GB 内存，跑 1 个小时，费用可能在几美分到几十美分不等，具体得看你在哪个区域，还有那个区域的资源单价是多少。&lt;br>
支持自定义容器。&lt;/p>
&lt;h2 id="consumption-plan">Consumption Plan
&lt;/h2>&lt;p>这可是个完全无服务器托管的选项，简单来讲，只有函数运行的时候才会产生费用。它是怎么计费的呢？主要看函数的执行数量、执行时间，还有占用的内存。&lt;br>
举个例子，要是在美国西部区域，有个内存消耗为 512MB 的函数，这个月执行了 3,000,000 次，每次执行就持续 1 秒。咱们来算算账，内存资源消耗费用大概是这样算：&lt;br>
&lt;code>{（3百万秒 * 512GB/1,024） - 0.4百万GB - 秒} * 0.000016美元/GB - 秒 = 17.6美元&lt;/code>&lt;br>
函数执行次数费用如下：&lt;br>
&lt;code>（3百万次执行 – 1百万次执行） * 0.20美元 = 0.4美元&lt;/code>&lt;br>
把这两项一加，总费用就是 17.6 美元 + 0.4 美元 = 18 美元。&lt;br>
不支持自定义容器。&lt;/p></description></item><item><title>网络请求 - 用 Kotlin(KMP) 做跨端原生开发</title><link>https://www.jsongo.top/articles/kmp-http-sse/</link><pubDate>Sun, 05 Jan 2025 16:24:30 +0800</pubDate><guid>https://www.jsongo.top/articles/kmp-http-sse/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/c1e2de3d85f49231f2290e3ec17b3940.jpg" alt="Featured image of post 网络请求 - 用 Kotlin(KMP) 做跨端原生开发" />&lt;blockquote>
&lt;p>示例中用的是 Kotlin (KMP) &lt;code>2.x&lt;/code> ，Ktor &lt;code>3.x&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;h1 id="网络请求">网络请求
&lt;/h1>&lt;h2 id="基础的请求方法">基础的请求方法
&lt;/h2>&lt;p>用 ktor 提供的 &lt;code>HttpClient&lt;/code> 来创建一个发请求的 handler，实例化之后，我们包一个通用的 request，定义一个通用的返回类型。&lt;br>
官方文档中给了不少 &lt;a class="link" href="https://ktor.io/docs/client-requests.html" target="_blank" rel="noopener"
>示例&lt;/a>，相对比较简单，如：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.request.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.statement.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">val&lt;/span> &lt;span class="py">response&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">HttpResponse&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;https://ktor.io/&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Configure request parameters exposed by HttpRequestBuilder
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="封装序列化等逻辑">封装序列化等逻辑
&lt;/h2>&lt;p>不过这只能做一些相对简单场景的请求处理，如果要做 json 解析或 payload 序列化的话，还得引入 ContentNegotiation 、serializer 等，如果还需要 token 认证的话，还得加 header，下面我们一步步封装一个比较通用的请求类。&lt;br>
代码如下：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;span class="lnt">80
&lt;/span>&lt;span class="lnt">81
&lt;/span>&lt;span class="lnt">82
&lt;/span>&lt;span class="lnt">83
&lt;/span>&lt;span class="lnt">84
&lt;/span>&lt;span class="lnt">85
&lt;/span>&lt;span class="lnt">86
&lt;/span>&lt;span class="lnt">87
&lt;/span>&lt;span class="lnt">88
&lt;/span>&lt;span class="lnt">89
&lt;/span>&lt;span class="lnt">90
&lt;/span>&lt;span class="lnt">91
&lt;/span>&lt;span class="lnt">92
&lt;/span>&lt;span class="lnt">93
&lt;/span>&lt;span class="lnt">94
&lt;/span>&lt;span class="lnt">95
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.plugins.contentnegotiation.ContentNegotiation&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.plugins.logging.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.request.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.request.forms.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.statement.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.http.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.serialization.kotlinx.json.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.json.Json&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.json.JsonObject&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.serialization.serializer&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">const&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">BASE&lt;/span>&lt;span class="n">_URL&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="s2">&amp;#34;https://api.xxx.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">open&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">MyHttpClient&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">baseURL&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">BASE_URL&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">token&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">jsonUtil&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">Json&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">prettyPrint&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">isLenient&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ignoreUnknownKeys&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">encodeDefaults&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">explicitNulls&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">coerceInputValues&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">private&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">client&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">HttpClient&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">install&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">ContentNegotiation&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">json&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonUtil&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">install&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">Logging&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logger&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">Logger&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">DEFAULT&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">level&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">LogLevel&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">INFO&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sanitizeHeader&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">header&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">header&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nc">HttpHeaders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Authorization&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">suspend&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">request&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">HttpMethod&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">token&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">body&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">HttpResponse&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">queryString&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">let&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">params&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">isNotEmpty&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">params&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">entries&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">joinToString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;amp;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${it.key}&lt;/span>&lt;span class="s2">=&lt;/span>&lt;span class="si">${it.value}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="o">?:&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">fullPath&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">contains&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;?&amp;#34;&lt;/span>&lt;span class="p">))&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">$path&lt;/span>&lt;span class="s2">&amp;amp;&lt;/span>&lt;span class="si">$queryString&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">queryString&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">isNotEmpty&lt;/span>&lt;span class="p">())&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">$path&lt;/span>&lt;span class="s2">?&lt;/span>&lt;span class="si">$queryString&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="n">path&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">url&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">baseURL&lt;/span> &lt;span class="o">?:&lt;/span> &lt;span class="n">BASE_URL&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="n">fullPath&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] Request URL: &lt;/span>&lt;span class="si">$url&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">url&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">this&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">method&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">method&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">headers&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">actualToken&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">token&lt;/span> &lt;span class="o">?:&lt;/span> &lt;span class="k">this&lt;/span>&lt;span class="nd">@MyHttpClient&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">token&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">actualToken&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">let&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">HttpHeaders&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Authorization&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Bearer &lt;/span>&lt;span class="si">${it}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">headers&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">forEach&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">method&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nc">HttpMethod&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Get&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">body&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">when&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">is&lt;/span> &lt;span class="n">MultiPartFormDataContent&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">contentType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">ContentType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">MultiPart&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">FormData&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setBody&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">is&lt;/span> &lt;span class="n">String&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">contentType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">ContentType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">Text&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Plain&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setBody&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">is&lt;/span> &lt;span class="n">JsonObject&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">contentType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">ContentType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">Application&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Json&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setBody&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">jsonUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">encodeToString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">JsonObject&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">serializer&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="n">body&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">contentType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">ContentType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">Application&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Json&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setBody&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">status&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="nc">HttpStatusCode&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">OK&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] Error response: &lt;/span>&lt;span class="si">${response.status}&lt;/span>&lt;span class="s2"> - &lt;/span>&lt;span class="si">${response.bodyAsText()}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">response&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Exception&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] Request failed: &lt;/span>&lt;span class="si">${e.message}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">e&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>jsonUtil 用于统一 json 的序列化和反序列化，这是 Kotlin 等语言里比较特殊的地方，不过也挺好用，可以对“序列化”这个操作做统一的设置，ignoreUnknownKeys 设置为 true，来避免 response 里遇到一些不认识的字段时出错。习惯了动态语言的同学可能不觉得这是个问题，但强类型语言，json 的序列化还是挺讲究的。&lt;/li>
&lt;li>token 可以在创建类实例的时候传入，也可以在调用具体请求方法的时候传入，灵活些。&lt;/li>
&lt;li>RequestOptions 用于带入额外的请求头，因为有些接口可能会有特殊的 header 需求。另外为了方便支持 URL 中有多个参数的场景，也可以让用户传入 params，我们把它拼接到 URL 后面。&lt;br>
上方的代码里还有很多细节，不一一讲了，可以自己查文档。&lt;/li>
&lt;/ul>
&lt;h2 id="进一步封装简洁的方法">进一步封装简洁的方法
&lt;/h2>&lt;p>接着我们常用的其实还是 post 或 get 等，request 本身的参数还是比较多的。所以在 request 方法下方，再添加下更具体的请求方法：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">suspend&lt;/span> &lt;span class="k">inline&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="k">reified&lt;/span> &lt;span class="nc">T&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nf">get&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">opts&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">options&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">params&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">params&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">params&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">params&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">headers&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">headers&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="n">options&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">HttpMethod&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Get&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">options&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">opts&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">responseText&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">bodyAsText&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// println(&amp;#34;[HTTP] Raw Response: $responseText&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">jsonUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">decodeFromString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">serializer&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">&amp;gt;(),&lt;/span> &lt;span class="n">responseText&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">suspend&lt;/span> &lt;span class="k">inline&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="k">reified&lt;/span> &lt;span class="nc">T&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nf">post&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">payload&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] Posting to &lt;/span>&lt;span class="si">$path&lt;/span>&lt;span class="s2"> with payload &lt;/span>&lt;span class="si">$payload&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">HttpMethod&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Post&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">payload&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">responseText&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">bodyAsText&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// println(&amp;#34;[HTTP] Raw Response: $responseText&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">return&lt;/span> &lt;span class="n">jsonUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">decodeFromString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">serializer&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">&amp;gt;(),&lt;/span> &lt;span class="n">responseText&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">suspend&lt;/span> &lt;span class="k">inline&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="k">reified&lt;/span> &lt;span class="nc">T&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nf">put&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">payload&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] Putting to &lt;/span>&lt;span class="si">$path&lt;/span>&lt;span class="s2"> with payload &lt;/span>&lt;span class="si">$payload&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">HttpMethod&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Put&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">payload&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">responseText&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">bodyAsText&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">jsonUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">decodeFromString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">serializer&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">&amp;gt;(),&lt;/span> &lt;span class="n">responseText&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">suspend&lt;/span> &lt;span class="k">inline&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="p">&amp;lt;&lt;/span>&lt;span class="k">reified&lt;/span> &lt;span class="nc">T&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="nf">delete&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">payload&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">T&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] Deleting from &lt;/span>&lt;span class="si">$path&lt;/span>&lt;span class="s2"> with payload &lt;/span>&lt;span class="si">$payload&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">response&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">request&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">HttpMethod&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Delete&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">payload&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">responseText&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">response&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">bodyAsText&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">jsonUtil&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">decodeFromString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">serializer&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">T&lt;/span>&lt;span class="p">&amp;gt;(),&lt;/span> &lt;span class="n">responseText&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>用泛型来让用户定义想返回什么类型的结果。&lt;/li>
&lt;li>用 jsonUtil.decodeFromString 来对结果做反序列化处理。&lt;/li>
&lt;/ul>
&lt;h1 id="支持-sse">支持 SSE
&lt;/h1>&lt;p>在 AI 流行的时代，SSE (Server Sent Event) 成了标配。在前端 JS 等场景中，有 axios 等库做了封装，使用起来很方便，在 Kotlin 里要实现还是得费些工夫。&lt;/p>
&lt;h2 id="实现">实现
&lt;/h2>&lt;p>幸运的是，Ktor 3.0 在 2024 年底发布的时候，原生支持 SSE 了。&lt;/p>
&lt;ul>
&lt;li>Server 端：&lt;a class="link" href="https://ktor.io/docs/server-server-sent-events.html" target="_blank" rel="noopener"
>Server-Sent Events | Ktor Documentation&lt;/a>&lt;/li>
&lt;li>Client 端：&lt;a class="link" href="https://ktor.io/docs/client-server-sent-events.html" target="_blank" rel="noopener"
>Server-Sent Events | Ktor Documentation&lt;/a>&lt;br>
KMP Client 端接入现在变得很简单，也不需要什么特殊依赖：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/035e39a399cfc90d0f6f9676a208ccaf.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
扩展上文中的代码，添加一个 sse 方法：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fun&lt;/span> &lt;span class="nf">sse&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">path&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">body&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">):&lt;/span> &lt;span class="n">Flow&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">ServerSentEvent&lt;/span>&lt;span class="p">&amp;gt;&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">flow&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] SSE posting to &lt;/span>&lt;span class="si">$path&lt;/span>&lt;span class="s2"> with payload &lt;/span>&lt;span class="si">$body&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">baseURL&lt;/span> &lt;span class="p">+&lt;/span> &lt;span class="n">path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">method&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nc">HttpMethod&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Post&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">token&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">let&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Authorization&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;Bearer &lt;/span>&lt;span class="si">$it&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Accept&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;text/event-stream&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Cache-Control&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;no-cache&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Connection&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;keep-alive&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">options&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">headers&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">forEach&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">key&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="k">value&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">contentType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">ContentType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nc">Application&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Json&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">body&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">let&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">setBody&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">it&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">})&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">var&lt;/span> &lt;span class="py">shouldContinue&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">var&lt;/span> &lt;span class="py">eventCount&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">maxEvents&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="m">500&lt;/span> &lt;span class="c1">// 最大事件数限制
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">while&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">shouldContinue&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="n">eventCount&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="n">maxEvents&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">incoming&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">event&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">!is&lt;/span>&lt;span class="n">Active&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] SSE connection is no longer active&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shouldContinue&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="nd">@collect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eventCount&lt;/span>&lt;span class="o">++&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] SSE event (&lt;/span>&lt;span class="si">$eventCount&lt;/span>&lt;span class="s2">/&lt;/span>&lt;span class="si">$maxEvents&lt;/span>&lt;span class="s2">): &lt;/span>&lt;span class="si">$event&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">eventType&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">event&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="o">?.&lt;/span>&lt;span class="n">let&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="nc">EventType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">fromValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">it&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 如果 event.event 是 EventType.ERROR，则打印 msg 然后结束
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">eventType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nc">EventType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ERROR&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shouldContinue&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="nd">@collect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">emit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">eventType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nc">EventType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">DONE&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="n">eventType&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nc">EventType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">WORKFLOW_DONE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shouldContinue&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="nd">@collect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span> &lt;span class="k">catch&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Exception&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] SSE connection error: &lt;/span>&lt;span class="si">${e.message}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">shouldContinue&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">e&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">eventCount&lt;/span> &lt;span class="o">&amp;gt;=&lt;/span> &lt;span class="n">maxEvents&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;[HTTP] SSE reached maximum event limit (&lt;/span>&lt;span class="si">$maxEvents&lt;/span>&lt;span class="s2">)&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">throw&lt;/span> &lt;span class="n">Exception&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;SSE reached maximum event limit&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里要多引入几个包：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.client.plugins.sse.sse&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">io.ktor.sse.ServerSentEvent&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.coroutines.flow.Flow&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.coroutines.flow.flow&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.coroutines.isActive&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这个实现看起来有点复杂。几个关键点：&lt;/p>
&lt;ul>
&lt;li>&lt;code>client.sse&lt;/code> 是官方提供的、做 SSE 请求的方法，直接就可以使用。&lt;/li>
&lt;li>&lt;code>header(&amp;quot;Accept&amp;quot;, &amp;quot;text/event-stream&amp;quot;)&lt;/code> 添加一个 Accept header 指定为 &lt;code>text/event-stream&lt;/code>。&lt;/li>
&lt;li>maxEvents 设置一个最大的事件数，以免 while 在边缘的情况下进入无限的死循环。&lt;/li>
&lt;li>shouldContinue 用于控制 while 是否继续，逻辑里当发现结束标志的时候，把 shouldContinue 设置成 false。&lt;/li>
&lt;li>Flow，下面专门讲解。&lt;/li>
&lt;/ul>
&lt;h2 id="kotlin-flow">Kotlin Flow
&lt;/h2>&lt;h3 id="whats-flow">What&amp;rsquo;s Flow
&lt;/h3>&lt;p>这是属于语言基础的问题，不过多展开。简单说就是在 Kotlin 中，&lt;code>Flow&lt;/code> 是一种用于处理异步数据流的类型安全的 API。它可以用于处理像网络请求返回的数据、数据库查询结果等一系列按顺序产生的数据。&lt;code>Flow&lt;/code> 是 &amp;ldquo;&lt;strong>冷流&lt;/strong>&amp;quot;（Cold Stream），这意味着它只有在被收集（&lt;code>collect&lt;/code>）的时候才会开始执行。&lt;br>
SSE 的场景不正好就是“按顺序生成数据”嘛，所以自然就跟 Flow 结合了。在 JS、Python 里可能会自然的联想到 generator（&lt;code>yield&lt;/code>），写起来很简单，如 JS 里用 for await 来消费就行。&lt;/p>
&lt;h3 id="incoming">Incoming
&lt;/h3>&lt;p>代码中的 incoming 是 &lt;code>client.sse&lt;/code> 引入的、表示 SSE 事件流数据的一个内置变量，它本身就是一个 Flow，直接拿来用即可。这是源码中的定义：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * A Server-sent events session.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">public&lt;/span> &lt;span class="k">interface&lt;/span> &lt;span class="nc">SSESession&lt;/span> &lt;span class="p">:&lt;/span> &lt;span class="n">CoroutineScope&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * An incoming server-sent events flow.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">public&lt;/span> &lt;span class="k">val&lt;/span> &lt;span class="py">incoming&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Flow&lt;/span>&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="n">ServerSentEvent&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>incoming 怎么来的： &lt;code>client.sse&lt;/code> 是由 &lt;code>serverSentEvents&lt;/code> 方法生成的，它返回一个 &lt;code>ClientSSESession&lt;/code>，而 &lt;code>ClientSSESession&lt;/code> 继承了 &lt;code>SSESession&lt;/code>，所以 incoming 一直传到了 &lt;code>client.sse&lt;/code> 的 scope 里。&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>当调用 &lt;code>incoming.collect&lt;/code> 时，它会触发这个 &lt;code>Flow&lt;/code> 开始工作，并且会将 &lt;code>Flow&lt;/code> 发射出的每个数据项传递给 &lt;code>collect&lt;/code> 函数内部定义的操作进行处理。Collect 参数是一个 lambda 表达式，参数就是一个 ServerSentEvent，定义如下图，遵守 SSE 的数据流协议，比较标准，没什么好说的。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/f7c4b8c6b499c3c7eed20a4751139e6c.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;/li>
&lt;li>EventType 是我们自己定义的，根据业务来定制的，开发者可以自己命令（跟服务端接口对齐好就行），大概的定义可以参考这个实现：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="cm">/**
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> * Event types for all events (chat, workflow, etc.)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cm"> */&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@Serializable&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">enum&lt;/span> &lt;span class="k">class&lt;/span> &lt;span class="nc">EventType&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">val&lt;/span> &lt;span class="py">value&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Chat events
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">CONVERSATION_CHAT_CREATED&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;conversation.chat.created&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONVERSATION_CHAT_IN_PROGRESS&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;conversation.chat.in_progress&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONVERSATION_CHAT_COMPLETED&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;conversation.chat.completed&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CONVERSATION_CHAT_FAILED&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;conversation.chat.failed&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// Common events
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">DONE&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;done&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">ERROR&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;error&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">companion&lt;/span> &lt;span class="k">object&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fun&lt;/span> &lt;span class="nf">fromValue&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">value&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">):&lt;/span> &lt;span class="n">EventType&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">entries&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">find&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="k">it&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="k">value&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="k">value&lt;/span> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其中 DONE 表示这个流已经结束了，字符串“done”是后端定的，换成其它标识也行，但不管怎么说得有这么一个结束标识，要不然就会一直卡在那等。&lt;/p>
&lt;h3 id="协程">协程
&lt;/h3>&lt;p>Flow 的 &lt;code>collect&lt;/code> 函数本身其实不是用于启动协程的。&lt;br>
它是一个挂起函数，有点类似其它语言中的 &lt;code>yield&lt;/code>。挂起就意味着它必须在协程的上下文中被调用（要不然主线程就被阻塞了）。&lt;br>
协程是一种轻量级的线程，可以暂停和恢复，用于处理异步操作。运行一个协程有几种方式，介绍两种：&lt;br>
1、runBlocking&lt;/p>
&lt;ul>
&lt;li>我们可以在 &lt;code>runBlocking&lt;/code> 协程构建器的上下文中可以调用 &lt;code>collect&lt;/code>。&lt;code>runBlocking&lt;/code> 是一个顶层协程启动器，它会阻塞当前线程，直到其内部的协程（包括调用 &lt;code>collect&lt;/code> 的操作）完成，所以使用时，我们可以用它来包一下，让 Flow 在里面被消费。
&lt;ul>
&lt;li>不过 &lt;code>runBlocking&lt;/code> 是一个顶层协程启动器，会阻塞当前线程，直到其内部的协程（包括所有子协程）执行完成。这意味着在 &lt;code>runBlocking&lt;/code> 内部的代码执行完之前，外部的代码（如果有的话）是无法继续执行的。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>示例：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fun&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Before runBlocking&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">runBlocking&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">delay&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">1000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Inside runBlocking&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;After runBlocking&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>&lt;code>Before runBlocking&lt;/code> 会先打印，然后 &lt;code>runBlocking&lt;/code> 内部的协程开始执行，由于 &lt;code>delay&lt;/code> 操作暂停了协程 1 秒钟，在这期间当前线程被阻塞。当协程内部的代码执行完后，才会打印 &lt;code>After runBlocking&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>2、 CoroutineScope&lt;/p>
&lt;ul>
&lt;li>&lt;code>CoroutineScope&lt;/code> 本身并不阻塞线程。它主要是用于定义协程的作用域，确定了协程的生命周期和上下文。协程在 &lt;code>CoroutineScope&lt;/code> 内启动后，&lt;code>CoroutineScope&lt;/code> 可以继续执行其他操作，不会等待协程完成。&lt;/li>
&lt;li>改下上面的例子：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">fun&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">runBlocking&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Before CoroutineScope&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">scope&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">CoroutineScope&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">Dispatchers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Default&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">scope&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">launch&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">delay&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="m">1000&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Inside launched coroutine&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;After CoroutineScope&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这次 &lt;code>Before CoroutineScope&lt;/code> 和 &lt;code>After CoroutineScope&lt;/code> 会先打印，然后才是 &lt;code>Inside launched coroutine&lt;/code>。&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>&lt;code>collect&lt;/code> 的一些特点和注意事项&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>&lt;strong>顺序处理&lt;/strong>：&lt;code>collect&lt;/code> 会按照 &lt;code>Flow&lt;/code> 发射数据的顺序来处理数据。如果 &lt;code>Flow&lt;/code> 发射的数据有先后顺序，&lt;code>collect&lt;/code> 也会按照这个顺序依次处理每个数据项。&lt;/li>
&lt;li>&lt;strong>挂起函数&lt;/strong>：&lt;code>collect&lt;/code> 是一个挂起函数，这意味着它要在协程（Coroutine）内部被调用，并且可以暂停协程的执行，直到 &lt;code>Flow&lt;/code> 有新的数据需要处理或者 &lt;code>Flow&lt;/code> 完成。而 &lt;code>runBlocking&lt;/code> 是一个用于在主函数中启动协程的函数，它会阻塞当前线程，直到所有协程完成。&lt;/li>
&lt;li>&lt;strong>异常处理&lt;/strong>：如果 &lt;code>Flow&lt;/code> 在发射数据过程中出现异常，&lt;code>collect&lt;/code> 函数可以通过合适的异常处理机制来捕获和处理这些异常。例如，可以在 &lt;code>collect&lt;/code> 函数内部使用 &lt;code>try - catch&lt;/code> 块来处理可能出现的异常。&lt;/li>
&lt;/ul>
&lt;h2 id="使用-sse">使用 SSE
&lt;/h2>&lt;p>使用上肯定是直接用 collect 只不过如果要不阻塞当前的主线程，可以用上文介绍的 CoroutineScope。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.coroutines.*&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.coroutines.flow.Flow&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">import&lt;/span> &lt;span class="nn">kotlinx.coroutines.flow.collect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">suspend&lt;/span> &lt;span class="k">fun&lt;/span> &lt;span class="nf">startEventFlowProcessing&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">apiUrl&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">String&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">payload&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">Any&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">?&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="k">null&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">eventFlow&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sse&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">apiUrl&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">payload&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">options&lt;/span>&lt;span class="o">?:&lt;/span> &lt;span class="n">RequestOptions&lt;/span>&lt;span class="p">())&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// 使用 launch 开启一个新的协程来执行收集操作
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">CoroutineScope&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nc">Dispatchers&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">Default&lt;/span>&lt;span class="p">).&lt;/span>&lt;span class="n">launch&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">eventFlow&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">collect&lt;/span> &lt;span class="p">{&lt;/span> &lt;span class="n">event&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">val&lt;/span> &lt;span class="py">chatData&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="n">sseEvent2ChatData&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">event&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">emit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">chatData&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// If event is &amp;#34;[DONE]&amp;#34;, end
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">chatData&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">event&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nc">EventType&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">DONE&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;SSE DONE.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span>&lt;span class="nd">@collect&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>要阻塞，就换成 runBlocking。这里就不再补充代码示例了。&lt;/p></description></item><item><title>azure Function 自定义镜像</title><link>https://www.jsongo.top/articles/azure-function-custom-containers/</link><pubDate>Sun, 05 Jan 2025 11:25:49 +0800</pubDate><guid>https://www.jsongo.top/articles/azure-function-custom-containers/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/772c64fbb07e3cd46573602f922a7829.jpg" alt="Featured image of post azure Function 自定义镜像" />&lt;p>Azure Function 默认是跑在它官方的 &lt;a class="link" href="https://hub.docker.com/r/microsoft/azure-functions-base" target="_blank" rel="noopener"
>microsoft/azure-functions-base&lt;/a> 这个镜像上。当然你可以定义自己的镜像，Azure 开放了这个能力。本文主要介绍如何操作。&lt;/p>
&lt;h1 id="创建自己的镜像">创建自己的镜像
&lt;/h1>&lt;h2 id="创建-dockerfile">创建 Dockerfile
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">func init --docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>它会初始化一个 Dockerfile 等文件，如果你只需要 Dockerfile 可以把参数改成 &lt;code>--docker-only&lt;/code>。&lt;br>
生成的 Dockerfile 里面有如下基础的配置：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># To enable ssh &amp;amp; remote debugging on app service change the base image to the one below&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="c"># FROM mcr.microsoft.com/azure-functions/python:4-python3.12-appservice&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">FROM&lt;/span>&lt;span class="s"> mcr.microsoft.com/azure-functions/python:4-python3.12&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">ENV&lt;/span> &lt;span class="nv">AzureWebJobsScriptRoot&lt;/span>&lt;span class="o">=&lt;/span>/home/site/wwwroot &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> &lt;span class="nv">AzureFunctionsJobHost__Logging__Console__IsEnabled&lt;/span>&lt;span class="o">=&lt;/span>true&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">COPY&lt;/span> requirements.txt /&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> pip install -r /requirements.txt&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">COPY&lt;/span> . /home/site/wwwroot&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这些不要改动。不过可以在上面添加你自己的东西，比如我在做视频相关的处理，所以我需要一个 ffmpeg 库安装上去，所以我添加了如下的代码：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-Dockerfile" data-lang="Dockerfile">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># 安装 ffmpeg&lt;/span>&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="err">&lt;/span>&lt;span class="k">RUN&lt;/span> apt-get update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get install -y ffmpeg &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> apt-get clean &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> rm -rf /var/lib/apt/lists/*&lt;span class="err">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="注册">注册
&lt;/h2>&lt;p>在 &lt;a class="link" href="https://portal.azure.com/#browse/Microsoft.ContainerRegistry%2Fregistries" target="_blank" rel="noopener"
>Azure Container Registry&lt;/a>（容器注册表）这里注册一个你自己的命令空间。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/463f2950bea861c9729cb23cdc5a6478.webp"
width="675"
loading="lazy"
alt="|675"
>&lt;br>
创建完你就有一个自己的专属 Azure 镜像的域，如我这里的是 &lt;code>jsongo.azurecr.io&lt;/code>。&lt;br>
在 CLI 中登录：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az acr login --name jsongo
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果你的 &lt;code>az&lt;/code> 命令之前登录过，这里直接就成功了。记住后面再遇到 docker 操作提示登录的问题，直接运行上面这个命令即可。&lt;br>
接下去你就可以构建镜像，并把它推到你的这个域上了。&lt;/p>
&lt;h2 id="构建">构建
&lt;/h2>&lt;p>首先你本地得有一个 Docker 软件安装并运行起来，可以到 Docker 官网上去下载，这个比较简单。当然如果你有一个线上的虚拟机，那就直接在上面处理也行，只不过还得在上面安装 azure 的 CLI。上一篇已经介绍过了、不再赘述。&lt;br>
接下去可以在云端构建：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az acr build --registry jsongo.azurecr.io/azure-video:0.1.0 .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>或者在本地构建上面创建的镜像。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker build --tag jsongo/azure-video:0.1.0 .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如下示例。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/a28f11024d5a8fe4f5c8ad0337479ee7.webp"
loading="lazy"
alt="|750|750x319"
>&lt;br>
比如我这个镜像，由于加了 ffmpeg 之后，构建完成时整个镜像很大，一下子撑到了 2G。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/4f71b5b5f343bcc4b0db975f24bfce60.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;br>
构建完，试着把它运行起来看看：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker run --rm -e &lt;span class="nv">WEBSITES_INCLUDE_CLOUD_CERTS&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">true&lt;/span> -p 8080:80 --name test-azure-video -it jsongo.azurecr.io/azure-video
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当然你的 auth level 要设置成 anonymous authorization 才可以直接访问，如果没问题它能正常跑起来。接下去在本地 curl 一下 8080 端口就可以看到有没有正确返回。&lt;/p>
&lt;h3 id="查看构建出来的镜像">查看构建出来的镜像
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az acr repository list --name jsongo --output table
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="用-azure-cli-更新镜像">用 Azure CLI 更新镜像
&lt;/h2>&lt;p>Azure 也提供了相应的指令用于更新你的镜像。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az acr build --registry jsongo --image jsongo.azurecr.io/azure-video:0.2.0 .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>这里我们构建一个 0.2.0 版本，它同时会把新构建完的镜像 push 到 Registry 里。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/30c03710c34bfd64f9299837e3ee22ce.webp"
width="750"
loading="lazy"
alt="|750"
>&lt;/p>
&lt;h2 id="推到-azure-平台上">推到 Azure 平台上
&lt;/h2>&lt;p>先打个 tag，刚构建时，默认是用的 dockerhub 的。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker tag jsongo/azure-video:0.1.0 jsongo.azurecr.io/azure-video:0.1.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其中 &lt;code>jsongo.azurecr.io&lt;/code> 就是我们上面创建的域，它标识了一个 Docker Registry 的地址（默认是 &lt;code>docker.io&lt;/code>）。&lt;br>
接下去运行 docker push 的时候，就可以找到 azure 的 Registry。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker push jsongo.azurecr.io/azure-video:0.1.0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后就是等了。我这个镜像 2G+，着实是要等好一会儿。&lt;br>
Push 完，打开你的 &lt;a class="link" href="https://portal.azure.com/#view/HubsExtension/BrowseResource/resourceType/Microsoft.ContainerRegistry%2Fregistries" target="_blank" rel="noopener"
>容器注册表页面&lt;/a>，在这里就可以看到你刚推送上去的镜像了。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/fb1175d6eaf44464ccf31a4c1a79046b.webp"
width="750"
loading="lazy"
alt="|750"
>&lt;/p>
&lt;h1 id="使用镜像">使用镜像
&lt;/h1>&lt;p>下面介绍两种使用镜像的方式，分别对应下图中的两个红框。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/05e3ba7519cfcf0353ab94e9920cd241.webp"
width="800"
loading="lazy"
alt="|800"
>&lt;/p>
&lt;h2 id="创建函数应用">创建函数应用
&lt;/h2>&lt;p>创建一个 Function 如果要使用自己的镜像，“弹性消耗”是不支持的。要选“高级计划”或“应用服务”才行。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/61ccd18ce92bbd84fe47a4bdf732ff55.webp"
width="600"
loading="lazy"
alt="|600"
>&lt;br>
一步步往下直到创建完成。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/db86acc839e4545ce6e255d56a6bc911.webp"
loading="lazy"
>&lt;br>
接下去就可以打开 azure 函数首页，去看刚部署的函数。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/6efc5b6d235cc4e37d11ef1a7b0c52de.webp"
width="750"
loading="lazy"
alt="|750"
>&lt;br>
至于哪些计划可以支持自定义容器部署可以参考这里：&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-scale" target="_blank" rel="noopener"
>Azure Functions scale and hosting | Microsoft Learn&lt;/a>。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/3ef8be06d615efb0daf5495e872d716e.webp"
width="725"
loading="lazy"
alt="|725"
>&lt;/p>
&lt;h2 id="创建函数容器环境container-apps">创建函数容器环境（Container Apps）
&lt;/h2>&lt;p>其实如果要更好的跟 Azure Function 结合的话，可以试下“容器应用环境”(Azure Container Apps environment)，它可以用于你已经在跑的函数中。&lt;br>
同样我们也在首页创建一个，在“基本”（basics）中填写一些基础信息，这里不再赘述，比较简单。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/8214ec925893f7b328ad5d50499b3e4d.webp"
width="800"
loading="lazy"
alt="|800"
>&lt;br>
接着到“部署”选项卡中，设置你刚 push 上去的镜像。先把“使用快速入门图像”勾选去掉，另外映像类型选专用的（Private），如图一样填写你的镜像信息。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/31737bdba1d7f1ee2ca7666308ac3471.webp"
loading="lazy"
>&lt;br>
费用是按需支付的，跟之前的两种方式不太一样：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/e6a5c97b8e6c5a26b8b16c017f57bc69.webp"
loading="lazy"
alt="|500|500x992"
>&lt;br>
而且单个机子的配置选项也足够灵活，如图。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/e3e7946cc1641c5515fbb230dca83c28.webp"
width="275"
loading="lazy"
alt="|275"
>&lt;/p>
&lt;h1 id="应用开发和部署">应用开发和部署
&lt;/h1>&lt;p>如果使用了第一种方式创建了函数应用，它的部署方式就有所变化。之前在 [[azure serverless]] 里做过一些简单的介绍，当时提到发布方式比较简单，即 &lt;code>func azure functionapp publish xxx&lt;/code> 就行。&lt;br>
不过现在我们是把代码打包到容器里，所以没法再使用这种方式去部署。现在需要改成 azure CLI 提供的 build 命令，其实在上文中提过了，只不过要稍加修改。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az acr build --registry jsongo --image jsongo.azurecr.io/azure-video:latest .
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>它推到远程去构建，并也 push 到远程 acr。&lt;br>
多次使用下来，其实我发现直接使用 docker 命令在本地构建会快很多，因为有缓存，所以我把面上的命令改成了：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker build -t jsongo.azurecr.io/azure-video:latest .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">docker push jsongo.azurecr.io/azure-video:latest
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>构建完成后，接下来，我们再运行下之前的更新命令即可：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">func azure functionapp publish video-handler
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="其它">其它
&lt;/h1>&lt;h2 id="关于-premium-plan-和-dedicated-plan">关于 Premium Plan 和 Dedicated Plan
&lt;/h2>&lt;p>这些 Plan 其实都涉及到了多种服务和资源，根据不同情况来选择。&lt;/p>
&lt;h3 id="premium-plan">Premium Plan
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>计算资源&lt;/strong>：通常指高性能的虚拟机或计算实例等。以虚拟机为例，不同规格的虚拟机收费不同，一般每小时的费用在 0.5 美元到几美元不等，如 DS 系列虚拟机可能比普通系列的虚拟机费用要高，高性能的虚拟机每小时费用可能要 0.834 美元甚至更高。&lt;/li>
&lt;li>&lt;strong>存储资源&lt;/strong>：如果是 Premium Storage，收费标准通常按磁盘的最大容量阶梯收费，而不是用多少算多少，且其读写操作也可能会有额外的收费，如每 10 万个存储事务为 3 元，不过每月一般会提供 100 亿次免费的事务 13。&lt;/li>
&lt;li>&lt;strong>网络资源&lt;/strong>：对于使用流量较大的公网 IP，每月费用可能在 1.2 美元及以上，负载均衡器每小时也会有一定的费用，如标准负载均衡器每小时的费用是 0.016 美元左右。&lt;/li>
&lt;/ul>
&lt;h3 id="dedicated-plan">Dedicated Plan
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>计算资源&lt;/strong>：如 Dedicated Host，一般会根据主机的配置和租用时长收费，一台配置中等的 Dedicated Host 每月费用可能在 1000 美元到 3000 美元左右。
&lt;ul>
&lt;li>&lt;strong>存储资源&lt;/strong>：若使用专用的存储设备或特定的存储方案，收费也会因存储容量、性能要求等因素而异，通常专用存储的费用相对较高，每 GB 每月的费用可能在 0.2 美元到 0.5 美元之间，具体取决于存储类型和性能等级。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>网络资源&lt;/strong>：如果需要专用的网络设备或带宽保证，费用也会相应增加，专用网络带宽每 Mbps 每月的费用可能在 10 美元到 50 美元左右。&lt;/li>
&lt;/ul>
&lt;h3 id="选择">选择
&lt;/h3>&lt;p>可以根据需求来选择：&lt;/p>
&lt;ul>
&lt;li>如果对计算性能要求极高，但对资源的独占性要求不是特别高，Premium plan 可能更合适，因为它可以提供高性能的计算资源，同时成本相对较低。&lt;/li>
&lt;li>如果对安全性、合规性以及资源的独占性有严格要求，需要完全隔离的计算和存储环境，那么 Dedicated plan 可能是更好的选择，尽管费用相对较高，但能满足特定的业务需求。&lt;br>
实在不好选择，直接就选 Premium plan，比较经济些，一般也用不到比较太高级的配置。它目前有以下三个配置可以选：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/c0f3dcf1e6ca0c79664d2697b121675b.webp"
width="450"
loading="lazy"
alt="|450"
>&lt;br>
不过价格上… 是有点高些，具体可以看这里：&lt;a class="link" href="https://azure.microsoft.com/zh-cn/pricing/details/functions/" target="_blank" rel="noopener"
>定价 - Functions | Microsoft Azure&lt;/a>。&lt;br>
小时视角：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/bcac629924bd882bed230aa3781131f6.webp"
width="850"
loading="lazy"
alt="|850"
>&lt;br>
月视角：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/cc859d4f93fc2c606083a65c5d005ff7.webp"
width="800"
loading="lazy"
alt="|800"
>&lt;br>
补：后来在函数的设置里，看到了比较实际的价格。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/cfd8d327d4b15dd049054f2fcf6223d7.webp"
width="800"
loading="lazy"
alt="|800"
>&lt;br>
这个看起来比较切合实际，1 小时不到 2 块。&lt;/li>
&lt;/ul>
&lt;h1 id="参考">参考
&lt;/h1>&lt;ul>
&lt;li>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-how-to-custom-container?tabs=core-tools,acr,azure-cli2,azure-cli&amp;amp;pivots=container-apps#creating-containerized-function-apps" target="_blank" rel="noopener"
>Working with Azure Functions in containers | Microsoft Learn&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-create-container-registry?tabs=acr,bash&amp;amp;pivots=programming-language-python#build-the-container-image-and-verify-locally" target="_blank" rel="noopener"
>Create Azure Functions in a local Linux container | Microsoft Learn&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-roles?tabs=azure-cli" target="_blank" rel="noopener"
>Azure Container Registry roles and permissions - Azure Container Registry | Microsoft Learn&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://zone.huoxian.cn/d/2594-azure-functions" target="_blank" rel="noopener"
>使用自定义云容器在 Azure Functions 中增强云安全性&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>入门 - 用 Kotlin(KMP) 做跨端原生开发</title><link>https://www.jsongo.top/articles/kmp-101/</link><pubDate>Fri, 27 Dec 2024 11:31:09 +0800</pubDate><guid>https://www.jsongo.top/articles/kmp-101/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/24372eee204cc869cbb56c86a09a6b4c.png" alt="Featured image of post 入门 - 用 Kotlin(KMP) 做跨端原生开发" />&lt;p>Kotlin 是由 JetBrains 开发的编程语言，Google 将其作为 Android 应用开发的首选语言，并且它通过相关跨平台框架（如 Kotlin Multiplatform Platform - KMP）发展出了跨端开发的能力。&lt;/p>
&lt;blockquote>
&lt;p>示例中用的是 Kotlin (KMP) &lt;code>2.x&lt;/code> ，Ktor &lt;code>3.x&lt;/code>&lt;/p>
&lt;/blockquote>
&lt;h1 id="概述">概述
&lt;/h1>&lt;h2 id="跨端">跨端
&lt;/h2>&lt;p>用 KMP 来做跨端的好处是，它能静态编译成原生的 Android、iOS 代码，如果单独作为工程使用，性能上原生会更好；如果是作为组件供原生开发的客户端使用，也能共享代码逻辑。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>代码共享优势&lt;/strong>：Kotlin 在跨端开发中，主要优势在于能够共享业务逻辑代码。例如，在开发一个同时有 Android 和 iOS 版本的应用时，应用中关于数据处理（如数据加密、数据验证等）、网络请求（如 API 调用、数据解析）等业务逻辑部分的 Kotlin 代码可以在两个平台间共享，这大大减少了开发工作量。&lt;/li>
&lt;li>&lt;strong>支持多平台类型&lt;/strong>：除了 Android 和 iOS，Kotlin 还可以用于后端开发（如使用 Kotlin 与 Spring Boot 结合开发服务器端应用），这样就有可能构建从后端到移动端完整的跨平台应用生态系统。&lt;/li>
&lt;/ul>
&lt;h2 id="原理">原理
&lt;/h2>&lt;p>在 KMM 框架里，Kotlin 代码会被编译为不同平台的目标代码。&lt;/p>
&lt;ul>
&lt;li>对于 Android，Kotlin 代码可以直接编译为字节码在 Android 设备上运行（就像它在传统 Android 开发中的方式一样）。&lt;/li>
&lt;li>对于 iOS，Kotlin 代码通过中间表示（Intermediate Representation，IR）与 iOS 原生开发环境进行交互。这个中间表示是一种抽象的代码形式，它可以与 iOS 的 Swift 或 Objective-C 代码进行互操作。&lt;br>
除了 Android，本质上，Kolit 是通过编译成能&lt;strong>与其它语言互操作的中间代码来实现的&lt;/strong>。它跟 Flutter 类的框架有比较明显的区别，Flutter 最终是通过 Dart 虚拟机来抹平底层的差异，而 KMP 则是顺应各端的语言环境，编译成它们更友好的中间语言来做集成。&lt;br>
为了更好的理解，我再进一步讲下：在 iOS 应用中使用 KMP（借助 Kotlin/Native）开发的场景中，Kotlin 代码会被编译为机器码，这个过程是通过 Kotlin/Native 编译器完成的。编译后的代码会生成一个类似 XCFramework 的库文件，它可以被&lt;strong>链接&lt;/strong>到 iOS 应用中。这个库文件在 iOS 应用运行时并没有一个像 Flutter 那样的单独的 “runtime” 概念。所以性能上会比 Flutter 类的框架好很多。&lt;br>
从性能上看，由于 Kotlin/Native 编译后的代码直接与 iOS 原生代码集成，性能方面基本就是原生代码的性能。没有额外的运行时解释层，使得代码执行效率较高。&lt;br>
在资源占用方面，因为不需要加载一个单独的运行时环境，相对来说对设备资源（如内存、CPU 等）的占用会少些。&lt;/li>
&lt;/ul>
&lt;h2 id="更多资料">更多资料
&lt;/h2>&lt;p>官网提供了比较详细的指引，可以参考这里： &lt;a class="link" href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-create-first-app.html#examine-the-project-structure" target="_blank" rel="noopener"
>Create your first cross-platform app | Kotlin Multiplatform Development Documentation&lt;/a>。&lt;br>
本文简单地介绍它在跨端开发上体验。&lt;/p>
&lt;blockquote>
&lt;p>背景：尝试 KMP 框架，主要是因为在做一个 SDK 的客户端版本时，需要开发 iOS 和 Android 版本，大概看了下当前的趋势和性能、认可度等方面，综合判断选择了这个框架。&lt;/p>
&lt;/blockquote>
&lt;h1 id="跑起第一个-kmp-应用">跑起第一个 KMP 应用
&lt;/h1>&lt;p>官方指定用 Android Studio，可以从这里 &lt;a class="link" href="https://developer.android.com/studio" target="_blank" rel="noopener"
>下载 Android Studio 和应用工具 &lt;/a>。默认是内置了 Gradle 来做编译，包含跨端的代码编译。&lt;/p>
&lt;h2 id="生成项目及初始代码介绍">生成项目及初始代码介绍
&lt;/h2>&lt;p>官方给了一个工具用于生成初始化的项目代码：https://kmp.jetbrains.com/，在这上面配置下应用相关的信息即可。一般只需要 Android 和 iOS 两个端即可：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/076751605e49d1210f34130cb80ed50e.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
下载到本地，然后用 Android Studio 导入。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/40711a8957ede4718b786f891b2ffe9d.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;br>
代码主要包含 3 个部分：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Shared&lt;/strong>，共享的部分。它是跨端的逻辑代码存放的地方，主要有 &lt;code>androidMain&lt;/code> 、&lt;code>commonMain&lt;/code> 和  &lt;code>iosMain&lt;/code>，最终编译成 Android Library 和 iOS framework 供两端集成。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/90a4b3199a161461a2964e7e36b47089.webp"
loading="lazy"
>&lt;/li>
&lt;li>&lt;strong>ComposeApp&lt;/strong>，是一个完整的 Kotlin 模块，它可以通过 Gradle 直接编译成 Android 应用，它里面也包含了 Shared module，Android 应用编译时可以引用这部分共用的模块。&lt;/li>
&lt;li>&lt;strong>IosApp&lt;/strong>，则是一个 Xcode 项目，用于编译成 iOS 应用。&lt;/li>
&lt;/ul>
&lt;h2 id="写一个-shared-modulecommonmain">写一个 Shared module（CommonMain）
&lt;/h2>&lt;p>依赖是写 KMP 应用会遇到的第一个比较麻烦的问题，不过大都能从 &lt;a class="link" href="https://ktor.io/docs/welcome.html" target="_blank" rel="noopener"
>这个文档&lt;/a> 中找到，可能需要点耐心。&lt;br>
写到 CommonMain/ 目录里的代码，如果包含了平台专有的 API，IDE 会给 Warning 提醒，交互比较友好。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/6556d2995f4234f406c6bb50c4131d0b.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;br>
把 import 部分改成 &lt;code>kotlin.random.Random&lt;/code> 就没报错了（Random 类写法去掉括号）。&lt;br>
接下去点击图中 Top bar 里的运行按钮就可以跑起来了，它会出现 Android 一虚拟机，在上面运行你的代码。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/345f016c58696f3658be24fd2a43d104.webp"
width="300"
loading="lazy"
alt="|300"
>&lt;/p>
&lt;h2 id="自定义">自定义
&lt;/h2>&lt;p>跑通了基础的流程，我们接下去的工作就简单了，创建一个 kt 文件，写好逻辑即可。&lt;br>
比如我想写一个通用的 HTTP 请求的模块，需要先安装一些依赖，具体可以参考 &lt;a class="link" href="https://ktor.io/docs/client-dependencies.html#repositories" target="_blank" rel="noopener"
>这里&lt;/a>。打开 &lt;code>composeApp/build.gradle.kts&lt;/code>，添加下几个依赖：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/798b355d1da19bded2025aff5dbafa7e.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;/p>
&lt;h3 id="依赖分析">依赖分析
&lt;/h3>&lt;p>1、plugins&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-kotlin" data-lang="kotlin">&lt;span class="line">&lt;span class="cl">&lt;span class="n">plugins&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">alias&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">libs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">plugins&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">kotlinMultiplatform&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">alias&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">libs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">plugins&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">androidApplication&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">alias&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">libs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">plugins&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">composeMultiplatform&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">alias&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">libs&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">plugins&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">composeCompiler&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c1">// my plugins
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">&lt;/span> &lt;span class="n">kotlin&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;plugin.serialization&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">version&lt;/span> &lt;span class="s2">&amp;#34;2.0.0&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>安装完之后，点击 Sync Now，让它安装依赖。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/8994d10bce0c602a2960336c04975a04.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
怎么处理不同环境的差异，可以参考这里：&lt;a class="link" href="https://medium.com/@uwaisalqadri/manage-project-environment-in-kotlin-multiplatform-mobile-528847c3bfc5" target="_blank" rel="noopener"
># Manage Project Environment in Kotlin Multiplatform Mobile&lt;/a>&lt;/p>
&lt;h2 id="ios">IOS
&lt;/h2>&lt;p>要跑在 iOS 上还需要一些跨端的配置。&lt;/p>
&lt;h3 id="kotlin-共用模块编译">Kotlin 共用模块编译
&lt;/h3>&lt;p>我们在 composeApp 里面写了不少跨端用的代码，在 &lt;code>iosApp/&lt;/code> 这个目录下是没有相关东西的，需要有一个编译的过程，把这些代码编译成 Xcode 能识别并处理的 iOS 代码（swift）。&lt;br>
有两种方法来配置编译脚本，具体可以参考这里：&lt;a class="link" href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-integrate-in-existing-app.html#connect-the-framework-to-your-ios-project" target="_blank" rel="noopener"
>Make your Android application work on iOS&lt;/a> ，下面简单讲解下：&lt;br>
1、一是手动&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/720c1908479bfd532143a11319c339a4.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;/p>
&lt;ul>
&lt;li>双击项目名，然后进入 &lt;code>Build Phases&lt;/code> Tab，点加号，添加一个 &lt;code>Run Script&lt;/code>，添加：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$SRCROOT&lt;/span>&lt;span class="s2">/..&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./gradlew :composeApp:embedAndSignAppleFrameworkForXcode
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>然后把顺序拖到上面这里：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/ea53970b00a8070dd98d9afc061f4187.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;/li>
&lt;li>不过，JDK 11 从 11.0.3 开始商用收费，如果在内部业务使用也要购买许可证：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/0a8e90a2af180b831f72a183de9c9203.webp"
width="600"
loading="lazy"
alt="|600"
>&lt;br>
所以还是得用 OpenJDK，我试了下，是兼容的。安装可以看这里：[[JDK 怎么安装]]。&lt;/li>
&lt;li>另外也要设置下 sandboxing&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/df8e47732e837d1448d5c38676d61d8c.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;br>
2、用插件&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/cf83f28ecdf0cd79fa2428b7fe2fe7c5.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;/li>
&lt;li>安装完之后，其它就自动帮你设置了一个 Build Script 在上文提到的 &lt;code>Build Phases&lt;/code> 里：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/888bf5edebab276ef39aad2b4333d580.webp"
width="700"
loading="lazy"
alt="|700"
> - 这里选择的那两行是我加的，因为运行时它找不到 JDK，如果你也遇到这个问题也可以这么解决。&lt;br>
配置好后，可以点击 Xcode 右上角的编译按钮触发一次编译，我第一次试，编译了近 2 分钟：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/7c99ac5c4b0ae67a218530c73582ac60.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;/li>
&lt;/ul>
&lt;h3 id="使用公共模块">使用公共模块
&lt;/h3>&lt;p>很简单，把 &lt;code>ComposeApp&lt;/code> 引入就行，这样里面我们写的方法就都可以用了。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/c4ab964094083a97810d18b06dc0508e.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;/p>
&lt;h1 id="参考">参考
&lt;/h1>&lt;ul>
&lt;li>&lt;a class="link" href="https://www.jetbrains.com/help/kotlin-multiplatform-dev/multiplatform-upgrade-app.html#create-api-requests" target="_blank" rel="noopener"
>Share more logic between iOS and Android | Kotlin Multiplatform Development Documentation&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Daily Meditations - W52</title><link>https://www.jsongo.top/articles/meditations-w52/</link><pubDate>Wed, 25 Dec 2024 23:25:18 +0800</pubDate><guid>https://www.jsongo.top/articles/meditations-w52/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/0b2412e8fae47001461d7b73f3127e2d.jpg" alt="Featured image of post Daily Meditations - W52" />&lt;blockquote>
&lt;p>这两周都在看吴军的新书《脉络》，从书中我读出他有点凯文凯利的一面。一些比较大的命题，他能举重若轻地用一两句简单的总结，表达出一些一针见血的见解。让人感悟深刻。&lt;/p>
&lt;/blockquote>
&lt;h1 id="整个社会的视角">整个社会的视角
&lt;/h1>&lt;blockquote>
&lt;p>也有点经济学的思维&lt;/p>
&lt;/blockquote>
&lt;h2 id="时不时的去放弃一些东西">时不时的去放弃一些东西
&lt;/h2>&lt;p>只保留生活必需品。&lt;br>
其实，对大多数人来讲，很多东西并没有太大的存在必要，却对别人很重要。适当的舍弃或捐献或许能提升社会资源的利用率和价值。&lt;br>
买的东西也不一定要选择退货，也可以把它捐掉，一方面商家可能拿到后也是扔掉，反而是对资源的浪费，自己还蒙受了损失；另一方面，这能反向地约束自己，敦促自己买东西前要三思、想清楚真正需要再下手。&lt;br>
对我来说，家里有很多书，也有很多很久没用的东西，这些其实占了我满大空间，但如果我把它们捐掉或送给有需要的人，我甚至都不需要那么大的空间来存放，给自己腾出一些地方来。&lt;/p>
&lt;h2 id="人们对社会的贡献可能是正数也可能是负数">人们对社会的贡献，可能是正数、也可能是负数
&lt;/h2>&lt;p>我们如果以贡献最终值来衡量的话（正 + 负），那些名人的贡献不一定比我们多，因为他们除了做了很多有用的事之外，也做了很多影响很大的坏事，这些使得他们的贡献总量可能为负。&lt;br>
比如，几年前中国的共享单车在竞争这个市场的时候，完全是在浪费社会资源，如果只有那么一两家在相互竞争、相互促进，不断的强大和发展，为社会众人解决最后 1 公里的交通问题，那是没啥问题的，但是百来家这真的有点浪费社会资源，还搞得到处被自行车堵得乱糟糟的。&lt;/p>
&lt;h2 id="这个世界缺少长期主义者">这个世界缺少长期主义者
&lt;/h2>&lt;p>人类在生理上天生就有一个缺陷，就是喜欢即时反馈和鼓励，不太喜欢等待。&lt;br>
要解决社会上任何需要时间的问题，靠得住的其实不是某个政治家或领导，而是能够盈利的商业，只有在有利可图时，人们才有动力去做，如果能适当的引导让大家往好的方向去竞争，问题解决的效率会是最高。&lt;br>
吴军说，正是因为很多人迷信所谓的“历史巨变”、“人生转折”，才把原来非常广阔的道路留给了极少数长期主义者。&lt;/p>
&lt;h1 id="共识">共识
&lt;/h1>&lt;h2 id="教育的作用">教育的作用
&lt;/h2>&lt;p>较好的教育，除了简单的在知识上、逻辑上能够有所增进之外，还要学会如何更好的运用知识。&lt;br>
更重要的是教育能够教会人学习，它搭建起了我们和人类思想之间的桥梁的，我们学会了更多的去思考如何高效地获取更多、更好的知识，以及如何把知识更好的变成生产力，去丰富生活，以及为社会做贡献。&lt;br>
以前我们会以为离开的学校就解放了，不用再学习了，但其实那只是一个开始。&lt;br>
在学校只是学到了基础和方法论，上了社会就要不断的完善和充实自己，没法躺平，共同富裕也不是让你躺平，因为人总要挣钱、生活，躺平了就等着饿死。这个社会在飞速的发展，如果没有很好的学习能力，很难在未来活的很好。现在的努力，更多地是在为未来做储备，而不只是去解决现在的问题，要不然就跟有了这顿、没有下顿的古代平民没太大区别。&lt;/p>
&lt;h2 id="有些财富建立在共识之上">有些财富建立在共识之上
&lt;/h2>&lt;p>比如“房价还会继续涨”，这个共识让房价一直保持着高价。&lt;br>
在中国，这个观念是几千来农耕/封建历史养成的，形成了人们的“家”的观念，大家共同的信仰。不过这个事也不是完全牢不可破的，万一某一代人因为巨大的压力不敢再持有这种信仰的时候，房价就会慢慢的下滑。&lt;br>
比特币经常大波动，特别是乱世的时候疯狂地涨或跌，是因为一直有些人持有“无国界”货币的观念，而且人也不少，他们形成了种共识，共同推动着虚拟币的涨跌。而更多参与的人，是在陪玩，他们没有坚定的信念，经常就是眼馋或想着快速致富，跟投资房地产没有本质上的不同。&lt;/p>
&lt;h1 id="回到这本书">回到这本书
&lt;/h1>&lt;p>脉络这本书前面的章节主要就是在讲过去的历史，很多跟我们认知都不太一样。过去没有我们想象的那么美好，而且我们经常会去美化历史，但实际上过去的盛世真正只占历史的 1/3 都不到，大部分时候都是兵荒马乱。&lt;br>
最开始的章节也讲到，现代人的生活水平其实大部分都是工业革命之后才飞速发展起来的。那么长的农耕时代，其实并没有对现代生活贡献多少，社会的整体生产力一直没有得到什么发展，而工业革命给整个人类社会带来了非常迅猛的技术和财富的增长。&lt;br>
之后比较长的篇幅在讲工业革命及之后的一些观点，很有意思。看到上面这些介绍，相信有的人会开始对这本书有所兴趣，总之它让我看到了凯文凯利的影子，这或许也是吴军当时想写出来的效果。&lt;/p></description></item><item><title>用 Cursor 开发未知语言代码</title><link>https://www.jsongo.top/articles/coding-with-cursor/</link><pubDate>Wed, 25 Dec 2024 21:16:20 +0800</pubDate><guid>https://www.jsongo.top/articles/coding-with-cursor/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/a7f752e124242dcebca6f80af1173db0.jpeg" alt="Featured image of post 用 Cursor 开发未知语言代码" />&lt;h1 id="概述">概述
&lt;/h1>&lt;h2 id="一句话总结">一句话总结
&lt;/h2>&lt;p>Cursor 对于研发来说，是一个非常有用的提效工具。一句话来总结 Cursor 就是：&lt;/p>
&lt;div class="admonition tip">
&lt;div class="details-summary admonition-title">
&lt;i class='icon fas fa-lightbulb fa-fw'>&lt;/i>
提示&lt;br
&lt;/div>&lt;/div>
&lt;div class="details-content">
&lt;div class="admonition-content">
&lt;p>语言、语法不再重要，Cursor 可以把思路和逻辑很好的翻译成代码，但开发者的还是要设计好整个项目的研发框架和方案，然后指挥工具干活。&lt;br>
开发 KMP 跨端框架的代码，开始时我不懂它的 Kotlin 语法；开发完之后，我依然还不懂怎么写 Kotlin，但不影响我实现相关的功能。&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>&lt;h2 id="感受">感受
&lt;/h2>&lt;blockquote>
&lt;p>cursor 有点像 code review 的交互：&lt;/p>
&lt;/blockquote>
&lt;p>&lt;img src="https://cdn.lyb.pub/2025/01/4673799a9001151d68a5ceb7f9de9d51.webp"
loading="lazy"
alt="001aadc69264ca248e71eeee340a33ff_MD5|0|700x316"
>&lt;br>
开发时的感受也确实像 Code Review，只不过多了一个“yes or no”的选择操作。认可这个修改点它旁边的 Accept 按钮，觉得不对，就 “Reject”。&lt;/p>
&lt;h2 id="本文-case-说明">本文 Case 说明
&lt;/h2>&lt;p>本文中，我们以 Coze OpenAPI 的 SDK 开发为例，目前（2024.12） 已经有 JS、Python、Java 版的 SDK 了，不过还是有用户提了其它语言的诉求，我们只有前后端，所以这时 Cursor 成了我们开发多种语言版本的 SDK 的有力助手。&lt;br>
不过不管是什么语言，第一件事，都是先搭环境，把最简单的该语言 Hello World 跑起来。对习惯 JS/Go/Python 的同学来说，可能觉得这不是个问题，但当你遇到 Java、Kotlin、Android、iOS 等这些语言时，准备环境经常是一个很麻烦的事。&lt;/p>
&lt;blockquote>
&lt;p>小建议：&lt;br>
如果遇到了一些新框架的话，还得跟着 Quick Start 跑一下，不要着急、上来就想要结果。&lt;br>
在 KMP 的项目中，这一点让我感触颇深。开始花了挺多时间踩坑，后来发现其实 Quick Start 里都有，KMP 前些天刚升级 3.0 之后，很多玩法都不一样了，网上的很多代码都跑不起来（Cursor 生成的代码还都基于老的框架写，训练数据就是这样），折腾半天没结果，第二天发现，还不如抽几分钟把 Quick Start 跑一下，问题全解了。&lt;/p>
&lt;/blockquote>
&lt;h2 id="cursor-agent-composer">Cursor Agent (Composer)
&lt;/h2>&lt;p>Cursor 刚出的 agent 比之前简单的 Chat 强不少。之前的 Chat 它记不住太远的上下文，多问几轮，最开始的问题它会重复地犯错。&lt;br>
简单的讲：&lt;/p>
&lt;ul>
&lt;li>Cursor Chat：帮助开发者理解代码片段、提供代码优化建议、协助查找代码错误或者回答关于特定编程语言和框架的一般性问题；&lt;/li>
&lt;li>Cursor Agent：更全面，首先可以让 Agent 读取整个项目文件，快速掌握项目的主要功能和关键文件，也能同时操作多个文件，根据需要增删改，甚至还能对整个项目做分析，帮你优化项目结构等。&lt;br>
下面例子中 大都基于 Composer 来实现的。下图是一个简单的例子：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/4eda348bfcc4a6e8a603326467a6840f.webp"
loading="lazy"
alt="1145cf430e1f015e5a552747f0f4a7c7_MD5|500|500x503"
>&lt;/li>
&lt;/ul>
&lt;h1 id="cursor-基于代码生成代码的基本步骤">Cursor 基于代码生成代码的基本步骤
&lt;/h1>&lt;p>&lt;img src="https://cdn.lyb.pub/2025/01/c9e05dbfde43c7dbb0f8f24909166b6c.webp"
loading="lazy"
alt="|700x102"
>&lt;/p>
&lt;h2 id="1先把相应的目录结构建好">1、先把相应的目录结构建好
&lt;/h2>&lt;p>因为不同的语言，代码组织的习惯和方式都不太一样。要做的第二件事，是先把代码结构先想清楚，然后发给 AI 问下比较合理的结构是什么样。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/0469fa103c6ebb26a2747e1491292465.webp"
loading="lazy"
alt="011aee5c56b4b53497b5d789c0fbeffb_MD5|500|700x169"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/0f0fef12795483bddb7e3d4bf5ffa74e.webp"
loading="lazy"
alt="4ed11244d635908bdf3aaffee68c1db6_MD5|400|0x0"
> &lt;img src="https://cdn.lyb.pub/2025/01/71d3277a1c9450424f1175f05714cbd9.webp"
loading="lazy"
alt="56695bc97506c77d525a8b7a30786162_MD5|250|250x619"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/34125f9d5d186efc995f3f421e8ea716.webp"
loading="lazy"
alt="3562669265f694cc8e5a37537570e387_MD5|600|600x525"
>&lt;br>
最后我调整了下，改成上文最后那张图。&lt;/p>
&lt;h2 id="2实现第一个-demo">2、实现第一个 Demo
&lt;/h2>&lt;p>在我们的例子中，首先要解决的是不同语言里的请求方法不一样，先选一个最简单的请求来跑通流程。&lt;br>
把 js 里的请求代码找出来，帮 cursor 圈出来（加到上下文里），然后让它实现一个 Kotlin 的请求。&lt;/p>
&lt;blockquote>
&lt;p>当时让 Cursor 改了好几版都不能用，主要问题还是在于 KMP 这东西比较新，3.0 又做了大改，引用的包得去做下排列组合。后来在官方文档里找到了 3.0 的正确姿势发请求，把它丢给 Cursor，这时它才写出了正确的请求。&lt;br>
然后找到最基础的模块，比如本例中我选了 Chat 相关的接口，跑通非 Stream 模式比较简单，所以作为第一个接入。实现后，再研究了下 Kotlin 里怎么实现 SSE（这个 cursor 死活写不出正确的来），也跑通之后，一个模块算是比较完整了。&lt;/p>
&lt;/blockquote>
&lt;h2 id="3把这套模块复制到其它模块中">3、把这套模块复制到其它模块中
&lt;/h2>&lt;p>第二个模块选择了 &lt;strong>Auth&lt;/strong> &lt;strong>模块&lt;/strong>，用它来验证第一个模块用到的通用方法是否可迁移。&lt;br>
首先是让 Cursor 把&lt;strong>请求模块的代码&lt;/strong>抽出来，做成一个通用的请求基类，其它模块继承它就行。把这个思路告诉 Cursor，让它改好后，进入下一步：把 JS 的 auth.ts 代码加入到 Context 中，在相应的目录下新建一个 Auth.kt 的 kotlin 模块，告诉 Cursor &lt;!-- raw HTML omitted -->把 auth 的逻辑从 ts 翻译成 kotlin&lt;!-- raw HTML omitted -->。&lt;br>
写完后，再在 Demo 文件夹里创建一个 Auth 的 &lt;strong>Demo 文件&lt;/strong>，让 Cursor 仿照 Chat 的 Demo 把 Auth 里的方法都用起来、去生成一个 Auth Demo。这步也做完后，进入第四步。&lt;br>
到 App 界面中去添加按钮，绑定 Demo，去触发它的方法，验证刚的代码是否可行。&lt;br>
这一步是最费时间的，因为第一版基本都不行，到处有问题，需要不断的试、不断的 fix bug。好在这些操作也可以让 Cursor 来做。&lt;/p>
&lt;h2 id="4都开发完之后发包写文档开源">4、都开发完之后，发包、写文档、开源……
&lt;/h2>&lt;p>这个就不展开了，不是重点，不同语言也不一样，讲这个意义不大。&lt;/p>
&lt;h1 id="完整例子">完整例子
&lt;/h1>&lt;p>&lt;strong>让&lt;/strong> &lt;strong>Cursor&lt;/strong> &lt;strong>帮我写&lt;/strong> &lt;strong>Auth&lt;/strong> &lt;strong>模块的代码&lt;/strong>。&lt;br>
背景：我把 Coze API SDK 代码从 JS 迁移到 Kotlin，里面有很多个模块。之前已经实现了 Chat 模块的 API，这次实现 Auth 模块。代码也是不少、而且有点分散。&lt;/p>
&lt;h2 id="初步生成">初步生成
&lt;/h2>&lt;p>找到主入口文件，这个例子中，是 &lt;code>auth.ts&lt;/code> ，我把它加入到 Context 里。另外我自己也创建了一个文件在特定的目录里，把它也加到 Context 里（Kotlin 的代码结构组织跟 JS 还是有比较大的区别，下面再讲），这个文件让 Cursor 创建也行，只不过我还得给他描述路径/位置，还不如直接点“+”就创建了。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/1b108415bafc10678d91c7888802cb53.webp"
loading="lazy"
alt="600b7d39aa5a96c84d23b1409c0e1eac_MD5|0|700x383"
>&lt;br>
其中 auth.ts 只是一个入口文件，它涉及到很多相关的类和函数等，定义在其它文件，所以我在 prompt 里告诉它要把相关的定义都搬过去。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/86f176619ca75c5a4777eac559dfdf55.webp"
loading="lazy"
alt="414f29730ce41fba0d1bbc12407f4a87_MD5|0"
>&lt;br>
一下子写了 361 行，里面涉及到很多个方法都需要一个个验证，这个后面说。截图中可以看到，它还问我们要不要把一些相关的函数搬过来，让它继续。然后又给我搬了几百行过来，之后发现有一些依赖库缺失，所以问我是否要加到 gradle 配置里：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/83a947616392ee8d6a6dffb361e7b387.webp"
width="600"
loading="lazy"
alt="571c38e14c2b4c8c21c66b5194d2c0a1_MD5|600"
>&lt;/p>
&lt;h2 id="解决小问题">解决小问题
&lt;/h2>&lt;p>在上面这个地方就遇到了问题，它认为我其它文件里的逻辑可能没有用，直接大段大段地删除我原本的代码，如 Http.kt，&lt;code>auth.ts&lt;/code> 里用到了一个封装过的 HTTP 请求，所以在引入的时候，它找到我原来的 HTTP 请求的封装直接改了它。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/09954d7c01331cac66d6c52fd36252b6.webp"
width="800"
loading="lazy"
alt="205dc1e6d24d761c009260ac8cae8bb2_MD5|800"
>&lt;br>
这种事要能多盯着点、注意下可能的问题，及时补救，引导 Cursor 去修正。&lt;br>
一些小问题，在采用它的代码时，稍微留意下：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/3ae3a5bf297f7eda62ed740f33c619f4.webp"
width="800"
loading="lazy"
alt="b240a1222ec78b5b5382fdbbf75ea0e2_MD5|800"
>&lt;br>
再比如这种写法一看就感觉有点问题：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/568a319a389daad0a61def5e22073059.webp"
width="800"
loading="lazy"
alt="1116262183daa190d5cb3cc88895d884_MD5|800"
>&lt;br>
追问下，它就会纠正过来了：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/58c18e5e8bf2848a5561f5dd99d07c71.webp"
width="800"
loading="lazy"
alt="74847ffb18466f90a2d6c6ee88d114ac_MD5|800"
>&lt;br>
另一个比较大块的问题是，它生成完可能是有一些包引入问题的，因为它只有局部信息，缺少全局的，会犯像重复定义这样的错。而且可能有一堆 import 问题等着你解决，比如下面这个例子：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/1ea57a695273330b3ed5dd5661554b66.webp"
width="700"
loading="lazy"
alt="49ec0378de615efc9371ecab36f0c033_MD5|700"
> &lt;img src="https://cdn.lyb.pub/2025/01/d69d33cc46da8ae71cff9d95535d1e7a.webp"
width="700"
loading="lazy"
alt="aa7d0534cf5f6fc17177f5c45d157e25_MD5|700"
>&lt;br>
&lt;strong>重复定义&lt;/strong>。&lt;br>
左边这个截图里的 RequestOptions，其实我已经在其它地方定义过了，但它又重新定义了一次，造成了多个地方冲突。这种情况也可以把问题描述给 Cursor 让它解决，但我看问题不大直接就手动合并了下这两个定义。&lt;br>
右边的截图中，跨端涉及到 Android 的包安装，开发过 Java 的同学都知道，这个有点麻烦，得找到合适的包添加到 library 里才行。这个也只能手动去做，因为过程有点麻烦：&lt;/p>
&lt;blockquote>
&lt;p>另外，两个截图都是 Android Studio 里的，在 Cursor 上是没有报相关的异常，而前者是专门为开发 KMP 定制的 IDE，它能找到更深层次的异常。所以我开两个 IDE，一个写代码，一个改 Bug。&lt;/p>
&lt;/blockquote>
&lt;h2 id="对接">对接
&lt;/h2>&lt;p>经过一系列操作，终于能正常跑起来了，但只能说&lt;strong>写完了&lt;/strong>。接下去是更麻烦的事情，我们调试 JWT Auth，在 Android 里 Cursor 建议用 &lt;code>com.auth0.jwt&lt;/code> 这个包，代码它也帮写好了，但运行时，接口一直返回签名错误，接下来就要一个字段一个字段的比对。&lt;br>
这里难免就要去打印过程中的每个数据，比如加密的 Payload、几个 key、algorithm、timestamp 等，用 JS 也跑一个、&lt;strong>打印出来，做下对比&lt;/strong>，看哪个字段有问题。&lt;br>
改完后，还是签名错误。参数对了，但还是不行，那就是算法问题，接下去核对了下 Base64 encode 的地方、RSA 算出的数据跟 JS 的跑出来是否一致。这里发现了问题，但没有头绪。&lt;br>
这时，死马当活马医，让 cursor 再帮我检查一遍：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/85a79b192ec91ca09d2fa5c60f3a996e.webp"
loading="lazy"
alt="037c1ba6aa4295b45bc15c1a7a930e5d_MD5|800|800x175"
> &lt;img src="https://cdn.lyb.pub/2025/01/307e4e2a0ab807513480c86855068e19.webp"
width="700"
loading="lazy"
alt="1512af0b52ab204e684d567bc9c2b510_MD5|700"
>&lt;br>
看起来似乎是喂给算法的数据格式有问题（虽然数据都是对的），Cursor 实现了一个 toMap 的方法对原来的代码做了个转化，但这次代码跑不起来，重新让它改了一版，这下居然拿到正确的返回了。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/4ae11c7b01875dd3c0fab873498c6b90.webp"
width="700"
loading="lazy"
alt="ca3cf6410c6eafc5a7566ed550156a83_MD5|700"
>&lt;br>
返回解析失败，序列化的问题，不过是小问题，让它改完后，这次真的拿到了：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/cd181081d32b5a238a808949013c280e.webp"
width="800"
loading="lazy"
alt="bace8e15ef5ddc1d884a2b7da0919947_MD5|800"
>&lt;br>
就这个过程，搞了一个多小时。&lt;/p>
&lt;blockquote>
&lt;p>所以其实 Cursor 更像是一个帮程序员写简单代码、改 Bug 的一个辅助工具，在我们这个场景中，不太可能一次性把所有的代码从 TS 转过来，然后一次性成功。都得一个个调试。&lt;/p>
&lt;/blockquote>
&lt;h1 id="还能做什么">还能做什么
&lt;/h1>&lt;p>过程中发现，还有一些事情可以交给 Cursor，能解决的很好。&lt;/p>
&lt;h2 id="1整理代码变得更整洁些">1、整理代码，变得更整洁些
&lt;/h2>&lt;p>有一招简单的小技巧，可以让 Cursor 帮你整理下代码（至少看起来不像刚入门的人写的水平）：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/ed005e1d1081f932d31c31ae426b6f24.webp"
width="700"
loading="lazy"
alt="3c5dbaed0244273f9faac47623a5c284_MD5|700"
>&lt;br>
以及：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/d72c40dd0185031bddc7b1ca07d1ecdf.webp"
width="700"
loading="lazy"
alt="64f0e1e71796b58da1d0939017c89c96_MD5|700"
>&lt;br>
Prompt:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-text" data-lang="text">&lt;span class="line">&lt;span class="cl">把代码改得极其整洁，风格保持一致，能简化的处理下，但同一行不要太多字符。注释的话，不合理的注释可以删掉，但也不要随便删，同时把中文的注释翻译成英文
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="2解决拼写问题">2、解决拼写问题
&lt;/h2>&lt;p>比如这个 README，我们研发同学写的比较匆忙，有比较多的拼写或表达上的问题，https://github.com/coze-dev/coze-java/pull/3/files ，用 cursor 一键完成修改，重点是它能发现 README 里的示例代码中，用的字段名不正确的问题：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/a2a57432caf6934023aca6188eb999b2.webp"
loading="lazy"
alt="67eef2544216d5bc05746b5e1f26b2b5_MD5|800|800x465"
> &lt;img src="https://cdn.lyb.pub/2025/01/90d987a8fead9f2db45c1afd91824e58.webp"
width="700"
loading="lazy"
alt="09bbb3747c1a278eef3f672f204c3f79_MD5|700"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/55496ca31ffb05f169c550e905810115.webp"
width="700"
loading="lazy"
alt="41011b38b591252aea92768c14e304c2_MD5|700"
>&lt;/p>
&lt;h2 id="3批量修改小问题">3、批量修改小问题
&lt;/h2>&lt;p>遇到问题比较多的时候，直接截图，丢给 cursor，它会一个个帮你改。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/ae4af222ea296426b04ddd084b1ddfd0.webp"
width="500"
loading="lazy"
alt="f77a083c5ee957658f80d19e5582c6f1_MD5|500"
> &lt;img src="https://cdn.lyb.pub/2025/01/2b61dce38f2bd6f806ffc42af1da764b.webp"
width="500"
loading="lazy"
alt="4afb655c9393f474cadb8c0f6f4241b5_MD5|500"
>&lt;br>
还有一个技巧是，让它参考其它同类的代码来实现：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/406acbce7072a3e2cadf3a5c6ebe34da.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
以及：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/8e6d7d1522cd199bba69fd23f96b799d.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
还有一次给我引入了 java 包，在 common 里：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/3c13e95894243029f6d9878688fa5b47.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;br>
不太合理，这时就要让他修正下，同时我也丢给它一个 KMP 官方给的参考，让它照着改，这总不会再弄错吧。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/a4a4c7a782729d0a708fbd710c1dd048.webp"
width="600"
loading="lazy"
alt="|600"
>&lt;/p>
&lt;blockquote>
&lt;p>下面的例子，是我开发另一个 Coze 插件时遇到的，顺便都整合到这个文档里、不单独拆开了。&lt;/p>
&lt;/blockquote>
&lt;h2 id="4强有力的工具logging">4、强有力的工具：logging
&lt;/h2>&lt;p>&lt;img src="https://cdn.lyb.pub/2025/01/efb2c1134ac77e7c50e5248f01c62265.webp"
width="500"
loading="lazy"
alt="05b5da00f57db097cdb439b39e55cfdb_MD5|500"
>&lt;br>
我连续让它改了很多次（不下 10 次），它也换了好几种实现方法，都不行。后来我提示他是否需要再加一些打印来定位问题，然后他发现确实应该这样。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/53f82d55f491285c2ee9132dd69636db.webp"
width="500"
loading="lazy"
alt="35c347109c19e7421b89c2ff4a705ed0_MD5|500"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/f18aa994a02b7255bed74408f76f80fc.webp"
width="500"
loading="lazy"
alt="accbaf51486af45cdbec970b93dbeb8e_MD5|500"
>&lt;/p>
&lt;blockquote>
&lt;p>语气也变得更客气，本来一直说“我”，这次改了称呼“我们”，仿佛在说这是我们的共同成果&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>用这个技巧可以极大的提升问题修复的速度。当然如果你的代码都是在 cursor 里跑的、输出也在它的 terminal 里，那会更方便一些。我的场景是，代码在 serverless runtime 里运行，本地只是为了让 cursor 来改代码。&lt;/li>
&lt;/ul>
&lt;h2 id="5思考并引导">5、思考并引导
&lt;/h2>&lt;p>有的时候，Cursor 掉坑里去了，试了一二十次了，都不太行。后来我想到一个重要的信息，给他补充了下，结果不到 5 次就跑起来了，方向对了。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/be8fdee4ad64d56b435aab0e2ceb9ac4.webp"
width="500"
loading="lazy"
alt="9a7218f4b8ab4400b9a059cca2dfbea6_MD5|500"
>&lt;/p>
&lt;blockquote>
&lt;p>这从里来看，Cursor 并不能让完全不懂代码的人来写出各种复杂的逻辑，甚至一些看似简单、但潜藏着很多细节的功能，他们也很难很难搞定。&lt;strong>所以广大程序员，暂时还能松一口气&lt;/strong>。&lt;/p>
&lt;/blockquote>
&lt;h2 id="6及时给反馈有时能有些惊喜">6、及时给反馈，有时能有些惊喜
&lt;/h2>&lt;p>&lt;img src="https://cdn.lyb.pub/2025/01/964e3bd7d40baea9275703a22dba7fb4.webp"
width="500"
loading="lazy"
alt="4c72cba33e74267f72c6e802ba14b6ff_MD5|500"
>&lt;br>
然后 blabla 跟我说了一堆，它会把之前几次尝试为什么没成功、这次为什么成功了，给你做个总结。很有意思。&lt;/p>
&lt;h1 id="过程记录">过程记录
&lt;/h1>&lt;h2 id="kmp-sse-遇到的一些坑">KMP SSE 遇到的一些坑
&lt;/h2>&lt;p>1、SSE 以前是用外部库，到了 3.0 之后，官方原生支持了，其它方案试了下没通。&lt;br>
2、iOS 跑 SSE 会抛错：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-SQL" data-lang="SQL">&lt;span class="line">&lt;span class="cl">&lt;span class="n">Uncaught&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Kotlin&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">exception&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">io&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">ktor&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">client&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">plugins&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">sse&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="n">SSEClientException&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Exception&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">in&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">http&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">request&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Error&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">Domain&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">NSURLErrorDomain&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">Code&lt;/span>&lt;span class="o">=-&lt;/span>&lt;span class="mi">1200&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;An SSL error has occurred and a secure connection to the server cannot be made.&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>跟豆包“交流”了几回后，她终于找到问题点了，我改了下配置果然就可以了：&lt;br>
&lt;a class="link" href="https://www.doubao.com/thread/w18b43c12a58af46c" target="_blank" rel="noopener"
>https://www.doubao.com/thread/w18b43c12a58af46c&lt;/a>&lt;br>
简单说就是打开 Info.plist 添加：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-XML" data-lang="XML">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;key&amp;gt;&lt;/span>NSAppTransportSecurity&lt;span class="nt">&amp;lt;/key&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;dict&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;key&amp;gt;&lt;/span>NSAllowsArbitraryLoads&lt;span class="nt">&amp;lt;/key&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;true/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;key&amp;gt;&lt;/span>NSExceptionDomains&lt;span class="nt">&amp;lt;/key&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dict&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;key&amp;gt;&lt;/span>api.coze.com&lt;span class="nt">&amp;lt;/key&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;dict&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;key&amp;gt;&lt;/span>NSExceptionAllowsInsecureHTTPSLoads&lt;span class="nt">&amp;lt;/key&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;true/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;key&amp;gt;&lt;/span>NSExceptionMinimumTLSVersion&lt;span class="nt">&amp;lt;/key&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;string&amp;gt;&lt;/span>TLSv1.2&lt;span class="nt">&amp;lt;/string&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;key&amp;gt;&lt;/span>NSExceptionRequiresForwardSecrecy&lt;span class="nt">&amp;lt;/key&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;false/&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dict&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;lt;/dict&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nt">&amp;lt;/dict&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>原因主要是：iOS 系统默认信任一系列常见的证书颁发机构（CA）所颁发的证书，但如果服务器使用的是比较小众或者自签名的证书，iOS 设备可能不会自动信任它。上面把 &lt;code>NSExceptionAllowsInsecureHTTPSLoads&lt;/code> =&amp;gt; true，&lt;code>NSExceptionRequiresForwardSecrecy&lt;/code> =&amp;gt; false。&lt;/p>
&lt;h2 id="语言框架带来的麻烦">语言框架带来的麻烦
&lt;/h2>&lt;p>开发 KMP 比较麻烦的点是，它动不动就炸 💥💥💥：&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/75eb7e325f7128c528fbfb128db05263.webp"
width="800"
loading="lazy"
alt="bf7c2bde8023209700897ad92f5412cd_MD5|800"
>&lt;br>
Git diff 看不到任何区别，后来查了下，是环境上的包冲突，一不小心装了版本冲突的包就会出问题。版本的匹配关系还有人专门做了个表：https://github.com/realm/realm-kotlin#version-compatibility-matrix 但还是不全，真遇到了问题还是得多试，没啥技术含量。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/01/191bc2fd51984c29da43d5c355562e7b.webp"
width="500"
loading="lazy"
alt="e3c399703cd2afa57208ac3c424603f2_MD5|500"
>&lt;br>
上面这个异常，试了很久都没解决（可能是我对 Kotlin 环境不熟悉），后来干脆重建一个目录，把代码原样的 clone 过去，再重新用 Android Studio 加载、编译，居然就好了…… 不知道 Java 类语言的开发者，平时要花多少时间在环境和包依赖上，这些纯属无产出的事情。&lt;/p></description></item><item><title>蓝牙 &amp; wifi - 隔墙传播衰减数据</title><link>https://www.jsongo.top/articles/ble-wifi-decays-through-wall/</link><pubDate>Wed, 25 Dec 2024 01:06:18 +0800</pubDate><guid>https://www.jsongo.top/articles/ble-wifi-decays-through-wall/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/437965e93ce93d3c2ca0ebac98d54619.jpeg" alt="Featured image of post 蓝牙 &amp; wifi - 隔墙传播衰减数据" />&lt;h1 id="基础">基础
&lt;/h1>&lt;h2 id="发射功率的大概认知">发射功率的大概认知
&lt;/h2>&lt;ul>
&lt;li>一般家用 &lt;strong>Wifi&lt;/strong> 的发射功率在 13 ~ 20dBm 左右&lt;/li>
&lt;li>一般&lt;strong>蓝牙&lt;/strong>设备的发射功率范围一般在 -30dBm ~ 20dBm 之间
&lt;ul>
&lt;li>常见的蓝牙设备，如蓝牙耳机、蓝牙音箱等，发射功率通常在 0 - 4dBm 左右，蓝牙耳机发射功率可能在 0dBm 左右&lt;/li>
&lt;li>长距离传输的蓝牙模块，发射功率可能会接近 20dBm&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="换算">换算
&lt;/h2>&lt;ul>
&lt;li>在中国，无线路由器发射功率一般不超过 100mW（毫瓦）。功率（P）与分贝毫瓦（dBm）的换算公式为：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/b4371d0440c37ebc53e0c2329eb832b0.webp"
width="400"
loading="lazy"
alt="|400"
>&lt;/li>
&lt;li>对于 100mW 的发射功率，换算后约为 20dBm&lt;/li>
&lt;/ul>
&lt;h1 id="分贝-db-估算">分贝 (dB) 估算
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>混凝土墙&lt;/strong>
&lt;ul>
&lt;li>蓝牙，信号强度降低 10 - 20dB 左右&lt;/li>
&lt;li>Wifi，2.4GHz 强度可能会降低 10 - 20dB，5GHz 降低 15 - 30dB 左右 &lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>砖墙&lt;/strong>
&lt;ul>
&lt;li>蓝牙，信号强度降低 3 - 10dB 左右&lt;/li>
&lt;li>Wifi，单堵普通砖墙会使 2.4GHz 强度降低 5 - 12dB 左右，5GHz 降低 8 - 15dB 左右&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>木板墙和石膏板墙&lt;/strong>
&lt;ul>
&lt;li>蓝牙，强度降低一般在 1 - 3dB 左右&lt;/li>
&lt;li>Wifi，2.4GHz 大概降低 1 - 3dB 左右，5GHz 大概降低 2 - 4dB 左右&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="距离估算">距离估算
&lt;/h1>&lt;ul>
&lt;li>空旷环境下
&lt;ul>
&lt;li>蓝牙，10 米&lt;/li>
&lt;li>Wifi，2.4GHz 一般室内可达 30 - 50 米左右，5GHz 频段的一般 15 - 30 米左右&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>隔了一堵&lt;strong>砖墙&lt;/strong>后
&lt;ul>
&lt;li>蓝牙，有效传输距离可能会缩短到 3 - 7 米&lt;/li>
&lt;li>Wifi，2.4GHz 频段的 WiFi 信号传输距离可能缩短到 10 - 30 米，5GHz 可能缩短到 5 - 15 米&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>隔了&lt;strong>混凝土墙&lt;/strong>后
&lt;ul>
&lt;li>蓝牙，有效传输距离可能进一步缩短到 1 - 5 米&lt;/li>
&lt;li>Wifi，2.4GHz 频段有效传输距离一般在 5-15 米左右，而 5GHz 仅为 3-10 米左右。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h1 id="应用">应用
&lt;/h1>&lt;p>房间布局比较复杂的情况下，测算 Wifi 的覆盖是比较有用的。&lt;/p>
&lt;ul>
&lt;li>先画出房间的布局图，标注出哪些是砖墙、混凝土墙，标明各房间大概的长宽等&lt;/li>
&lt;li>标出 Wifi 的位置（或可以摆放的地方一个个试），往同样环境的地方画圆（扇形），都是空旷的话就是整个圆，如果被墙隔开则分两部分画，多种墙隔着则再拆分更细来画&lt;/li>
&lt;li>没覆盖到的地方、或者只在最后一米的地方，信息肯定很差，这时要再想想哪里能挂个中继器&lt;br>
另外，蓝牙网关也是一种场景，测算方式差不多。&lt;/li>
&lt;/ul>
&lt;h1 id="其它">其它
&lt;/h1>&lt;p>对于 Wifi 来说，WiFi 协议会根据信号强度和质量自动调整传输速率。例如，在信号良好的情况下，可能达到理论上的高速传输速率，如 802.11ac 标准下的几百 Mbps 甚至更高。但当信号减弱后，传输速率可能会降低到几十 Mbps 甚至更低。&lt;/p>
&lt;hr>
&lt;h1 id="footnotes">Footnotes
&lt;/h1>&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>5GHz 频段的信号波长更短，更容易被障碍物阻挡&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>Cron 表达式</title><link>https://www.jsongo.top/articles/cron-syntax/</link><pubDate>Wed, 18 Dec 2024 00:55:38 +0800</pubDate><guid>https://www.jsongo.top/articles/cron-syntax/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/91668e623e452ebc624daa105d2f82c2.jpg" alt="Featured image of post Cron 表达式" />&lt;p>平时工作中，可能会时不时碰到像 &lt;code>0 */5 * * * *&lt;/code> 这种 Cronjob 定时任务的配置，特别是运维和服务端的同学，经常会打交道。本文只是最基础的用法，后面有新内容再补充，仅作为自己学习、记录、备忘的文档沉淀下。&lt;/p>
&lt;h1 id="基础语法">基础语法
&lt;/h1>&lt;h2 id="cron-表达式的基本格式和含义">Cron 表达式的基本格式和含义
&lt;/h2>&lt;ul>
&lt;li>Cron 表达式用于配置定时任务的执行时间。它由 6 ~ 7 个段组成，从左到右依次是：秒（0 - 59）、分（0 - 59）、时（0 - 23）、日（1 - 31）、月（1 - 12）、周（0 - 6，0 表示周日）。&lt;/li>
&lt;li>上面提到的表达式 &lt;code>0 */5 * * * *&lt;/code> 中，有 6 个字段，一一对号入座就行。&lt;/li>
&lt;li>除了直接写 &lt;code>*&lt;/code>、&lt;code>*/数字&lt;/code> 、&lt;code>数字&lt;/code>，这种写法之外，还有用逗号隔开的写法，如第 4 个位置表示一个月中的哪一日，如果它写成 &lt;code>1,3,5&lt;/code> 表示每个月的 1 日、3 日和 5 日。&lt;/li>
&lt;/ul>
&lt;h2 id="对每个字段的具体分析-">对每个字段的具体分析 **
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>秒（0）&lt;/strong>：表示任务在每分钟的第 0 秒开始执行。&lt;/li>
&lt;li>&lt;strong>分（*/5）&lt;/strong>：&lt;code>*/5&lt;/code> 是一个特殊的语法。在这里，&lt;code>*&lt;/code> 表示 “所有可能的值”，&lt;code>/&lt;/code> 是一个间隔符号。所以 &lt;code>*/5&lt;/code> 表示 “每隔 5 分钟”。也就是说，任务会在 0 分、5 分、10 分、15 分…… 以此类推，每隔 5 分钟执行一次。&lt;/li>
&lt;li>&lt;strong>时（*）&lt;/strong>：&lt;code>*&lt;/code> 表示每一个小时，即任务会在一天中的每一个小时都有可能执行，具体的分钟由前面的 &lt;code>*/5&lt;/code> 决定。&lt;/li>
&lt;li>&lt;strong>日（*）&lt;/strong>：&lt;code>*&lt;/code> 表示一个月中的每一天，即任务在一个月中的每一天都有可能执行。这是第 4 个位置，它有一些特定的语法，如：
&lt;ul>
&lt;li>&lt;code>L&lt;/code>：表示每月的最后一天。&lt;/li>
&lt;li>&lt;code>W&lt;/code>：用于指定最接近给定日期的工作日（周一到周五），如“15W”，它表示最接近 15 日的工作日。&lt;/li>
&lt;li>&lt;code>LW&lt;/code>：合起来，用于指定本月的最后一个工作日。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>月（*）&lt;/strong>：&lt;code>*&lt;/code> 表示每一个月，即任务在每一个月都有可能执行，具体日期由前面的日、时、分决定。&lt;/li>
&lt;li>&lt;strong>周（*）&lt;/strong>：&lt;code>*&lt;/code> 表示每一个周，即任务在每一周都有可能执行，这个比较特殊，也可以省略而只需要前面 5 个也行。&lt;br>
开头说的这个配置，含义是在每分钟的第 0 秒开始，并且每隔 5 分钟执行一次，每天每小时、每月都会按照这个间隔执行。简单说，就是 &lt;strong>5 分钟执行一次&lt;/strong>。
&lt;div class="admonition summary">
&lt;div class="details-summary admonition-title">
&lt;i class='icon fas fa-pencil-alt fa-fw'>&lt;/i>
简单好记&lt;br
&lt;/div>&lt;/div>
&lt;div class="details-content">
&lt;div class="admonition-content">
&lt;p>一个比较简单的方法来记，就是把 &lt;code>*&lt;/code> 翻译成“&lt;strong>每&lt;/strong>”，把 &lt;code>/&lt;/code> 翻译成“&lt;strong>每隔&lt;/strong>”，非 &lt;code>*&lt;/code> 的则对应地加上时间表达即可。&lt;br>
另一个方法是，从后往前倒着看，比如只看前三个，它就是时间的表达，像 1:00:00&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>&lt;/li>
&lt;/ul>
&lt;h1 id="使用">使用
&lt;/h1>&lt;p>下面举一些例子，尽量全地覆盖可能用到的场景：&lt;/p>
&lt;ol>
&lt;li>&lt;strong>每 5 秒执行一次&lt;/strong>
&lt;ul>
&lt;li>表达式：&lt;code>*/10 * * * * *&lt;/code>&lt;/li>
&lt;li>解释：在秒的位置上 &lt;code>*/10&lt;/code> 表示每隔 10 秒。上面介绍过这类基础的用法。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>每小时的第 10 分钟执行&lt;/strong>
&lt;ul>
&lt;li>表达式：&lt;code>0 10 * * * *&lt;/code>&lt;/li>
&lt;li>解释：分的位置是 10，秒是 0，表示每小时的第 10 分钟开始时执行。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>每天凌晨 2 点执行&lt;/strong>
&lt;ul>
&lt;li>表达式：&lt;code>0 0 2 * * *&lt;/code>&lt;/li>
&lt;li>解释：时为 2，分和秒为 0，表示每天凌晨 2 点整执行。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>每隔 2 小时执行一次&lt;/strong>
&lt;ul>
&lt;li>表达式：&lt;code>0 0 */2 * * *&lt;/code>&lt;/li>
&lt;li>解释：时的位置 &lt;code>*/2&lt;/code> 表示每隔 2 小时执行。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>每月 1 号凌晨 0 点执行&lt;/strong>
&lt;ul>
&lt;li>表达式：&lt;code>0 0 0 1 * *&lt;/code>&lt;/li>
&lt;li>解释：日为 1，时、分、秒为 0，表示每月 1 号凌晨 0 点执行。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>每周一早上 9 点执行&lt;/strong>
&lt;ul>
&lt;li>表达式：&lt;code>0 0 9 * * 1&lt;/code>&lt;/li>
&lt;li>解释：时为 9，分和秒为 0，周为 1（周一），即每周一早上 9 点执行。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>每月最后一天晚上 11 点 59 分 59 秒执行&lt;/strong>
&lt;ul>
&lt;li>表达式：&lt;code>59 59 23 L * *&lt;/code>&lt;/li>
&lt;li>解释：秒为 59，分是 59，时是 23，日的位置 &lt;code>L&lt;/code> 表示每月最后一天。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>每年 1 月 1 日凌晨 0 点执行&lt;/strong>
&lt;ul>
&lt;li>表达式：&lt;code>0 0 0 1 1 *&lt;/code>&lt;/li>
&lt;li>解释：日为 1，月为 1，时、分、秒为 0，表示每年 1 月 1 日凌晨 0 点执行。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>工作日（周一到周五）早上 8 点执行&lt;/strong>
&lt;ul>
&lt;li>表达式：&lt;code>0 0 8 * * 1-5&lt;/code>&lt;/li>
&lt;li>解释：时为 8，分和秒为 0，周为 1-5，表示周一到周五早上 8 点执行。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol></description></item><item><title>Azure Function Triggers</title><link>https://www.jsongo.top/articles/azure-function-triggers/</link><pubDate>Wed, 18 Dec 2024 00:42:33 +0800</pubDate><guid>https://www.jsongo.top/articles/azure-function-triggers/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/54ae9a6d9d56a2e58c20dc50f584fd39.jpg" alt="Featured image of post Azure Function Triggers" />&lt;h1 id="触发器各类">触发器各类
&lt;/h1>&lt;p>Azure Function 有多种模板，我们在创建 Function 时，一般会用 &lt;code>--template&lt;/code> 参数要指定用哪个模板。详细的可以参考官方文档：&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings" target="_blank" rel="noopener"
>Triggers and bindings in Azure Functions | Microsoft Learn&lt;/a> 或中文版 &lt;a class="link" href="https://learn.microsoft.com/zh-cn/azure/azure-functions/functions-triggers-bindings?tabs=isolated-process,node-v4,python-v2&amp;amp;pivots=programming-language-csharp" target="_blank" rel="noopener"
>Azure Functions 中的触发器和绑定 | Microsoft Learn&lt;/a>。&lt;br>
以下是一些常见的：&lt;/p>
&lt;h2 id="基于事件触发的模板">基于事件触发的模板
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>Azure Blob Storage Trigger&lt;/strong>：当 Azure Blob 存储中的 Blob 被创建、更新或删除时触发函数。例如，可以在有新文件上传到指定 Blob 容器时，自动触发函数进行数据处理或文件转换等操作。&lt;/li>
&lt;li>&lt;strong>Azure Event Hubs Trigger&lt;/strong>：用于接收来自 Azure Event Hubs 的事件流消息，可实现对实时数据的处理。例如，在物联网场景中，接收设备发送的大量实时数据进行分析和处理。&lt;/li>
&lt;li>&lt;strong>Azure Service Bus Trigger&lt;/strong>：可以响应来自 Azure Service Bus 队列或主题的消息，支持批量接收消息。适用于处理异步消息传递场景，如订单处理、消息通知等。&lt;/li>
&lt;/ul>
&lt;h2 id="基于数据存储的模板">基于数据存储的模板
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>Azure Cosmos DB Trigger&lt;/strong>：使用 Azure Cosmos DB 的变更 feed 来监听分区中的插入和更新操作，当有数据发生变化时触发函数，可用于实时数据同步等场景。&lt;/li>
&lt;li>&lt;strong>Azure SQL Database Trigger&lt;/strong>：当 Azure SQL 数据库中的表发生数据插入、更新或删除操作时触发函数，方便进行数据的关联操作和业务逻辑处理。&lt;/li>
&lt;/ul>
&lt;h2 id="基于定时任务的模板">基于定时任务的模板
&lt;/h2>&lt;p>除了 Timer Trigger 外，还有一些定时任务相关的模板或扩展，如支持按照特定时间间隔或 cron 表达式来定期执行函数，可用于定时数据备份、报表生成等任务 。&lt;/p>
&lt;h2 id="基于-http-请求的模板">基于 HTTP 请求的模板
&lt;/h2>&lt;p>除了常见的 HTTP Trigger 外，还有一些针对特定 HTTP 场景的模板或扩展，如支持接收和处理来自 Webhook 的 HTTP 请求，可用于与第三方系统进行集成，接收外部系统推送的数据或事件。&lt;/p>
&lt;h2 id="其他模板">其他模板
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>PowerShell Trigger&lt;/strong>：允许使用 PowerShell 脚本编写函数逻辑，方便系统管理员或熟悉 PowerShell 的开发人员进行自动化脚本编写和任务调度。&lt;/li>
&lt;li>&lt;strong>Python Trigger&lt;/strong>：使用 Python 语言编写函数逻辑，适用于数据科学、机器学习等场景，可方便地调用 Python 库进行数据处理和分析。&lt;/li>
&lt;/ul>
&lt;h1 id="实践">实践
&lt;/h1>&lt;h2 id="timer-trigger">Timer Trigger
&lt;/h2>&lt;p>Http trigger 在 &lt;a class="link" href="azure%20serverless.md" >azure serverless&lt;/a> 中介绍过了。这里再讲一下 Timer Trigger，在做定时任务时非常有用，而且计费也只是按函数的执行时间来计，比较划算。&lt;br>
详细使用可以参考官方文档：&lt;a class="link" href="https://learn.microsoft.com/zh-cn/azure/azure-functions/functions-bindings-timer?tabs=python-v2,isolated-process,nodejs-v4&amp;amp;pivots=programming-language-python" target="_blank" rel="noopener"
>Azure Functions 的计时器触发器 | Microsoft Learn&lt;/a> 。&lt;br>
跟创建普通的 Azure Function 一样，还是用 CLI 的 new 命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">func new --name xxx --template &lt;span class="s2">&amp;#34;timer trigger&amp;#34;&lt;/span> --authlevel &lt;span class="s2">&amp;#34;function&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>它会在你的 &lt;code>function_app.py&lt;/code> 里创建一个新的 function：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="nd">@app.timer_trigger&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">schedule&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;0 */10 * * * *&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">arg_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;timer&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">run_on_startup&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">use_monitor&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">False&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">my_polling&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">timer&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">func&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">TimerRequest&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">-&amp;gt;&lt;/span> &lt;span class="kc">None&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">timer&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">past_due&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;The timer is past due!&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">logging&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">info&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;Python timer trigger function executed.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>@app.timer_trigger 里的几个参数：&lt;/p>
&lt;ul>
&lt;li>schedule：语法跟 cronjob 的配置一样，参考：&lt;a class="link" href="https://www.jsongo.top/articles/cron-syntax/" target="_blank" rel="noopener"
>Cron 表达式&lt;/a>。&lt;/li>
&lt;li>arg_name：表示计时器对象的变量的名称，没啥特别含义，就是随便定个名字能用就行。&lt;/li>
&lt;li>run_on_startup：部署完、或重新启用时，它自动触发一次。&lt;/li>
&lt;li>use_monitor：是否被 monotor 记录，如果间隔大于 1 分钟，建议设置为 true。&lt;br>
其中， &lt;code>func.TimerRequest&lt;/code> 这个参数，其实就只有 &lt;code>past_due&lt;/code> 这个 boolean 类型的属性。&lt;br>
&lt;code>past_due&lt;/code> 用于判断当前定时器触发的任务是否已经逾期：&lt;/li>
&lt;li>当定时任务由于某些原因（例如系统负载高、资源暂时不可用等）未能在预定的时间点执行，后面才被触发时，&lt;code>mytimer.past_due&lt;/code> 将为 &lt;code>True&lt;/code>。&lt;/li>
&lt;li>如果定时任务在预定时间内正常执行，那么 &lt;code>mytimer.past_due&lt;/code> 将为 &lt;code>False&lt;/code>&lt;br>
现在 &lt;code>my_polling&lt;/code> 函数里，我们可以添加一些对其它 Azure Function 的调用，由此来处理其它任务的定时执行。这样由两个触发器配合来完成特定任务。当然把逻辑全与在 Timer Trigger 里也不是不行，只不过解耦开之后，Http Trigger 还能被单独使用。&lt;/li>
&lt;/ul></description></item><item><title>git 恢复误删笔记or文件</title><link>https://www.jsongo.top/articles/git-recover-notes/</link><pubDate>Tue, 17 Dec 2024 23:34:22 +0800</pubDate><guid>https://www.jsongo.top/articles/git-recover-notes/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/6424b2c83ab269ea18c2240356db3b9d.jpg" alt="Featured image of post git 恢复误删笔记or文件" />&lt;p>自从改用 Obsidian 来做笔记后，再也不怕文件丢失了，特别是我有了 git 来管理文件后，不小心删掉一些文件也都能找回来，即使是 100 天前删除的都行，非常方便。&lt;/p>
&lt;div class="admonition tip">
&lt;div class="details-summary admonition-title">
&lt;i class='icon fas fa-lightbulb fa-fw'>&lt;/i>
为什么用 git 管理？同步软件不行吗&lt;br
&lt;/div>&lt;/div>
&lt;div class="details-content">
&lt;div class="admonition-content">
&lt;p>我试过用 Obsidian 官方的，但我的笔记增长太快了（最近一直在迁移以前的笔记），一个月就增长 1G，所以买官方的服务太贵了，而且还有一个更重要的原因：文件经常会莫名其妙地被覆盖，而我完全没办法，可以看到一些历史，但很麻烦，得一个个点开找，可以说不太可用。&lt;br>
其实 git 是最完美的版本管理工具，非常丰富的命令可以实现各种操作、满足各类诉求。下面讲讲我是怎么找回我的文件&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>&lt;h1 id="主要方法">主要方法
&lt;/h1>&lt;p>文件不小心删掉了要找回来是比较常见的，比如我装的 &lt;code>clear unused images&lt;/code> 插件，经常有些不知名的原因删我的图片。开始我还一个一个 commit 找，效率实在太低了，其实 git 是支持从 log 里找的，命令也不难。比如我今天不小心删掉了某个文件，现在我想恢复，我明确知道是今天删的（因为昨天还没有这个图片贴的那个文档），所以我就从今天开始搜索，很快：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git log --since&lt;span class="o">=&lt;/span>midnight -- 74a006c91c5150f0d9d9dd25d5c5ab34.webp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>找到有哪些 commit 操作了这个文件，然后再用 git show 命令来看当时做了哪些操作：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git show 5b12e80a540539b0da2ac75cf4d5e7221f2b7342 -- 74a006c91c5150f0d9d9dd25d5c5ab34.webp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>结果：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/95c7302d5fa881834bb45c88c8115cb2.webp"
width="725"
loading="lazy"
alt="|725"
>&lt;br>
可以看到，当时把这个文件给删掉了。再往上看，可以找到第一条 commit，这就是它创建的那个提交，还能看到是什么时候提交的：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/861fa74e3155d6e84b9e6ffba287e05e.webp"
width="725"
loading="lazy"
alt="|725"
>&lt;br>
最后就是恢复文件，直接用 &lt;code>git checkout&lt;/code> 命令就行：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git co c171a4c169470455fa8ac62fd8d4164ea677c8ec -- 2c579673c6b2f0793f2e423523cc6fe3.webp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="扩展">扩展
&lt;/h1>&lt;h2 id="时间范围">时间范围
&lt;/h2>&lt;p>上文讲 git log，它其实有很多指定时间范围的参数，刚刚用了 since midnight (非常语义化、好理解)，也可以指定要几天前。另外还有一个 &lt;code>--util&lt;/code> 参数，用法跟 since 一样，这两个参数可以办公室一个范围，比如大前天的文件变更情况，可以用：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git log --since&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;3 days ago&amp;#34;&lt;/span> --until&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;2 days ago&amp;#34;&lt;/span> -- &amp;lt;filename&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>此外还有两个类似的参数：after（=since）、before（=until），记住一组就行。&lt;/p>
&lt;h2 id="时间写法">时间写法
&lt;/h2>&lt;p>上文涉及到：&lt;code>midnight&lt;/code>、&lt;code>3 days ago&lt;/code> 这两种，都是直接用英文表达的。做个汇总：&lt;/p>
&lt;ul>
&lt;li>相对日期：&lt;code>--since=&amp;quot;3 days ago&amp;quot;&lt;/code>&lt;/li>
&lt;li>绝对日期：&lt;code>--since=&amp;quot;2024-10-01&amp;quot;&lt;/code> 或具体到时间，如 &lt;code>2024-10-01 12:00&lt;/code>&lt;/li>
&lt;li>时间戳（秒）：&lt;code>--since=1633046400&lt;/code>&lt;/li>
&lt;li>自然语言时间，主要有：
&lt;ul>
&lt;li>&lt;code>yesterday&lt;/code>&lt;/li>
&lt;li>&lt;code>today&lt;/code>&lt;/li>
&lt;li>&lt;code>midnight&lt;/code>：今天的午夜&lt;/li>
&lt;li>&lt;code>noon&lt;/code>：今天的中午&lt;/li>
&lt;li>&lt;code>teatime&lt;/code>：今天的下午 4 点&lt;/li>
&lt;li>&lt;code>last week&lt;/code>&lt;/li>
&lt;li>&lt;code>last month&lt;/code>&lt;/li>
&lt;li>&lt;code>last year&lt;/code>&lt;/li>
&lt;li>&lt;code>last christmas&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>组件表达，非常强大，举几个例子：
&lt;ul>
&lt;li>&lt;code>3 days ago 14:00&lt;/code>&lt;/li>
&lt;li>&lt;code>2 weeks ago midnight&lt;/code>&lt;/li>
&lt;li>&lt;code>last friday&lt;/code>&lt;/li>
&lt;li>&lt;code>last year december 31 23:59&lt;/code>&lt;/li>
&lt;li>&lt;code>new year's eve 2022&lt;/code>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>Azure Function + Mysql 入门</title><link>https://www.jsongo.top/articles/azure-serverless-mysql/</link><pubDate>Mon, 16 Dec 2024 13:39:37 +0800</pubDate><guid>https://www.jsongo.top/articles/azure-serverless-mysql/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/0dba76ff89c558a40825ce7e7a507005.jpg" alt="Featured image of post Azure Function + Mysql 入门" />&lt;blockquote>
&lt;p>在 Azure Function 上使用 mysql DB，具体可以参考：&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-bindings-azure-mysql?tabs=isolated-process&amp;amp;pivots=programming-language-python" target="_blank" rel="noopener"
>Azure Database for MySQL bindings for Functions | Microsoft Learn&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h1 id="mysql-申请">Mysql 申请
&lt;/h1>&lt;h2 id="免费额度">免费额度
&lt;/h2>&lt;p>免费用户其实还是有不少额度可以使用：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/31a8630222aa9b38aa0c6bedb54fb61e.webp"
width="650"
loading="lazy"
alt="|650"
>&lt;br>
详细可以阅读：&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/mysql/flexible-server/how-to-deploy-on-azure-free-account" target="_blank" rel="noopener"
>Try Out With an Azure Free Account - Azure Database for MySQL - Flexible Server | Microsoft Learn&lt;/a>&lt;/p>
&lt;ul>
&lt;li>简单说，可以支持 B1MS 实例一直在线上跑，有 32G 的存储空间。B1MS 有 1~2 个 CPU 微核&lt;/li>
&lt;/ul>
&lt;h2 id="添加一个实例">添加一个实例
&lt;/h2>&lt;ul>
&lt;li>打开：[[https://portal.azure.com/#browse/Microsoft.DBforMySQL%2Fservers]]，点 &lt;code>Quick Create&lt;/code>。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/a1e23752568d6a93c878dcf2864d5a30.webp"
loading="lazy"
>&lt;/li>
&lt;li>简单填写下信息就行：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/4fee17d9e7f06b0c894723a5a2cc1c18.webp"
loading="lazy"
>&lt;/li>
&lt;li>下一步、创建，等几分钟就创建成功了：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/aab8b78c940e753bc5de50a461d49053.webp"
loading="lazy"
>&lt;/li>
&lt;/ul>
&lt;h1 id="简单使用">简单使用
&lt;/h1>&lt;h2 id="手动连接">手动连接
&lt;/h2>&lt;p>在本地默认是连接不上的， azure 为了安全，对访问做了限制，可以通过 zero trust 网络来接入，当然也可以简单的设置下网络、放行你的 ip：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/da949ffb37dbb360bb9e563577f2adf8.webp"
loading="lazy"
>&lt;br>
不过其实还有更简单的方式，直接在页面上打开连接：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/34cdbaccec72321f854ea1da97fac0b4.webp"
loading="lazy"
>&lt;br>
连接时，它会弹出一个 terminal，然后自动运行 mysql 命令进行连接。实际上，这个时候还连不上，即使你密码输入正确了也不行，它需要验证证书（也是为了安全）。&lt;br>
证书可以从这里下载：[[https://learn.microsoft.com/zh-cn/azure/mysql/flexible-server/how-to-connect-tls-ssl#download-the-public-ssl-certificate]] ，或者直接用我下图中的 wget 命令即可。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/de4826c732a4f7e2e09f0280c58246a3.webp"
width="725"
loading="lazy"
alt="|725"
>&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">wget https://dl.cacerts.digicert.com/DigiCertGlobalRootCA.crt.pem
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>需要注意的是，直接连接 Mysql 进行操作比较危险，可以应急用，不建议当成常规操作。&lt;/p>
&lt;h2 id="操作">操作
&lt;/h2>&lt;p>刚创建的 MySQL 服务里面是空的，得自己手动创建一个 database：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-sql" data-lang="sql">&lt;span class="line">&lt;span class="cl">&lt;span class="k">create&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">database&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">xxx&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后就可以切到这个 db 上使用了：&lt;code>use xxx&lt;/code>。&lt;/p>
&lt;h2 id="mac-上连接">Mac 上连接
&lt;/h2>&lt;p>如果是在 mac 上安装 mysql 客户端的话，用 brew install 会非常慢，直接到这个地址上去下载一个客户端：&lt;a class="link" href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener"
>Download MySQL Community Server&lt;/a>&lt;/p></description></item><item><title>免费的花生壳 - cloudflared</title><link>https://www.jsongo.top/articles/build-a-cloudflared-tunnel/</link><pubDate>Sun, 15 Dec 2024 16:03:07 +0800</pubDate><guid>https://www.jsongo.top/articles/build-a-cloudflared-tunnel/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/f53c5884b5505531f32ad8fa0fc57247.jpg" alt="Featured image of post 免费的花生壳 - cloudflared" />&lt;div class="admonition note">
&lt;div class="details-summary admonition-title">
&lt;i class='icon fas fa-pencil-alt fa-fw'>&lt;/i>
花生壳&lt;br
&lt;/div>&lt;/div>
&lt;div class="details-content">
&lt;div class="admonition-content">
&lt;p>一般我们习惯用花生壳来实现内网穿透，不过花生壳本身是要收钱的，它的域名也要收钱，流量也收一次钱，而且给了钱之后它的流量带宽也受到限制，正常是 1M 带宽下载速度只有 100 多 k，用起来很难受，加点带宽就要加不少钱。而且每个月还有总流量限制，经常用了半个月就不行了，非常痛苦。&lt;/p>
&lt;/div>
&lt;/div>
&lt;/div>&lt;p>其实 cloudflare 本身就提供了一个免费的 cloudflared 的 tunnel 工具，直接下载运行就行。如果用 Docker 的话可以用这个镜像：&lt;a class="link" href="https://hub.docker.com/r/cloudflare/cloudflared" target="_blank" rel="noopener"
>hub.docker.com/r/cloudflare/cloudflared&lt;/a> 里面也有一些简单的指引。&lt;/p>
&lt;h1 id="简单使用">简单使用
&lt;/h1>&lt;p>一条命令就可以搞定：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cloudflared tunnel --no-autoupdate --hello-world
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>不过这么跑，比较依赖于不需要 Cloudflare 帐户的公共 trycloudflare.com，很不稳定，我之前试用过，经常断，网速也不稳定。要实际上线使用的话，还是得自己注册一个 cloudflare 账号，下面介绍。&lt;/p>
&lt;h1 id="搭建个人-tunnel-网络">搭建个人 Tunnel 网络
&lt;/h1>&lt;h2 id="注册一个-tunnel">注册一个 Tunnel
&lt;/h2>&lt;p>到 &lt;a class="link" href="https://dash.teams.cloudflare.com/%e2%81%a0" target="_blank" rel="noopener"
>Cloudflare One&lt;/a> 上注册一个 Cloudflare Zero Trust 域名，选 Free 就可以了&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/420352862a7523747b97d596ff767b81.webp"
loading="lazy"
alt="|675|0x0"
>&lt;br>
接下去它会让你绑定一个支付卡，即使选的是免费的。这是海外各类服务的常见操作，因为收费计划可能会变，而且你使用时也可能会超额，所以先让你把扣费的方式留好，以备后面需要的时候能扣到钱。&lt;br>
注册完后，下面我们来一步步创建一个 tunnel，其实过程也很简单。&lt;/p>
&lt;blockquote>
&lt;p>这些是一步步摸索出来的，没有参考其它外部的指引，所以可能会有更好的办法。希望有读者找到更好的方法时，能给我留个评论，感激不尽。&lt;/p>
&lt;/blockquote>
&lt;h2 id="创建-tunnel">创建 Tunnel
&lt;/h2>&lt;p>在下图中的菜单里找到创建的地方，选 Cloudflared。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/5b690dff91048eeaeb5663f168c837a2.webp"
width="875"
loading="lazy"
alt="|875"
>&lt;br>
自己取一个名字（不跟别人重复就行）&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/8652218a31d2d78c56aa4f0a43edcf8d.webp"
width="900"
loading="lazy"
alt="|900"
>&lt;br>
下一步，取得 token：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/29b1a001c14459ba21b349c12cb4288d.webp"
width="925"
loading="lazy"
alt="|925"
>&lt;br>
如上图，划线处就是你的 token，先记下来，下面用。&lt;/p>
&lt;h2 id="启动接入">启动、接入
&lt;/h2>&lt;p>创建完之后，在本地运行 cloudflared 的命令：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cloudflare tunnel --no-autoupdate run --token xxx
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果使用 docker 的话，可以用这个 compose yml&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="nt">version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;3.8&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">services&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cloudflared&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cloudflare/cloudflared:latest&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">container_name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">cloudflared&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">tunnel --no-autoupdate run --token xxxx&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">restart&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">unless-stopped&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">network_mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">host&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dns&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="m">1.1.1.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>其中，xxx 换成你自己的 token。&lt;br>
如果你家里有个服务器或 NAS，其实 docker 是比较合适的，它可以一直在线跑。&lt;br>
创建完之后，在同一个界面里可以看到已经有一个设备连接上来了：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/3c23fd4e318bb3198e69dd369ed24c29.webp"
width="725"
loading="lazy"
alt="|725"
>&lt;br>
再下一步，public hostnames 里添加一个你转到 cloudflare 来解析的域名，加一个子域名。同时 Service 填写你内网的某个服务的地址，如你的 nginx 网关等。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/0e9d6a0c0afadbd8100b681aab58a962.webp"
width="875"
loading="lazy"
alt="|875"
>&lt;br>
再下一步就回到了列表页，可以看到你的 tunnel 已经在跑了：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/f39e1282f64410a6862142f136b7108b.webp"
width="850"
loading="lazy"
alt="|850"
>&lt;br>
回到你的 cloudflare DNS 配置页面，可以看到它帮你添加了一个 CNAME，说明已经成功了&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/292affb6bfeac40389684bb915b7bce0.webp"
width="875"
loading="lazy"
alt="|875"
>&lt;br>
&lt;a class="link" href="https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/routing-to-tunnel/dns/" target="_blank" rel="noopener"
>DNS records · Cloudflare Zero Trust docs&lt;/a> 这条 CNAME 的规则是：&lt;code>&amp;lt;Tunnel ID&amp;gt;.cfargotunnel.com&lt;/code> ，这个 Tunnel ID 可以在上方的截图中找到。所以手动配置也行。
现在你可以用刚配置的域名来访问你的内网服务了。网速很快。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/7063c449ce57a9dfa970e2e9c6916d9e.webp"
width="750"
loading="lazy"
alt="|750"
>&lt;/p>
&lt;h2 id="优化网络连接">优化网络连接
&lt;/h2>&lt;p>如果你的服务需要耗时比较久，比如 git 服务，有时你拉内容的时候都要好几分钟，那就需要设置连接和超时时长了。&lt;br>
在上面我们配置 publish hostname 时，下方其实还有高级配置，如下图位置：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/321e5240cb520e8f255d0afad7893609.webp"
loading="lazy"
alt="|725|725x580"
>&lt;br>
调整下 timeout 的时长（默认 30s），超过 30 秒就自动关闭链接了，所以这个地方可以适当调大一些。&lt;/p>
&lt;h2 id="header">Header
&lt;/h2>&lt;p>&lt;img src="https://cdn.lyb.pub/upic/1744470864_fTcwVf.png"
loading="lazy"
>&lt;/p></description></item><item><title>azure serverless 使用</title><link>https://www.jsongo.top/articles/azure-serverless/</link><pubDate>Sat, 14 Dec 2024 01:33:06 +0800</pubDate><guid>https://www.jsongo.top/articles/azure-serverless/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/9f2713cc4890d8cf0449df9f4877fa26.jpg" alt="Featured image of post azure serverless 使用" />&lt;h1 id="基础工具">基础工具
&lt;/h1>&lt;p>Mac 上直接装：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">brew tap azure/functions
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">brew install azure-cli
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">brew install azure-functions-core-tools@4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">brew link --overwrite azure-functions-core-tools@4
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;blockquote>
&lt;p>具体可以参考这里：&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-run-local?tabs=macos,isolated-process,node-v4,python-v2,http-trigger,container-apps&amp;amp;pivots=programming-language-csharp" target="_blank" rel="noopener"
>Develop Azure Functions locally using Core Tools | Microsoft Learn&lt;/a>&lt;/p>
&lt;ul>
&lt;li>另外，这链接里也有怎么用命令行来创建的方法。下文 vscode 插件和 CLI 都会涉及。&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h1 id="vscode-插件">Vscode 插件
&lt;/h1>&lt;p>参考这个：&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/create-first-function-vs-code-python?toc=/azure/developer/python/toc.json&amp;amp;bc=/azure/developer/python/breadcrumb/toc.json" target="_blank" rel="noopener"
>Create a Python function using Visual Studio Code - Azure Functions | Microsoft Learn&lt;/a>&lt;/p>
&lt;h2 id="简介">简介
&lt;/h2>&lt;p>在 vscode 中安装插件：Azure Functions&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/fb2e0acc105d63d085c40bdd1920f6a2.webp"
width="425"
loading="lazy"
alt="|425"
>&lt;br>
切到这个插件去点击添加一个函数，一步步往下都有说明，比较简单。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/ea7349816d01aa7f064eebb26475e767.webp"
width="300"
loading="lazy"
alt="|300"
>&lt;br>
我选了 HTTP 触发器的模板，最后给我生成了这个文件：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/92942fa30fb661c19c1901c6df0f73ee.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;/p>
&lt;h2 id="调试运行">调试运行
&lt;/h2>&lt;p>简单的运行，可以用插件面板上，下半部分中的 Project 展开，里面有个调试相关的操作（它可点击）。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/b1f01eb135df433a4a2f8b9e91904dbb.webp"
width="850"
loading="lazy"
alt="|850"
>&lt;br>
它会先做一些安装，然后启动 function，IDE 进入 debug 模式。这时主要运行的命令是：&lt;code>func host start&lt;/code>，直接在命令行里运行这个命令也可以启动本地调试运行。但如果你想查询代码中打的日志，一定要记得加上 &amp;ndash;verbose 的参数，所以正确的使用姿势是：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">func host start --verbose
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>本地调试时，其实已经默认把 AZURE_FUNCTIONS_ENVIRONMENT 这个变量设置为 &lt;code>Development&lt;/code> 了，如果你修改代码，它会触发服务的重启，非常方便。&lt;br>
它同时生成一个链接可以直接点击，它会触发函数执行：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/fe3b5f734dbe003a59b09c561687bf88.webp"
width="650"
loading="lazy"
alt="|650"
>&lt;/p>
&lt;h1 id="创建">创建
&lt;/h1>&lt;p>用 IDE 插件进行 function 创建上面已经介绍过来了，比较简单，不过读者可能会遇到网络问题而没法往下尝试。这里再介绍下 CLI 的方式来创建。&lt;br>
先初始化目录：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">func init --python
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>它会生成一些基础的配置文件，包括  [[https://learn.microsoft.com/en-us/azure/azure-functions/functions-develop-local#local-settings-file]]  和  &lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/functions-host-json" target="_blank" rel="noopener"
>&lt;em>host.json&lt;/em>&lt;/a>。&lt;br>
创建一个 api 入口：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="k">func&lt;/span> &lt;span class="n">new&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">name&lt;/span> &lt;span class="n">combine_videos&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">template&lt;/span> &lt;span class="s2">&amp;#34;HTTP trigger&amp;#34;&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">authlevel&lt;/span> &lt;span class="s2">&amp;#34;function&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Authlevel 有三个值：&lt;/p>
&lt;ul>
&lt;li>Anonymous 即任何人都可以访问，不需要带什么认证，相当于公开了。&lt;/li>
&lt;li>Function 函数级别的认证，创建的每个函数都得在 URL 上带一个 token 进行认证，参数是 &lt;code>?code=&amp;lt;token&amp;gt;&lt;/code>。&lt;/li>
&lt;li>Admin，最高级别的认证，只有具有管理员权限的用户才能访问函数，适用于包含敏感操作或数据的函数，如修改系统关键配置、访问敏感的业务数据等。这种模式依赖于复杂的身份管理系统（如 AAD）。&lt;/li>
&lt;/ul>
&lt;h1 id="部署">部署
&lt;/h1>&lt;h2 id="平台创建应用">平台创建应用
&lt;/h2>&lt;p>先打开 [[https://portal.azure.com/#browse/Microsoft.Web%2Fsites/kind/functionapp]] 这个 portal 地址，创建一个 &lt;code>Function App&lt;/code> （或者中文叫“函数应用”）。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/8c7facddd451e9fca9cba01e0b045eac.webp"
width="575"
loading="lazy"
alt="|575"
>&lt;/p>
&lt;h2 id="plugin">Plugin
&lt;/h2>&lt;p>正式部署前，肯定是需要先登录的。正常是可以在插件上操作，如下：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/91ce1f913a33cb8ab6d9d64480929b25.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
如果不成功，可以用下文 CLI 的方法来登录。&lt;br>
选择 Deploy to Function App，直接进行部署。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/bda580eaff46be66e6353ae23f839da6.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;br>
我在使用的时候，经常遇到网络问题，因为某些你懂的原因，所以挺难的，得给 vscode 设置 Proxy (具体就不介绍了)&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/628fc45d846b96aa8dd84a59bc7f7ff7.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;/p>
&lt;h2 id="cli-发布">CLI 发布
&lt;/h2>&lt;h3 id="登录">登录
&lt;/h3>&lt;p>使用前也一样需要先登录 (上面的说明都是在本地开发)：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">az login
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>运行时，它会打开一个网页进行登录授权&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/e473747eb42ae1af27de1a51d5d59e94.webp"
width="750"
loading="lazy"
alt="|750"
>&lt;br>
命令行也会有一堆打印，有如下关键信息就说明已经登录成功了。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/6d649277ba0edb949dfeb3bb2f736a94.webp"
width="900"
loading="lazy"
alt="|900"
>&lt;/p>
&lt;h3 id="发布操作">发布操作
&lt;/h3>&lt;p>当然我们也可以选择用 CLI 来做发布：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">func azure functionapp publish &amp;lt;project_name&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>具体细节可以参考这里：&lt;a class="link" href="https://learn.microsoft.com/en-us/azure/azure-functions/create-first-function-cli-python?toc=/azure/developer/python/toc.json&amp;amp;bc=/azure/developer/python/breadcrumb/toc.json&amp;amp;tabs=macos,bash,azure-cli,browser" target="_blank" rel="noopener"
>Create a Python function from the command line - Azure Functions | Microsoft Learn&lt;/a>&lt;br>
这里的 &lt;code>project_name&lt;/code> 跟在平台上创建的应用名要保持一致，要不然会找不到这个 App 而发布失败。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/8ae08faed3138aeebf5aab5a595ebe9e.webp"
width="775"
loading="lazy"
alt="|775"
>&lt;br>
另外还有一点要注意的是，本地的 python 环境需要跟平台上的一致，避免本地跑的好好的、部署上去就缺一些模块：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/d4c8cfd171f834123918d1a99265533f.webp"
width="675"
loading="lazy"
alt="|675"
>&lt;br>
部署完会生成一个地址可供访问：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/3ac8969d54d4b231a0dad35cec82b39c.webp"
width="800"
loading="lazy"
alt="|800"
>&lt;br>
部署的过程是会比较慢，我们从平台的部署日志中可以看到它部署完后，会等待 1 分钟：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/a945e829b9eace8c1a74fb3afdcc9396.webp"
width="750"
loading="lazy"
alt="|750"
>&lt;br>
在线上运行后，可以访问试试。&lt;br>
线上日志可以在这里看到：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/4ca6c0c355611de0c1b3f2c29ca5f0e7.webp"
width="725"
loading="lazy"
alt="|725"
>&lt;br>
不过经常连接不稳定，所以其实可以到另一个地方查看 ：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/be1071dc6f42f0523efb4fcb176d311a.webp"
width="775"
loading="lazy"
alt="|775"
>&lt;/p>
&lt;h1 id="重要插件-azurite">重要插件 Azurite
&lt;/h1>&lt;p>安装另一个三方的 server 运行插件 Azurite，为开发人员提供了一个免费的本地环境，用于测试 Azure Blob、队列存储和表存储应用程序。常用的主要是 MySQL 操作，本地连不上线上 MySQL，它帮你开了一个代理，可以直接把本地调试时写的数据同步到线上。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/02f0caabaf55d3b7cd7d1ae156e1deb3.webp"
width="550"
loading="lazy"
alt="|550"
>&lt;br>
如果没有它，本地如果运行定时任务就是出异常：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/bb208c03b576515896aa151e5a12fa6c.webp"
loading="lazy"
>&lt;br>
修改下 &lt;code>local.settings.json&lt;/code> 的配置，把 &lt;code>AzureWebJobsStorage&lt;/code> 设置成 &lt;code>&amp;quot;UseDevelopmentStorage=true&amp;quot;&lt;/code>。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/f477dc6f98630c7d9911cd2d28eb7ab5.webp"
width="550"
loading="lazy"
alt="|550"
>&lt;br>
打开命令面板，运行 Azurite start 来启动服务&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/e96da6632ab1e656b5bcdb2978135a51.webp"
width="475"
loading="lazy"
alt="|475"
>&lt;br>
这时它们的启动非常快，一闪而过，没关系，它已经在跑了。&lt;br>
比较烦的时，运行时，会在当前目录下生成一些文件：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/d08188a1cf18ec9fc4a3dd1170c2f5e0.webp"
width="450"
loading="lazy"
alt="|450"
>&lt;/p>
&lt;ul>
&lt;li>&lt;em>blobstorage&lt;/em>  和  &lt;em>queuestorage&lt;/em>
&lt;ul>
&lt;li>&lt;strong>作用&lt;/strong>：
&lt;ul>
&lt;li>这些文件夹通常用于存储本地开发时的 Azure Blob 存储和 Azure Queue 存储的模拟数据。当你在本地运行和测试 Azure Functions 时，这些文件夹可以帮助模拟真实的 Azure 存储环境。&lt;/li>
&lt;li>例如，如果你有一个 Azure Function，它从 Blob 存储中读取数据或者向 Queue 存储中写入数据，在本地开发环境中，这些文件夹会存储相关的数据，以便函数能够正常运行和测试。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>使用场景&lt;/strong>：
&lt;ul>
&lt;li>在没有连接到真实 Azure 存储账户的情况下，本地开发和调试函数时需要用到。如果删除这些文件夹，可能会导致本地运行的函数在涉及到 Blob 或 Queue 操作时出现错误，因为它们找不到模拟的存储数据。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>以  &lt;em>azurite_db&lt;/em>  开头的.json 文件
&lt;ul>
&lt;li>&lt;strong>作用&lt;/strong>：
&lt;ul>
&lt;li>这些文件是 Azurite 数据库文件。Azurite 是一个本地的 Azure 存储模拟器，用于在本地模拟 Azure Blob、Queue 和 Table 存储服务。这些.json 文件存储了 Azurite 模拟存储服务的数据结构和数据内容。&lt;/li>
&lt;li>例如，&lt;em>azurite_db_blob&lt;/em>.json 文件用于存储模拟的 Blob 存储数据结构和数据，&lt;em>azurite_db_queue&lt;/em>.json 文件用于存储模拟的 Queue 存储数据等。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>读《不上班咖啡馆》的收获</title><link>https://www.jsongo.top/articles/no-work-cafe/</link><pubDate>Fri, 13 Dec 2024 17:29:08 +0800</pubDate><guid>https://www.jsongo.top/articles/no-work-cafe/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/058b101b8325853cf16210d89529ed82.jpg" alt="Featured image of post 读《不上班咖啡馆》的收获" />&lt;blockquote>
&lt;p>这是这几天在看的一本很有趣的书，有感而发这篇读书笔记&lt;/p>
&lt;/blockquote>
&lt;h1 id="概述">概述
&lt;/h1>&lt;p>买这本书主要是冲着古典老师去的，之前对他的《跃迁》印象深刻，受益匪浅。刚看到书名我就想起了《世界尽头的咖啡馆》前两年还出了续集，我都看了。后来在读本书的时候，感觉就是在看国产的《世界尽头的咖啡馆》，叙述方式很像，内容上也是讲职场和生活，所以阅读起来我有种熟悉的感觉。&lt;br>
这几年经济不好，大家都在职场和创业的路上挣扎，都过得很不容易。随着越来越多人“毕业”，讲人生规划类的书籍或课程必定会大受欢迎。因为大量的城市精英突然就遇到了 10 几年一个周期的经济萧条，上一轮大概率没经历过，这么一来就有点措手不及，人生突然陷入迷茫。&lt;br>
有缘看到这篇文章的人，如果正好自在这个阶段，可以读读上面提到的这 3 本书（《世界尽头的咖啡馆》有两本），相信会有不错的启发。&lt;br>
本文主要摘录我在阅读过程中受到触动，结合自己思考写下来的一些笔记，希望能引发读者一些思考。&lt;/p>
&lt;hr>
&lt;h1 id="思考清楚自己的赛道">思考清楚自己的赛道
&lt;/h1>&lt;h2 id="下班后才是一个打工人最清醒的时刻">下班后才是一个打工人最清醒的时刻
&lt;/h2>&lt;p>全书多次提到这句话，故事中的那个咖啡馆也只有在晚上 9 点后才开门，因为打工人下班了。古典在书中说的这句话，主要想表达，在上班的时候，人容易迷失自己，沉浸在为做好工作而对其它事情浑然不觉的状态中，更不会抽时间去思考自己的现在、做事方式、未来的发展等，一心在做好当下的事。&lt;br>
不过在下班后，就有更多的时间回去“做自己”，这时就换了一个完全不一样的思维，可以思考更多的可能性，而不是工作干不好整个世界就完了的状态。&lt;/p>
&lt;h2 id="换赛道">换赛道
&lt;/h2>&lt;p>如果打算换赛道，尽可能地一步步切换，就像攀岩，不要一步就跳过去，容易失去抓手、然后掉下去。&lt;br>
即使是“毕业”，离开岗位时，也要留住人脉和技能，然后在这些基础上慢慢探索、切入适合自己的赛道。&lt;br>
书中古典老师化身的胖子，是一个耐心的人生导师。他针对职场，提出了一个公式：&lt;br>
&lt;strong>定位=行业 x 企业 x 职位&lt;/strong>&lt;br>
可以尝试先切换其中的一个变量。比如现在是在互联网行业，这个大前提可以不用换。之前一直在走“职位”这条路，一路往上爬。实际上还有其它思路，只是我们平时很少思路，一心盯着职位职级。公式中没有讲的很具体，没提职位怎么切，但这个变量给了我们一个思考的起点，即可以挪挪屁股，换一个部门或团队，如果一个产品 (业务) 自己不喜欢、不适合、或识别出不是自己未来发展方向的话，及时果断地换。比如想往 AI 技术方向发展，可以切换到 AI 相关的团队中去，找到一个让自己有更多学习的机会的环境中去。&lt;br>
大概的步骤可能是这样：&lt;/p>
&lt;ul>
&lt;li>先认真收尾手头的事，边观察机会、切换赛道；&lt;/li>
&lt;li>然后在新赛道中认真的学习、快速积累，不计得失，努力去做成一些事，有一些自己的创造或产出；&lt;/li>
&lt;li>在上一条的持续迭代中，不断地精进到某个高度，同时积累更多的技术和人脉；&lt;/li>
&lt;li>如果条件成熟，可以再考虑切换企业，继续创造，验证这套模式可行性，并不断完善相应框架，同时继续积累更多的技术经验和人脉；&lt;/li>
&lt;li>最后如果还有激情和条件，可以再切换到创业的赛道，有一份真正属于自己的事业。&lt;/li>
&lt;/ul>
&lt;h1 id="职场">职场
&lt;/h1>&lt;h2 id="职业的本质是什么">职业的本质是什么？
&lt;/h2>&lt;p>通过帮别人解决问题来获利。&lt;br>
&lt;strong>该给你多少钱，不是看你有多厉害，而是看别人的问题有多大&lt;/strong>。&lt;br>
我们一直以为只有把专业技能练到炉火纯青的地步才能赚大钱，其实不太对。赚钱的是那些，找对了痛点和问题、然后培养自己能力，最终能解决这类问题的人。&lt;br>
简单说，是&lt;strong>需求决定价格，而不是供给决定价格&lt;/strong>。&lt;br>
同样是销售，卖房子的就是比卖汽水的赚钱。虽然他们的本质都是跟人打交道，找到别人的痛点，把自己的东西包装下卖给别人。最关键的点，在于找对行业。怎么把一瓶水卖出天价，也许能做到这个的人你会觉得他很厉害，不过很可能他只是把水运到了沙漠中去卖而已。&lt;br>
当然这点可能不只一个人发现，那么随着加入的人越来越多，就成了红海。时机很重要，但如果已经晚了的话呢？这时我们只能去发现更多的新机会。新机会往往出现在新行业，这有点像废话，不过更多时候，我们只是看着新行业到来，也没什么行动。&lt;/p>
&lt;h2 id="宁当鸡头不做凤尾">宁当鸡头，不做凤尾
&lt;/h2>&lt;p>在一个不怎么重要的部门当尾部，还不如去一个新部门（缺人才的部门）承担非常重要的岗位，给自己更多的历练，最重要的是成长和突破过去的自我，往未来趋势的方向不断的前进，这才是最有意义的。&lt;br>
很多人一直盯着职级、地位看，干嘛要一直去跟别人做比较呢？要知道职级就是公司设置的游戏规则，把人牢牢地套在规则里面、认真的奉献，不过很多人即使知道这一点，还是会很执著地追求这些。可能是因为不甘心，也可能是因为自尊心太重…… 但不是正确的方向还要坚持，就很难过得好。&lt;/p>
&lt;h1 id="提升自我">提升自我
&lt;/h1>&lt;h2 id="打磨优势">打磨优势
&lt;/h2>&lt;p>没有人是完美的，要充分亮出自己的优势，像一把沙子中只有一点点金子，经常容易被埋没，如果你经常去擦亮你找到的金子，它就会在沙子中闪闪发光。&lt;br>
重要的是把优势放大，同时规避劣势。&lt;br>
找优势可以用排除法，看看失去什么会让我活不下去。每个人都有优势，只是说怎么在沙子中找到金子，以及怎么让别人看到。&lt;br>
风口没了，猪会不会摔死？&lt;br>
你进入了风口之后，要不断地学习、站稳，让自己长出翅膀来，趁着红利在这个领域站稳脚跟。翅膀就是这个培养出来的优势，如果没及时长出来、亮出来，风口过后就会摔得很惨。&lt;/p>
&lt;h2 id="多关注自己跟过去比">多关注自己、跟过去比
&lt;/h2>&lt;p>不用总盯着别人的优势、跟别人比，要多跟现在自己比，只要让自己过得更舒适、更充实就行。&lt;br>
不一定要超越别人才算成功，大家的起点或运气不一样，世界本就不公，抱怨改变不了一切，接受现实往往是很难的，总会有不满。但我们注意力不应该在这，而应该放在&lt;strong>怎么不断地去突破自我&lt;/strong>，要比之前的自己活得更好、变得更强。以前觉得自己不太行的地方，突然自己变得非常行了，这就是最有意义的事。&lt;/p>
&lt;h2 id="只要坚持着慢慢地跑就能赢过很多人">只要坚持着慢慢地跑，就能赢过很多人
&lt;/h2>&lt;p>人生就像一场马拉松。这点感受很深，平时我也经常去跑步，坚持很累，特别是突破之前跑过的距离，很多人都会在途中停下休息，如果能一直坚持，就能赢过大部分人。&lt;br>
人生更像是在操场上跑圈，时不时有人加入，不用羡慕刚加入的人的体力，他们刚下场体力就是好，开始时就是跑得快，也可能是基因好、祖上都是运动员。但你一直坚持下来了，总能超过大部分人，毕竟有先天优势的只是非常少数，干嘛一定要跟他们比呢。&lt;/p>
&lt;h2 id="读书的方法">读书的方法
&lt;/h2>&lt;p>读书就是&lt;strong>以自己为中心，以问题为导向，以改变为终点&lt;/strong>。&lt;/p>
&lt;h2 id="想不是办法干才有答案">想不是办法，干才有答案
&lt;/h2>&lt;p>路是走出来的，不是设计出来的。&lt;br>
人们总是喜欢提前规划路线，其实路不是想出来的，而是走出来的。没真走到那路口，也不一定了解那边的路况，只是听人说、或看地图知道的。这些都不一定准确，或者偏离的很多。&lt;/p>
&lt;h2 id="初心">初心
&lt;/h2>&lt;p>“如果当时……” 是人生最大的谎言。&lt;br>
或许当时的选择，已经是那会能找到了最好的选项之一。不用去想走了另一条路会怎么样，因为我们经常会去美化那些得不到的东西，这样它就变得不真实，而且会很后悔、搞坏了尽情…… 没必要，这些都是自己在找罪受。&lt;br>
认识到这一点后，怎么正确地去看待这些选择呢？重点还是“初心”，了解自己来自哪、有什么目标或使命要去完成。这样再去做选择的时候，至少知道方向。&lt;br>
每个苦苦坚持的不得不，都藏着巨大的初心。&lt;br>
我们可能都有一些比较初期的出发点，或许我们已经忘了，但它带来的动力和惯性，让我们一直往前走，只不过后来我们以&lt;strong>最近的幻想&lt;/strong>来衡量自己的行为和成果，忘了这个初心。&lt;br>
或许当时的初心只是不想在小城市一眼看到头，而是想探索更多的可能性，想不断地超越儿时玩伴或亲戚朋友，只不过慢慢地，买了房，有了房贷，想自由，想赚钱，然后迷失了最初的初心，变得浮躁，一切心赚钱为目标，但又碰到各种障碍，终日郁郁寡欢。&lt;br>
当一个人知道最初的“为何”，就能承受一切“如何”。&lt;br>
我们不是害怕苦难，而是怕苦得没有意义，白白花费了很多精力、最终没得到任何收获。&lt;/p>
&lt;h1 id="管理">管理
&lt;/h1>&lt;h2 id="项目管理中的-1-10-100-定律">项目管理中的 1-10-100 定律
&lt;/h2>&lt;p>解决一个问题：&lt;/p>
&lt;ul>
&lt;li>事前计划，只需要 1 的成本。&lt;/li>
&lt;li>事中改进，就需要 10 的成本。&lt;/li>
&lt;li>事后修正，那需要 100 的成本。&lt;br>
所以为什么要做重要但不紧急的事。因为这是最省成本的方法，如果每天都在做紧急的事，那基本都要付出 10 或 100 的成本。&lt;br>
如果大部分能预期的事，都提前做好事前的计划，并及时地执行，那你完成它们的成本就只有 1 x N，而不是 100xN。这时你就可以比别人省出更多的时间。&lt;/li>
&lt;/ul>
&lt;h2 id="做团队管理的两个重要的事">做团队管理的两个重要的事
&lt;/h2>&lt;ul>
&lt;li>1 是帮别人拿成果，要为他争取机会，且争取时间，及时、适当地推他一把。&lt;/li>
&lt;li>2 是保护大家，一方面不让一些杂事、不重要的投诉分心，另一方面 pk 掉不合适的需求直接找到他们，不要当一个传话筒或需求传送带。&lt;/li>
&lt;/ul>
&lt;h2 id="成为专家之路的几个阶段">成为专家之路的几个阶段
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>求助者&lt;/strong>，这是最开始的时候，什么都不太懂，开始入门&lt;/li>
&lt;li>&lt;strong>探索家&lt;/strong>，有了兴趣或任务，不断地深挖、学习更多这方面的知识&lt;/li>
&lt;li>&lt;strong>建筑师&lt;/strong>，把自己在这里面学到的一些有一定难度的东西沉淀下来，形成框架&lt;/li>
&lt;li>&lt;strong>助人者&lt;/strong>，在平时帮助别人解决问题的过程中，不断的完善自己的框架，补齐知识点&lt;/li>
&lt;li>&lt;strong>专家&lt;/strong>，最终自己的框架已经比大多数人认知更深了，在别人眼里就是半个专家了。&lt;br>
其实不一定要到了助人者或专家再开始发声，从探索时就可以开始，动手去慢慢打磨、创造一个产品，然后跟着它一起成长。同时也把这个成长的过程分享出来，让初学者都能从中受益。&lt;br>
这个世界其实初学者（求助者）远远多于其它阶段的人。这就是一个金字塔，越塔尖的人越专业、而大部分人都是在中等以下。所以市场及需求最大的往往都是上面说的“探索家”和“求助者”。&lt;/li>
&lt;/ul></description></item><item><title>踩坑：如何避免被 aws 悄悄地收费</title><link>https://www.jsongo.top/articles/avoid-aws-charges/</link><pubDate>Fri, 13 Dec 2024 15:59:05 +0800</pubDate><guid>https://www.jsongo.top/articles/avoid-aws-charges/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/1f46848857f50464c097c5ea752ee538.jpg" alt="Featured image of post 踩坑：如何避免被 aws 悄悄地收费" />&lt;p>最近被 aws 算计了好多钱，之前一直没在意。后来才知道，是当时开了一个 cloud9。
&lt;img src="https://cdn.lyb.pub/2024/12/8004e7b22145d8b77b7bcca05c34f06b.webp"
loading="lazy"
alt="a0ca56c580cb92b784f7a891d694a46c_MD5"
>
EC2 一个月扣我 10 刀，Virtual Private Cloud 应该是 cloud9 启动后，内部建立的容器集群。Tax 这个就不用说了，10%的税
刚开始进入控制面板首页时，看不到什么异常，点 EC2 也没看到什么不对的地方：&lt;/p>
&lt;ul>
&lt;li>这个页面：https://us-east-1.console.aws.amazon.com/console/home?region=us-east-1
&lt;img src="https://cdn.lyb.pub/2024/12/5f2935beac626250341b78204dba3aaa.webp"
loading="lazy"
alt="dc4d2f7b2f6541fdf855791c014cd6bc_MD5"
>
看起来很正常，也没有实例在跑&lt;/li>
&lt;li>后来点了 global view 才知道，原来其它区域还有，aws 它是分区域隔离的，我一直在用 us-east 的，所以一直没发现。
&lt;img src="https://cdn.lyb.pub/2024/12/4f04b71f829cf419a34b05797f7e6cd6.webp"
loading="lazy"
alt="07fe0255dd659d8be840fad26fa1025a_MD5"
>
&lt;a class="link" href="https://us-east-1.console.aws.amazon.com/ec2globalview/home" target="_blank" rel="noopener"
>这里找 global 使用中的实例&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Daily Meditations - W50</title><link>https://www.jsongo.top/articles/meditations-w50/</link><pubDate>Mon, 09 Dec 2024 13:34:29 +0800</pubDate><guid>https://www.jsongo.top/articles/meditations-w50/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/99b74ba8e0135b5536a125e3596d5212.jpg" alt="Featured image of post Daily Meditations - W50" />&lt;h1 id="职业的本质是什么">职业的本质是什么？
&lt;/h1>&lt;p>&lt;!-- raw HTML omitted -->通过帮别人解决问题来获利。&lt;!-- raw HTML omitted -->&lt;br>
该给你多少钱，不是你有多厉害，而是别人的问题有多大。&lt;br>
我们一直以为只有把专业技能，练到炉火纯青的地步才能赚大钱，其实不一定对。不排除这种可能性，那些真正赚钱的是找对了目标问题，然后培养自己能力，最终能越来越好地解决这类问题的人。&lt;br>
简单说，是&lt;!-- raw HTML omitted -->需求决定价格，而不是供给决定价格&lt;!-- raw HTML omitted -->。&lt;/p>
&lt;h2 id="例子">例子
&lt;/h2>&lt;p>同样是销售，卖房子的就是比卖汽水的赚钱。他们的本质都是跟人打交道，找到别人的痛点，把自己的东西包装下卖给别人。&lt;br>
关键在于找对行业。怎么把一瓶水卖出天价，或许能做到这个的人，你会觉得很厉害，不过可能，他只是把水运到了沙漠中去卖而已，会的技能可能就是开车运货，以及经过探索学会了低成本把水运到沙漠、并全身而退的经验。&lt;br>
这或许不只一个人发现了，可能加入的人越来越多，就成了红海。&lt;!-- raw HTML omitted -->我们需要去发现更多的新机会&lt;!-- raw HTML omitted -->。新机会往往出现在新行业。这有点像废话，但更多时候，我们只是看着新行业、新机遇到来，却没什么行动，原来的地方太舒服了，不想动，也或者是因为觉得自己根本玩不来。&lt;/p>
&lt;h1 id="工作中真正有价值的东西">工作中真正有价值的东西
&lt;/h1>&lt;p>真正有价值的东西，是你&lt;!-- raw HTML omitted -->离开现在的工作环境后，你还剩什么&lt;!-- raw HTML omitted -->，还有多少人认可你。你现在的职级、带多少人、老板多看重你，这些都没有价值，它或许能短期能帮助你过得更好，但不是你长期可以保有的东西。某天公司不行了，或者你被迫离开公司后，这些都不再是你的。&lt;/p>
&lt;ul>
&lt;li>职级，在你离开后，只是一个饭后谈资，也可能在下一份职业中帮你得到了一个更好的定位，但前提是真有公司需要，说白了还是得看其它公司的脸色（需求）。&lt;/li>
&lt;li>带多少人，这更没意义了，离开公司，谁记得你曾经带过多少人？&lt;/li>
&lt;li>老板多看重你，这只是他个人的主观看法，离开这个老板（转岗）就没意义了，可能他地位比较高，能在一些事情上帮你一把，但你真离开公司了，他又能为你做啥呢？况且你的离开可能本身就是对他的伤害。&lt;/li>
&lt;/ul>
&lt;p>只要不是老板，你平时的工作更多的是在为别人实现“梦想”。&lt;br>
这里说的“老板”，是指你有不少股权，或从中能得到不错的声誉等，把你跟公司的兴衰绑定在了一起。&lt;br>
“价值”这个事，其实是变化的。&lt;/p>
&lt;ul>
&lt;li>刚毕业时，主要的时间都是在学习，边学习还能边赚钱养活自己，这样就够了。&lt;/li>
&lt;li>等积累多了，成了这方面的资源员工、或团队负责人、或专家，这时你就是在不断运营自己的影响力，让自己被更多人认可，能得到更多的好处。&lt;/li>
&lt;li>之后离开公司了，你留下来的技能、人脉，这些才是你自己的东西，是真正有价值的。&lt;/li>
&lt;/ul></description></item><item><title>开发 Office Add-ins 应用（一）：在 word 里使用大模型</title><link>https://www.jsongo.top/articles/office-add-ins-1/</link><pubDate>Fri, 06 Dec 2024 13:08:16 +0800</pubDate><guid>https://www.jsongo.top/articles/office-add-ins-1/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/8c1ce5c3e62a16997b7cf83e5164726c.jpg" alt="Featured image of post 开发 Office Add-ins 应用（一）：在 word 里使用大模型" />&lt;h1 id="介绍">介绍
&lt;/h1>&lt;p>借助 Office Add-ins 可以在 word 里使用大模型与用户输入的内容做交互。甚至可以尝试接入 RTC 让用户用嘴写作，动口不动手。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/d306f3c989ebb5b3882644abfbd5a49d.webp"
width="500"
loading="lazy"
alt="b453b1cce3c6e66c8f7ee107a10961d5_MD5|500"
>&lt;/p>
&lt;blockquote>
&lt;p>Office Add-ins，中文 “加载项”。&lt;br>
下文中，讲到 Add-ins 主要是指这个技术，提到具体应用时，会用“加载项”概念，主要是指 Office 应用中、下图所示的功能。&lt;/p>
&lt;/blockquote>
&lt;h2 id="概念">概念
&lt;/h2>&lt;p>Office &lt;strong>Add-ins&lt;/strong> 可以理解为是一种可以扩展 Microsoft Office 应用程序（如 Word、Excel、PowerPoint 等）功能的小程序，能增强 Office 应用程序的能力，能与 Office 文档中的内容进行交互。&lt;br>
从技术栈来说，它是基于 Web 技术（如 HTML、CSS 和 JavaScript）构建的，可以利用熟悉的 Web 技术栈来创建它们。&lt;br>
LLM 这两年来的火热，结合强大的内容生产工具套件——Office，其实可以给很多专业的内容工作者带来很大的帮助。&lt;/p>
&lt;h2 id="工作原理">工作原理
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>加载机制&lt;/strong>：用户在 Office 应用程序（如 Excel）中通过特定的界面（如 “插入” 选项卡中的 “我的加载项”）来加载和运行 Office Add-ins。当用户启动时，Office 应用程序会创建一个运行环境，加载相关的 Web 资源（HTML、CSS、JavaScript），并为 Add-ins 提供访问 Office 文档和应用程序功能的接口。&lt;/li>
&lt;li>&lt;strong>交互方式&lt;/strong>：Add-ins 使用 JavaScript 调用 Office JavaScript API，来跟 Office 应用程序进行交互。这个 API 提供了许多对象和方法，允许 Add-ins 读取和写入文档内容、操作 UI 元素（如自定义任务窗格、功能区按钮）等。比如，一个 Word Add-ins 可以使用 API 获取当前文档中的段落数量，或者在文档的特定位置插入文本，或者获取内容然后与 LLM 对话。&lt;/li>
&lt;/ul>
&lt;h2 id="应用场景">应用场景
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>数据可视化&lt;/strong>：可以将复杂的数据以直观的图表或图形形式展示在 Office 文档中。例如，在 Excel 中创建一个加载项，能够根据工作表中的数据自动生成精美的数据可视化图表，而且这些图表可以根据数据的更新而实时变化。&lt;/li>
&lt;li>&lt;strong>协作工具&lt;/strong>：增强 Office 应用程序的协作功能。比如在 Word 文档中添加一个加载项，实现多人同时在线编辑文档时的实时评论和沟通功能，类似于在文档旁边开启一个小型的即时通讯窗口，方便团队成员交流想法。&lt;/li>
&lt;li>&lt;strong>内容生成与自动化&lt;/strong>：帮助用户自动生成文档内容或进行格式设置。以 PowerPoint 为例，一个加载项可以根据用户输入的主题和要点自动生成一套完整的幻灯片，包括添加合适的图表、图片和布局等&lt;/li>
&lt;/ul>
&lt;h2 id="why-add-ins">Why Add-ins
&lt;/h2>&lt;p>官网给了一张图：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/ff7e6c77ddcf6130227a8ba4b47e6875.webp"
loading="lazy"
alt="09c7cc8c5fb5ab19a79d21aac9c36d04_MD5"
>&lt;/p>
&lt;ul>
&lt;li>可以跨端，不同端上都有 Office，你写的功能在不同平台上都可以跑起来&lt;/li>
&lt;li>中心化的分发，不用你自己到处去做上线（如 app Store）&lt;/li>
&lt;li>很容易下载安装&lt;/li>
&lt;li>开发的技术栈也都比较友好（Web）&lt;/li>
&lt;/ul>
&lt;h1 id="市场appsource">市场（AppSource）
&lt;/h1>&lt;p>&lt;a class="link" href="https://appsource.microsoft.com/zh-cn/marketplace/apps?product=office%3Bword&amp;amp;page=1&amp;amp;src=office&amp;amp;corrid=1f1d6156-7354-6d5f-d739-b9841f6e1c48&amp;amp;omexanonuid=&amp;amp;referralurl=&amp;amp;ClientSessionId=e4728826-ce48-4ae1-83a3-f11b7f195f63" target="_blank" rel="noopener"
>业务应用 - Microsoft AppSource&lt;/a>&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/f4e96ef3446b8a5867243039bbea65ee.webp"
loading="lazy"
alt="31a5772abd77fa083a40bbabf855bf21_MD5"
>&lt;br>
可以看到已经有很多 AI 应用了，这个截图还只是首页的前几个应用。有不少官方也都上线了 Office Add-ins 应用，比如 Grammarly、Draw.io、Adobe、Wekipedia、Mermaid 等。生态已经比较成熟了。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/4bf99f0f5b0dbfe9c178f6a779071743.webp"
loading="lazy"
alt="d9eb88a665c0acd52243e001fb941aa8_MD5"
>&lt;br>
过滤了下 Microsoft 365 相关的（如 Excel/Word/OneNote/Outlook/PPT 等）就有 7000+ 个。&lt;/p>
&lt;h1 id="交互形态">交互形态
&lt;/h1>&lt;p>目前看到的主要交互形态有：&lt;br>
1、Excel 等里作为一个嵌入内容显示在表格中。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/0718a4c5c68f59a0dac54be3613db317.webp"
loading="lazy"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/0bdcf9ded954ee9ec42fb3066cf850e8.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
2、Excel/Word/PPT 中作为侧边窗格可以单独进行交互。&lt;/p>
&lt;ul>
&lt;li>这种交互其中有两个操作点，一个是顶部，它也可以触发一个事件；另一个是侧边，本质上它是在侧边开一个类似 Webview 的容器，里面跑 Web 页面。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/8f588b5eba7bcc45fd9d37358ce0ab99.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/43b2b8f25fa14664239034833ae828b9.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/9ae3d75c01e2fae11e25ab81ed8f6340.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/328217d99c5ba98b83784ac03fba1858.webp"
width="500"
loading="lazy"
alt="|500"
>&lt;/li>
&lt;/ul>
&lt;h1 id="开发">开发
&lt;/h1>&lt;h2 id="工具安装">工具安装
&lt;/h2>&lt;h3 id="基础开发环境">基础开发环境
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pnpm install -g yo generator-office
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>如果没成功可能是依赖 mem-fs，直接安装下就可以：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pnpm install -g mem-fs
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="生成代码">生成代码
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">yo office
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://cdn.lyb.pub/2024/12/308db6a261cf76acf4114a4a78ab2557.webp"
loading="lazy"
alt="091737356a84529f6186ece9c4b25f10_MD5"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/41cedbbf9a12160ae1f0e4368a4dc876.webp"
loading="lazy"
alt="8fc4fc480f6fddbdf826d2095a18622c_MD5"
>&lt;br>
生成后它默认用 npm 来 install，觉得慢的话直接把进程杀掉，然后重新跑 &lt;code>pnpm install&lt;/code>。&lt;br>
后面就是熟悉的 &lt;code>npm run start&lt;/code> 了，写真正的代码逻辑了。&lt;/p>
&lt;h2 id="辅助开发工具">辅助开发工具
&lt;/h2>&lt;p>Office Addin 项目创建和基架工具是 Office 加载项的 Yeoman 生成器，简称为 &lt;code>yo&lt;/code>：&lt;a class="link" href="https://github.com/yeoman/yo" target="_blank" rel="noopener"
>GitHub - yeoman/yo: CLI tool for running Yeoman generators&lt;/a>。&lt;/p>
&lt;h3 id="vs-codecursor-开发插件">Vs code/cursor 开发插件
&lt;/h3>&lt;p>可以安装下这个：&lt;a class="link" href="https://marketplace.visualstudio.com/items?itemName=msoffice.microsoft-office-add-in-debugger" target="_blank" rel="noopener"
>Microsoft Office Add-ins Development Kit&lt;/a>&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/94b2a20f155e46bba502cec36e009b1f.webp"
loading="lazy"
alt="06ed2b1e5c337d53818b449c6a6ead71_MD5"
>&lt;br>
当然也可以用 npm start，不过运行前一定要记得先运行 &lt;code>npm run dev-server&lt;/code>，要不然只是 start 个客户端、背后没服务是跑不起来的。如果一直失败，那直接把所有在 run 的都关掉，word 也退出，运行几次 &lt;code>npm stop&lt;/code> （因为我也遇到了，当时运行了好几次 start，它起了多个背后的进程）。所以其实用插件还是比较方便些，命令行可能会遇到一些想不通的问题。&lt;/p>
&lt;blockquote>
&lt;p>用命令行如果遇到问题，可以参考这里：&lt;a class="link" href="https://learn.microsoft.com/en-us/office/dev/add-ins/quickstarts/word-quickstart-yo" target="_blank" rel="noopener"
>Build your first Word task pane add-in - Office Add-ins | Microsoft Learn&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;h3 id="script-lab">Script Lab
&lt;/h3>&lt;p>Script Lab 是一种用于快速创建调用 Office JavaScript 库 API 的“原型代码”。&lt;/p>
&lt;blockquote>
&lt;p>Script Lab is a tool for quickly prototyping code that calls the Office JavaScript Library APIs.&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>安装时，公司账号可能会用不了，可能跟公司的安全策略有关。最好切换个人账号。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/766add3fe8dd77c7b29ce094a1f8b986.webp"
loading="lazy"
alt="481f65c8228eb4e2a18b297bba34e058_MD5"
>&lt;br>
可以到 &lt;a class="link" href="https://learn.microsoft.com/en-us/office/dev/add-ins/overview/explore-with-script-lab" target="_blank" rel="noopener"
>这里&lt;/a> 或 &lt;a class="link" href="https://appsource.microsoft.com/en-us/product/office/WA104380862" target="_blank" rel="noopener"
>这里&lt;/a> 来直接下载安装，需要登录，这里如果用公司的账号可能会失败，可以尝试下个人的账号。如果是走的公司内部的采购，有个小技巧：公司内部申请下来之后，用它激活，然后退出登录自己的账号，我这么测试了下，用自己账号依然保持着激活状态，看来它激活的是软件本身，跟账号没关系。&lt;br>
第一次登录 AppSource 的话，会有一堆流程，一会儿要认证，一会儿要补充信息……&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/ed446538cfc84f72e0e5b86b639fc8ed.webp"
loading="lazy"
alt="a5222986bf0607d4b24cef11d34a7e99_MD5"
>&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/92fa65ed60838d1e687557ce3418cdc6.webp"
loading="lazy"
alt="6ce02359d39da2d74996140ea160c735_MD5"
>&lt;br>
装完之后，打开 word 就可以看到了：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/8889f62079f35926fb5ab63fe45b0d05.webp"
loading="lazy"
alt="02913cb0e00b47cca7a08800297d3910_MD5"
>&lt;/li>
&lt;/ul>
&lt;h2 id="运行">运行
&lt;/h2>&lt;p>运行起来后，如图所示：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/5020607f6dca911463819e1884f959f0.webp"
loading="lazy"
alt="b71eb2e0a6e37ecb7264538e8b0e8e3c_MD5"
>&lt;br>
Word 是自己弹出来的，vscode 插件背后是起了一个 server （默认在 3000 端口），为侧边这个“页面”提供调试服务。&lt;/p>
&lt;h1 id="限制">限制
&lt;/h1>&lt;p>从生成的代码中可以看出，微软对 Add-ins 其实做了一些环境限制：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/779ca230a5c6deef84980df0246a0c51.webp"
loading="lazy"
alt="8933d8a34dc9ebc2133a5ddb8bbcc6b7_MD5"
>&lt;br>
只有 IE 和 Edge 浏览器内核才能跑，当然 Office 版本也有限制，这个倒还好。&lt;/p>
&lt;h1 id="相关资源">相关资源
&lt;/h1>&lt;ul>
&lt;li>&lt;a class="link" href="https://learn.microsoft.com/en-us/office/dev/add-ins/tutorials/word-tutorial" target="_blank" rel="noopener"
>Word add-in tutorial - Office Add-ins | Microsoft Learn&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Claude MCP 体验</title><link>https://www.jsongo.top/articles/claude-mcp-101/</link><pubDate>Fri, 06 Dec 2024 00:56:02 +0800</pubDate><guid>https://www.jsongo.top/articles/claude-mcp-101/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/b87a43aef0ebf4a4d13f45ad57e9b5d2.jpeg" alt="Featured image of post Claude MCP 体验" />&lt;h1 id="概念">概念
&lt;/h1>&lt;p>MCP 即 Model Context Protocol，模型上下文协议，它能通过借助外部或历史信息，来更高效地构建信息更全面的上下文信息。&lt;br>
这是一个非常重要的协议，刚发布的时候，x 上大家都乐开了花，一个比较典型的说法是“&lt;a class="link" href="https://x.com/eviljer/status/1861333739730804848" target="_blank" rel="noopener"
>村里通网了 - Claude MCP 开启数据连接和操作的新宇宙&lt;/a>”。我一直认为，LLM 要能跟外界真正的能交互起来才能有更大的想像空间。之前见过一些有趣的如操作电脑的辅助 LLM 的工作，还有一些辅助浏览器操作的插件，这次是从协议上就定出一个标准，大家只要按照标准来，都可以相互打通。&lt;/p>
&lt;h1 id="功能">功能
&lt;/h1>&lt;h2 id="介绍">介绍
&lt;/h2>&lt;p>&lt;img src="https://cdn.lyb.pub/2024/11/88311bd3dfca6df4998441df0654ee91.webp"
width="850"
loading="lazy"
alt="图片来自 x|850"
>&lt;/p>
&lt;blockquote>
&lt;p>参考：&lt;a class="link" href="https://x.com/nicekate8888/status/1861323082969030978" target="_blank" rel="noopener"
>Claude 秒变 Cursor！MCP 让 AI 直接编辑本地文件 | Anthropic MCP 实测&lt;/a>&lt;/p>
&lt;/blockquote>
&lt;ul>
&lt;li>官方文档：&lt;a class="link" href="https://www.anthropic.com/news/model-context-protocol" target="_blank" rel="noopener"
>Introducing the Model Context Protocol - Anthropic&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="使用">使用
&lt;/h2>&lt;ul>
&lt;li>安装（以 Mac 来讲）
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">brew install uv git sqlite3
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>然后下载 Claude &lt;a class="link" href="https://claude.ai/download" target="_blank" rel="noopener"
>桌面端&lt;/a>，&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>开启
&lt;ul>
&lt;li>如何启用具体可以参考：[[https://modelcontextprotocol.io/quickstart#installing-prerequisites-macos]]&lt;/li>
&lt;li>简单说，这个功能桌面端才有，Mac 上可以打开 &lt;code>~/Library/Application Support/Claude/claude_desktop_config.json&lt;/code> 编辑下这个 JSON 文件，然后重启下 Claude 客户端就自动启用了。往 JSON 文件里写内容：&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;mcpServers&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sqlite&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;command&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;uvx&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;args&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;mcp-server-sqlite&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;--db-path&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;/Users/&amp;lt;my-user-name&amp;gt;/claude.db&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="示例">示例
&lt;/h2>&lt;p>官方给的例子：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Create a new SQLite database&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sqlite3 ~/claude.db &lt;span class="s">&amp;lt;&amp;lt;EOF
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">CREATE TABLE products (
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> id INTEGER PRIMARY KEY,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> name TEXT,
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> price REAL
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">INSERT INTO products (name, price) VALUES
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Widget&amp;#39;, 19.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Gadget&amp;#39;, 29.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Gizmo&amp;#39;, 39.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Smart Watch&amp;#39;, 199.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Wireless Earbuds&amp;#39;, 89.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Portable Charger&amp;#39;, 24.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Bluetooth Speaker&amp;#39;, 79.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Phone Stand&amp;#39;, 15.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Laptop Sleeve&amp;#39;, 34.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Mini Drone&amp;#39;, 299.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;LED Desk Lamp&amp;#39;, 45.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Keyboard&amp;#39;, 129.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Mouse Pad&amp;#39;, 12.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;USB Hub&amp;#39;, 49.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Webcam&amp;#39;, 69.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Screen Protector&amp;#39;, 9.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Travel Adapter&amp;#39;, 27.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Gaming Headset&amp;#39;, 159.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Fitness Tracker&amp;#39;, 119.99),
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> (&amp;#39;Portable SSD&amp;#39;, 179.99);
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>创建一个表，然后往里面写一些数据。&lt;/p>
&lt;h2 id="运行">运行
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">uvx mcp-server-sqlite
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>它会用 &lt;a class="link" href="https://docs.astral.sh/uv/guides/tools/" target="_blank" rel="noopener"
>uvx&lt;/a> 来运行 mcp 服务。&lt;br>
Prompt Demo:&lt;br>
&lt;code>Can you connect to my SQLite database and tell me what products are available, and their prices?&lt;/code>&lt;/p>
&lt;h1 id="原理">原理
&lt;/h1>&lt;p>其实就是加了一个 MCP server 作为本地代理，架构如下：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/11/fe0e494830be8e36f62559f1729cb921.webp"
width="725"
loading="lazy"
alt="|725"
>&lt;br>
MCP 是一个开放协议：&lt;/p>
&lt;ul>
&lt;li>首先会建立与外部数据源的连接。它使用预定义的接口和数据格式来识别和访问这些外部源。例如，当需要从一个关系型数据库获取信息来为语言模型（LLM）提供上下文时，MCP 会通过数据库驱动程序按照数据库的协议（如 SQL）进行通信，检索数据。&lt;/li>
&lt;li>另一方面 MCP 也类似 Prompt 模板一样，提供了&lt;strong>动态上下文构建&lt;/strong>的能力： - MCP 能够留空的方式，动态地构建上下文。 - 例如，在聊天界面应用中，当用户询问一个关于特定产品的问题时，MCP 可以快速从产品数据库中获取产品的规格、用户评价等相关信息，并将这些信息组合成一个有意义的上下文提供给 LLM。 - 还可以根据用户的交互历史来调整上下文。&lt;br>
它本身会不断更新和优化提供给 LLM 的上下文，确保 LLM 能够跟上用户的思路，通过这些方式，MCP 能提高 LLM 的工作效率和回答质量。&lt;/li>
&lt;/ul></description></item><item><title>图像生成：角色场景形象适配</title><link>https://www.jsongo.top/articles/ipadapter-lora-controlnet/</link><pubDate>Sun, 01 Dec 2024 11:29:47 +0800</pubDate><guid>https://www.jsongo.top/articles/ipadapter-lora-controlnet/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/3c463375cc35ddc5e78d71b95ddcbd51.jpeg" alt="Featured image of post 图像生成：角色场景形象适配" />&lt;hr>
&lt;h1 id="几种方案">几种方案
&lt;/h1>&lt;h2 id="ip-adapter">IP-Adapter
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>原理&lt;/strong>：IP-Adapter 的核心是其 “解耦交叉注意力机制”，它将文本特征和图像特征的处理分开，为每种输入类型创建了不同的路径，从而能够更好地将视觉提示信息整合到模型中，同时不影响模型对文本指令的理解和执行能力。通过这种机制，IP-Adapter 可以识别参考图的艺术风格、内容以及特定的角色形象等信息，并生成与之相似的作品。&lt;/li>
&lt;li>&lt;strong>使用方式&lt;/strong>：以 Stable Diffusion 为例，需先下载对应版本的 IP-Adapter 预处理器和模型，如 sd1.5 版本的 “ip-adapter_clip_sd15” 预处理器及相关模型。在使用时，将打斗场景图作为输入图像，将角色形象图作为参考图，通过调整相关参数和权重，IP-Adapter 就能根据角色形象图的特征对打斗场景图中的角色进行适配和修改，生成符合预期的新图像。&lt;/li>
&lt;/ul>
&lt;h2 id="dreambooth">DreamBooth
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>原理&lt;/strong>：DreamBooth 是一种基于扩散模型的微调技术，它允许用户使用少量的特定主题图像（如你的角色形象图）对预训练的文本到图像生成模型进行微调，使模型能够学习到与该主题相关的特定特征和细节，从而在生成图像时能够更准确地生成符合该主题的内容。&lt;/li>
&lt;li>&lt;strong>使用方式&lt;/strong>：首先收集包含角色形象的高质量图像数据集，然后选择一个预训练的基础模型，如 Stable Diffusion 等。使用 DreamBooth 技术对基础模型进行微调，将角色形象与特定的唯一标识符绑定，让模型学习到角色的特征。最后，将微调后的模型应用于打斗场景图，通过输入相关的文本提示，模型会根据学习到的角色特征对场景图中的角色进行适配和生成。&lt;/li>
&lt;/ul>
&lt;h2 id="lora-low-rank-adaptation-of-large-language-models">LoRA (Low-Rank Adaptation of Large Language Models)
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>原理&lt;/strong>：LoRA 的基本思想是通过在大型语言模型的基础上，添加少量的可训练参数来实现对模型的微调，从而在保持模型原有性能的基础上，快速适应特定的任务或领域。对于图像生成任务，同样可以利用类似的原理，通过对预训练的图像生成模型添加 LoRA 模块，使其能够根据特定的角色形象图进行微调，学习到角色的特征表示，进而在生成图像时能够更好地适配这些角色形象。&lt;/li>
&lt;li>&lt;strong>使用方式&lt;/strong>：先确定预训练的图像生成模型，然后针对你的角色形象图准备相应的数据集。接着，设计并训练适合该模型的 LoRA 模块，使其能够捕捉到角色形象的关键特征。在实际应用中，将训练好的 LoRA 模块与预训练模型结合，输入包含打斗场景和角色相关的文本提示，模型就会根据 LoRA 模块中学习到的角色特征，对场景图中的角色进行相应的适配和生成。&lt;/li>
&lt;/ul>
&lt;h2 id="controlnet">ControlNet
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>原理&lt;/strong>：ControlNet 是一种用于控制图像生成过程的神经网络架构，它可以通过添加额外的条件控制信息来引导图像生成模型生成符合特定要求的图像。在你的需求中，可以将角色形象图作为 ControlNet 的输入条件，通过网络中的特定模块对生成过程进行约束和引导，使生成的打斗场景图中的角色能够更好地适配给定的角色形象.&lt;/li>
&lt;li>&lt;strong>使用方式&lt;/strong>：选择合适的 ControlNet 预训练模型，并将其与基础的图像生成模型结合，如 Stable Diffusion。将打斗场景图作为基础图像输入，同时将角色形象图作为 ControlNet 的条件输入，通过调整 ControlNet 中的各种参数和权重，如控制线条、色彩、形状等方面的参数，来精确控制生成的图像中角色的外观和姿态，使其与给定的角色形象相匹配。&lt;/li>
&lt;/ul>
&lt;h1 id="成本分析">成本分析
&lt;/h1>&lt;ul>
&lt;li>&lt;strong>IP-Adapter&lt;/strong>：IP-Adapter 无需进行模型训练，主要成本在于寻找符合预期的参考图，其成本相对较低，能在几分钟内看到结果，大大节省了时间。&lt;/li>
&lt;li>&lt;strong>DreamBooth&lt;/strong>：训练成本相对较高，需要至少 20 张不同角度的人物图像，并且对硬件要求较高，至少需要 24GB 的显存以及性能较好的 GPU，若使用云服务训练则还需额外产生费用。&lt;/li>
&lt;li>&lt;strong>LoRA&lt;/strong>：LoRA 可以冻结预训练模型的全部参数权重，然后只在新增的网络层去做训练，训练数据量可根据具体需求而定，因此成本相对较低。&lt;/li>
&lt;li>&lt;strong>ControlNet&lt;/strong>：ControlNet 的训练成本相对较高。例如，其 canny edge detector 模型的训练需要 300 万张边缘 - 图像 - 标注对的语料，在 A100 80g 的环境下要花费 600 个 gpu 小时；human pose 模型则需 8 万张姿态 - 图像 - 标注对的语料及 400 个 gpu 时。&lt;/li>
&lt;/ul>
&lt;h1 id="思路">思路
&lt;/h1>&lt;h2 id="lora">LoRA
&lt;/h2>&lt;h3 id="过拟合问题">过拟合问题
&lt;/h3>&lt;p>需要准备多张形象比较一致的图片，要不然只有一张图会有&lt;strong>过拟合问题&lt;/strong>，以及&lt;strong>特征不全面&lt;/strong>的问题。简单说，仅靠一张图片，LoRA 可能无法学习到角色的完整特征，导致在生成场景图中角色的其他角度或状态时出现不匹配的情况。例如，角色在训练图片中是正面微笑的形象，在生成侧面打斗场景时，可能会出现面部结构变形或者表情不自然的问题。&lt;br>
这个方法可以作为后续优化的方向，当可以生成多张形象一致的图片时，再来试试这个思路。&lt;/p>
&lt;h3 id="猫箱类软件">猫箱类软件
&lt;/h3>&lt;p>这些软件会让使用者先上传几张自己的图片，之后它其实会拿这些去做 LoRA 训练（也可能是其它方式的微调， 如 DreamBooth），之后再用这个用户专属的模型去生成他后续的各场景图。这类软件使用方式上，稍微有些麻烦，因为上传图片用户得好好挑挑，都上传同一时间或穿着、光线下的图片时，其实效果也一般也容易过拟合。不过训练完后，就可以非常自由的生成非常丰富、多样的场景下的个人图片，弄得好的话非常逼真，真假难辨。&lt;/p>
&lt;h2 id="controlnet-1">ControlNet
&lt;/h2>&lt;h3 id="硬件要求">硬件要求
&lt;/h3>&lt;p>ControlNet 需要一定的硬件支持来运行，由于它在原始扩散模型基础上增加了控制模块，对 GPU 等硬件资源的需求相对较高，特别是在处理复杂的控制条件和高分辨率图像生成时，可能需要更强大的 GPU 来保证生成速度和质量。&lt;/p>
&lt;h3 id="时间成本">时间成本
&lt;/h3>&lt;p>训练 ControlNet 所需的时间较长，从数据收集、标注到模型训练完成，整个过程可能需要数天甚至数周，这取决于训练数据的规模和硬件设备的性能。&lt;/p>
&lt;blockquote>
&lt;p>总体看，成本上不一定划得来。相比之下，IP-Adapter 不需要训练模型，只需找到符合预期的参考图即可开始生成，大大节省了时间和资源，能够在几分钟内看到结果，其模型参数只有 22m，存储占用小，对硬件资源的要求相对较低，下面展开讲下&lt;/p>
&lt;/blockquote>
&lt;h2 id="ip-adapter-1">IP-Adapter
&lt;/h2>&lt;p>IP-Adapter 确实有其独特的优势，使其成为一种很有吸引力的图像生成辅助方法，以下是对其优点的详细介绍。&lt;/p>
&lt;h3 id="无需训练模型">无需训练模型
&lt;/h3>&lt;p>与需要收集大量数据并进行长时间训练的 LoRA 等方法不同，IP-Adapter 不需要训练模型，大大节省了时间和资源，仅需找到符合预期的参考图即可开始生成，能在几分钟内看到结果，效率极高。&lt;/p>
&lt;h3 id="单图即可实现风格迁移">单图即可实现风格迁移
&lt;/h3>&lt;p>只需一张图片就能实现风格迁移，将该图片的风格特征融入到生成的图像中。例如，如果有一张具有独特画风的角色图片，IP-Adapter 可以把这种画风应用到新生成的打斗场景图中，让场景图中的角色呈现出与参考图一致的风格，为生成特定风格的图像提供了极大的便利。&lt;/p>
&lt;h3 id="支持多图多特征提取">支持多图多特征提取
&lt;/h3>&lt;p>可以同时读取多张参考图，并提取它们的特征，从而使生成的结果拥有更丰富的多样性和随机性。比如，你有几张同一角色在不同状态下的图片，IP-Adapter 能够综合这些图片的特征，生成更全面、更具变化的角色形象，使其在打斗场景中的表现更加自然和丰富。&lt;/p>
&lt;h3 id="与-prompt-配合度高">与 Prompt 配合度高
&lt;/h3>&lt;p>对 Prompt 有强注意力，能使 Prompt 中的信息更直观地反映在生成结果中。用户可以通过替换 Prompt 里的关键词，在继承参考图风格的同时，指向不同的结果，形成 Prompt 的组合矩阵，进一步拓展生成结果的多样性。例如，在生成打斗场景图时，通过修改 Prompt 中的关键词，如 “激烈打斗”“轻松打斗” 等，可以生成不同氛围和情节的场景图，且都带有参考图的风格特征。&lt;/p>
&lt;h3 id="兼容性强">兼容性强
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>适配多种基础模型&lt;/strong>：IP-Adapter 基于预训练的文本到图像扩散模型开发，具有很强的通用性和兼容性，可以适配 Stable Diffusion 等多种基础模型，而无需针对不同的基础模型进行重新训练或调整.&lt;/li>
&lt;li>&lt;strong>可与 ControlNet 等结合&lt;/strong>：能够与 ControlNet 等其他可控生成工具结合使用，实现更强大的图像生成控制能力。比如，通过 ControlNet 可以对生成图像的线条、边缘等细节进行控制，再结合 IP-Adapter 的风格迁移和内容引导，能够生成更加精细、准确且符合风格要求的图像。&lt;/li>
&lt;/ul>
&lt;h3 id="模型参数小">模型参数小
&lt;/h3>&lt;p>IP-Adapter 本身的模型参数只有 22M，存储占用小，对硬件资源的要求相对较低，在普通的硬件设备上也能够较为流畅地运行，降低了使用门槛，更便于广泛应用和推广。&lt;/p>
&lt;h1 id="方案选择">方案选择
&lt;/h1>&lt;p>最终还是决定先用 IP-Adapter 来推进。&lt;/p></description></item><item><title>Flux 图像生成模型</title><link>https://www.jsongo.top/articles/flux-101/</link><pubDate>Sun, 24 Nov 2024 23:31:34 +0800</pubDate><guid>https://www.jsongo.top/articles/flux-101/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/2679aa8e01ac3a9721f4b6f4e919a651.jpg" alt="Featured image of post Flux 图像生成模型" />&lt;h1 id="flux-基础">Flux 基础
&lt;/h1>&lt;blockquote>
&lt;p>Flux 是多模态和并行扩散 Transformer 块的混合架构，拥有 120 亿参数，是目前最大的开源文本到图像模型之一，能够生成高质量、细节丰富且风格多样的图像。&lt;br>
性能和效果可以与 Midjourney V6 媲美。&lt;br>
Flux 一般通过 ComfyUI 来调用。&lt;/p>
&lt;/blockquote>
&lt;h2 id="黑森林实验室与团队背景">黑森林实验室与团队背景
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>核心成员&lt;/strong>：黑森林实验室由 Stable Diffusion 的核心开发者 Robin Rombach 领衔创立，团队成员大多来自 Stability AI，如 Andreas Blattmann、Axel Sauer 等多位原 Stable Diffusion 项目的关键人物，他们在生成式模型开发领域经验丰富，为 Flux 的诞生奠定了坚实基础。大家可能听说过 Stability AI 团队内部不和，各种破事把公司折腾得够呛，所以由原班核心人马出来创业做的 Flux 受到很大的关注。&lt;/li>
&lt;li>&lt;strong>融资情况&lt;/strong>：这个实验室已获得 3200 万美元的种子轮融资，由著名风投机构 Andreessen Horowitz (a16z) 领投，多位业内知名人士参与投资，充足的资金支持使其能够大力推进模型的研发与优化等工作。主要还是因为它的背景实在太好了。&lt;/li>
&lt;/ul>
&lt;h2 id="flux-模型特点">Flux 模型特点
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>架构与参数&lt;/strong>：Flux 基于多模态和并行扩散 Transformer 块的混合架构，拥有 &lt;!-- raw HTML omitted -->120 亿参数&lt;!-- raw HTML omitted -->，是目前最大的开源文本到图像模型之一。这种架构和庞大的参数规模使其能够学习到更丰富的图像特征和语义信息，从而生成高质量的图像。&lt;/li>
&lt;li>&lt;strong>性能优势&lt;/strong>：
&lt;ul>
&lt;li>&lt;strong>图像质量&lt;/strong>：在视觉质量、图像细节和输出多样性等方面达到了新高度，生成的图像更加逼真、细腻，细节丰富度高，风格多样，能与闭源的 Midjourney v6.1 模型不相上下，甚至在一些方面表现更优，如复杂场景生成、人物细节处理等。&lt;/li>
&lt;li>&lt;strong>提示词遵循能力&lt;/strong>：对提示词的理解和遵循能力很强，能够准确地根据输入的文本描述生成符合要求的图像，包括对复杂指令、长文本描述以及特定场景和细节要求的准确呈现，减少了因提示词理解不准确而导致的图像与预期不符的问题。&lt;/li>
&lt;li>&lt;strong>文字生成能力&lt;/strong>：在图像中生成文字的效果出色，可以处理重复字母等棘手情况，生成的文字内容准确、排版合理，这在一些需要在图像中呈现文字信息的场景中具有很大优势，如生成带有文字标识的产品图片、包含文字说明的场景图片等。&lt;/li>
&lt;li>&lt;strong>手部细节处理&lt;/strong>：相较于之前的一些模型，Flux 在手部细节生成上有了显著改进，减少了手指等部位的畸形或错误，使生成的人物图像更加自然、真实。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>不同版本特点&lt;/strong>：&lt;br>
有 3 个核心版本，Pro/dev/schnell
&lt;ul>
&lt;li>&lt;strong>FLUX (pro)&lt;/strong>：闭源模型，自家压箱底的货。具备最佳性能，包括最先进的提示跟随能力、视觉质量、图像细节和输出多样性，适用于专业用户和对图像质量要求极高的场景，可通过注册官方 API 申请访问权限，同时支持企业定制。&lt;/li>
&lt;li>&lt;strong>FLUX (dev)&lt;/strong>：开源模型，不可商用，直接从 FLUX (pro) 蒸馏而来，具备相似的图像质量和提示词遵循能力，但更高效，适合开发者进行研究和实验等非商业用途的使用。&lt;/li>
&lt;li>&lt;strong>FLUX (schnell)&lt;/strong>：开源模型，可&lt;!-- raw HTML omitted -->商用&lt;!-- raw HTML omitted -->，专门为本地开发和个人使用量身定制，生成速度最快，内存占用最小，是个人用户体验和进行简单开发测试的不错选择。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description></item><item><title>初识 Diffusion（概念）</title><link>https://www.jsongo.top/articles/diffusion-101/</link><pubDate>Sun, 24 Nov 2024 11:26:10 +0800</pubDate><guid>https://www.jsongo.top/articles/diffusion-101/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/96539755245eb88510f037ed2d24f60d.jpeg" alt="Featured image of post 初识 Diffusion（概念）" />&lt;p>Diffusion（扩散模型）是一类生成式模型，在机器学习和人工智能领域应用广泛，特别是在图像生成、语音合成等领域发挥了重要作用。&lt;/p>
&lt;h1 id="model--checkpoint">Model &amp;amp; Checkpoint
&lt;/h1>&lt;p>开源模型发布出来的文件一般都很大，里面包含了很多模型参数、快照等。Model 和 checkpoint 在开源这个层面上，两个概念可以认为大体上是等价的，只不过我们一般不叫 checkpoint，而是说某个 model 开源了。&lt;/p>
&lt;ul>
&lt;li>Model 是一个比较抽象的概念，它包括模型的架构（例如神经网络中的层数、每层神经元数量、连接方式等）和训练目标（例如是进行分类任务、生成任务还是回归任务）&lt;/li>
&lt;li>Checkpoint 是在模型训练过程中定期保存的模型参数快照，与 Model 密切相关。Checkpoint 包含了 Model 的架构定义、参数值、优化器状态以及训练过程的元数据等，是对 Model 在特定训练阶段状态的完整记录。&lt;/li>
&lt;/ul>
&lt;h1 id="clip">CLIP
&lt;/h1>&lt;h2 id="概念">概念
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>CLIP 模型&lt;/strong>：CLIP 是 Contrastive Language-Image Pre-training 的缩写，由 OpenAI 在 2021 年 1 月 5 日发布，是一种将计算机视觉与自然语言处理相结合的神经网络模型。
&lt;ul>
&lt;li>它通过对 400,000,000 组（图像，文本）对数据进行预训练，从而能够在给定图像的情况下，根据自然语言指令预测出最相关的文本片段，展现出了类似 GPT-2 和 GPT-3 的 zero-shot 学习能力，即模型可以在未针对特定任务进行直接优化训练的情况下，对未曾见过的数据类别进行较好地预测&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>CLIP Vision&lt;/strong>：CLIP Vision 主要负责处理视觉信息，也就是对输入的图像数据进行特征提取和编码等操作，将图像转化为模型能够理解和处理的向量表示，以便与文本信息进行对比学习和关联。&lt;sup id="fnref:1">&lt;a href="#fn:1" class="footnote-ref" role="doc-noteref">1&lt;/a>&lt;/sup>
&lt;ul>
&lt;li>例如，在图像生成领域，CLIP Vision 可以帮助模型理解图像的内容和特征，从而生成更符合语义描述的图像。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>CLIP Text&lt;/strong>：我们常看到的这个 CLIP Text 概念，主要是指作为参考文本来对图像进行调整的文本描述。&lt;/li>
&lt;/ul>
&lt;h2 id="应用">应用
&lt;/h2>&lt;ul>
&lt;li>&lt;strong>图像生成&lt;/strong>：如在 Paints-Undo 项目中，CLIP Vision 作为模型架构的一部分，与其他组件共同作用，通过对输入图像的处理和分析，为生成模拟人类绘画过程的动画提供视觉信息基础，帮助模型理解图像的内容和结构，从而更准确地生成绘画过程中的各个中间状态。&lt;/li>
&lt;li>&lt;strong>图像分类与标注&lt;/strong>：可以根据图像的视觉特征，结合预训练时学习到的图像与文本的关联，对未见过的图像进行分类或自动生成相应的文本标注，例如判断一张图片是风景照、人物照还是动物照，并给出相应的文字描述。&lt;/li>
&lt;li>&lt;strong>图像检索&lt;/strong>：基于 CLIP Vision 对图像特征的提取和与文本的关联能力，可以实现根据文本描述来检索相关的图像，或者根据图像来查找与之语义相关的文本信息，提高图像检索的准确性和效率。&lt;/li>
&lt;li>&lt;strong>视觉问答系统&lt;/strong>：帮助系统理解图像中的视觉内容，结合对自然语言问题的理解，生成准确的文本答案，例如回答关于图像中物体的位置、颜色、数量等问题 。&lt;/li>
&lt;/ul>
&lt;h1 id="vae">VAE
&lt;/h1>&lt;p>VAE 主要用于将图像数据压缩到一个潜在空间，然后再从这个潜在空间中生成新的图像，侧重于图像的生成和重建。&lt;/p>
&lt;h2 id="latent-image">Latent Image
&lt;/h2>&lt;p>经过某种变换或编码后隐藏在数据中的图像信息。例如，在使用变分自编码器（VAE）进行图像生成或处理时，图像数据会被压缩到一个潜在空间（latent space），这个潜在空间中的向量可以被看作是潜像的一种表示形式。这些潜像向量包含了图像的关键特征，如形状、颜色、纹理等信息，通过解码器可以将这些潜像向量转换回可见的图像。&lt;/p>
&lt;h1 id="lora">Lora
&lt;/h1>&lt;p>LoRA 是一种用于微调预训练模型的技术，通过在原始模型的基础上添加少量可训练的参数来实现对模型的微调。&lt;/p>
&lt;hr>
&lt;h1 id="footnotes">Footnotes
&lt;/h1>&lt;div class="footnotes" role="doc-endnotes">
&lt;hr>
&lt;ol>
&lt;li id="fn:1">
&lt;p>简单说就是，主要用于处理和理解图像信息，能够提取图像的特征表示，进而与文本特征进行对比和匹配等操作，以实现如根据文本描述生成相应图像、图像分类、图像检索等多种与图像和文本相关的任务&amp;#160;&lt;a href="#fnref:1" class="footnote-backref" role="doc-backlink">&amp;#x21a9;&amp;#xfe0e;&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/div></description></item><item><title>About me</title><link>https://www.jsongo.top/about/</link><pubDate>Fri, 22 Nov 2024 00:48:28 +0800</pubDate><guid>https://www.jsongo.top/about/</guid><description>&lt;img src="https://cdn.lyb.pub/2024/11/57bb06afa963ce540f0629c84f866978.png" alt="Featured image of post About me" />&lt;p>一个很普通的程序员，喜欢折腾，喜欢看书和思考。&lt;/p></description></item><item><title>Stable Diffusion 生图技术（一）</title><link>https://www.jsongo.top/articles/stable-diffusion-gen-image-1/</link><pubDate>Tue, 19 Nov 2024 16:36:27 +0800</pubDate><guid>https://www.jsongo.top/articles/stable-diffusion-gen-image-1/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/772c64fbb07e3cd46573602f922a7829.jpg" alt="Featured image of post Stable Diffusion 生图技术（一）" />&lt;h1 id="概述">概述
&lt;/h1>&lt;h2 id="背景">背景
&lt;/h2>&lt;p>Stable Diffusion 最初是由德国慕尼黑大学的 CompVis 研究小组、纽约的 RunwayML 公司等组成的国际研究团队开发的，后来 Stability AI 参与其中并推动了其发展。&lt;br>
Stable Diffusion 的发展历程如下：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/afb65322de6b531c0c01e86e6d27c0e0.webp"
width="900"
loading="lazy"
alt="|900"
>&lt;/p>
&lt;h2 id="技术简介">技术简介
&lt;/h2>&lt;p>Stable Diffusion 在模型架构中采用了 Transformer 架构的一些特性，基于扩散模型架构来生成图片。&lt;br>
它的原理用白话说，比较简单：加噪和去噪（专业术语叫前向扩散和反向扩散）。加噪后的图片主要用于训练或作为初始输入（latent），然后训练一个模型去实现某些图像生成目标（去噪过程）。&lt;/p>
&lt;ul>
&lt;li>&lt;strong>前向扩散&lt;/strong>：在前向阶段，通过向原始图像数据（如真实的照片或绘画）添加噪声，逐步将图像转换为纯噪声。这个过程是在多个时间步（time - steps）中完成的，每一步都按照一定的规则（通常是基于高斯分布）添加噪声，使得图像信息逐渐被噪声掩盖。例如，开始时图像可能还比较清晰，随着时间步的增加，图像越来越模糊，最终变成完全的噪声。&lt;/li>
&lt;li>&lt;strong>反向扩散&lt;/strong>：这是生成图像的关键阶段。从纯噪声开始，模型通过学习到的去噪过程，逐步恢复图像信息。模型会预测每个时间步中需要去除的噪声，经过多个时间步的迭代，最终生成一张类似于训练数据分布的图像。这个过程类似于从无序的噪声中逐渐 “雕刻” 出有意义的图像。&lt;/li>
&lt;/ul>
&lt;h1 id="生图过程">生图过程
&lt;/h1>&lt;p>&lt;img src="https://cdn.lyb.pub/2024/11/d66a5473be54d712b3aa8e879f9a8c3a.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;/p>
&lt;h2 id="模型-checkpoint跟采样的关系">模型 （Checkpoint）跟采样的关系
&lt;/h2>&lt;p>Checkpoint 包含了模型在特定训练阶段的所有权重、偏置以及优化器的状态等信息，而采样模型的参数是由 Checkpoint 所确定的，采样模型使用该 Checkpoint 中存储的权重和其他参数进行计算。不同的 Checkpoint 会导致采样模型在生成图像时表现出不同的性能和风格。例如，某些 Checkpoint 可能侧重于生成高分辨率的图像，而另一些可能更擅长生成具有特定艺术风格的图像。这是因为在训练过程中，不同的 Checkpoint 所对应的训练数据和训练目标可能有所不同，从而影响了采样模型的行为。&lt;/p>
&lt;h2 id="clip-text-encode">CLIP Text Encode
&lt;/h2>&lt;p>属于 Condition 节点，它用 CLIP 模型对文本 Prompt 进行编码，对模型生成的结果进行方向上的引导，其实可能理解为文本模型中的 embedding。&lt;/p>
&lt;h2 id="采样">采样
&lt;/h2>&lt;p>生图其实就是一个反向扩散的过程，从一个完全是噪声的图像开始，通过模型逐步去除噪声来生成图像。这个过程通过一个采样函数来实现，它基于模型预测的噪声来更新噪声图像。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/12/dd2433499e7a9229aa5bd816177c8988.webp"
loading="lazy"
>&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Steps&lt;/strong>，迭代生图，每次更新噪声图像，需要经过多个 Step 的迭代。随着 Step 反复执行，图像中的噪声逐渐减少，最终生成一个近似原始图像分布的图像。不过生成的图像质量可能会受到多种因素的影响，如模型的性能、采样方法、时间步数等。在实际应用中，可能需要对生成的图像进行后处理（如调整颜色、对比度等）来提高图像质量。&lt;/li>
&lt;li>&lt;strong>seed&lt;/strong>，种子值，用于初始化随机数生成器。相同的种子值在相同的模型和参数设置下会生成相同的图像，这有助于复现结果。&lt;/li>
&lt;li>&lt;strong>control_after_generate&lt;/strong>：这个参数可能与生成后的控制操作有关，例如对生成的图像进行随机化处理&lt;/li>
&lt;li>&lt;strong>steps&lt;/strong>：指生成过程中的迭代步数。步数越多，生成的图像通常会越精细，但也会增加计算时间。&lt;/li>
&lt;li>&lt;strong>cfg&lt;/strong>（Classifier-Free Guidance）：无分类器引导的强度，它是一种在生成式模型（如 Stable Diffusion）中用于引导图像生成方向的技术，决定了模型在生成图像时对正向提示（你希望在图像中出现的内容）的遵循程度。较高的 CFG 值会使生成的图像更紧密地遵循正向 Prompt，但也有可能导致图像过度拟合。
&lt;ul>
&lt;li>取值范围：
&lt;ul>
&lt;li>CFG 的值通常在 1 到 20 之间，理论上可以取更高的值，但在实际应用中，过高的值往往会导致图像质量下降。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>较低值（1 - 4）：
&lt;ul>
&lt;li>当 CFG 值较低时，生成的图像会更具随机性和创造性。模型对正向提示的遵循程度较弱，因此可能会生成一些与提示不太相关但具有独特创意的图像。这种情况下，图像可能会包含一些意外的元素或风格。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>中等值（4 - 10）：
&lt;ul>
&lt;li>在这个范围内，是比较常用的取值。模型会在遵循正向提示和保持一定的创造性之间取得较好的平衡。能够生成与提示较为符合的图像，同时也不会显得过于刻板。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>较高值（10 - 20）：
&lt;ul>
&lt;li>当 CFG 值较高时，生成的图像会非常紧密地遵循正向提示。这可能会导致图像过于 “完美” 地符合提示，但也可能会出现一些问题，比如图像的细节可能会显得不自然，色彩可能会过于饱和，或者图像可能会失去一些自然的随机性和美感&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;strong>sampler_name&lt;/strong>：这是指采样器的名称。不同的采样器（如 Euler、Langevin 等）有不同的特性，会影响图像生成的速度和质量。&lt;/li>
&lt;li>&lt;strong>scheduler&lt;/strong>：调度器，用于控制生成过程中的步长和其他参数。不同的调度器会影响生成的效率和结果。&lt;/li>
&lt;li>&lt;strong>denoise&lt;/strong>：去噪参数控制生成过程中对噪声的去除程度。较低的去噪值会使生成的图像更具随机性，而较高的值会使图像更平滑和可预测。&lt;/li>
&lt;/ul>
&lt;h2 id="vae-decoder变分自解码器">VAE Decoder（变分自解码器）
&lt;/h2>&lt;p>图像数据往往是高维的，包含大量的像素信息，所以一般训练和计算时，往往要压缩到低维来处理，用更紧凑的方式表示图像的关键特征，就像文本模型中的 Embedding 处理，变成稠密的数据，在图像处理领域叫潜在空间（Latent Space）。而解码器则是将潜在空间中的表示再转换回图像数据空间，尽可能地重建原始图像。&lt;br>
生成新图的过程，由于潜在空间是连续的，稍微改变潜在空间中的向量值，就可以生成与原始图像在某些特征上有所变化的新图像。例如，在生成人脸图像的 VAE 模型中，在潜在空间中沿着某个方向移动向量可能会改变人脸的表情、发型或者年龄等特征。&lt;/p>
&lt;h2 id="latent-image">Latent Image
&lt;/h2>&lt;p>一般在整个 ComfyUI 流程中，会插入一张空的（Empty） Lantent Image，它提供了一个初始的 “画布”，让模型在这个基础上进行生成或转换操作。&lt;br>
当然如果是对已有的图片进行调整、修复或优化，则可以把空的图换成一张现成的图片，这时就要把它加载并转换为合适的潜在表示形式后，可以作为生成过程的起点。在 ComfyUI 中，可能涉及到将图片通过适当的预处理步骤，如调整大小、归一化等操作后，然后将其编码为潜在空间中的表示，这样就可以基于已有的图像内容进行修改、风格转换或者其他生成操作。&lt;/p>
&lt;h1 id="stability-ai-官方">Stability AI 官方
&lt;/h1>&lt;p>Stable Diffusion 的官方可用的模型，可以从 API 文档中看到： &lt;a class="link" href="https://platform.stability.ai/pricing" target="_blank" rel="noopener"
>Stability AI - Developer Platform&lt;/a>。最新的是 SD 3.5（2024 年 11 月）。&lt;/p>
&lt;ul>
&lt;li>1 credit = $0.01&lt;/li>
&lt;li>这么算，生成一张 SD 3.5 的图片，medium 要 $0.035，差不多 0.25 元，4 张 1 块。&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/11/207f1abc8b1be591d3f76ec236344c3c.webp"
width="700"
loading="lazy"
alt="736deaffc1c02497df089d14539fba5d_MD5|700"
>&lt;/li>
&lt;/ul>
&lt;h2 id="体验">体验
&lt;/h2>&lt;p>&lt;a class="link" href="https://stabledifffusion.com/tools/ai-image-generator" target="_blank" rel="noopener"
>Free AI Image Generator - Turn Text to Image Online | Stable Diffusion Online&lt;/a>&lt;/p>
&lt;h1 id="字节的-lighting-模型">字节的 Lighting 模型
&lt;/h1>&lt;p>&lt;a class="link" href="https://huggingface.co/ByteDance/SDXL-Lightning" target="_blank" rel="noopener"
>ByteDance/SDXL-Lightning at main&lt;/a> 字节的这个模型生成效果相当不错。&lt;br>
它同时提供了 Full UNet 和 LoRA 版本，都是相对比较小的蒸馏模型（虽然 UNet 也有几个 G）。&lt;/p>
&lt;blockquote>
&lt;p>We provide both full UNet and LoRA checkpoints. The full UNet models have the best quality while the LoRA models can be applied to other base models.&lt;/p>
&lt;/blockquote>
&lt;h2 id="小科普可跳过">小科普（可跳过）
&lt;/h2>&lt;h3 id="概念">概念
&lt;/h3>&lt;ul>
&lt;li>UNet 是卷积神经网络（CNN）的一种特殊架构，在生成对抗网络 (GANs) 和扩散模型中广泛使用。它是一种完整的网络架构，专门用于图像分割任务，从输入图像到输出分割结果，有自己独立的结构和训练流程。&lt;/li>
&lt;li>LoRA 不是一种独立的网络架构，而是一种模型微调策略，可以应用于各种现有的预训练模型（包括但不限于基于 UNet 架构的模型），用于在不大量修改原始模型结构的情况下进行任务适配。&lt;/li>
&lt;/ul>
&lt;h3 id="从参数规模与训练成本来看">从参数规模与训练成本来看
&lt;/h3>&lt;ul>
&lt;li>&lt;strong>UNet&lt;/strong>：在训练过程中，需要对整个网络的参数进行学习和更新，尤其是在处理高分辨率图像或复杂任务时，可能需要大量的训练数据和计算资源。&lt;/li>
&lt;li>&lt;strong>LoRA&lt;/strong>：通过低秩分解减少了需要训练的参数数量，在对大型预训练模型进行微调时，训练成本显著降低，对数据量的要求也相对较少。&lt;br>
UNet 的模型一般都比较大：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/11/8f1f152a35835044e0ea8fc381a9333b.webp"
width="475"
loading="lazy"
alt="|475"
>&lt;br>
LoRA 则小很多&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/11/36b48790266f80b2cb03cfc22ded0f13.webp"
width="475"
loading="lazy"
alt="|475"
>&lt;/li>
&lt;/ul>
&lt;h2 id="使用">使用
&lt;/h2>&lt;p>它们都有 2-Step, 4-Step, 8-Step，其中 1-step 只是实验性的、效果不好、质量不稳定，一般建议用折中的 4-step，如果资源充足可以选质量最好的 8-step。&lt;br>
ComfyUI 中的使用非常简单：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/11/fc799454d0483ec8b7fea253e7ce45e4.webp"
width="675"
loading="lazy"
alt="|675"
>&lt;br>
如果只是想玩玩，可以直接在 huggingface 上试试：&lt;a class="link" href="https://huggingface.co/spaces/ByteDance/SDXL-Lightning" target="_blank" rel="noopener"
>SDXL-Lightning spaces&lt;/a> ，效果还是不错的：&lt;br>
&lt;img src="https://cdn.lyb.pub/2024/11/22638b08323398c180c2d2ff0d1e59f8.webp"
width="700"
loading="lazy"
alt="|700"
>&lt;/p></description></item><item><title>成本思维</title><link>https://www.jsongo.top/articles/thoughts/cost-thinking/</link><pubDate>Sun, 03 Nov 2024 13:35:12 +0800</pubDate><guid>https://www.jsongo.top/articles/thoughts/cost-thinking/</guid><description>&lt;img src="https://cdn.lyb.pub/2024/11/053cc313b6d764b5ee7d6b645fdca2bc.jpg" alt="Featured image of post 成本思维" />&lt;h1 id="成本思维">成本思维
&lt;/h1>&lt;p>大多数看起来有所利益的事情，肯定有成本，而且有风险。风险本质上也是一种成本。&lt;br>
用成本 + 风险的思维来看问题，不要只想着好处。成本和风险往往是在巨大的利益面前，特别容易被忽视的东西。&lt;br>
塔勒布在《非对称风险》中表达了一个观点，他反复提到在真实的世界里，一定要风险共担，如果有人不愿意承担风险，却要享受好处，这样的人是有问题的。&lt;/p>
&lt;h2 id="企业最大的成本是老大的决策成本">企业最大的成本，是老大的决策成本
&lt;/h2>&lt;p>如果动不动就来个调整，发现不对，马上再折腾几回，这损耗的是非常大的。决策成功率越低，企业就会被越来越快消磨掉。我们说大公司病，其实有一层逻辑是：公司小的时候，10 个决策中，有一两个正确的决策可能就能把营收和规模做上来；但当公司越来越大的时候，10 个决策中如果有一两个决策做错了，那都是在损耗。所以大公司病往往不是因为决策人变笨了，而是企业到了那个阶段，决策的成本变高了。&lt;br>
看过一篇文章《&lt;a class="link" href="https://news.qq.com/rain/a/20241015A04JNI00" target="_blank" rel="noopener"
>只有 10%的产品值得用 AI 再做一遍&lt;/a>》，标题就直接表明了作者的观点。文中提到了 AI 时代，各大厂争先恐后地攻城略地，但后来发现，做了很多产品功能都是徒劳，浪费了很多资源。比如：&lt;/p>
&lt;ul>
&lt;li>支小宝虽有创意但操作路径复杂且多数功能未发挥 AI 能力；
&lt;blockquote>
&lt;pre>&lt;code>如果我用支小宝坐公交，我需要把 APP 打开，点开对话，再输入指令“我要坐公交”，等待 2-3s 加载出来，这个过程至少需要 5s 以上。
实际上，用手机的 NFC 直接刷码上车，不需要打开任何 App 就完成了这个操作。
&lt;/code>&lt;/pre>
&lt;/blockquote>
&lt;/li>
&lt;li>淘宝问问、京东京言等电商 AI 助手功能空泛、多轮对话理解能力差且 AI 划重点功能无实际价值；&lt;/li>
&lt;li>饿了么的 AI 评价总结功能上线又下线，因为既无价值还浪费费用；&lt;/li>
&lt;li>携程问道生成的内容干巴巴且缺乏实用性。&lt;br>
这些都表明很多产品为跟上 AI 潮流而做 AI，未解决用户痛点，在未成熟阶段盲目投入，造成大师的资源浪费。&lt;br>
当然也不能说探索就是浪费，只是想表达决策是需要成本的，而且经常是最大的企业成本。&lt;/li>
&lt;/ul>
&lt;h2 id="制度本身也要成本">制度本身也要成本
&lt;/h2>&lt;p>坏的制度增加企业&lt;strong>成本&lt;/strong>，而好的制度是降低企业&lt;strong>成本&lt;/strong>的。&lt;br>
制度虽然有时让人诟病，但它们能带来一些确定性。一个集体如果制度有问题，一方面在遇到事时，经常会有模棱两可的疑惑，直到有个人做了表率，其它人慢慢地也跟上了。到后来，大家苦于不合理制度的约束，他们可能会不断地试探，直到看到不好的信号或良心觉得不妥，从而确定了一个心里底线，形成了自己的“制度”。&lt;br>
刘润讲到一个案例：一家文化教育的企业，老板从来不管教学质量，这家公司里的老师能偷懒就偷懒，因为没有制度去管理他们，慢慢的好老师就都走了，留下的越来越烂，这是会传染的。&lt;br>
问题制度带来的成本，就是人才流失，导致最后没有优秀的人来高效的做事，成本急剧增加。&lt;/p>
&lt;blockquote>
&lt;p>题外话，刘润在书中提到，对公司的管理的三种手段：&lt;/p>
&lt;ul>
&lt;li>鼓励白，即激励一些对的事；&lt;/li>
&lt;li>压缩灰，即用文化作为共同的价值观，给大家一个底层的判断标准，从而遇到模棱两可的事时能有一个基础的良知判断；&lt;/li>
&lt;li>禁止黑，即什么事一定不能做，这是一个更强硬的制度，防止公司烂掉。&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h2 id="团队的规模也有成本">团队的规模也有成本
&lt;/h2>&lt;p>我在之前的其它文章里提到了亚马逊的 &lt;code>Two Pizza team&lt;/code> 原则：&lt;/p>
&lt;blockquote>
&lt;p>把整个系统拆分成微服务或独立模块，不同的 team 各负责一个单位的事情。Two Pizza team 是指用两块 pizza 就能吃饱的团队规模，一个业务的团队超过了这个规模，信息传递的成本就很高，沟通协作就变得困难。&lt;/p>
&lt;/blockquote>
&lt;p>小团队沟通高效，目标也容易对齐。团队大了经常要各种对齐，很多时间花在开会上。很多会都是用来同步信息的，没有它们反而可以跑的更快。所以团队规模越来，沟通协作的成本越高，这些都是决策时要考虑的成本问题。&lt;/p>
&lt;h2 id="机会成本">机会成本
&lt;/h2>&lt;p>那些看似免费或便宜的东西、或能直接带来利益的事情，往往也是有机会&lt;strong>成本&lt;/strong>的。你可能要花挺多时间在上面，研究它到底对你有没有用，是忽悠人还是可能有少许好处可以捞。&lt;br>
总之不管什么样的情况，你总需要付出时间，要拿机会&lt;strong>成本&lt;/strong>来换，而且很多并不划算，你完全可以拿这些时间来做更有价值的事情。&lt;br>
忘了哪本书里提到：&lt;br>
你得到的越多，选择放弃的机会成本就越大，就越不敢往前走，就越需要勇气和智慧。&lt;br>
另外还有社交，也是要成本。放弃无效社交，它们会占用你原本可用于提升自己的时间。&lt;br>
总之，如果尝试用成本思维去思考下，你很可能会得出不一定的决策。&lt;/p>
&lt;h1 id="阅读">阅读
&lt;/h1>&lt;p>这周还在阅读子皮的《价值生长》。再分享一个有趣的观点：人一辈子抓住几次机会就够了，不用怕有什么好机会在眼前错过了。&lt;br>
永远把质量排在第一位，弱水三千，只取一瓢。在自己擅长的领域，找到绝对信任的人、靠谱的事，哪怕只搭上一趟火箭就够了。&lt;br>
买股票也一样，不要怕错过什么妖股、潜力股，那太多了。全都要的话，你的钱根本不够用，也不用天天去刷 K 线、抢先看新闻、生怕错过，找到一些真正有价值的，投入并在一段时间内看好它、坚定持有，长期看是会给你带来回报的。&lt;br>
不过不管怎么样，保住本金还是第一要务，不要乱投，耐心地蹲守、观察，找准时机再动手。&lt;/p>
&lt;blockquote>
&lt;p>投资的第一条原则 ，永远不要失去本金；第二条原则，牢牢记住第一条。—— 巴菲特&lt;/p>
&lt;/blockquote></description></item><item><title>打开心智 - 读书笔记</title><link>https://www.jsongo.top/articles/unlock-the-mind/</link><pubDate>Tue, 29 Oct 2024 00:08:41 +0800</pubDate><guid>https://www.jsongo.top/articles/unlock-the-mind/</guid><description>&lt;img src="https://cdn.lyb.pub/2024/11/82c4155b2681df9665519ffb08d4e346.jpeg" alt="Featured image of post 打开心智 - 读书笔记" />&lt;h1 id="一如何阅读">一、如何阅读
&lt;/h1>&lt;h2 id="避免做题式的阅读那到底要怎么读怎么用这个方法来改变我的阅读习惯">避免做题式的阅读，那到底要怎么读，怎么用这个方法来改变我的阅读习惯？
&lt;/h2>&lt;h3 id="避免备考式的阅读">避免备考式的阅读
&lt;/h3>&lt;p>之前看书，大都是从头看到尾，没意识地想去把整本书的结构都理清楚，最后还会把所有的重点都整理出来、形成一个比较大的笔记。&lt;br>
最近在阅读《打开心智》，里面提到的不太好的阅读习惯，貌似每条都在说我。想想确实很有道理，不过主要还是习惯、观念和心态的问题。观念是可以改变的，但就是比较顽固；习惯则可以通过培养和践行新习惯来覆盖；而心态可能就是一个需要比较漫长的磨练，才能去改变的。&lt;br>
书里主要提倡“以我为主，为我所用”的阅读习惯。书中内容的结构、甚至作者的看法都不重要，我自己的看法才重要，也就是它对我的思维造成了什么影响，给我带来了什么帮助。&lt;br>
书中提到一个“计数器陷阱”，讲的是太过追求数量，设置错了目标（即使也是按 smart 原则来制订的）。“为我所用”才是真正的上的。&lt;br>
不要去追求看完、看几本，这些数量并不是我的目的，但我之前常把它们当目的。&lt;br>
也不用追求把一本书里的知识全掌握，这不是在备考，可能我们都没太注意到，中学时留下的一些习惯一直跟着大多数人。除非看那种比较体系的教材去体系化的学习。大部分书，挑对自己有用、自己感兴趣的部分去阅读就好，或者每个阶段都有自己感兴趣的主题，可能后面还会翻到这本书。&lt;/p>
&lt;h3 id="主动式地学习经验--提炼--看书完善--强化方法论">主动式地学习：经验 -&amp;gt;提炼 -&amp;gt;看书完善 -&amp;gt;强化方法论
&lt;/h3>&lt;p>作者在书中给了一个模型：&lt;br>
![[assets/local_image_plus/7854b0e4882ba4957ecba9e5d142f1fd_MD5.jpg]]&lt;br>
从实践运用中去获取一些经验，提炼出思维模型或行为模型，然后通过阅读去完善这些模型，甚至去完全纠正。不过也没关系，有了实践，再去思考，肯定会比光思考深刻很多，理解的更透。&lt;br>
带着问题去阅读，是主动式学习的最好方式。开始看一本书的时候，先通过目录去思考有哪些内容跟我现阶段感兴趣的事情相关，我想通过阅读它来弄懂什么问题，就比如现在的这个过程，就是在回答一个问题。最终我要能得到一个答案，可能是一个观点，也可能是改变我习惯的方法，也可能是一种新的思维，也或者是打开了一个新领域的知识，让我产生了新的兴趣，开始系统地去学习，等等，这些都是收获。&lt;/p>
&lt;h3 id="作者的例子">作者的例子
&lt;/h3>&lt;p>他发现自己的知识不成体系，怎么整理好像都没用。于是通过实践思考总结出了需要让知识流动起来才有用，于是去学习了 GTD 的方法（通过阅读等），把里面的思想和理念跟自己的想法结合，总结出了一个知识管理模型。后面的阅读、思考过程中，都在完善他的这个模型，得出自己实用的方法。&lt;/p>
&lt;h3 id="想法">想法
&lt;/h3>&lt;ul>
&lt;li>或许可以把我收藏的书的目录，收集起来，然后喂给大模型，未来想看某些主题的时候就让大模型去帮我找出合适的章节。可以在 coze 上去实现这个功能。&lt;/li>
&lt;li>用 python 写，去抓微信读书上的内容&lt;/li>
&lt;li>展示的时候，让大模型做下格式化&lt;/li>
&lt;li>我把相关的书发给它，它给我返回列表，我选择相关的书籍查看目录结构，然后能导入我的知识库，直接做向量化，后面用于做检索&lt;/li>
&lt;li>检索也在 coze 上面实现，可能得想想怎么打通到知识库，动态补充&lt;/li>
&lt;/ul>
&lt;h2 id="如何通过边阅读边思考来记忆知识点而不是读过就忘了另外怎么把这些知识点形成体系结构">如何通过边阅读边思考来记忆知识点，而不是读过就忘了，另外怎么把这些知识点形成体系结构
&lt;/h2>&lt;h3 id="关于记忆">关于记忆
&lt;/h3>&lt;p>3 种阅读方式：照抄、看结构回忆，以及完全自由的回想。&lt;/p>
&lt;ul>
&lt;li>第一种，基本都没怎么经过思考，也是我之前做读书笔记的方式，一直想去梳理出书的结构、以及作者的写作思路。但这些真的重要吗，我去了解书的结构干嘛，要理完整个结构那就是要通读整本书。但真没太多必要，理完也没怎么思考，就是整理出了一个文档，平时需要的时候可以查看，把纸书电子化了，也自己结构化了一遍。&lt;/li>
&lt;li>第二种 ，看结构（脑图、目录等）去回忆，这里面也是有一点想把整个知识点都消化掉的思路。刻意去回忆，确实能加深记忆，不定时地去看，根据记忆遗忘曲线是可以记住更多的内容。不过想想，这不就是备考的思路吗，为啥要去背知识点呢？背不是目的。&lt;/li>
&lt;li>第三种，自由回想，一方面把一些记忆深刻的点 recall 出来，另一方面自由地随想，可能会创建一些意外的关联。还有一点更重要的是，想到一些点，就要去结合自身的行为、习惯、思维方式去思考，要有一些收获，或者改变，可能是行为习惯上的、也可能是思维方式上的，能有一些不一样的收获就好。&lt;/li>
&lt;/ul>
&lt;h3 id="知识结构">知识结构
&lt;/h3>&lt;p>读不同的知识点，可以逐步地完善自己的知识结构。这个词我的认知一直是构建一个脑图，把不同的知识点、结构分支等整理上去，形成一个树状或网状的结构。后者没法用脑图表示。&lt;br>
那有什么软件或工具能更好的描绘出我的知识结构呢？&lt;br>
理下目前知道的工具主要有：&lt;/p>
&lt;ul>
&lt;li>飞书画脑图工具、processon 的脑图，这两个可以画回路；&lt;/li>
&lt;li>标签体系，如 flomo，可惜它没有可视化，只能通过点标签目录去大概看出网状，而且是得用标签查询去找线索；&lt;br>
![[assets/local_image_plus/65355c728f54c7468e9b262411f74a72_MD5.jpg]]&lt;br>
← 像这种标签树，看起来也是一种可视化，但它有两个问题，一是只是一个图，没法链接；另一方面是它没法通过两个标签来定位一个知识点，即没法网状地找东西。&lt;/li>
&lt;li>flowUs 的脑图，每个节点都是一个 block，这个很创新，可以建立很多链接，我觉得是一个不错的建立知识库的工具，不过可能要实践探索一下，目前还没有比较系统的思路。&lt;/li>
&lt;/ul>
&lt;h3 id="心态">心态
&lt;/h3>&lt;ul>
&lt;li>没必要去记住或用上书里提到的每一个知识点，这不是要去考试；&lt;/li>
&lt;li>书不要看完，培养自己能释怀的心态，不要老追求从头到尾读完每一本书，这中间会浪费很多时间，虽然这样经常会有一些额外的收获，但就像刘润讲的，从沙子里挑出较大的金子，其它较细的金沙没必要去慢慢抠，读书是淘金，而且密度很高，但粒度不同，书有很多，没必要每次都要把金子收集干净；&lt;/li>
&lt;/ul>
&lt;h3 id="正确的使用知识">正确的使用知识
&lt;/h3>&lt;ul>
&lt;li>获得核心的知识点，与自己结合，给自己带来收获或改变&lt;/li>
&lt;li>数据和细节等，记到一个笔记里就行，后面通过 AI 来对接，让 AI 帮你 retrieve，不用去记&lt;/li>
&lt;li>大知识点形成结构，笔记里画脑图记下来，链接起来，不求多，这主要是为了形成更深刻的知识结构，时不时看，在脑子里刻下来&lt;/li>
&lt;li>弄个工具去查找未接触的知识或内容，如书籍，向量化并通过 AI 来查找&lt;br>
之前看书，大都是从头看到尾，没意识地想去把整本书的结构都理清楚，最后还会把所有的重点都整理出来、形成一个比较大的笔记。&lt;br>
最近在阅读《打开心智》，里面提到的不太好的阅读习惯，貌似每条都在说我。想想确实很有道理，不过主要还是习惯、观念和心态的问题。观念是可以改变的，但就是比较顽固；习惯则可以通过培养和践行新习惯来覆盖；而心态可能就是一个需要比较漫长的磨练，才能去改变的。&lt;br>
书里主要提倡“以我为主，为我所用”的阅读习惯。书中内容的结构、甚至作者的看法都不重要，我自己的看法才重要，也就是它对我的思维造成了什么影响，给我带来了什么帮助。&lt;br>
书中提到一个“计数器陷阱”，讲的是太过追求数量，设置错了目标（即使也是按 smart 原则来制订的）。“为我所用”才是真正的上的。&lt;br>
不要去追求看完、看几本，这些数量并不是我的目的，但我之前常把它们当目的。&lt;br>
也不用追求把一本书里的知识全掌握，这不是在备考，可能我们都没太注意到，中学时留下的一些习惯一直跟着大多数人。除非看那种比较体系的教材去体系化的学习。大部分书，挑对自己有用、自己感兴趣的部分去阅读就好，或者每个阶段都有自己感兴趣的主题，可能后面还会翻到这本书。&lt;/li>
&lt;/ul>
&lt;h1 id="二构建知识体系">二、构建知识体系
&lt;/h1>&lt;h2 id="怎么构建自己的知识体系--inkp">怎么构建自己的知识体系 － INKP
&lt;/h2>&lt;p>作者提出了 INKP 理论，我再结合最近在使用的 flowUs 软件，做一些梳理和结合，给一些实践和方法。&lt;/p>
&lt;ul>
&lt;li>Inbox&lt;/li>
&lt;li>阅读时，有一些好的点子或想法，都可以快速放到 inbox 里，一条一条记
&lt;ul>
&lt;li>可以创建一个页面，也可以用 flomo 来写。这里涉及到一个观念：创建页面感觉比用 flomo 快速在输入框里写一条记录更重些。为什么会有这种感觉，我想主要还是因为页面里，整个区域都是输入区，给人比较大的压力，觉得要写很多才不会浪费；而 flomo 像聊天窗口一样，只有底部有一个输入框，看起来压力很小，就是记录一张小卡片。另外 notion 类软件也是要删除两次才能彻底删除，简单的删除，它的链接什么的都还在，还可以打开这个文档，而且“最近打开”的列表里还有它，总感觉它还在占着空间。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>平时突然有一些好想法，也可以写到这个 Inbox 里&lt;/li>
&lt;li>Note&lt;/li>
&lt;li>主要就是记录一些概念，最重要的是，得经常去整理 inbox 的内容，把相关的概念弄清楚，然后打上一些标签之类的&lt;/li>
&lt;li>所以是不是 inbox 和 note 都用 flomo 来记，然后整理好的、比较确定的概念都落到 notion 类的笔记软件里，这些概念后面可能会被引用&lt;/li>
&lt;li>Knowledge&lt;/li>
&lt;li>实际上就是一个主题，比如“克服拖延”、“情绪”、“专注力”，它也是一个独立的页面，所有跟这个主题相关的，如果比较小，可以直接写进去，如果内容比较多，则可以链接进去。&lt;/li>
&lt;li>这个 knowledge 页面，就是这个主题的根据地，所有跟它相关的都要可以在这里找到&lt;/li>
&lt;li>这页面也要抽时间去做些结构上的整理，比如可以弄个脑图，或者整理下目录结构。flowUs 的脑图是一个非常好的工具，它每个节点是一个 block，可以做一些链接，让知识形成树状，同时链接也能把各个地方的知识连到一起，形成网状。知识树、链接网。&lt;/li>
&lt;li>如果一个概念，是跟这个主题相关，但又不太好归类或嵌入到架构合适的地方，那可以在页面底部加一个相关知识点，把这些整理进去。这样至少能保证相关的内容，都可以在这里找到的。&lt;/li>
&lt;li>用主题的方式，而不是标签的方式来关联，好处是它会被整理成一个整体，标签拉出来的笔记列表，它没法调顺序和结构，只能是一堆知识堆积，所以卡片笔记也是有弱点的。缺点就是得花时间去整理。&lt;/li>
&lt;li>主题页面，需不需要整理的很正式、甚至可以拿去发表的呢？其实有两种情况，一种是主题本身就比较简单，整理出来的东西，如果时间充足，就可以优化下表达、整个就是一篇可发表的小论文；另一种情况是，这个主题很复杂，还要添加很多知识才能看起来是完整的，要不读起来感觉东缺一块、西漏一些，整篇内容就显得不严谨。后面这种情况，结构整理起来也会比较复杂，可能会经常调整，随时都可能有变化。
&lt;ul>
&lt;li>所以如果要发表的话，直接用笔记是最合适的，flowUs 是可以，不过有个小问题是，所有的改动马上就直接发出去了，缺少一个发布的动作；notion 也有这个问题，语雀和印象笔记可能好一些，但印象的性能/体验实在不太行。&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>Project&lt;/li>
&lt;li>由多个主题汇总而成， 当然这些主题也需要有关联，而且要能形成一个更大的知识体系。&lt;/li>
&lt;li>比如原则 2（应对变化中的世界秩序），把政治秩序、经济周期结合起来，通过对周期规律的分析来预测当下的环境、以及未来的发展趋势。经济周期里，包含了货币、信贷和经济活动等，每个都是一个大主题；而政治秩序双分为了内部秩序（内部的政权迭代）、外部的政治环境等等，每个也是一个主题。这么多主题最终形成了一个大周期的理论，它们之间的关系不是平铺的，而是有点树状的结构&lt;/li>
&lt;/ul>
&lt;h2 id="实践-inkp">实践 INKP
&lt;/h2>&lt;h3 id="基本操作流程">基本操作流程
&lt;/h3>&lt;p>平时有什么不错的输入，或好的想法，先记录到 inbox 笔记中，比如我的“随手记”目录中。快速写下当时触动我的点，简单些，也可以只写关键字。重要的是后面能明白是什么，以及不要打断太久当前的阅读。重在快速和写对点。&lt;br>
接着，晚上的时候，在书桌前打开电脑后，就先一个个的过 inbox，扩写下，补充查询些资料，升级成理论或概念，抽象出核心观点短语作为标题，从 inbox 移出，放到具体的分类目录里。如果跟某个主题相关，那么可以整个进去，看是在主题结构的哪个位置，整理整理。但如果是一个新主题，可能就要新建一个主题页面。&lt;br>
如果是比较大、比较复杂的概念，则可以在标题上加个待处理的标识，等周末或工作日有空时统一处理。&lt;br>
建立关联很重要，一方面是上文提到的归入某个主题，另一方面也有可能只是跟某个概念有关，那就找到相关的那个概念笔记，链接进去，notion 类产品会在底部显示本文档被那些地方引用，所以其实可以在目标概念文档、或主题文档中，通过行内链接的形式把文档关联进去。&lt;br>
周末抽半小时到一小时整理这周的待处理，查资料、问 AI，或者找视频资料等，学习并整合进去。如果发现某个主题比较完善，可以把它发表出来，如写入 thinking 或整理成一个主题分享，用费曼学习法反推自己更深入、更及时地学习下这个主题，沉淀下来，分享出去。&lt;br>
作者还有一个方法，为了避免笔记太多、内容太重复、知识层级太深或叶子结点过多，他每整理完一个概念笔记，或某些主题笔记，不再直接用它时，就把笔记归档。我理解这个归档其实可以平铺放入一个 archived 目录下，里面的东西不是没用，而是不会再直接去打开它，只会通过知识框架链接进去找他。这个方法很重要，要不然知识架构，跟目录就完全脱节，得另外维护一个脑图等，同步是个问题，不过也可能是更好的办法，这个得通过实践去看看哪种更适合自己。&lt;br>
可以把某个主题的笔记的复习任务，安排到某周的待办事项里，挤时间去整理它。要认真去经营自己的知识结构，回顾或复习，也不能漫无目的、随机的复习，平时整理笔记的时候，总会想到哪个主题最近得再复习整理下。&lt;br>
最后，项目是解决一个问题，比如提高自己的工作效率，涉及几个主题，去专注力、咖啡的研究、某个技能 等。&lt;br>
一个项目，可以有一些基础的配置：计划、方案或思路等，都可以链接到这个主页里。&lt;br>
当我在进行一个项目时，其实可以把 inbox 分个专业的类别，在 inbox 目录里，以项目或主题来全名。这样收集到的信息都会收敛到里面，晚上在整理的时候也能在 inbox 里看到他们。&lt;/p>
&lt;h3 id="主题和项目有什么明显的区别怎么区分呢">主题和项目有什么明显的区别，怎么区分呢
&lt;/h3>&lt;p>综合下，上面其实陆陆续续提到了一些。&lt;/p>
&lt;ul>
&lt;li>主题一般是一个比较小的话题，可能就是一个点，里面可以有多个概念 (note)，它们聚合起来充分地解释了这个主题的各个方面。&lt;/li>
&lt;li>例子先说 note，即概念，如精神内耗，这是个什么概念，有什么危害，我有没这方面的问题，要怎么避免&lt;/li>
&lt;li>然后就是主题，上面这个概念，可能涉及到生活质量、拖延、情绪调控等主题，如生活质量这是一个我追求的主题，里面肯定会涉及到“精神内耗”相关的东西，所以在生活质量的主题下，就会把精神内耗链接进去（行内链接）。&lt;/li>
&lt;li>项目，则是一个动作或一个很大的主题。&lt;/li>
&lt;li>例子：品质生活，涉及精神层面的提升生活质量，也涉及改善生活条件（居住环境、财务情况等），这个项目就要多个方面去推进。&lt;/li>
&lt;li>我其实还有一个领域的概念，它是某个方面的东西聚焦，比如家族、生活、读书笔记等，它们不是主题、也不是项目，不太好归类到里面去。它们往往是一个较大的同一类型的内容集合，跟项目可能就是平行的关系，并不是包含关系。&lt;br>
作者给的另一个比较形象的例子：看到一篇讲“会员积分体系”的文章，开一个 note 记录下，然后里面没讲清楚的地方，还可以继续查更多的资料（最后加一个参考资料的部分）。然后整理的时候，想到会员积分体系，其实是一种“激励”，也是一种“游戏化”、“增长黑客”等主题里的知识点，于是链接进去。后来，作者想起一个项目，做一个“内容社区”，这时这相关的主题也都可以引用到，基于相关的主题可以做些什么方面的规划和设计。&lt;br>
另一个例子，比较简单，即睡眠 (K) 这个主题，下面包含了“晨型和夜型”、“睡眠周期”、“睡眠对记忆的作用”、“睡眠与情绪”、“为什么我们需要睡眠”等这些概念 (N)。&lt;br>
&lt;strong>主题构成了我们知识体系的主干&lt;/strong>，而&lt;strong>概念则是比较零散的知识点小枝叶&lt;/strong>，没有主干来组织，就是散落一地的枝条叶片。而&lt;strong>项目则是做一张桌子&lt;/strong>，它可以从这棵树上切一条枝干做桌腿，从另一个更粗的树干中切出一片桌面，最后组装成一张桌子（当然这个例子不一定恰当，因为并不是真的“切”，而是一种可以无限复制的副本，切掉还在的情况，因为内容不会消失。领域呢，则是一个平行的东西，它研究的是苹果树、柳树、白桦树等，跟前面讲的不是一个位面的，但也可以有相互的包含，比如白桦树干比较坚挺，更适合做出什么样的成品等。&lt;br>
另外，主题、项目 一般也需要用脑图来组织。主题好理解，其实就是把树画出来（脑图跟树很像），而项目，则主要是用脑图来做一些整理，结构可能（前几层级）大体相同。这些画出来的脑图其实就是比较图形化的知识结构，好记，都是我的知识结构，打开一看就知道大体有哪些东西。&lt;/li>
&lt;/ul>
&lt;h3 id="自上而下还是自下而上">自上而下、还是自下而上
&lt;/h3>&lt;p>平时的记录，肯定是散乱的，这时应该是先有内容，自下而上。但其实一直是这么被动的整理，一方面知识体系不一定完整，另一方面也漫无目的、不知道什么时候是个头。所以作者给的建议是，先积累一波概念（素材），然后找个周末的时间建立主题结构，可以通过 AI 辅助、也可以请教别人，把结构画出来之后，再针对性地去研究每一个还没有涉及到的概念知识点。&lt;br>
这是一种先建立框架，再填充框架的思路。把自下而上和自上而下结合起来。&lt;br>
这里说的“上”是指主题 (K)，“下”是指概念或知识点 (N)。&lt;/p>
&lt;h3 id="总结">总结
&lt;/h3>&lt;p>简单一句话概括：&lt;strong>主题是小话题，项目是一次研究或改变，领域是一个学科、或一个方面的专业知识&lt;/strong>。不一定要区分的很清楚，大概判断下就行。&lt;br>
其实要建设好自己的知识体系，最最核心的还是要经常去整理，上面讨论了那么多，主要还是在讲整理的方法，如果压根就没时间腾出来去做整理，上面讲再多也是白搭。&lt;/p>
&lt;h1 id="三创造">三、创造
&lt;/h1>&lt;h2 id="作者关于创造的观点和方法是什么样的">作者关于创造的观点和方法是什么样的
&lt;/h2>&lt;p>你创造的东西定义了别人眼中你是一个什么样的人，而不是你拥有的东西定义的，拥有的只能定义出你是富人还是穷人，有什么样的品味和爱好。&lt;br>
时间管理的目的，是减少要做的事情，而不是增加。把很多价值不怎么大的事情规划出去，留下能创造价值的事，然后找到效率高的时间去更好的实现它。&lt;br>
创造是一种快乐，甚至是一在充实人生的意义。打个简单的比方，你去一个地方旅游，自己拍拍照，朋友圈晒一晒，这是消费的快乐，一下子就过去了。但如果你做了一个攻略，整理得自己都很满意，发布出去，别人看了之后也能得到帮助，经常有人评论或点赞，那就是创造之乐，它会持续地带来惊喜。而且这是你的一个“标志”，别人通过这个标志产生对你的第一印象。&lt;/p>
&lt;h2 id="找到自己喜欢的事情是什么">找到自己喜欢的事情是什么
&lt;/h2>&lt;p>去体验不同的事情，去接触不同的人，认识不同行业、不同思维方式的人，从他们身上找到能给你带来较持久激情、让你兴奋的事。当看到它的那一刻，你可能就知道这就是你的“公理”。所谓的“公理”是借用的数学领域的概念，公理是你不需要去证明的，它就是你的终极意义，确定下来就不用再去怀疑，遇到的事情对你来说有没有意义，反而要用这个公理去验证。&lt;br>
很多人活在自己的空间里，很少走出去，接触的也不多，陷入循环里，越是没什么兴趣，就越想去娱乐自己，天天刷抖音、头条、玩游戏等，打发时间，这样接触和体验就越少、越局限于一些无意义的小领域。&lt;br>
如果还没找到你的“公理”，遇到很多事尽量不要拒绝，去尝试，不要退缩。而且很多机会也是这么来的，一直待在自己舒适圈里，碰到的机会肯定不会多。&lt;br>
另外，体验或接触新领域，也意味着要行动，而不是碰到就了解下，这不叫体验，顶多叫看到。&lt;/p>
&lt;h3 id="怎么找到自己的兴趣">怎么找到自己的兴趣
&lt;/h3>&lt;p>其实兴趣本质是一种快乐，你去尝试了、解决了一个个的小问题，然后解决了更大的问题，得到了回报，内部的满足感和外部的金钱等激励，然后兴趣就上来了。&lt;br>
因为体验而发现擅长，因为擅长而产生兴趣，因为获得的激励而增强了动力。&lt;br>
接着反复地做了之后，积累了更多的经验和能力，然后学起相关的知识也比别人快且稳固，觉得自己就是做这块事情的料，兴趣越长久。&lt;/p>
&lt;h3 id="方法论找公理的步骤">方法论：找“公理”的步骤
&lt;/h3>&lt;p>1、每天抽点时间出来，去回想哪些方面或许可以接触到更多的新鲜事，接触到可能感兴趣的事。&lt;br>
2、每周抽时间去体验&lt;br>
3、沉浸到里面，并及时回想、复盘这些事，找更多资料去了解更多，然后再体验、尝试&lt;br>
4、找到其中最有可能是你人生意义的事，扩大范围去增加自己的影响力，用更多的时间和精力去尝试，看是否有可能性。&lt;/p>
&lt;h2 id="作者认为的更高层级的快乐是怎么样">作者认为的更高层级的快乐是怎么样
&lt;/h2>&lt;p>快乐分两类，一种是消费的快乐，另一种是创造的快乐。消费比如你拍照总是讲究用什么高端镜头，结果可能后面就陷入堆装备、跟圈子里的人攀比的快乐去了，买一个高端镜头就快乐一下，明天起来可能就消退了。但如果你花心思去钻研怎么用手机拍出更精致的照片，那注意力就聚焦在技巧上，大部分精力都在思考如果创造出更好的东西，拍出来的照片还能分享到更多的范围被人赞赏等，这种快乐就不一样。&lt;br>
读书其实也是，有些人停留在消费的快乐，听说某本书很流行，立马买了一本，放到书架里，而且整个书架很大、里面放了很多非常受欢迎的书，书架拍下来看都很漂亮，他也会经常站在书架前欣赏这些书。这是把它们当艺术品玩了。另一种快乐，不求多，也不追求读过的数量，而是从一些非常高价值的书里学到很有价值的知识或认知，去改变自己的生活，提升生活品质和职业技能，然后把相关的思想也沉淀下来，分享给别人、影响更多的人，让更多人受益。这于人于己都有重大意义，是你从已有的价值（书）里创造出来的新价值。&lt;/p>
&lt;h3 id="避开消费主义陷阱">避开消费主义陷阱
&lt;/h3>&lt;p>很简单，就问一个问题：&lt;br>
如果全世界除了我之外，没有人知道我拥有它，我还会想要它吗？如果答案是否定的，或者你犹豫了，那你很可能就落入陷阱了。&lt;/p>
&lt;h3 id="创造者视角">创造者视角
&lt;/h3>&lt;p>玩一个游戏，不要沉迷到里面，而是站在创造者的角度思考他设计的这游戏规则，他想要我们怎么通关，我们自己能从中锻炼什么技能（手指灵活度？快速反应能力？）。&lt;br>
进一步地，学了编程，玩游戏的时候，就会想创造者是怎么实现这个效果的。&lt;br>
更进一步，学了心理学，玩的时候则想这游戏背后 作者想怎么吸引大家来玩，有什么心理学上的设计等。&lt;br>
这些都是创造者视角，培养这种视角，会让自己习惯性地抽离出来，去看到全局而不是陷入别人的设计里。做同一个事，关注的角度不一样，会有不同的乐趣和收获。&lt;br>
创造者视角，其实是一种让我们脱离低级的消费快乐的方法，对自己来说是一种创造，如果把相关的思考也沉淀下来，分享出去，对别人来说，也是一种创造。&lt;/p>
&lt;h1 id="四时间精力管理">四、时间&amp;amp;精力管理
&lt;/h1>&lt;h2 id="作者是怎么安排好每天工作的">作者是怎么安排好每天工作的？
&lt;/h2>&lt;h3 id="化零为整">化零为整
&lt;/h3>&lt;p>化零为整，一切安排都要先去想办法挤出整段的时间用于创造。创造是困难的，肯定是需要大段时间去思考和整理，零散的时间见缝插针地做出来的东西，大概率是草率的。腾出整块的时间，然后专注去创造（工作），集中攻克。&lt;br>
作者专注的方法：&lt;/p>
&lt;ul>
&lt;li>把任务拆解，然后每个小任务安排一个倒计时做完&lt;/li>
&lt;li>不强求自己一定要专注，任其自然，走神了再拉回来，从发现到拉回的时间，越来越短之后，专注的时间就越来越长&lt;/li>
&lt;li>任务切换，一段时间后从一个事中抽离出来，安排另一个事，保持思考&lt;/li>
&lt;/ul>
&lt;h3 id="避免时间黑洞">避免时间黑洞
&lt;/h3>&lt;p>把琐事合并起来，集中到一个时间段去做完。&lt;br>
主动休息，如工作半小时就听一会儿音乐，看会儿小说等，不过要给这个放松提前设置个时间，如 15min，时间一到就立马停止。&lt;br>
弄一些小“仪式”再开始，比如开始前先深呼吸然后数到 10。&lt;/p>
&lt;h3 id="做符合长远目标的事">做符合长远目标的事
&lt;/h3>&lt;p>每个周期之后，安排一次复盘，很简单，只要把这段时间做的事都列出来，然后一个个打分，看下离自己的长远目标有多远，越符合分越高。如果发现自己花了很多时间在偏离的方向上，那后续对这个事就要更加警惕。其实我们很多时候都在惯性地做事，当时并不会去思考那个事是否真有意义，只是习惯性地就做了。如果经常复盘，发现了这些问题，后面对它们就会更加警惕。&lt;/p>
&lt;h2 id="作者怎么让自己每天效率爆表">作者怎么让自己每天效率爆表
&lt;/h2>&lt;h3 id="大脑的关联效应">大脑的关联效应
&lt;/h3>&lt;p>大脑喜欢不自觉地建立联系，所以你在不同的场景里会有不同的想法。比如你一坐到沙发上就想看电视，一坐到书桌前可能就想打电脑。因此也可以创造一些场景，比如阳台上的一把小沙发椅，坐上去就想看书。&lt;br>
还有一个点，就是工作桌子不用经常整理，乔布斯的就挺乱的，乱不是问题，每个东西各摆一个地方，甚至堆叠起来，这其实就是一种大脑能记忆的工作场景，你收拾了可能反而会打破场景。&lt;br>
不只是地点，习惯的触发也是一种大脑能自动建立的联系，比如你遇到复杂的事情就会习惯地打开脑图来整理思路，那每次有问题，就打开了脑图，思路自然地就涌出来了，这是大脑的一种场景关联。&lt;br>
所以&lt;strong>状态是可以创造出来的，而不是等出来的&lt;/strong>，虽然是会有一定的影响，但进入状态更多的取决于大脑的关联。&lt;/p>
&lt;h3 id="少量多次冲刺">少量多次冲刺
&lt;/h3>&lt;p>不用追求要专注多长时间，可以把更多地训练自己的快速进入专注状态的能力。&lt;br>
休息的时候，换换脑子，可以整理整理资料，回复下消息，通讯软件可以根据专注的时段来关闭和打开，减少对专注的干扰。&lt;br>
不过有个问题，一旦休息时，大脑的上下文就清空了，所以得让自己能暂存现场，办法就是记录当时做到哪，思路是怎么样的，下一步要干嘛等。等回头来继续工作的时候，很快就可以找到状态，再加上场景的关联，多训练训练，快速进入专注的能力就越来越强了。这实际上可以节省大把的时间，因为分段冲刺后，就多出了很多上下文切换的成本。&lt;/p>
&lt;h2 id="作者是怎么休息来保持精力的">作者是怎么休息来保持精力的
&lt;/h2>&lt;p>首选肯定是睡眠，作者建议每天睡 7.5h，5 个睡眠周期。&lt;br>
其它是一些方法或观念：&lt;br>
1、动脑休息&lt;br>
不要觉得工作这么累了，去刷刷手机放松，其实这只会让自己兴奋，提高了大脑的阈值和期望，不刷了之后会感到无聊，反而影响精力。&lt;br>
我们应该选择继续思考，意志力这东西，你认为是无限的，就可以是无限的，主要还是得通过主动选择去做一些有意义的事，取得成就，让大家保持一定兴奋度和自信。&lt;br>
2、交替工作&lt;br>
掌握好节奏，大概 1 小时休息个 10~15min。番茄工作法有一定的道理，不过不用这么死板，给自己设定个最长时间段，如果超过了就去做点其它事。比如可以拿出问题清单，去思考一些问题有什么解法，这类事情主要是让思维发散，不会像专注时那么耗精力，同时想出一些点子、把事情往前推进几步，也是一种成就，让大脑充满干劲，继续回到原来的工作中、精力充沛的战斗。当然中间去思考问题的那段时间也不能太短，要不然没弄出点什么就切走，大脑反而会一直思考原来的事，甚至会受到打击。&lt;br>
3、放松空间&lt;br>
放松空间，并不是就放空时间、随便度过。&lt;br>
每天早上 1 小时的读书时间，就是我的放松空间。这段时间可以不用管其它事，沉浸到书籍里，去学习、感悟、思考，其它烦恼也不会干扰到我（当然偶尔会因为一些事变得不专心）。&lt;br>
其实晚上也可以借助这个思路，给自己设定一个放松空间，一回家就赶紧把其它必做的事弄完（洗澡、哄娃、其它家务等），然后一闲下来就开始进入这个放松空间。半小时左右的整理、复盘、回顾思考等。&lt;br>
如果还有时间，那再来半小时学习。白天的精力一直波动在较好的水平，到晚上其实并不是就直接下来了，用好这个时间，主动去学习，创造出自己的放松空间。&lt;br>
这是个很虚的概念，说了好像等于没说，但其实是在脑子里创造了一个概念，默默地告诉自己，这个时间段就是固定用来做什么的，习惯了之后，未来就变成了一种“关联”，进入场景后就自然关联起那时该有的状态。比如早上我坐到咖啡厅，一个人，掏出书，大脑自动就关联起来，调出了看书的状态。&lt;br>
4、设定界限&lt;br>
得知道自己这周有哪些非常重要的事，必须要完成，得用多少时间，这些时间是被“锁住”的，然后这周还剩多少时间，心里得有这个大概的度量。&lt;br>
之后有个什么事过来，如果剩下的时间不太够了，那就可能要想办法拒绝、或转手，有这个界限就会让自己有个衡量的标准，而不会一直是迷茫的状态，不清楚做了这个事还有没有时间做其它事。这些事先就要先估好。&lt;br>
事情永远做不完，也不盘的很细，每天要什么事，做完才能回家。算到这么精细反而挺浪费时间和精力，还不如直接就用事先估好的这个“度”去评估每天是否该下班，是否有些事做不完了、得事先去沟通或安排。&lt;/p></description></item><item><title>优化 .git 目录过大的问题</title><link>https://www.jsongo.top/articles/optimize-large-git-directory/</link><pubDate>Sun, 27 Oct 2024 11:31:09 +0800</pubDate><guid>https://www.jsongo.top/articles/optimize-large-git-directory/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/c9b66ea1eb0408c5eedd37d7d3b2ea29.jpg" alt="Featured image of post 优化 .git 目录过大的问题" />&lt;h1 id="优化-git-仓库的存储设置">优化 Git 仓库的存储设置
&lt;/h1>&lt;h2 id="调整-git-gc-参数">调整 &lt;code>git gc&lt;/code> 参数
&lt;/h2>&lt;ul>
&lt;li>原理：&lt;code>git gc&lt;/code>（垃圾回收）命令用于清理 Git 仓库中不必要的文件和优化存储。默认情况下，&lt;code>git gc&lt;/code> 会自动运行，但你可以手动调整它的参数来更好地优化仓库。&lt;/li>
&lt;li>步骤：可以通过增加 &lt;code>--prune = &amp;lt;date&amp;gt;&lt;/code> 参数来指定一个日期，删除在这个日期之前的所有未引用的对象。例如，要删除一年前的未引用对象，可以使用以下命令：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git gc --prune &lt;span class="o">=&lt;/span> &lt;span class="s1">&amp;#39;1 year ago&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>注意事项：这个操作会清理 Git 仓库中的对象，可能会影响到一些历史版本的恢复等功能。所以在使用之前要确保仓库中的历史记录没有重要的未引用对象需要保留。&lt;/li>
&lt;/ul>
&lt;h2 id="使用浅克隆--depth">使用浅克隆（&lt;code>--depth&lt;/code>）
&lt;/h2>&lt;ul>
&lt;li>原理：浅克隆是指只克隆仓库的一部分提交历史，而不是全部。对于一些只需要最新代码的场景，如持续集成环境或者临时开发环境，浅克隆可以大大减少克隆仓库的大小。&lt;/li>
&lt;li>步骤：在克隆仓库时，使用 &lt;code>--depth&lt;/code> 参数来指定克隆的深度。例如，要克隆最近的 10 个提交，可以使用以下命令：&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git clone --depth &lt;span class="m">10&lt;/span> &amp;lt;repository - url&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;ul>
&lt;li>注意事项：浅克隆的仓库不包含完整的提交历史，所以如果需要查看或者恢复更早的提交，就需要重新克隆完整的仓库。并且，浅克隆的仓库在拉取更新时可能会受到一些限制，需要根据实际情况进行调整。&lt;/li>
&lt;/ul></description></item><item><title>清理 mac 电脑磁盘空间</title><link>https://www.jsongo.top/articles/clean-mac-disk-space/</link><pubDate>Thu, 10 Oct 2024 11:31:09 +0800</pubDate><guid>https://www.jsongo.top/articles/clean-mac-disk-space/</guid><description>&lt;img src="https://cdn.lyb.pub/banners/d8418fa48f2cc793c8f63aa13111635f.png" alt="Featured image of post 清理 mac 电脑磁盘空间" />&lt;p>经常遇到磁盘不够的情况，即使我电脑已经是 512G 的磁盘，还是经常遇到磁盘不足的问题。系统就占了 200G 以上，实在太黑盒了，其它部分一不小心就超出了。所以时不时会研究下怎么清理我的电脑。&lt;br>
首先，可以先过一遍电脑中的代码，如果用 node 的话，可以把 node_modules 删一删。&lt;/p>
&lt;h1 id="1-vscode-或-cursor-等">1 、Vscode 或 Cursor 等
&lt;/h1>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">mv &lt;span class="s2">&amp;#34;/Users/bytedance/Library/Application Support/Code/logs&amp;#34;&lt;/span> ~/.Trash
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>除了这个 logs 还有另外两个可能空间占用也比较大的目录：&lt;/p>
&lt;ul>
&lt;li>&lt;strong>CachedData:&lt;/strong>  缓存数据，删除后 Cursor 可能需要重新下载/索引某些数据，导致启动或某些功能变慢。&lt;/li>
&lt;li>&lt;strong>CachedExtensionVSIXs:&lt;/strong>  缓存的扩展程序安装包，删除后 Cursor 可能需要重新下载扩展，影响扩展功能。&lt;br>
有需要也可以删，可能会稍微影响 cursor 下次打开时的性能，但问题不大。&lt;br>
另外 Cursor 和 windsurf 等也一样。&lt;/li>
&lt;/ul>
&lt;h1 id="2清理-git">2、清理 Git
&lt;/h1>&lt;p>有的 git 历史太多，可能有上 G 的内容。可以尝试让 git 自动清理下。&lt;br>
第一步，先用 &lt;code>git reflog expire&lt;/code> 来过期旧的 reflog 条目。例如，过期超过一周的条目&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git reflog expire --expire&lt;span class="o">=&lt;/span>1.week.ago --all
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>然后清理未引用的对象，下面这条命令会删除不需要的对象，并压缩存储库（新 git 版本一般都会做，所以一般这步收益不大，反而因为磁盘不足，压到一半中断，增加了未删除的压缩文件）。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git gc --prune&lt;span class="o">=&lt;/span>1.week.ago
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>进一步的，可以强制垃圾回收（这一步可能会特别慢）。&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">git gc --aggressive --prune&lt;span class="o">=&lt;/span>1.week.ago
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>我试了以上的命令，回收的有限，可能我本地已经有很好的压缩了。&lt;/p>
&lt;h1 id="3处理-obsidian-中的图片等">3、处理 Obsidian 中的图片等
&lt;/h1>&lt;p>如果也使用了 Obsidian 的话，里面可能有些资源会比较大，如你曾经贴过一个较大的视频或几兆的图片，这些都可以做下压缩。&lt;br>
把所有的 png 图片找出来，比如根目录文件，先进入根目录，然后：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ag -g .png$ . &lt;span class="p">|&lt;/span> xargs ls -lh &lt;span class="p">|&lt;/span> awk &lt;span class="s1">&amp;#39;{print $5, $9}&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> sort -hr &lt;span class="p">|&lt;/span> more
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;code>ag&lt;/code> 是 the_silver_searcher 工具，mac 上没这个命令的话，可以自己安装一个。&lt;br>
开始用的好好的，但后来发现有些文件名中带了空格，awk 中用 $9 打印出来的文件名不完整。后来改用 &lt;code>du -h&lt;/code> 来代替 &lt;code>ls -lh&lt;/code>：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ag -0 -g .png$ . &lt;span class="p">|&lt;/span> xargs -0 du -h &lt;span class="p">|&lt;/span> sort -hr
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>好使！&lt;/p>
&lt;h1 id="docker">Docker
&lt;/h1>&lt;p>清理未使用的镜像和：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker image prune -a -f
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>清理停止的容器（确定都没用了再操作）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker container prune
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>当然更绝一点，连 build 的缓存都不要了（谨慎）&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">docker builder prune -a
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h1 id="磁盘">磁盘
&lt;/h1>&lt;p>比较通用的方法是，从系统磁盘中查看哪个目录占用较大，一层层往下分析。&lt;br>
&lt;img src="https://cdn.lyb.pub/2025/04/e2c574e7ab713206354294e0faac5ae1.webp"
loading="lazy"
alt="8ee84296b354d8a922451b7d0e50e8a8_MD5|806x888"
>&lt;br>
每一个都可以点进去看有哪些大文件（它按大小排序）。&lt;br>
当然要更细的话，也可以用命令行，从上往下看某些目录里的占用情况：&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">du -hsx ~/* &lt;span class="p">|&lt;/span> sort -rh &lt;span class="p">|&lt;/span> head -10
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>&lt;img src="https://cdn.lyb.pub/2025/04/bba67c4fef0813913b1399566d099fc7.webp"
loading="lazy"
alt="c63ab378d1ecb0a972305dfab65f9d0c_MD5|806x202"
>&lt;br>
然后找到大文件&lt;/p></description></item><item><title>Archives</title><link>https://www.jsongo.top/page/archives/</link><pubDate>Tue, 28 May 2019 00:00:00 +0000</pubDate><guid>https://www.jsongo.top/page/archives/</guid><description/></item><item><title>Links</title><link>https://www.jsongo.top/page/links/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.jsongo.top/page/links/</guid><description>&lt;h2 id="相关链接">相关链接
&lt;/h2></description></item><item><title>Search</title><link>https://www.jsongo.top/page/search/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://www.jsongo.top/page/search/</guid><description/></item></channel></rss>